"use strict";(this.webpackChunkopensheetmusicdisplay=this.webpackChunkopensheetmusicdisplay||[]).push([[592],{67:(e,t)=>{var i;Object.defineProperty(t,"__esModule",{value:!0}),t.SystemLinePosition=void 0,function(e){e[e.MeasureBegin=0]="MeasureBegin",e[e.MeasureEnd=1]="MeasureEnd"}(i||(t.SystemLinePosition=i={}))},98:(e,t,i)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.GraphicalGlissando=void 0;const s=i(9409),n=i(6438),r=i(6452);t.GraphicalGlissando=class{constructor(e){this.Glissando=e,this.staffEntries=[]}calculateLine(e){const t=this.staffEntries[0],i=this.staffEntries[this.staffEntries.length-1],o=t.findGraphicalNoteFromNote(this.Glissando.StartNote),a=i.findGraphicalNoteFromNote(this.Glissando.EndNote);if(!o&&!a)return;const l=t.parentMeasure.ParentStaffLine;let u,c,h,d;if(o&&t.parentMeasure.ParentStaffLine===this.StaffLine)u=o.PositionAndShape.RelativePosition.x+o.parentVoiceEntry.parentStaffEntry.PositionAndShape.RelativePosition.x+o.parentVoiceEntry.parentStaffEntry.parentMeasure.PositionAndShape.RelativePosition.x+e.GlissandoNoteOffset,h=o.PositionAndShape.AbsolutePosition.y;else{u=i.parentMeasure.beginInstructionsWidth-.4;const t=this.Glissando.Direction===n.ColDirEnum.Down?-1:1;h=a.PositionAndShape.AbsolutePosition.y+t*e.GlissandoStafflineStartYDistanceToNote}if(a&&i.parentMeasure.ParentStaffLine===this.StaffLine)c=a.PositionAndShape.RelativePosition.x+a.parentVoiceEntry.parentStaffEntry.PositionAndShape.RelativePosition.x+a.parentVoiceEntry.parentStaffEntry.parentMeasure.PositionAndShape.RelativePosition.x-.5-e.GlissandoNoteOffset,u>c&&(u=c-e.GlissandoStafflineStartMinimumWidth),d=a.PositionAndShape.AbsolutePosition.y;else{if(l.Measures.last().parentSourceMeasure.HasEndLine)return;c=l.PositionAndShape.Size.width,c-u>e.GlissandoStafflineEndOffset&&(u=c-e.GlissandoStafflineEndOffset);const t=this.Glissando.Direction===n.ColDirEnum.Down?1:-1;d=o.PositionAndShape.AbsolutePosition.y+t*e.GlissandoStafflineStartYDistanceToNote}const m=new s.PointF2D(u,h),f=new s.PointF2D(c,d);void 0===this.Width&&(this.Width=e.GlissandoDefaultWidth),this.Line=new r.GraphicalLine(m,f,this.Width)}}},164:(e,t,i)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.MidiInstrument=t.ClefEnum=t.ClefInstruction=void 0;const s=i(8233),n=i(5364),r=i(8233),o=i(8233),a=i(7307);class l extends n.AbstractNotationInstruction{constructor(e=u.G,t=0,i=2){super(void 0),this.clefType=u.G,this.line=2,this.octaveOffset=0,this.line=i,this.clefType=e,this.octaveOffset=t,this.calcParameters()}static getDefaultClefFromMidiInstrument(e){switch(e){case c.Acoustic_Grand_Piano:case c.Electric_Bass_finger:case c.Electric_Bass_pick:case c.Fretless_Bass:case c.Slap_Bass_1:case c.Slap_Bass_2:case c.Synth_Bass_1:case c.Synth_Bass_2:case c.Contrabass:return new l(u.F,0,4);default:return new l(u.G,0,2)}}static getAllPossibleClefs(){const e=[];for(let t=0;t<=2;t++){const i=new l(u.G,t,2);e.push(i)}for(let t=-2;t<=0;t++){const i=new l(u.F,t,4);e.push(i)}return e}static isSupportedClef(e){switch(e){case u.G:case u.F:case u.C:case u.percussion:case u.TAB:return!0;default:return!1}}get ClefType(){return this.clefType}set ClefType(e){this.clefType=e}get Line(){return this.line}set Line(e){this.line=e}get OctaveOffset(){return this.octaveOffset}set OctaveOffset(e){this.octaveOffset=e}get ClefPitch(){return this.clefPitch}set ClefPitch(e){this.clefPitch=e}get ReferenceCyPosition(){return this.referenceCyPosition}set ReferenceCyPosition(e){this.referenceCyPosition=e}Equals(e){return this===e||!(!this||!e)&&this.clefPitch===e.clefPitch&&this.Line===e.Line}NotEqual(e){return!this.Equals(e)}ToString(){return"ClefType: "+this.clefType}calcParameters(){switch(this.clefType){case u.G:this.clefPitch=new s.Pitch(r.NoteEnum.G,1+this.octaveOffset,o.AccidentalEnum.NONE),this.referenceCyPosition=5-this.line+2;break;case u.F:this.clefPitch=new s.Pitch(r.NoteEnum.F,0+this.octaveOffset,o.AccidentalEnum.NONE),this.referenceCyPosition=5-this.line+1.5;break;case u.C:this.clefPitch=new s.Pitch(r.NoteEnum.C,1+this.octaveOffset,o.AccidentalEnum.NONE),this.referenceCyPosition=5-this.line;break;case u.percussion:this.clefPitch=new s.Pitch(r.NoteEnum.C,2,o.AccidentalEnum.NONE),this.referenceCyPosition=2;break;case u.TAB:this.clefPitch=new s.Pitch(r.NoteEnum.G,0,o.AccidentalEnum.NONE),this.referenceCyPosition=0;break;default:throw new a.ArgumentOutOfRangeException("clefType")}}}var u,c;t.ClefInstruction=l,function(e){e[e.G=0]="G",e[e.F=1]="F",e[e.C=2]="C",e[e.percussion=3]="percussion",e[e.TAB=4]="TAB"}(u||(t.ClefEnum=u={})),function(e){e[e.None=-1]="None",e[e.Acoustic_Grand_Piano=0]="Acoustic_Grand_Piano",e[e.Bright_Acoustic_Piano=1]="Bright_Acoustic_Piano",e[e.Electric_Grand_Piano=2]="Electric_Grand_Piano",e[e.Honky_tonk_Piano=3]="Honky_tonk_Piano",e[e.Electric_Piano_1=4]="Electric_Piano_1",e[e.Electric_Piano_2=5]="Electric_Piano_2",e[e.Harpsichord=6]="Harpsichord",e[e.Clavinet=7]="Clavinet",e[e.Celesta=8]="Celesta",e[e.Glockenspiel=9]="Glockenspiel",e[e.Music_Box=10]="Music_Box",e[e.Vibraphone=11]="Vibraphone",e[e.Marimba=12]="Marimba",e[e.Xylophone=13]="Xylophone",e[e.Tubular_Bells=14]="Tubular_Bells",e[e.Dulcimer=15]="Dulcimer",e[e.Drawbar_Organ=16]="Drawbar_Organ",e[e.Percussive_Organ=17]="Percussive_Organ",e[e.Rock_Organ=18]="Rock_Organ",e[e.Church_Organ=19]="Church_Organ",e[e.Reed_Organ=20]="Reed_Organ",e[e.Accordion=21]="Accordion",e[e.Harmonica=22]="Harmonica",e[e.Tango_Accordion=23]="Tango_Accordion",e[e.Acoustic_Guitar_nylon=24]="Acoustic_Guitar_nylon",e[e.Acoustic_Guitar_steel=25]="Acoustic_Guitar_steel",e[e.Electric_Guitar_jazz=26]="Electric_Guitar_jazz",e[e.Electric_Guitar_clean=27]="Electric_Guitar_clean",e[e.Electric_Guitar_muted=28]="Electric_Guitar_muted",e[e.Overdriven_Guitar=29]="Overdriven_Guitar",e[e.Distortion_Guitar=30]="Distortion_Guitar",e[e.Guitar_harmonics=31]="Guitar_harmonics",e[e.Acoustic_Bass=32]="Acoustic_Bass",e[e.Electric_Bass_finger=33]="Electric_Bass_finger",e[e.Electric_Bass_pick=34]="Electric_Bass_pick",e[e.Fretless_Bass=35]="Fretless_Bass",e[e.Slap_Bass_1=36]="Slap_Bass_1",e[e.Slap_Bass_2=37]="Slap_Bass_2",e[e.Synth_Bass_1=38]="Synth_Bass_1",e[e.Synth_Bass_2=39]="Synth_Bass_2",e[e.Violin=40]="Violin",e[e.Viola=41]="Viola",e[e.Cello=42]="Cello",e[e.Contrabass=43]="Contrabass",e[e.Tremolo_Strings=44]="Tremolo_Strings",e[e.Pizzicato_Strings=45]="Pizzicato_Strings",e[e.Orchestral_Harp=46]="Orchestral_Harp",e[e.Timpani=47]="Timpani",e[e.String_Ensemble_1=48]="String_Ensemble_1",e[e.String_Ensemble_2=49]="String_Ensemble_2",e[e.Synth_Strings_1=50]="Synth_Strings_1",e[e.Synth_Strings_2=51]="Synth_Strings_2",e[e.Choir_Aahs=52]="Choir_Aahs",e[e.Voice_Oohs=53]="Voice_Oohs",e[e.Synth_Voice=54]="Synth_Voice",e[e.Orchestra_Hit=55]="Orchestra_Hit",e[e.Trumpet=56]="Trumpet",e[e.Trombone=57]="Trombone",e[e.Tuba=58]="Tuba",e[e.Muted_Trumpet=59]="Muted_Trumpet",e[e.French_Horn=60]="French_Horn",e[e.Brass_Section=61]="Brass_Section",e[e.Synth_Brass_1=62]="Synth_Brass_1",e[e.Synth_Brass_2=63]="Synth_Brass_2",e[e.Soprano_Sax=64]="Soprano_Sax",e[e.Alto_Sax=65]="Alto_Sax",e[e.Tenor_Sax=66]="Tenor_Sax",e[e.Baritone_Sax=67]="Baritone_Sax",e[e.Oboe=68]="Oboe",e[e.English_Horn=69]="English_Horn",e[e.Bassoon=70]="Bassoon",e[e.Clarinet=71]="Clarinet",e[e.Piccolo=72]="Piccolo",e[e.Flute=73]="Flute",e[e.Recorder=74]="Recorder",e[e.Pan_Flute=75]="Pan_Flute",e[e.Blown_Bottle=76]="Blown_Bottle",e[e.Shakuhachi=77]="Shakuhachi",e[e.Whistle=78]="Whistle",e[e.Ocarina=79]="Ocarina",e[e.Lead_1_square=80]="Lead_1_square",e[e.Lead_2_sawtooth=81]="Lead_2_sawtooth",e[e.Lead_3_calliope=82]="Lead_3_calliope",e[e.Lead_4_chiff=83]="Lead_4_chiff",e[e.Lead_5_charang=84]="Lead_5_charang",e[e.Lead_6_voice=85]="Lead_6_voice",e[e.Lead_7_fifths=86]="Lead_7_fifths",e[e.Lead_8_bass_lead=87]="Lead_8_bass_lead",e[e.Pad_1_new_age=88]="Pad_1_new_age",e[e.Pad_2_warm=89]="Pad_2_warm",e[e.Pad_3_polysynth=90]="Pad_3_polysynth",e[e.Pad_4_choir=91]="Pad_4_choir",e[e.Pad_5_bowed=92]="Pad_5_bowed",e[e.Pad_6_metallic=93]="Pad_6_metallic",e[e.Pad_7_halo=94]="Pad_7_halo",e[e.Pad_8_sweep=95]="Pad_8_sweep",e[e.FX_1_rain=96]="FX_1_rain",e[e.FX_2_soundtrack=97]="FX_2_soundtrack",e[e.FX_3_crystal=98]="FX_3_crystal",e[e.FX_4_atmosphere=99]="FX_4_atmosphere",e[e.FX_5_brightness=100]="FX_5_brightness",e[e.FX_6_goblins=101]="FX_6_goblins",e[e.FX_7_echoes=102]="FX_7_echoes",e[e.FX_8_scifi=103]="FX_8_scifi",e[e.Sitar=104]="Sitar",e[e.Banjo=105]="Banjo",e[e.Shamisen=106]="Shamisen",e[e.Koto=107]="Koto",e[e.Kalimba=108]="Kalimba",e[e.Bag_pipe=109]="Bag_pipe",e[e.Fiddle=110]="Fiddle",e[e.Shanai=111]="Shanai",e[e.Tinkle_Bell=112]="Tinkle_Bell",e[e.Agogo=113]="Agogo",e[e.Steel_Drums=114]="Steel_Drums",e[e.Woodblock=115]="Woodblock",e[e.Taiko_Drum=116]="Taiko_Drum",e[e.Melodic_Tom=117]="Melodic_Tom",e[e.Synth_Drum=118]="Synth_Drum",e[e.Reverse_Cymbal=119]="Reverse_Cymbal",e[e.Guitar_Fret_Noise=120]="Guitar_Fret_Noise",e[e.Breath_Noise=121]="Breath_Noise",e[e.Seashore=122]="Seashore",e[e.Bird_Tweet=123]="Bird_Tweet",e[e.Telephone_Ring=124]="Telephone_Ring",e[e.Helicopter=125]="Helicopter",e[e.Applause=126]="Applause",e[e.Gunshot=127]="Gunshot",e[e.Percussion=128]="Percussion"}(c||(t.MidiInstrument=c={}))},200:(e,t,i)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.RectangleF2D=void 0;const s=i(6864),n=i(9409);class r{constructor(e,t,i,s){this.x=0,this.y=0,this.width=0,this.height=0,this.x=e,this.y=t,this.width=i,this.height=s}static createFromLocationAndSize(e,t){return new r(e.x,e.y,t.width,t.height)}get Location(){return new n.PointF2D(this.x,this.y)}get Size(){return new s.SizeF2D(this.width,this.height)}}t.RectangleF2D=r},242:(e,t)=>{var i,s,n;Object.defineProperty(t,"__esModule",{value:!0}),t.PhonicScoreModes=t.MusicSymbolDrawingStyle=t.DrawingMode=void 0,function(e){e[e.All=0]="All",e[e.NoOverlays=1]="NoOverlays",e[e.Leadsheet=2]="Leadsheet"}(i||(t.DrawingMode=i={})),function(e){e[e.Normal=0]="Normal",e[e.Disabled=1]="Disabled",e[e.Selected=2]="Selected",e[e.Clickable=3]="Clickable",e[e.PlaybackSymbols=4]="PlaybackSymbols",e[e.FollowSymbols=5]="FollowSymbols",e[e.QFeedbackNotFound=6]="QFeedbackNotFound",e[e.QFeedbackOk=7]="QFeedbackOk",e[e.QFeedbackPerfect=8]="QFeedbackPerfect",e[e.Debug1=9]="Debug1",e[e.Debug2=10]="Debug2",e[e.Debug3=11]="Debug3"}(s||(t.MusicSymbolDrawingStyle=s={})),function(e){e[e.Following=0]="Following",e[e.Midi=1]="Midi",e[e.Manual=2]="Manual"}(n||(t.PhonicScoreModes=n={}))},298:(e,t,i)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.StaffLineActivitySymbol=void 0;const s=i(7741),n=i(6438);class r extends s.GraphicalObject{constructor(e){super(),this.parentStaffLine=e;const t=e.PositionAndShape;this.boundingBox=new n.BoundingBox(this,t),this.boundingBox.BorderRight=6,this.boundingBox.BorderBottom=4.5,this.boundingBox.BorderLeft=-1.5,this.boundingBox.BorderTop=-1.5}}t.StaffLineActivitySymbol=r},348:(e,t,i)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.GraphicalStaffEntry=void 0;const s=i(6438),n=i(2561),r=i(7741),o=i(813),a=i(7921);class l extends r.GraphicalObject{constructor(e,t=void 0,i=void 0){super(),this.graphicalChordContainers=[],this.tabStaffEntry=void 0,this.MaxAccidentals=0,this.graphicalInstructions=[],this.ties=[],this.graphicalTies=[],this.lyricsEntries=[],this.parentMeasure=e,this.graphicalVoiceEntries=[],this.sourceStaffEntry=t,i?(this.staffEntryParent=i,this.parentVerticalContainer=i.parentVerticalContainer,this.PositionAndShape=new s.BoundingBox(this,i.PositionAndShape)):this.PositionAndShape=new s.BoundingBox(this,e.PositionAndShape),t&&(this.relInMeasureTimestamp=t.Timestamp),this.FingeringEntries=[]}get GraphicalInstructions(){return this.graphicalInstructions}get GraphicalTies(){return this.graphicalTies}get LyricsEntries(){return this.lyricsEntries}set LyricsEntries(e){this.lyricsEntries=e}getAbsoluteTimestamp(){const e=this.parentMeasure.parentSourceMeasure.AbsoluteTimestamp.clone();return this.relInMeasureTimestamp&&e.Add(this.relInMeasureTimestamp),e}findTieGraphicalNoteFromNote(e){for(const t of this.graphicalVoiceEntries)for(const i of t.notes){const t=i.sourceNote;if(!t.isRest()&&t.Pitch.FundamentalNote===e.Pitch.FundamentalNote&&t.Pitch.Octave===e.Pitch.Octave&&t.getAbsoluteTimestamp().Equals(e.getAbsoluteTimestamp()))return i}}findEndTieGraphicalNoteFromNoteWithStartingSlur(e,t){if(e)for(const i of this.graphicalVoiceEntries)if(i.parentVoiceEntry===e.ParentVoiceEntry)for(const e of i.notes){const i=e.sourceNote;if(i.NoteTie&&-1!==i.NoteSlurs.indexOf(t))return e}}findGraphicalNoteFromGraceNote(e){if(e)for(const t of this.graphicalVoiceEntries)if(t.parentVoiceEntry===e.ParentVoiceEntry)for(const i of t.notes)if(i.sourceNote===e)return i}findGraphicalNoteFromNote(e){if(e)for(const t of this.graphicalVoiceEntries)if(t.parentVoiceEntry===e.ParentVoiceEntry)for(const i of t.notes)if(i.sourceNote===e&&this.getAbsoluteTimestamp().Equals(e.getAbsoluteTimestamp()))return i}getGraphicalNoteDurationFromVoice(e){for(const t of this.graphicalVoiceEntries)if(t.parentVoiceEntry.ParentVoice===e)return t.notes[0].graphicalNoteLength;return new n.Fraction(0,1)}findVoiceEntryGraphicalNotes(e){for(const t of this.graphicalVoiceEntries)if(t.parentVoiceEntry===e)return t.notes}isVoiceEntryPartOfLinkedVoiceEntry(e){if(this.sourceStaffEntry.Link)for(let t=0,i=this.sourceStaffEntry.Link.LinkStaffEntries.length;t<i;++t){const i=this.sourceStaffEntry.Link.LinkStaffEntries[t];if(-1!==i.VoiceEntries.indexOf(e)&&i!==this.sourceStaffEntry)return!0}return!1}findStaffEntryMinNoteLength(){let e=new n.Fraction(Number.MAX_VALUE,1);for(const t of this.graphicalVoiceEntries)for(const i of t.notes){const t=i.graphicalNoteLength;t.lt(e)&&t.GetExpandedNumerator()>0&&(e=t)}return e}findStaffEntryMaxNoteLength(){let e=new n.Fraction(0,1);for(const t of this.graphicalVoiceEntries)for(const i of t.notes){const t=i.graphicalNoteLength;e.lt(t)&&t.GetExpandedNumerator()>0&&(e=t)}return e}findOrCreateGraphicalVoiceEntry(e){for(const t of this.graphicalVoiceEntries)if(t.parentVoiceEntry===e)return t;const t=a.MusicSheetCalculator.symbolFactory.createVoiceEntry(e,this);return this.graphicalVoiceEntries.push(t),t}findOrCreateGraphicalVoiceEntryFromGraphicalNote(e){for(const t of this.graphicalVoiceEntries)if(t===e.parentVoiceEntry)return t;const t=a.MusicSheetCalculator.symbolFactory.createVoiceEntry(e.sourceNote.ParentVoiceEntry,this);return this.graphicalVoiceEntries.push(t),t}addGraphicalNoteToListAtCorrectYPosition(e,t){const i=e.notes;if(0===i.length||t.PositionAndShape.RelativePosition.y<o.CollectionUtil.last(i).PositionAndShape.RelativePosition.y)i.push(t);else for(let e=i.length-1;e>=0;e--){if(i[e].PositionAndShape.RelativePosition.y>t.PositionAndShape.RelativePosition.y){i.splice(e+1,0,t);break}if(0===e){i.splice(0,0,t);break}}}hasOnlyRests(){return this.sourceStaffEntry.hasOnlyRests}getSkylineMin(){const e=this.parentMeasure?.ParentStaffLine.SkyBottomLineCalculator;if(!e)return;const[t,i]=this.getAbsoluteStartAndEnd();return e.getSkyLineMinInRange(t,i)}getHighestYAtEntry(){return this.parentMeasure.ParentStaffLine.PositionAndShape.AbsolutePosition.y+this.getSkylineMin()}getLowestYAtEntry(){return this.parentMeasure.ParentStaffLine.PositionAndShape.AbsolutePosition.y+this.getBottomlineMax()}getBottomlineMax(){const e=this.parentMeasure?.ParentStaffLine.SkyBottomLineCalculator;if(!e)return;const[t,i]=this.getAbsoluteStartAndEnd();return e.getBottomLineMaxInRange(t,i)}getAbsoluteStartAndEnd(){let e=this.PositionAndShape.AbsolutePosition.x;return e-=this.parentMeasure.ParentStaffLine.PositionAndShape.AbsolutePosition.x,[e,e+this.PositionAndShape.Size.width]}}t.GraphicalStaffEntry=l},427:function(e,t,i){var s=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.MusicSheet=t.PlaybackSettings=void 0;const n=i(2561),r=i(9024),o=i(6001),a=i(7435),l=i(5534),u=i(8786),c=i(9713),h=i(2683),d=s(i(3065)),m=i(7533);class f{}t.PlaybackSettings=f;class p{constructor(){this.idString="uninitialized",this.sourceMeasures=[],this.repetitions=[],this.dynListStaves=[],this.timestampSortedDynamicExpressionsList=[],this.timestampSortedTempoExpressionsList=[],this.instrumentalGroups=[],this.instruments=[],this.musicPartManager=void 0,this.musicSheetErrors=new u.MusicSheetErrors,this.staves=[],this.transpose=0,this.defaultStartTempoInBpm=0,this.drawErroneousMeasures=!1,this.hasBeenOpenedForTheFirstTime=!1,this.currentEnrolledPosition=new n.Fraction(0,1),this.MeasureWidthFactor=1,this.playbackSettings=new f,this.playbackSettings.rhythm=new n.Fraction(4,4,0,!1),this.userStartTempoInBPM=100,this.pageWidth=120,this.MusicPartManager=new r.MusicPartManager(this),this.hasBPMInfo=!1}static getIndexFromStaff(e){return e.idInMusicSheet}get SourceMeasures(){return this.sourceMeasures}set SourceMeasures(e){this.sourceMeasures=e}get Repetitions(){return this.repetitions}set Repetitions(e){this.repetitions=e}get DynListStaves(){return this.dynListStaves}get TimestampSortedTempoExpressionsList(){return this.timestampSortedTempoExpressionsList}get TimestampSortedDynamicExpressionsList(){return this.timestampSortedDynamicExpressionsList}get InstrumentalGroups(){return this.instrumentalGroups}get Parts(){return this.instruments}get Instruments(){return this.instruments}get SheetPlaybackSetting(){return this.playbackSettings}set SheetPlaybackSetting(e){this.playbackSettings=e}get DrawErroneousMeasures(){return this.drawErroneousMeasures}set DrawErroneousMeasures(e){this.drawErroneousMeasures=e}get HasBeenOpenedForTheFirstTime(){return this.hasBeenOpenedForTheFirstTime}set HasBeenOpenedForTheFirstTime(e){this.hasBeenOpenedForTheFirstTime=e}InitializeStartTempoInBPM(e){this.userStartTempoInBPM=e}get DefaultStartTempoInBpm(){return this.defaultStartTempoInBpm}set DefaultStartTempoInBpm(e){this.defaultStartTempoInBpm=e,this.InitializeStartTempoInBPM(e)}get Path(){return this.path}set Path(e){this.path=e}get Staves(){return this.staves}get TitleString(){return this.title?this.title.text:""}set TitleString(e){this.Title=new a.Label(e)}get SubtitleString(){return this.subtitle?this.subtitle.text:""}set SubtitleString(e){this.Subtitle=new a.Label(e)}get ComposerString(){return this.composer?this.composer.text:""}set ComposerString(e){this.Composer=new a.Label(e)}get LyricistString(){return this.lyricist?this.lyricist.text:""}set LyricistString(e){this.Lyricist=new a.Label(e)}get CopyrightString(){return this.copyright?this.copyright.text:""}set CopyrightString(e){this.Copyright=new a.Label(e,m.TextAlignmentEnum.CenterBottom,void 0,!0)}get Title(){return this.title}set Title(e){this.title=e}get Subtitle(){return this.subtitle}set Subtitle(e){this.subtitle=e}get Composer(){return this.composer}set Composer(e){this.composer=e}get Lyricist(){return this.lyricist}set Lyricist(e){this.lyricist=e}get Copyright(){return this.copyright}set Copyright(e){this.copyright=e}get Rules(){return this.rules||(d.default.debug("warning: sheet.Rules was undefined. Creating new EngravingRules."),this.rules=new c.EngravingRules),this.rules}set Rules(e){this.rules=e}get SheetErrors(){return this.musicSheetErrors}get SelectionStart(){return this.selectionStart}set SelectionStart(e){this.selectionStart=e.clone(),this.currentEnrolledPosition=e.clone()}get SelectionEnd(){return this.selectionEnd}set SelectionEnd(e){this.selectionEnd=e}set HasBPMInfo(e){this.hasBPMInfo=e}get HasBPMInfo(){return this.hasBPMInfo}addMeasure(e){this.sourceMeasures.push(e),e.measureListIndex=this.sourceMeasures.length-1}checkForInstrumentWithNoVoice(){for(let e=0,t=this.instruments.length;e<t;++e){const t=this.instruments[e];if(0===t.Voices.length){const e=new l.Voice(t,1);t.Voices.push(e)}}}getStaffFromIndex(e){return this.staves[e]}fillStaffList(){let e=0;for(let t=0,i=this.instruments.length;t<i;++t){const i=this.instruments[t];for(let t=0,s=i.Staves.length;t<s;++t){const s=i.Staves[t];s.idInMusicSheet=e,this.staves.push(s),e++}}}get MusicPartManager(){return this.musicPartManager}set MusicPartManager(e){this.musicPartManager=e}getCompleteNumberOfStaves(){let e=0;for(let t=0,i=this.instruments.length;t<i;++t)e+=this.instruments[t].Staves.length;return e}getListOfMeasuresFromIndeces(e,t){const i=[];for(let s=e;s<=t;s++)i.push(this.sourceMeasures[s]);return i}getNextSourceMeasure(e){const t=this.sourceMeasures.indexOf(e);return t===this.sourceMeasures.length-1?e:this.sourceMeasures[t+1]}getFirstSourceMeasure(){return this.sourceMeasures[0]}getLastSourceMeasure(){return this.sourceMeasures[this.sourceMeasures.length-1]}resetAllNoteStates(){const e=this.MusicPartManager.getIterator();for(;!e.EndReached&&e.CurrentVoiceEntries;){for(let t=0,i=e.CurrentVoiceEntries.length;t<i;++t){const i=e.CurrentVoiceEntries[t];for(let e=0,t=i.Notes.length;e<t;++e)i.Notes[e].state=h.NoteState.Normal}e.moveToNext()}}getMusicSheetInstrumentIndex(e){return this.Instruments.indexOf(e)}getGlobalStaffIndexOfFirstStaff(e){const t=this.getMusicSheetInstrumentIndex(e);let i=0;for(let e=0;e<t;e++)i+=this.Instruments[e].Staves.length;return i}setRepetitionNewUserNumberOfRepetitions(e,t){let i=0;for(let s=0;s<this.repetitions.length;s++)if(this.repetitions[s]instanceof o.Repetition){if(e===i){this.repetitions[s].UserNumberOfRepetitions=t;break}i++}}getRepetitionByIndex(e){let t=0;for(let i=0;i<this.repetitions.length;i++)if(this.repetitions[i]instanceof o.Repetition){if(e===t)return this.repetitions[i];t++}}CompareTo(e){return this.Title.text.localeCompare(e.Title.text)}getExpressionsStartTempoInBPM(){if(this.TimestampSortedTempoExpressionsList.length>0){const e=this.TimestampSortedTempoExpressionsList[0];if(e.InstantaneousTempo)return e.InstantaneousTempo.TempoInBpm;if(e.ContinuousTempo)return e.ContinuousTempo.StartTempo}return this.userStartTempoInBPM}get Errors(){return this.musicSheetErrors.measureErrors}get FirstMeasureNumber(){try{return this.getFirstSourceMeasure().MeasureNumber}catch(e){return d.default.info("MusicSheet.FirstMeasureNumber: ",e),0}}get LastMeasureNumber(){try{return this.getLastSourceMeasure().MeasureNumber}catch(e){return d.default.info("MusicSheet.LastMeasureNumber: ",e),0}}get CurrentEnrolledPosition(){return this.currentEnrolledPosition.clone()}set CurrentEnrolledPosition(e){this.currentEnrolledPosition=e.clone()}get Transpose(){return this.transpose}set Transpose(e){this.transpose=e}get FullNameString(){return this.ComposerString+" "+this.TitleString}get IdString(){return this.idString}set IdString(e){this.idString=e}getEnrolledSelectionStartTimeStampWorkaround(){const e=this.MusicPartManager.getIterator(this.SelectionStart);return n.Fraction.createFromFraction(e.CurrentEnrolledTimestamp)}get SheetEndTimestamp(){const e=this.getLastSourceMeasure();return n.Fraction.plus(e.AbsoluteTimestamp,e.Duration)}getSourceMeasureFromTimeStamp(e){for(let t=0,i=this.sourceMeasures.length;t<i;++t){const i=this.sourceMeasures[t];for(let t=0,s=i.VerticalSourceStaffEntryContainers.length;t<s;++t){const s=i.VerticalSourceStaffEntryContainers[t];if(e.Equals(s.getAbsoluteTimestamp()))return i}}return this.findSourceMeasureFromTimeStamp(e)}findSourceMeasureFromTimeStamp(e){for(const t of this.sourceMeasures)if(t.AbsoluteTimestamp.lte(e)&&e.lt(n.Fraction.plus(t.AbsoluteTimestamp,t.Duration)))return t}getVisibleInstruments(){const e=[];for(let t=0,i=this.Instruments.length;t<i;++t){const i=this.Instruments[t];i.Voices.length>0&&i.Voices[0].Visible&&e.push(i)}return e}}t.MusicSheet=p,p.defaultTitle="defaultTitle"},437:(e,t,i)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.OctaveEnum=t.OctaveShift=void 0;const s=i(8233);var n;t.OctaveShift=class{constructor(e,t){this.numberXml=1,this.setOctaveShiftValue(e,t)}get Type(){return this.octaveValue}set Type(e){this.octaveValue=e}get StaffNumber(){return this.staffNumber}set StaffNumber(e){this.staffNumber=e}get ParentStartMultiExpression(){return this.startMultiExpression}set ParentStartMultiExpression(e){this.startMultiExpression=e}get ParentEndMultiExpression(){return this.endMultiExpression}set ParentEndMultiExpression(e){this.endMultiExpression=e}setOctaveShiftValue(e,t){this.octaveValue=1===t&&"down"===e?n.VA8:1===t&&"up"===e?n.VB8:2===t&&"down"===e?n.MA15:2===t&&"up"===e?n.MB15:n.NONE}static getPitchFromOctaveShift(e,t){if(!e)return;if(e.OctaveShiftApplied)return e;let i=e.Octave;switch(t){case n.VA8:i-=1;break;case n.VB8:i+=1;break;case n.MA15:i-=2;break;case n.MB15:i+=2;break;case n.NONE:default:i+=0}const r=new s.Pitch(e.FundamentalNote,i,e.Accidental);return r.OctaveShiftApplied=!0,r}},function(e){e[e.VA8=0]="VA8",e[e.VB8=1]="VB8",e[e.MA15=2]="MA15",e[e.MB15=3]="MB15",e[e.NONE=4]="NONE"}(n||(t.OctaveEnum=n={}))},469:function(e,t,i){var s=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.VoiceGenerator=void 0;const n=i(4249),r=i(5534),o=i(1336),a=i(1850),l=i(2369),u=i(8365),c=i(5274),h=i(2257),d=i(4268),m=i(2561),f=i(2148),p=i(6030),S=i(7307),g=i(8233),y=i(8233),E=i(6644),M=s(i(3065)),b=i(8233),P=i(813),L=i(4127),v=i(4064),T=i(4236),x=i(5282),A=i(9647),I=i(6362);t.VoiceGenerator=class{constructor(e,t,i,s,o=void 0){this.openBeams=[],this.beamNumberOffset=0,this.currentOctaveShift=0,this.tupletDict={},this.openTupletNumber=0,this.staff=t,this.instrument=t.ParentInstrument,this.musicSheet=this.instrument.GetMusicSheet,this.slurReader=s,this.pluginManager=e,this.voice=o?new n.LinkedVoice(this.instrument,i,o):new r.Voice(this.instrument,i),this.instrument.Voices.push(this.voice),this.staff.Voices.push(this.voice),this.lyricsReader=new p.LyricsReader(this.musicSheet),this.articulationReader=new L.ArticulationReader(this.musicSheet.Rules)}get openTieDict(){return this.staff.openTieDict}get GetVoice(){return this.voice}get OctaveShift(){return this.currentOctaveShift}set OctaveShift(e){this.currentOctaveShift=e}createVoiceEntry(e,t,i,s=!1,n=!1,r=!1){this.currentVoiceEntry=new o.VoiceEntry(e.clone(),this.voice,t,s,n,r),i&&this.voice.VoiceEntries.push(this.currentVoiceEntry)}read(e,t,i,s,n,r,o,a,l,u,c,d,m,p,S,g,y,E,b,P,L){this.currentStaffEntry=o,this.currentMeasure=a;try{this.currentNote=r?this.addRestNote(e.element("rest"),t,s,i,n,m,p,b):this.addSingleNote(e,t,s,i,n,c,d,m,p,S,g,y,E,b,P),this.currentNote.DotsXml=L;const o=e.elements("lyric");void 0!==this.lyricsReader&&o&&(this.lyricsReader.addLyricEntry(o,this.currentVoiceEntry),this.voice.Parent.HasLyrics=!0);let a=!1;const f=e.element("notations");if(f){this.articulationReader&&this.readArticulations(f,this.currentVoiceEntry,this.currentNote);const t=f.elements("slur"),i=f.elements("slide"),s=f.elements("glissando");void 0!==this.slurReader&&(t.length>0||i.length>0)&&!this.currentNote.ParentVoiceEntry.IsGrace&&(this.slurReader.addSlur(t,this.currentNote),i.length>0&&this.slurReader.addSlur(i,this.currentNote),s.length>0&&this.slurReader.addSlur(s,this.currentNote));const n=f.elements("tuplet");n.length>0&&(this.openTupletNumber=this.addTuplet(e,n),a=!0);const r=f.element("arpeggiate");if(void 0!==r){let e;if(this.currentVoiceEntry.Arpeggio)e=this.currentVoiceEntry.Arpeggio;else{let t=!1;for(const i of this.currentStaffEntry.VoiceEntries)if(i.Arpeggio){t=!0,e=i.Arpeggio;break}if(!t){let t=T.ArpeggioType.ARPEGGIO_DIRECTIONLESS;const i=r.attribute("direction");if(i)switch(i.value){case"up":t=T.ArpeggioType.ROLL_UP;break;case"down":t=T.ArpeggioType.ROLL_DOWN;break;default:t=T.ArpeggioType.ARPEGGIO_DIRECTIONLESS}e=new T.Arpeggio(this.currentVoiceEntry,t),this.currentVoiceEntry.Arpeggio=e}}e.addNote(this.currentNote)}const o=f.elements("tied");o.length>0&&this.addTie(o,l,u,h.TieTypes.SIMPLE);const c=f.element("technical");if(c){const e=c.elements("hammer-on");e.length>0&&this.addTie(e,l,u,h.TieTypes.HAMMERON);const t=c.elements("pull-off");t.length>0&&this.addTie(t,l,u,h.TieTypes.PULLOFF)}}void 0===e.element("time-modification")||a||this.handleTimeModificationNode(e)}catch(e){M.default.warn(e);const t=f.ITextTranslation.translateText("ReaderErrorMessages/NoteError","Ignored erroneous Note.");this.musicSheet.SheetErrors.pushMeasureError(t),this.musicSheet.SheetErrors.pushMeasureError(e)}return this.currentNote}checkForStaffEntryLink(e,t,i,s){const n=new E.StaffEntryLink(this.currentVoiceEntry);n.LinkStaffEntries.push(i),i.Link=n;const r=this.currentVoiceEntry.Timestamp.clone(),o=s.getVerticalContainerByTimestamp(r);return(i=o.StaffEntries[e])||(i=new l.SourceStaffEntry(o,t),o.StaffEntries[e]=i),i.VoiceEntries.push(this.currentVoiceEntry),n.LinkStaffEntries.push(i),i.Link=n,i}checkForOpenBeam(){this.openBeams.length>0&&this.currentNote&&this.handleOpenBeam()}checkOpenTies(){const e=this.openTieDict;for(const t in e)if(e.hasOwnProperty(t)){const i=e[t];m.Fraction.plus(i.StartNote.ParentStaffEntry.Timestamp,i.Duration).lt(i.StartNote.SourceMeasure.Duration)&&delete e[t]}}hasVoiceEntry(){return void 0!==this.currentVoiceEntry}readArticulations(e,t,i){const s=e.element("articulations");s&&this.articulationReader.addArticulationExpression(s,t);const n=e.element("fermata");n&&this.articulationReader.addFermata(n,t);const r=e.element("technical");r&&this.articulationReader.addTechnicalArticulations(r,t,i);const o=e.element("ornaments");o&&this.articulationReader.addOrnament(o,t)}addSingleNote(e,t,i,s,n,r,l,u,c,h,d,p,E,P,L){let T,x,I,w,N=0,C=g.AccidentalEnum.NONE,R=y.NoteEnum.C,B=y.NoteEnum.C,D=0,F=0;const V=e.elements();for(let e=0,t=V.length;e<t;++e){const t=V[e];try{if("pitch"===t.name){const e=t.elements();for(let t=0,i=e.length;t<i;++t){const i=e[t];I=void 0,w=void 0;try{if("step"===i.name){if(R=y.NoteEnum[i.value],void 0===R){const e=f.ITextTranslation.translateText("ReaderErrorMessages/NotePitchError","Invalid pitch while reading note.");throw this.musicSheet.SheetErrors.pushMeasureError(e),new S.MusicSheetReadingException(e,void 0)}}else if("alter"===i.name){if(N=parseFloat(i.value),isNaN(N)){const e=f.ITextTranslation.translateText("ReaderErrorMessages/NoteAlterationError","Invalid alteration while reading note.");throw this.musicSheet.SheetErrors.pushMeasureError(e),new S.MusicSheetReadingException(e,void 0)}C=b.Pitch.AccidentalFromHalfTones(N)}else if("octave"===i.name&&(D=parseInt(i.value,10),isNaN(D))){const e=f.ITextTranslation.translateText("ReaderErrorMessages/NoteOctaveError","Invalid octave value while reading note.");throw this.musicSheet.SheetErrors.pushMeasureError(e),new S.MusicSheetReadingException(e,void 0)}}catch(e){M.default.info("VoiceGenerator.addSingleNote read Step: ",e.message)}}}else if("accidental"===t.name)T=t.value,"natural"===T?C=g.AccidentalEnum.NATURAL:"slash-flat"===T?C=g.AccidentalEnum.SLASHFLAT:"slash-quarter-sharp"===T?C=g.AccidentalEnum.SLASHQUARTERSHARP:"slash-sharp"===T?C=g.AccidentalEnum.SLASHSHARP:"double-slash-flat"===T?C=g.AccidentalEnum.DOUBLESLASHFLAT:"sori"===T?C=g.AccidentalEnum.SORI:"koron"===T&&(C=g.AccidentalEnum.KORON);else if("unpitched"===t.name){const e=t.element("display-step"),i=t.element("display-octave");if(i&&(D=parseInt(i.value,10),F=D-3,l&&(D+=1),1===this.instrument.Staves[0].StafflineCount&&(F+=1)),e){R=y.NoteEnum[e.value.toUpperCase()];let t=0,i=this.musicSheet.Rules.PercussionXMLDisplayStepNoteValueShift;1===this.instrument.Staves[0].StafflineCount&&(i-=3),[B,t]=b.Pitch.lineShiftFromNoteEnum(R,i),F+=t}}else"instrument"===t.name?t.firstAttribute&&(x=t.firstAttribute.value):"notehead"===t.name&&(I=t.value,t.attribute("filled")&&(w="yes"===t.attribute("filled").value))}catch(e){M.default.info("VoiceGenerator.addSingleNote: ",e)}}D-=b.Pitch.OctaveXmlDifference;const O=new b.Pitch(R,D,C,T),_=m.Fraction.createFromFraction(t);let k,G=-1,W=-1;const H=[],U=e.element("notations");if(U){const e=U.element("technical");if(e){const t=e.element("string");t&&(G=parseInt(t.value,10));const i=e.element("fret");i&&(W=parseInt(i.value,10)),e.elements("bend").forEach(function(e){const t=e.element("bend-alter");void 0!==e.element("release")?H.push({bendalter:parseInt(t.value,10),direction:"down"}):H.push({bendalter:parseInt(t.value,10),direction:"up"})})}}return k=G<0||W<0?new a.Note(this.currentVoiceEntry,this.currentStaffEntry,_,O,this.currentMeasure):new A.TabNote(this.currentVoiceEntry,this.currentStaffEntry,_,O,this.currentMeasure,G,W,H,L),this.addNoteInfo(k,i,u,c,n,B,F,P,P),k.TypeLength=s,k.IsGraceNote=h,k.StemDirectionXml=d,k.TremoloInfo=p,k.PlaybackInstrumentId=x,(void 0!==I&&"normal"!==I||void 0!==w)&&(k.Notehead=new v.Notehead(k,I,w)),d===o.StemDirectionType.None&&(E="#00000000"),this.currentVoiceEntry.Notes.push(k),this.currentVoiceEntry.StemDirectionXml=d,E&&(this.currentVoiceEntry.StemColorXml=E,this.currentVoiceEntry.StemColor=E,k.StemColorXml=E),e.elements("beam")&&!r&&this.createBeam(e,k),k}addRestNote(e,t,i,s,n,r,o,l){const u=m.Fraction.createFromFraction(t),c=e.element("display-step"),h=e.element("display-octave");let d,f,p;c&&h&&(d=y.NoteEnum[c.value.toUpperCase()],f=parseInt(h.value,10),p=new b.Pitch(d,f,g.AccidentalEnum.NONE,void 0,!0));const S=new a.Note(this.currentVoiceEntry,this.currentStaffEntry,u,p,this.currentMeasure,!0);return this.addNoteInfo(S,i,r,o,n,d,f,l,l),S.TypeLength=s,this.currentVoiceEntry.Notes.push(S),this.openBeams.length>0&&this.openBeams.last().ExtendedNoteList.push(S),S}addNoteInfo(e,t,i,s,n,r,o,a,l){e.NoteTypeXml=t,e.PrintObject=i,e.IsCueNote=s,e.NormalNotes=n,e.displayStepUnpitched=r,e.displayOctaveUnpitched=o,e.NoteheadColorXml=a,e.NoteheadColor=a}createBeam(e,t){try{const i=e.element("beam");let s;if(void 0!==i&&i.hasAttributes&&(s=i.attribute("number")),s){let i=parseInt(s.value,10);const n=e.elements("beam"),r=n[0].value;n&&("begin"===r?(i===this.openBeams.last()?.BeamNumber?(this.beamNumberOffset++,i+=this.beamNumberOffset):this.openBeams.last()&&this.handleOpenBeam(),this.openBeams.push(new u.Beam(i,this.beamNumberOffset))):i+=this.beamNumberOffset);let o=!1;if(!(i>0&&i<=this.openBeams.length&&this.openBeams[i-1]))return void M.default.debug("[OSMD] invalid beamnumber");for(let e=0,t=this.openBeams[i-1].Notes.length;e<t;++e){const t=this.openBeams[i-1].Notes[e];this.currentVoiceEntry===t.ParentVoiceEntry&&(o=!0)}o||(this.openBeams[i-1].addNoteToBeam(t),"end"===r&&this.endBeam())}}catch(e){const t=f.ITextTranslation.translateText("ReaderErrorMessages/BeamError","Error while reading beam.");throw this.musicSheet.SheetErrors.pushMeasureError(t),new S.MusicSheetReadingException("",e)}}endBeam(){this.openBeams.pop(),this.beamNumberOffset=Math.max(0,this.beamNumberOffset-1)}handleOpenBeam(){const e=this.openBeams.last();if(0!==e.Notes.length){if(1===e.Notes.length)return e.Notes[0].NoteBeam=void 0,void this.endBeam();if(this.currentNote===P.CollectionUtil.last(e.Notes))this.endBeam();else{const t=P.CollectionUtil.last(e.Notes).ParentStaffEntry,i=this.currentMeasure.getVerticalContainerIndexByTimestamp(t.Timestamp),s=t.VerticalContainerParent.StaffEntries.indexOf(t);if(i<this.currentMeasure.VerticalSourceStaffEntryContainers.length-1){const e=this.currentMeasure.VerticalSourceStaffEntryContainers[i+1].StaffEntries[s];if(e)for(let t=0,i=e.VoiceEntries.length;t<i;++t){const i=e.VoiceEntries[t];if(i.ParentVoice===this.voice){const e=i.Notes[0];e.Length.lte(new m.Fraction(1,8))?(this.openBeams.last().addNoteToBeam(e),this.endBeam()):this.endBeam()}}}else this.endBeam()}}else this.endBeam()}addTuplet(e,t){let i,s=!1;if(void 0!==t&&t.length>1){let n=e.element("time-modification");n&&(n=n.element("actual-notes"));const r=t;for(let t=0,a=r.length;t<a;++t){const a=r[t];if(void 0!==a&&a.attributes()){const t=a.attribute("bracket");t&&"yes"===t.value?(s=!0,i=!0):t&&"no"===t.value&&(i=!1);const r=this.readShowNumberNoneGiven(a),l=a.attribute("type");if(l&&"start"===l.value){let t=1;a.attribute("number")&&(t=parseInt(a.attribute("number").value,10));let o=0;if(n&&(o=parseInt(n.value,10),isNaN(o))){const e=f.ITextTranslation.translateText("ReaderErrorMessages/TupletNoteDurationError","Invalid tuplet note duration.");throw this.musicSheet.SheetErrors.pushMeasureError(e),new S.MusicSheetReadingException(e,void 0)}const l=new d.Tuplet(o,s);l.BracketedXmlValue=i,l.ShowNumberNoneGivenInXml=r,l.tupletLabelNumberPlacement=I.PlacementEnum.Above;const u=a.attribute("placement");u&&("below"===u.value&&(l.tupletLabelNumberPlacement=I.PlacementEnum.Below),l.PlacementFromXml=!0),this.tupletDict[t]&&(delete this.tupletDict[t],0===Object.keys(this.tupletDict).length?this.openTupletNumber=0:Object.keys(this.tupletDict).length>1&&this.openTupletNumber--),this.tupletDict[t]=l;const c=[];c.push(this.currentNote),l.Notes.push(c),l.Fractions.push(this.getTupletNoteDurationFromType(e)),this.currentNote.NoteTuplet=l,this.openTupletNumber=t}else if("stop"===l.value){let t=1;a.attribute("number")&&(t=parseInt(a.attribute("number").value,10));const i=this.tupletDict[t];if(i){const s=a.attribute("placement");s&&("below"===s.value?i.tupletLabelNumberPlacement=I.PlacementEnum.Below:i.tupletLabelNumberPlacement=I.PlacementEnum.Above,i.PlacementFromXml=!0);const n=[];if(n.push(this.currentNote),i.Notes.push(n),!i.PlacementFromXml){let e=!1;for(const t of i.Notes){for(const s of t)if(!s.isRest()){s.StemDirectionXml===o.StemDirectionType.Down?i.tupletLabelNumberPlacement=I.PlacementEnum.Below:i.tupletLabelNumberPlacement=I.PlacementEnum.Above,e=!0;break}if(e)break}}i.Fractions.push(this.getTupletNoteDurationFromType(e)),this.currentNote.NoteTuplet=i,delete this.tupletDict[t],0===Object.keys(this.tupletDict).length?this.openTupletNumber=0:Object.keys(this.tupletDict).length>1&&this.openTupletNumber--}}}}}else if(t[0]){const n=t[0];if(n.hasAttributes){const t=n.attribute("type").value;let r=1;n.attribute("number")&&(r=parseInt(n.attribute("number").value,10));const a=isNaN(r),l=this.readShowNumberNoneGiven(n),u=n.attribute("bracket");if(u&&"yes"===u.value?(s=!0,i=!0):u&&"no"===u.value&&(i=!1),"start"===t){let t=0,o=e.element("time-modification");if(o&&(o=o.element("actual-notes")),o&&(t=parseInt(o.value,10),isNaN(t))){const e=f.ITextTranslation.translateText("ReaderErrorMessages/TupletNoteDurationError","Invalid tuplet note duration.");throw this.musicSheet.SheetErrors.pushMeasureError(e),new S.MusicSheetReadingException(e)}a&&(this.openTupletNumber++,r=this.openTupletNumber);let u=this.tupletDict[r];u||(u=this.tupletDict[r]=new d.Tuplet(t,s),u.BracketedXmlValue=i,u.ShowNumberNoneGivenInXml=l,u.tupletLabelNumberPlacement=I.PlacementEnum.Above);const c=n.attribute("placement");c&&("below"===c.value?u.tupletLabelNumberPlacement=I.PlacementEnum.Below:u.tupletLabelNumberPlacement=I.PlacementEnum.Above,u.PlacementFromXml=!0);const h=[];h.push(this.currentNote),u.Notes.push(h),u.Fractions.push(this.getTupletNoteDurationFromType(e)),this.currentNote.NoteTuplet=u,this.openTupletNumber=r}else if("stop"===t){a&&(r=this.openTupletNumber);const t=this.tupletDict[this.openTupletNumber];if(t){const i=n.attribute("placement");i&&("below"===i.value?t.tupletLabelNumberPlacement=I.PlacementEnum.Below:t.tupletLabelNumberPlacement=I.PlacementEnum.Above,t.PlacementFromXml=!0);const s=[];if(s.push(this.currentNote),t.Notes.push(s),!t.PlacementFromXml){let e=!1;for(const i of t.Notes){for(const s of i)if(!s.isRest()){s.StemDirectionXml===o.StemDirectionType.Down?t.tupletLabelNumberPlacement=I.PlacementEnum.Below:t.tupletLabelNumberPlacement=I.PlacementEnum.Above,e=!0;break}if(e)break}}t.Fractions.push(this.getTupletNoteDurationFromType(e)),this.currentNote.NoteTuplet=t,0===Object.keys(this.tupletDict).length?this.openTupletNumber=0:Object.keys(this.tupletDict).length>1&&this.openTupletNumber--,delete this.tupletDict[r]}}}}return this.openTupletNumber}readShowNumberNoneGiven(e){const t=e.attribute("show-number");return!(!t?.value||"none"!==t.value)}handleTimeModificationNode(e){if(this.tupletDict[this.openTupletNumber])try{const t=this.tupletDict[this.openTupletNumber],i=P.CollectionUtil.last(t.Notes);let s;i[0].ParentVoiceEntry.Timestamp.Equals(this.currentVoiceEntry.Timestamp)?s=i:(s=[],t.Notes.push(s),t.Fractions.push(this.getTupletNoteDurationFromType(e))),s.push(this.currentNote),this.currentNote.NoteTuplet=t}catch(e){const t=f.ITextTranslation.translateText("ReaderErrorMessages/TupletNumberError","Invalid tuplet number.");throw this.musicSheet.SheetErrors.pushMeasureError(t),e}else if(this.currentVoiceEntry.Notes.length>0){const e=this.currentVoiceEntry.Notes[0];if(e.NoteTuplet){const t=e.NoteTuplet;P.CollectionUtil.last(t.Notes).push(this.currentNote),this.currentNote.NoteTuplet=t}}}addTie(e,t,i,s){if(e)if(1===e.length){const t=e[0];if(void 0!==t&&t.attributes()){const e=this.getTieDirection(t),i=t.attribute("type").value;try{if("start"===i){const t=this.findCurrentNoteInTieDict(this.currentNote);t<0&&delete this.openTieDict[t];const i=this.getNextAvailableNumberForTie(),n=new c.Tie(this.currentNote,s);this.openTieDict[i]=n,n.TieNumber=i,n.TieDirection=e}else if("stop"===i){const e=this.findCurrentNoteInTieDict(this.currentNote),t=this.openTieDict[e];t&&(t.AddNote(this.currentNote),delete this.openTieDict[e])}}catch(e){const t=f.ITextTranslation.translateText("ReaderErrorMessages/TieError","Error while reading tie.");this.musicSheet.SheetErrors.pushMeasureError(t)}}}else if(2===e.length){const t=this.findCurrentNoteInTieDict(this.currentNote);if(t>=0){const i=this.openTieDict[t];i.AddNote(this.currentNote);for(const t of e)if("start"===t.attribute("type").value){const e=this.getTieDirection(t);i.NoteIndexToTieDirection[i.Notes.length-1]=e}}}}getTieDirection(e){let t=I.PlacementEnum.NotYetDefined;const i=e.attribute("placement");i&&("above"===i.value?t=I.PlacementEnum.Above:"below"===i.value&&(t=I.PlacementEnum.Below));const s=e.attribute("orientation");return s&&("over"===s.value?t=I.PlacementEnum.Above:"under"===s.value&&(t=I.PlacementEnum.Below)),t}getNextAvailableNumberForTie(){const e=Object.keys(this.openTieDict);if(0===e.length)return 1;e.sort((e,t)=>+e-+t);for(let t=0;t<e.length;t++)if(""+(t+1)!==e[t])return t+1;return+e[e.length-1]+1}findCurrentNoteInTieDict(e){const t=this.openTieDict;for(const i in t)if(t.hasOwnProperty(i)){const s=t[i],n=s.Notes[0],r=e;if(s.Pitch.FundamentalNote===e.Pitch.FundamentalNote&&s.Pitch.Octave===e.Pitch.Octave)return parseInt(i,10);if(void 0!==n.StringNumberTab&&n.StringNumberTab===r.StringNumberTab)return parseInt(i,10)}return-1}getTupletNoteDurationFromType(e){if(e.element("type")){const t=e.element("type");if(t){const e=t.value;try{return x.NoteTypeHandler.getNoteDurationFromType(e)}catch(e){const t=f.ITextTranslation.translateText("ReaderErrorMessages/NoteDurationError","Invalid note duration.");throw this.musicSheet.SheetErrors.pushMeasureError(t),new S.MusicSheetReadingException("",e)}}}}}},474:function(e,t,i){var s=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.MusicPartManagerIterator=void 0;const n=i(2561),r=i(1110),o=i(9288),a=i(5875),l=s(i(3065));class u{constructor(e,t,i){this.currentMeasureIndex=0,this.currentPartIndex=0,this.currentVoiceEntryIndex=-1,this.currentDynamicEntryIndex=0,this.currentTempoEntryIndex=0,this.currentDynamicChangingExpressions=[],this.currentRepetition=void 0,this.endReached=!1,this.frontReached=!1,this.currentTimeStamp=new n.Fraction(0,1),this.currentEnrolledMeasureTimestamp=new n.Fraction(0,1),this.currentRelativeInMeasureTimestamp=new n.Fraction(0,1),this.currentVerticalContainerInMeasureTimestamp=new n.Fraction(0,1),this.jumpResponsibleRepetition=void 0,this.activeDynamicExpressions=[],this.SkipInvisibleNotes=!0;try{this.frontReached=!0,this.musicSheet=e,this.currentVoiceEntries=void 0,this.frontReached=!1;for(const e of this.musicSheet.Repetitions)this.setRepetitionIterationCount(e,1);if(this.activeDynamicExpressions=new Array(this.musicSheet.getCompleteNumberOfStaves()),this.currentMeasure=this.musicSheet.SourceMeasures[0],!t)return;do{this.moveToNext()}while((!this.currentVoiceEntries||this.currentTimeStamp.lt(t))&&!this.endReached);for(let e=0;e<this.activeDynamicExpressions.length;e++)if(this.activeDynamicExpressions[e])if(this.activeDynamicExpressions[e]instanceof a.ContinuousDynamicExpression){const t=this.activeDynamicExpressions[e];this.currentDynamicChangingExpressions.push(new r.DynamicsContainer(t,e))}else{const t=this.activeDynamicExpressions[e];this.currentDynamicChangingExpressions.push(new r.DynamicsContainer(t,e))}this.currentTempoChangingExpression=this.activeTempoExpression}catch(e){l.default.info("MusicPartManagerIterator: "+e)}}get EndReached(){return this.endReached}get FrontReached(){return this.frontReached}get CurrentMeasure(){return this.currentMeasure}get CurrentRepetition(){return this.currentRepetition}get CurrentRepetitionIteration(){return this.CurrentRepetition?this.getRepetitionIterationCount(this.CurrentRepetition):0}get CurrentJumpResponsibleRepetitionIterationBeforeJump(){return this.jumpResponsibleRepetition?this.getRepetitionIterationCount(this.jumpResponsibleRepetition)-1:0}get CurrentBpm(){return this.currentBpm}get CurrentVoiceEntries(){return this.currentVoiceEntries}get CurrentMeasureIndex(){return this.currentMeasureIndex}get CurrentEnrolledTimestamp(){return n.Fraction.plus(this.currentEnrolledMeasureTimestamp,this.currentVerticalContainerInMeasureTimestamp)}get CurrentSourceTimestamp(){return this.currentTimeStamp}get CurrentRelativeInMeasureTimestamp(){return this.currentRelativeInMeasureTimestamp}get JumpOccurred(){return this.backJumpOccurred||this.forwardJumpOccurred}get ActiveTempoExpression(){return this.activeTempoExpression}get ActiveDynamicExpressions(){return this.activeDynamicExpressions}get CurrentTempoChangingExpression(){return this.currentTempoChangingExpression}get JumpResponsibleRepetition(){return this.jumpResponsibleRepetition}clone(e=void 0,t=void 0){const i=new u(this.musicSheet,e??this.currentTimeStamp,t);return i.currentVoiceEntryIndex=this.currentVoiceEntryIndex,i.currentMappingPart=this.currentMappingPart,i.currentPartIndex=this.currentPartIndex,i.currentVoiceEntries=this.currentVoiceEntries,i.endReached=this.endReached,i.frontReached=this.frontReached,i}CurrentVisibleVoiceEntries(e){const t=[];if(!this.currentVoiceEntries)return t;if(e){for(const i of this.currentVoiceEntries)i.ParentVoice.Parent.IdString===e.IdString&&this.getVisibleEntries(i,t);return t}for(const e of this.currentVoiceEntries)this.getVisibleEntries(e,t);return t}CurrentAudibleVoiceEntries(e){const t=[];if(!this.currentVoiceEntries)return t;if(e){for(const i of this.currentVoiceEntries)if(i.ParentVoice.Parent.IdString===e.IdString)return this.getAudibleEntries(i,t),t}else for(const e of this.currentVoiceEntries)this.getAudibleEntries(e,t);return t}getCurrentDynamicChangingExpressions(){return this.currentDynamicChangingExpressions}CurrentScoreFollowingVoiceEntries(e){const t=[];if(!this.currentVoiceEntries)return t;if(e){for(const i of this.currentVoiceEntries)if(i.ParentVoice.Parent.IdString===e.IdString)return this.getScoreFollowingEntries(i,t),t}else for(const e of this.currentVoiceEntries)this.getScoreFollowingEntries(e,t);return t}moveToPrevious(){this.frontReached||(this.currentVoiceEntries&&(this.currentVoiceEntries=[]),this.recursiveMoveBack())}moveToPreviousVisibleVoiceEntry(e){for(;!this.frontReached;)if(this.moveToPrevious(),this.checkEntries(e))return}moveToNext(){this.forwardJumpOccurred=this.backJumpOccurred=!1,this.endReached||(this.frontReached&&(this.frontReached=!1,this.currentVoiceEntryIndex=-1),this.currentVoiceEntries&&(this.currentVoiceEntries=[]),this.recursiveMove(),this.currentMeasure||(this.currentTimeStamp=new n.Fraction(99999,1),this.currentMeasure=this.musicSheet.SourceMeasures.last()))}moveToNextVisibleVoiceEntry(e){for(;!this.endReached;)if(this.moveToNext(),this.checkEntries(e))return}resetRepetitionIterationCount(e){return this.setRepetitionIterationCount(e,1),1}incrementRepetitionIterationCount(e){return-1===this.repetitionIterationCountDictKeys.indexOf(e)?this.setRepetitionIterationCount(e,1):this.setRepetitionIterationCount(e,this.getRepetitionIterationCount(e)+1)}setRepetitionIterationCount(e,t){const i=this.repetitionIterationCountDictKeys.indexOf(e);return-1===i?(this.repetitionIterationCountDictKeys.push(e),this.repetitionIterationCountDictValues.push(t)):this.repetitionIterationCountDictValues[i]=t,t}getRepetitionIterationCount(e){const t=this.repetitionIterationCountDictKeys.indexOf(e);if(-1!==t)return this.repetitionIterationCountDictValues[t]}handleRepetitionsAtMeasureBegin(){for(let e=0,t=this.currentMeasure.FirstRepetitionInstructions.length;e<t;++e){const t=this.currentMeasure.FirstRepetitionInstructions[e];if(!t.parentRepetition)continue;const i=t.parentRepetition;this.currentRepetition=i,i.StartIndex===this.currentMeasureIndex&&void 0!==this.JumpResponsibleRepetition&&i!==this.JumpResponsibleRepetition&&i.StartIndex>=this.JumpResponsibleRepetition.StartIndex&&i.EndIndex<=this.JumpResponsibleRepetition.EndIndex&&this.resetRepetitionIterationCount(i)}}handleRepetitionsAtMeasureEnd(){for(let e=0,t=this.currentMeasure.LastRepetitionInstructions.length;e<t;++e){const t=this.currentMeasure.LastRepetitionInstructions[e],i=t.parentRepetition;if(i){if(i.BackwardJumpInstructions.indexOf(t)>-1&&this.getRepetitionIterationCount(i)<i.UserNumberOfRepetitions)return this.doBackJump(i),void(this.backJumpOccurred=!0);if(t===i.forwardJumpInstruction){void 0!==this.JumpResponsibleRepetition&&i!==this.JumpResponsibleRepetition&&i.StartIndex>=this.JumpResponsibleRepetition.StartIndex&&i.EndIndex<=this.JumpResponsibleRepetition.EndIndex&&this.resetRepetitionIterationCount(i);const e=i.getForwardJumpTargetForIteration(this.getRepetitionIterationCount(i));if(e>=0)return this.currentMeasureIndex=e,this.currentMeasure=this.musicSheet.SourceMeasures[this.currentMeasureIndex],this.currentVoiceEntryIndex=-1,this.jumpResponsibleRepetition=i,void(this.forwardJumpOccurred=!0);-2===e&&(this.endReached=!0)}}}this.currentMeasureIndex++,void 0!==this.JumpResponsibleRepetition&&this.currentMeasureIndex>this.JumpResponsibleRepetition.EndIndex&&(this.jumpResponsibleRepetition=void 0)}doBackJump(e){this.currentMeasureIndex=e.getBackwardJumpTarget(),this.currentMeasure=this.musicSheet.SourceMeasures[this.currentMeasureIndex],this.currentVoiceEntryIndex=-1,this.incrementRepetitionIterationCount(e),this.jumpResponsibleRepetition=e}activateCurrentRhythmInstructions(){if(void 0!==this.currentMeasure&&this.currentMeasure.FirstInstructionsStaffEntries.length>0&&void 0!==this.currentMeasure.FirstInstructionsStaffEntries[0]){const e=this.currentMeasure.FirstInstructionsStaffEntries[0].Instructions;for(let t=0,i=e.length;t<i;++t){const i=e[t];i instanceof o.RhythmInstruction&&(this.musicSheet.SheetPlaybackSetting.rhythm=i.Rhythm)}}}activateCurrentDynamicOrTempoInstructions(){const e=this.musicSheet.TimestampSortedDynamicExpressionsList;for(;this.currentDynamicEntryIndex>0&&(this.currentDynamicEntryIndex>=e.length||this.CurrentSourceTimestamp.lte(e[this.currentDynamicEntryIndex].parMultiExpression().AbsoluteTimestamp));)this.currentDynamicEntryIndex--;for(;this.currentDynamicEntryIndex<e.length&&e[this.currentDynamicEntryIndex].parMultiExpression().AbsoluteTimestamp.lt(this.CurrentSourceTimestamp);)this.currentDynamicEntryIndex++;for(;this.currentDynamicEntryIndex<e.length&&e[this.currentDynamicEntryIndex].parMultiExpression().AbsoluteTimestamp.Equals(this.CurrentSourceTimestamp);){const t=e[this.currentDynamicEntryIndex],i=t.staffNumber;this.CurrentSourceTimestamp.Equals(t.parMultiExpression().AbsoluteTimestamp)&&(t.continuousDynamicExpression?this.activeDynamicExpressions[i]=t.continuousDynamicExpression:t.instantaneousDynamicExpression&&(this.activeDynamicExpressions[i]=t.instantaneousDynamicExpression)),this.currentDynamicEntryIndex++}this.currentDynamicChangingExpressions=[];for(let e=0;e<this.activeDynamicExpressions.length;e++)if(this.activeDynamicExpressions[e]){let t,i;if(this.activeDynamicExpressions[e]instanceof a.ContinuousDynamicExpression){const s=this.activeDynamicExpressions[e];t=s.StartMultiExpression.AbsoluteTimestamp,i=s.EndMultiExpression.AbsoluteTimestamp,t.lte(this.CurrentSourceTimestamp)&&this.CurrentSourceTimestamp.lte(i)&&this.currentDynamicChangingExpressions.push(new r.DynamicsContainer(s,e))}else{const t=this.activeDynamicExpressions[e];this.CurrentSourceTimestamp.Equals(t.ParentMultiExpression.AbsoluteTimestamp)&&this.currentDynamicChangingExpressions.push(new r.DynamicsContainer(t,e))}}const t=this.musicSheet.TimestampSortedTempoExpressionsList;for(;this.currentTempoEntryIndex>0&&(this.currentTempoEntryIndex>=t.length||this.CurrentSourceTimestamp.lte(t[this.currentTempoEntryIndex].AbsoluteTimestamp));)this.currentTempoEntryIndex--;for(;this.currentTempoEntryIndex<t.length&&t[this.currentTempoEntryIndex].AbsoluteTimestamp.lt(this.CurrentSourceTimestamp);)this.currentTempoEntryIndex++;for(;this.currentTempoEntryIndex<t.length&&t[this.currentTempoEntryIndex].AbsoluteTimestamp.Equals(this.CurrentSourceTimestamp);)this.activeTempoExpression=t[this.currentTempoEntryIndex],this.currentTempoEntryIndex++;if(this.currentTempoChangingExpression=void 0,this.activeTempoExpression){let e=this.activeTempoExpression.AbsoluteTimestamp;this.activeTempoExpression.ContinuousTempo&&(e=this.activeTempoExpression.ContinuousTempo.AbsoluteEndTimestamp),(this.activeTempoExpression.AbsoluteTimestamp.lte(this.CurrentSourceTimestamp)||this.CurrentSourceTimestamp.lte(e))&&(this.currentTempoChangingExpression=this.activeTempoExpression)}}recursiveMoveBack(){if(this.currentVoiceEntryIndex>0){this.currentVoiceEntryIndex--;const e=this.currentMeasure.VerticalSourceStaffEntryContainers[this.currentVoiceEntryIndex];this.currentVoiceEntries=this.getVoiceEntries(e),this.currentVerticalContainerInMeasureTimestamp=e.Timestamp,this.currentRelativeInMeasureTimestamp=this.currentVerticalContainerInMeasureTimestamp,this.currentTimeStamp=n.Fraction.plus(this.currentMeasure.AbsoluteTimestamp,this.currentVerticalContainerInMeasureTimestamp),this.activateCurrentDynamicOrTempoInstructions();const t=this.musicSheet.SelectionEnd;return t&&this.currentTimeStamp.lt(t)&&(this.endReached=!1),void(this.currentMeasureIndex=this.musicSheet.SourceMeasures.indexOf(this.CurrentMeasure))}if(0===this.currentVoiceEntryIndex&&0!==this.currentMeasureIndex){const e=this.musicSheet.SourceMeasures[this.currentMeasureIndex-1];this.currentMeasureIndex--,this.currentMeasure=this.musicSheet.SourceMeasures[this.currentMeasureIndex];const t=e.VerticalSourceStaffEntryContainers[e.VerticalSourceStaffEntryContainers.length-1];this.currentVoiceEntries=this.getVoiceEntries(t),this.currentVerticalContainerInMeasureTimestamp=t.Timestamp,this.currentVoiceEntryIndex=e.VerticalSourceStaffEntryContainers.length-1,this.currentTimeStamp=n.Fraction.plus(this.currentMeasure.AbsoluteTimestamp,t.Timestamp),this.activateCurrentDynamicOrTempoInstructions();const i=this.musicSheet.SelectionEnd;return void(i&&this.currentTimeStamp.lt(i)&&(this.endReached=!1))}this.frontReached=!0,this.currentTimeStamp=new n.Fraction(-1,1)}recursiveMove(){if(this.currentVoiceEntryIndex++,0===this.currentVoiceEntryIndex&&(this.handleRepetitionsAtMeasureBegin(),this.activateCurrentRhythmInstructions()),this.currentVoiceEntryIndex>=0&&this.currentVoiceEntryIndex<this.currentMeasure.VerticalSourceStaffEntryContainers.length){const e=this.currentMeasure.VerticalSourceStaffEntryContainers[this.currentVoiceEntryIndex];this.currentVoiceEntries=this.getVoiceEntries(e),this.currentVerticalContainerInMeasureTimestamp=e.Timestamp,this.currentRelativeInMeasureTimestamp=this.currentVerticalContainerInMeasureTimestamp,this.currentTimeStamp=n.Fraction.plus(this.currentMeasure.AbsoluteTimestamp,this.currentVerticalContainerInMeasureTimestamp);const t=this.musicSheet.SelectionEnd;return t&&this.currentTimeStamp.gte(t)&&(this.endReached=!0),void this.activateCurrentDynamicOrTempoInstructions()}if(this.currentEnrolledMeasureTimestamp.Add(this.currentMeasure.Duration),this.handleRepetitionsAtMeasureEnd(),this.currentMeasureIndex>=0&&this.currentMeasureIndex<this.musicSheet.SourceMeasures.length)return this.currentMeasure=this.musicSheet.SourceMeasures[this.currentMeasureIndex],this.currentTimeStamp=n.Fraction.plus(this.currentMeasure.AbsoluteTimestamp,this.currentVerticalContainerInMeasureTimestamp),this.currentVoiceEntryIndex=-1,void this.recursiveMove();this.currentVerticalContainerInMeasureTimestamp=new n.Fraction,this.currentMeasure=void 0,this.currentVoiceEntries=void 0,this.endReached=!0}checkEntries(e){const t=this.CurrentVisibleVoiceEntries();if(t.length>0){if(!e)return!0;for(let e=0,i=t.length;e<i;++e)if(t[e].Notes[0].Pitch)return!0}return!1}getVisibleEntries(e,t){if(e.ParentVoice.Visible){let i=!1;for(const t of e.Notes)if(t.PrintObject){i=!0;break}if(!i&&this.SkipInvisibleNotes)return;t.push(e)}}getAudibleEntries(e,t){e.ParentVoice.Audible&&t.push(e)}getScoreFollowingEntries(e,t){e.ParentVoice.Following&&e.ParentVoice.Parent.Following&&t.push(e)}getVoiceEntries(e){const t=[];for(const i of e.StaffEntries)if(i)for(const e of i.VoiceEntries)t.push(e);return t}}t.MusicPartManagerIterator=u},512:(e,t)=>{var i;Object.defineProperty(t,"__esModule",{value:!0}),t.MusicSymbol=void 0,function(e){e[e.Unused_first_Symbol=0]="Unused_first_Symbol",e[e.BLACK_HEAD=1]="BLACK_HEAD",e[e.UPWARDS_TAIL=2]="UPWARDS_TAIL",e[e.DOWNWARDS_TAIL=3]="DOWNWARDS_TAIL",e[e.UPWARDS_DOUBLE_TAIL=4]="UPWARDS_DOUBLE_TAIL",e[e.DOWNWARDS_DOUBLE_TAIL=5]="DOWNWARDS_DOUBLE_TAIL",e[e.UPWARDS_TRIPLE_TAIL=6]="UPWARDS_TRIPLE_TAIL",e[e.DOWNWARDS_TRIPLE_TAIL=7]="DOWNWARDS_TRIPLE_TAIL",e[e.UPWARDS_QUAD_TAIL=8]="UPWARDS_QUAD_TAIL",e[e.DOWNWARDS_QUAD_TAIL=9]="DOWNWARDS_QUAD_TAIL",e[e.ROUND_HEAD=10]="ROUND_HEAD",e[e.WHITE_HEAD=11]="WHITE_HEAD",e[e.G_CLEF=12]="G_CLEF",e[e.F_CLEF=13]="F_CLEF",e[e.C_CLEF=14]="C_CLEF",e[e.BREVE=15]="BREVE",e[e.BREVE_REST=16]="BREVE_REST",e[e.COMMON_TIME=17]="COMMON_TIME",e[e.CUT_TIME=18]="CUT_TIME",e[e.WHOLE_REST=19]="WHOLE_REST",e[e.HALF_REST=20]="HALF_REST",e[e.QUARTER_REST=21]="QUARTER_REST",e[e.EIGHTH_REST=22]="EIGHTH_REST",e[e.SIXTEENTH_REST=23]="SIXTEENTH_REST",e[e.THIRTYSECOND_REST=24]="THIRTYSECOND_REST",e[e.SIXTYFOURTH_REST=25]="SIXTYFOURTH_REST",e[e.FLAT=26]="FLAT",e[e.SHARP=27]="SHARP",e[e.NATURAL=28]="NATURAL",e[e.DOUBLE_FLAT=29]="DOUBLE_FLAT",e[e.DOUBLE_SHARP=30]="DOUBLE_SHARP",e[e.ZERO=31]="ZERO",e[e.ONE=32]="ONE",e[e.TWO=33]="TWO",e[e.THREE=34]="THREE",e[e.FOUR=35]="FOUR",e[e.FIVE=36]="FIVE",e[e.SIX=37]="SIX",e[e.SEVEN=38]="SEVEN",e[e.EIGHT=39]="EIGHT",e[e.NINE=40]="NINE",e[e.DOT=41]="DOT",e[e.FERMATA=42]="FERMATA",e[e.INVERTED_FERMATA=43]="INVERTED_FERMATA",e[e.SPICCATO=44]="SPICCATO",e[e.TENUTO=45]="TENUTO",e[e.MARCATO=46]="MARCATO",e[e.MARCATISSIMO=47]="MARCATISSIMO",e[e.INVERTED_MARCATISSIMO=48]="INVERTED_MARCATISSIMO",e[e.P=49]="P",e[e.F=50]="F",e[e.S=51]="S",e[e.Z=52]="Z",e[e.M=53]="M",e[e.R=54]="R",e[e.SEGNO=55]="SEGNO",e[e.CODA=56]="CODA",e[e.DRUM_CLEF=57]="DRUM_CLEF",e[e.G_CLEF_SUB8=58]="G_CLEF_SUB8",e[e.G_CLEF_SUPER8=59]="G_CLEF_SUPER8",e[e.G_CLEF_SUB15=60]="G_CLEF_SUB15",e[e.G_CLEF_SUPER15=61]="G_CLEF_SUPER15",e[e.F_CLEF_SUB8=62]="F_CLEF_SUB8",e[e.F_CLEF_SUPER8=63]="F_CLEF_SUPER8",e[e.F_CLEF_SUB15=64]="F_CLEF_SUB15",e[e.F_CLEF_SUPER15=65]="F_CLEF_SUPER15",e[e.DOWN_BOW=66]="DOWN_BOW",e[e.MORDENT=67]="MORDENT",e[e.INVERTED_MORDENT=68]="INVERTED_MORDENT",e[e.TURN=69]="TURN",e[e.INVERTED_TURN=70]="INVERTED_TURN",e[e.LEFTHAND_PIZZICATO=71]="LEFTHAND_PIZZICATO",e[e.RELEASE_PED=72]="RELEASE_PED",e[e.ENGAGE_PED=73]="ENGAGE_PED",e[e.VA8=74]="VA8",e[e.VB8=75]="VB8",e[e.TRILL=76]="TRILL",e[e.MA15=77]="MA15",e[e.MB15=78]="MB15",e[e.HIGH=79]="HIGH",e[e.PLAY=80]="PLAY",e[e.MIC=81]="MIC",e[e.SNAP_PIZZICATO=82]="SNAP_PIZZICATO",e[e.NATURAL_HARMONIC=83]="NATURAL_HARMONIC",e[e.EditPen=84]="EditPen",e[e.PEDAL_BRACKET=85]="PEDAL_BRACKET",e[e.PEDAL_MIXED=86]="PEDAL_MIXED",e[e.PEDAL_SYMBOL=87]="PEDAL_SYMBOL"}(i||(t.MusicSymbol=i={}))},649:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.LyricWord=void 0,t.LyricWord=class{constructor(){this.syllables=[]}get Syllables(){return this.syllables}containsVoiceEntry(e){for(let t=0,i=this.Syllables.length;t<i;++t)if(this.Syllables[t].Parent===e)return!0;return!1}findLyricEntryInVoiceEntry(e){for(let t=0,i=this.Syllables.length;t<i;++t){const i=this.Syllables[t];if(i.Parent===e)return i}}}},735:(e,t,i)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.PlainSkyBottomLineBatchCalculatorBackend=void 0;const s=i(5479),n=i(3667);class r extends n.SkyBottomLineBatchCalculatorBackend{constructor(e,t){super(e,t)}getPreferredRenderingConfiguration(e,t){return{elementWidth:Math.ceil(e),numColumns:6,numRows:6}}onInitialize(e){}calculateFromCanvas(e,t,i,n,r){const o=e.width,a=t.getImageData(0,0,e.width,e.height),{elementWidth:l,elementHeight:u,numColumns:c}=r,h=[];for(let e=0;e<i.length;++e){const t=i[e],r=Math.floor(t.getVFStave().getWidth()),d=Math.max(Math.ceil(t.PositionAndShape.Size.width*n),1),m=e%c*l,f=m+r,p=Math.floor(e/c)*u,S=p+u,g=new Array(Math.max(d,r)).fill(0),y=new Array(Math.max(d,r)).fill(0);for(let e=m;e<f;++e){g[e-m]=0;for(let t=p;t<S;++t){const i=t*o*4+4*e;if(a.data[i+3]>0){g[e-m]=t-p;break}}y[e-m]=u;for(let t=S-1;t>=p;t--){const i=t*o*4+4*e;if(a.data[i+3]>0){y[e-m]=t-p;break}}}const E=Math.max(...g),M=Math.min(...y);for(let e=0;e<r;++e)g[e]=0===g[e]?E:g[e],y[e]=y[e]===u?M:y[e];h.push(new s.SkyBottomLineCalculationResult(g,y))}return h}}t.PlainSkyBottomLineBatchCalculatorBackend=r},806:function(e,t,i){var s=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.VexFlowMusicSheetCalculator=void 0;const n=i(7921),r=i(3753),o=i(5748),a=i(1327),l=i(5054),u=i(7785),c=s(i(3206));var h=c.default.Flow;const d=s(i(3065)),m=i(9479),f=i(2395),p=i(7751),S=i(9310),g=i(7809),y=i(7533),E=i(4022),M=i(2400),b=i(9161),P=i(624),L=i(7506),v=i(5282),T=i(6014),x=i(4980),A=i(6659),I=i(6954),w=i(7109),N=i(512),C=i(813),R=i(1216);class B extends n.MusicSheetCalculator{constructor(e){super(),this.beamsNeedUpdate=!1,this.rules=e,n.MusicSheetCalculator.symbolFactory=new r.VexFlowGraphicalSymbolFactory,n.MusicSheetCalculator.TextMeasurer=new u.VexFlowTextMeasurer(this.rules),n.MusicSheetCalculator.stafflineNoteCalculator=new L.VexflowStafflineNoteCalculator(this.rules),"gonville"===this.rules.DefaultVexFlowNoteFont?.toLowerCase()?c.default.Flow.DEFAULT_FONT_STACK=[c.default.Flow.Fonts?.Gonville,c.default.Flow.Fonts?.Bravura,c.default.Flow.Fonts?.Custom]:"petaluma"===this.rules.DefaultVexFlowNoteFont?.toLowerCase()&&(c.default.Flow.DEFAULT_FONT_STACK=[c.default.Flow.Fonts?.Petaluma,c.default.Flow.Fonts?.Gonville,c.default.Flow.Fonts?.Bravura])}clearRecreatedObjects(){super.clearRecreatedObjects(),n.MusicSheetCalculator.stafflineNoteCalculator=new L.VexflowStafflineNoteCalculator(this.rules);for(const e of this.graphicalMusicSheet.MeasureList)for(const t of e)t?.clean()}formatMeasures(){for(const e of this.graphicalMusicSheet.MeasureList)if(e&&e[0]){e.find(e=>e?.isVisible()).format();for(const t of e){for(const e of t.staffEntries)e.calculateXPosition();t.finalizeBeams()}}this.beamsNeedUpdate=!1}calculateMeasureXLayout(e){const t=[];for(const i of e)i?.isVisible()&&t.push(i);if(0===t.length)return 0;e=t;const i=[],s=new h.Formatter({softmaxFactor:this.rules.SoftmaxFactorVexFlow});let r=e[0].staffEntries.length,o=1;for(const t of e){if(!t)continue;let e=0;for(const i of t.staffEntries)e+=i.setMaxAccidentals();t.parentSourceMeasure.ImplicitMeasure&&(r=Math.max(t.staffEntries.length,r),o=Math.max(t.staffEntries.length+e,o));const n=t.vfVoices,a=[];for(const e in n)if(n.hasOwnProperty(e)){const s=n[e];t.hasOnlyRests&&!s.ticksUsed.equals(s.totalTicks)&&(s.ticksUsed=s.totalTicks),a.push(s),i.push(s)}0!==a.length?s.joinVoices(a):d.default.debug("Found a measure with no voices. Continuing anyway.",n)}let a=12;const l=e[0].parentSourceMeasure;if(i.length>0){if(a=s.preCalculateMinTotalWidth(i)/m.unitInPixels*this.rules.VoiceSpacingMultiplierVexflow+this.rules.VoiceSpacingAddendVexflow+.3*r,l?.ImplicitMeasure){a=l.Duration.RealValue/l.ActiveTimeSignature.RealValue*a;let e=0;const t=l.measureListIndex;if(t>1)for(const i of this.graphicalMusicSheet.MeasureList[t-1]){const t=i?.parentSourceMeasure.endingBarStyleEnum;if(t===I.SystemLinesEnum.ThinBold||t===I.SystemLinesEnum.DotsThinBold){e=this.rules.PickupMeasureRepetitionSpacing;break}}a+=e,r>1?a+=.3*o*1.5:t>1&&1===r&&(a+=this.rules.PickupMeasureSpacingSingleNoteAddend),a*=this.rules.PickupMeasureWidthMultiplier}n.MusicSheetCalculator.setMeasuresMinStaffEntriesWidth(e,a);const t=(e,t)=>{s.formatToStave(i,t.getVFStave())},u=(e,t)=>{s.formatToStave(i,t.getVFStave(),{align_rests:!0,context:void 0})};for(const i of e){if(this.rules.AlignRests===P.AlignRestOption.Never)i.formatVoices=t;else if(this.rules.AlignRests===P.AlignRestOption.Always)i.formatVoices=u;else if(this.rules.AlignRests===P.AlignRestOption.Auto){let e=!1;for(const t of i.staffEntries){let i=0,s=0;for(const n of t.graphicalVoiceEntries)if(n.parentVoiceEntry.IsGrace||n&&n.notes&&n.notes[0]&&n.notes[0].sourceNote&&n.notes[0].sourceNote.PrintObject&&i++,n&&n.notes&&n.notes[0]&&n.notes[0].sourceNote&&n.notes[0].sourceNote.isRest()&&n.notes[0].sourceNote.PrintObject&&s++,i>1&&s>=1){e=!0;break}if(e)break}i.formatVoices=e?u:t}if(i===e[0]){const e=i;e.formatVoices(a*m.unitInPixels,e)}}}for(const t of e)if(t)for(const e of t.staffEntries)e.calculateXPosition();for(const t of e){if(!t)continue;const e=t.vfVoices,i=[];for(const t in e)e.hasOwnProperty(t)&&i.push(e[t]);0!==i.length?s.joinVoices(i):d.default.debug("Found a measure with no voices. Continuing anyway.",e)}return a}calculateElongationFactor(e,t,i,s,n,r,a,l){let u=n,c=0;for(const h of e){const e=h.GraphicalLabel.Label.textAlignment;let d=a,m=l;if(h instanceof f.GraphicalLyricEntry&&h.ParentLyricWord){h.LyricsEntry.SyllableIndex>0&&(d=this.rules.BetweenSyllableMinimumDistance,y.TextAlignment.IsCenterAligned(e)&&(d+=1));const t=h.ParentLyricWord.GetLyricWord.Syllables;t.length>1&&h.LyricsEntry.SyllableIndex<t.length-1&&(void 0===this.dashSpace&&(this.dashSpace=1.5),m-=this.dashSpace)}const p=h instanceof f.GraphicalLyricEntry?h.GraphicalLabel.PositionAndShape:h.PositionAndShape,S=p.Size.width;let g,E,M,b,P=t.PositionAndShape.RelativePosition.x+p.BorderLeft;h instanceof A.GraphicalChordSymbolContainer&&h.PositionAndShape.Parent.DataObject instanceof o.GraphicalMeasure&&(P=this.rules.ChordSymbolWholeMeasureRestXOffset+p.BorderMarginLeft+h.PositionAndShape.Parent.DataObject.beginInstructionsWidth),void 0!==i[c]&&i[c].extend,i[c]&&(E=P-i[c].xPosition);const L=s*n;y.TextAlignment.IsCenterAligned(e)?(m/=4,M=L-P,b=S/2-m,i[c]&&(g=i[c].labelWidth/2+S/2+d)):y.TextAlignment.IsLeft(e)&&(M=L-P,b=S-m,i[c]&&(g=i[c].labelWidth+d));let v=1;const T=b/M;let x=1;h instanceof f.GraphicalLyricEntry&&h.LyricsEntry?i[c]&&(x=g/E,i[c].sourceNoteDuration.Denominator>4&&(x*=1.1)):i[c]&&(x=g/E),v=Math.max(T,x),u=Math.max(u,v);let I=Math.max(g-E||0,0);i[c]&&(I+=i[c].cumulativeOverlap),i[c]={cumulativeOverlap:I,extend:h instanceof f.GraphicalLyricEntry&&h.LyricsEntry.extend,labelWidth:S,measureNumber:r,sourceNoteDuration:h instanceof f.GraphicalLyricEntry&&h.LyricsEntry&&h.LyricsEntry.Parent.Notes[0].Length,text:h instanceof f.GraphicalLyricEntry?h.LyricsEntry.Text:h.GraphicalLabel.Label.text,xPosition:P},c++}return u}calculateElongationFactorFromStaffEntries(e,t,i,s){let n=i;const r={},o={};for(const i of e)i.LyricsEntries.length>0&&this.rules.RenderLyrics&&(n=this.calculateElongationFactor(i.LyricsEntries,i,r,t,n,s,this.rules.HorizontalBetweenLyricsDistance,this.rules.LyricOverlapAllowedIntoNextMeasure)),i.graphicalChordContainers.length>0&&this.rules.RenderChordSymbols&&(n=this.calculateElongationFactor(i.graphicalChordContainers,i,o,t,n,s,this.rules.ChordSymbolXSpacing,this.rules.ChordOverlapAllowedIntoNextMeasure));return n}calculateMeasureWidthFromStaffEntries(e,t){let i=1;for(const s of e)s&&0!==s.staffEntries.length&&s.isVisible()&&(i=this.calculateElongationFactorFromStaffEntries(s.staffEntries,t,i,s.MeasureNumber));return i=Math.min(i,this.rules.MaximumLyricsElongationFactor),t*i}createGraphicalTie(e,t,i,s,n){return new l.GraphicalTie(e,s,n)}updateStaffLineBorders(e){e.SkyBottomLineCalculator.updateStaffLineBorders()}graphicalMeasureCreatedCalculations(e){e.rules=this.rules,e.graphicalMeasureCreatedCalculations()}layoutVoiceEntry(e,t,i,s){for(let e=0;e<t.length;e++)t[e]=n.MusicSheetCalculator.stafflineNoteCalculator.positionNote(t[e])}layoutStaffEntry(e){e.parentMeasure.layoutStaffEntry(e)}initGraphicalMeasuresCreation(){}layoutArticulationMarks(e,t,i){}layoutGraphicalTie(e,t,i){const s=e.StartNote,n=e.EndNote;let r,o,a=0;s&&s.vfnote&&s.vfnote.length>=2&&(r=s.vfnote[0],a=s.vfnote[1]);let l=0;if(n&&n.vfnote&&n.vfnote.length>=2&&(o=n.vfnote[0],l=n.vfnote[1]),t){if(r){const t=new h.StaveTie({first_indices:[a],first_note:r});s.parentVoiceEntry.parentStaffEntry.parentMeasure.addStaveTie(t,e)}if(o){const t=new h.StaveTie({last_indices:[l],last_note:o});n.parentVoiceEntry.parentStaffEntry.parentMeasure.addStaveTie(t,e)}}else if(r||o){let t;if(i)if("S"===e.Tie.Type){const i=e.StartNote.sourceNote,s=e.EndNote.sourceNote;let n=1;i.FretNumber>s.FretNumber&&(n=-1),t=new h.TabSlide({first_indices:[a],first_note:r,last_indices:[l],last_note:o},n)}else t=new h.TabTie({first_indices:[a],first_note:r,last_indices:[l],last_note:o},e.Tie.Type);else{t=new h.StaveTie({first_indices:[a],first_note:r,last_indices:[l],last_note:o});const i=e.Tie.getTieDirection(s.sourceNote);i===x.PlacementEnum.Below?t.setDirection(1):i===x.PlacementEnum.Above&&t.setDirection(-1)}n.parentVoiceEntry.parentStaffEntry.parentMeasure.addStaveTie(t,e)}}calculateDynamicExpressionsForMultiExpression(e,t,i){if(t<this.rules.MinMeasureToDrawIndex||t>this.rules.MaxMeasureToDrawIndex)return;const s=e.AbsoluteTimestamp,n=this.graphicalMusicSheet.MeasureList[t],r=n[i].ParentStaffLine,o=n[i],a=e.StartingContinuousDynamic,l=void 0!==a&&!a.IsStartOfSoftAccent,u=this.getRelativePositionInStaffLineFromTimestamp(s,i,r,r?.isPartOfMultiStaffInstrument(),void 0,l);if(u.x<=0&&(u.x=o.beginInstructionsWidth+this.rules.RhythmRightMargin),e.InstantaneousDynamic){const t=new g.VexFlowInstantaneousDynamicExpression(e.InstantaneousDynamic,r,o);this.calculateGraphicalInstantaneousDynamicExpression(t,u,s),this.dynamicExpressionMap.set(s.RealValue,t.PositionAndShape)}if(a){const t=new M.VexFlowContinuousDynamicExpression(a,r,o.parentSourceMeasure);if(t.StartMeasure=o,t.IsSoftAccent=e.StartingContinuousDynamic.IsStartOfSoftAccent,!t.IsVerbal&&a.EndMultiExpression)try{this.calculateGraphicalContinuousDynamic(t,u),t.updateSkyBottomLine()}catch(e){}else t.IsVerbal?this.calculateGraphicalVerbalContinuousDynamic(t,u):d.default.warn("This continuous dynamic is not covered. measure"+e.SourceMeasureParent.MeasureNumber)}}createMetronomeMark(e){const t=e.ParentMultiTempoExpression.SourceMeasureParent.MeasureNumber,i=Math.max(e.StaffNumber-1,0),s=this.graphicalMusicSheet.findGraphicalMeasureByMeasureNumber(t,i),n=s===this.graphicalMusicSheet.MeasureList[0][0];if(s.hasMetronomeMark)return;const r=s.getVFStave();let o="q";if(e.beatUnit){const t=v.NoteTypeHandler.getNoteDurationFromType(e.beatUnit);o=T.VexFlowConverter.durations(t,!1)[0]}let a=this.rules.MetronomeMarkYShift,l=!1;for(const t of e.parentMeasure.TempoExpressions){const e=t.InstantaneousTempo?.Enum===b.TempoEnum.metronomeMark;if(t.getPlacementOfFirstEntry()===x.PlacementEnum.Above&&!e){l=!0;break}}l&&(a-=1.4);const u=this.graphicalMusicSheet.MeasureList[0][0].ParentStaffLine?.SkyLine;r.setTempo({bpm:e.TempoInBpm,dots:e.dotted,duration:o},a*m.unitInPixels);const c=n?this.rules.MetronomeMarkXShift*m.unitInPixels:0;r.getModifiers()[r.getModifiers().length-1].setShiftX(c),s.hasMetronomeMark=!0,u&&(u[0]=Math.min(u[0],-4.5+a))}calculateRehearsalMark(e){const t=e.rehearsalExpression;if(!t)return;const i=this.graphicalMusicSheet.MeasureList[0][0].MeasureNumber,s=Math.max(e.MeasureNumber-i,0);for(const i of this.graphicalMusicSheet.MeasureList[s]){const s=i?.getVFStave();if(!s||!i.isVisible())continue;let n=-this.rules.RehearsalMarkYOffsetDefault-this.rules.RehearsalMarkYOffset;i.parentSourceMeasure.isReducedToMultiRest&&(n+=this.rules.RehearsalMarkYOffsetAddedForRehearsalMarks);let r=this.rules.RehearsalMarkXOffsetDefault+this.rules.RehearsalMarkXOffset;e.IsSystemStartMeasure&&(r+=this.rules.RehearsalMarkXOffsetSystemStartMeasure);const o=this.rules.RehearsalMarkFontSize;return void s.setSection(t.label,n,r,o)}}calculateSingleOctaveShift(e,t,i,s){const n=t.OctaveShiftStart,r=n.ParentStartMultiExpression.Timestamp,o=n.ParentEndMultiExpression?.Timestamp,a=this.rules.MinMeasureToDrawIndex,l=this.rules.MaxMeasureToDrawIndex;let u,c,h=this.graphicalMusicSheet.MeasureList[i][s].ParentStaffLine;if(h||(h=this.graphicalMusicSheet.MeasureList[a][s].ParentStaffLine),u=n.ParentEndMultiExpression?this.graphicalMusicSheet.getGraphicalMeasureFromSourceMeasureAndIndex(n.ParentEndMultiExpression.SourceMeasureParent,s):this.graphicalMusicSheet.getLastGraphicalMeasureFromIndex(s,!0),u.MeasureNumber>l+1&&(u=this.graphicalMusicSheet.getLastGraphicalMeasureFromIndex(s,!0)),c=n.ParentEndMultiExpression?this.graphicalMusicSheet.getGraphicalMeasureFromSourceMeasureAndIndex(n.ParentStartMultiExpression.SourceMeasureParent,s):this.graphicalMusicSheet.MeasureList[a][s],c.MeasureNumber<a+1&&(c=this.graphicalMusicSheet.MeasureList[a][s]),c.MeasureNumber<a+1||c.MeasureNumber>l+1||u.MeasureNumber<a+1||u.MeasureNumber>l+1)return;let m=u.ParentStaffLine;if(m||(m=h),u&&h&&m){const e=new S.VexFlowOctaveShift(n,h.PositionAndShape);if(!e.startNote){let t;for(const e of c.staffEntries)if(e){t=e;break}if(!t)return;if(e.setStartNote(t),!e.startNote)return}if(!e.endNote){let t;for(let e=u.staffEntries.length-1;e>=0;e++)if(u.staffEntries[e]){t=u.staffEntries[e];break}if(!t)return void(e.graphicalEndAtMeasureEnd=!0);if(e.setEndNote(t),!e.endNote)return}let t=c.findGraphicalStaffEntryFromTimestamp(r);t||(t=c.staffEntries[0]);let i=u.findGraphicalStaffEntryFromTimestamp(o);if(i||(i=u.staffEntries[u.staffEntries.length-1]),e.setStartNote(t),m!==h){e.endsOnDifferentStaffLine=!0;let r=this.findLastStafflineMeasure(h);void 0===r&&(r=u);const o=r.staffEntries[r.staffEntries.length-1];e.setEndNote(o),e.graphicalEndAtMeasureEnd=!0,e.endMeasure=r;const a=m.ParentMusicSystem.Id-h.ParentMusicSystem.Id;if(a>0)for(let e=h.ParentMusicSystem.Id;e<m.ParentMusicSystem.Id;e++){const t=e+1,r=this.musicSystems[t];let o;for(const e of r.StaffLines)if(e.ParentStaff.idInMusicSheet===s){o=e;break}if(!o)continue;const l=o.Measures[0],c=new S.VexFlowOctaveShift(n,l.PositionAndShape);let h=this.findLastStafflineMeasure(o);e<a-1&&(c.endsOnDifferentStaffLine=!0,c.graphicalEndAtMeasureEnd=!0,c.endMeasure=h);const m=l.staffEntries[0];let f=h.staffEntries[h.staffEntries.length-1];u.ParentStaffLine===o&&(h=u,f=i),1===f.graphicalVoiceEntries.length&&1===f.graphicalVoiceEntries[0].notes.length&&f.graphicalVoiceEntries[0].notes[0].sourceNote.isWholeMeasureNote()&&(c.graphicalEndAtMeasureEnd=!0,c.endMeasure=h);const p="VexFlowMusicSheetCalculator.calculateSingleOctaveShift: ";m||d.default.warn(p+"no firstNote found"),f||d.default.warn(p+"no lastNote found"),c.setStartNote(m),c.setEndNote(f),o.OctaveShifts.push(c),this.calculateOctaveShiftSkyBottomLine(m,f,c,o)}this.calculateOctaveShiftSkyBottomLine(t,o,e,h)}else e.setEndNote(i),this.calculateOctaveShiftSkyBottomLine(t,i,e,h);h.OctaveShifts.push(e)}else d.default.warn("End measure or staffLines for octave shift are undefined! This should not happen!")}findLastStafflineMeasure(e){for(let t=e.Measures.length-1;t>=0;t--){const i=e.Measures[t];if(i.staffEntries.length>0)return i}}calculateSinglePedal(e,t,i,s){const n=t.PedalStart,r=n.ParentStartMultiExpression.Timestamp,o=n.ParentEndMultiExpression?.Timestamp,a=this.rules.MinMeasureToDrawIndex,l=this.rules.MaxMeasureToDrawIndex;let u,c,h=this.graphicalMusicSheet.MeasureList[i][s].ParentStaffLine;if(h||(h=this.graphicalMusicSheet.MeasureList[a][s].ParentStaffLine),u=n.ParentEndMultiExpression?this.graphicalMusicSheet.getGraphicalMeasureFromSourceMeasureAndIndex(n.ParentEndMultiExpression.SourceMeasureParent,s):this.graphicalMusicSheet.getLastGraphicalMeasureFromIndex(s,!0),u.MeasureNumber>l+1&&(u=this.graphicalMusicSheet.getLastGraphicalMeasureFromIndex(s,!0)),n.ParentEndMultiExpression?c=this.graphicalMusicSheet.getGraphicalMeasureFromSourceMeasureAndIndex(n.ParentStartMultiExpression.SourceMeasureParent,s):(c=this.graphicalMusicSheet.getGraphicalMeasureFromSourceMeasureAndIndex(n.ParentStartMultiExpression.SourceMeasureParent,s),c||(c=this.graphicalMusicSheet.MeasureList[a][s])),c.MeasureNumber<a+1&&(c=this.graphicalMusicSheet.MeasureList[a][s]),c.parentSourceMeasure.measureListIndex<a||c.parentSourceMeasure.measureListIndex>l||u.parentSourceMeasure.measureListIndex<a||u.parentSourceMeasure.measureListIndex>l)return;let m=u.ParentStaffLine;if(m||(m=h),u&&h&&m){let e=!1;h!==m&&(e=!0);const t=new w.VexFlowPedal(n,h.PositionAndShape,!1,e);t.setEndsStave(u,o);let i=c.findGraphicalStaffEntryFromTimestamp(r);i||(i=c.staffEntries[0]);let a=u.findGraphicalStaffEntryFromTimestamp(o);if(a||(a=u.staffEntries[u.staffEntries.length-1]),!t.setStartNote(i))return;if(t.setBeginsStave(t.startNote.isRest(),r),m!==h)if(t.pedalSymbol===N.MusicSymbol.PEDAL_SYMBOL){t.setEndNote(a),t.setEndMeasure(u),t.ReleaseText=" ",t.CalculateBoundingBox(),this.calculatePedalSkyBottomLine(t.startVfVoiceEntry,t.endVfVoiceEntry,t,h);const e=m.Measures[0],i=new w.VexFlowPedal(n,e.PositionAndShape);t.setEndsStave(u,o);const s=e.staffEntries[0];if(!i.setStartNote(s))return;i.setEndNote(a),i.setEndMeasure(u),t.setEndMeasure(u),m.Pedals.push(i),i.CalculateBoundingBox(),i.DepressText=" ",this.calculatePedalSkyBottomLine(i.startVfVoiceEntry,i.endVfVoiceEntry,i,m)}else{let e=this.findLastStafflineMeasure(h);void 0===e&&(e=u);const i=e.staffEntries[e.staffEntries.length-1];t.setEndNote(i),t.setEndMeasure(u),t.ChangeEnd=!1;const r=m.ParentMusicSystem.Id-h.ParentMusicSystem.Id;if(r>0){let e=1;for(let i=h.ParentMusicSystem.Id;i<m.ParentMusicSystem.Id;i++){const l=this.musicSystems[i+1].StaffLines[s],c=l.Measures[0];let h=!1,d=!1;e<r?h=!0:d=!0,e++;const m=new w.VexFlowPedal(n,c.PositionAndShape,!0,h);t.setEndsStave(u,o),m.ChangeBegin=!1,m.ChangeEnd=!!d&&n.ChangeEnd;let f=this.findLastStafflineMeasure(l);const p=c.staffEntries[0];let S=f.staffEntries[f.staffEntries.length-1];if(u.ParentStaffLine===l?(f=u,m.setEndMeasure(u),S=a):m.setEndMeasure(l.Measures.last()),!m.setStartNote(p))break;m.setEndNote(S),t.setEndMeasure(u),l.Pedals.push(m),m.CalculateBoundingBox(),this.calculatePedalSkyBottomLine(m.startVfVoiceEntry,m.endVfVoiceEntry,m,l)}}t.CalculateBoundingBox(),this.calculatePedalSkyBottomLine(t.startVfVoiceEntry,t.endVfVoiceEntry,t,h)}else t.setEndNote(a),t.setEndMeasure(u),t.CalculateBoundingBox(),this.calculatePedalSkyBottomLine(t.startVfVoiceEntry,t.endVfVoiceEntry,t,h);h.Pedals.push(t)}else d.default.warn("End measure or staffLines for pedal are undefined! This should not happen!")}calculatePedalSkyBottomLine(e,t,i,s){let n=t?.PositionAndShape;n||(n=i.endMeasure.PositionAndShape);const r=c.default.Flow.PedalMarking.Styles,o=i.getPedalMarking(),a=o.line+3+(s.StaffLines.length-1),l=o.render_options.text_margin_right/10;let u,h=e.PositionAndShape.AbsolutePosition.x-l;o.style!==r.MIXED&&o.style!==r.MIXED_OPEN_END&&o.style!==r.TEXT||(h-=1);let d=s.StaffLines.length-1;for(const e of s.Pedals){const t=e.getPedalMarking().line+3+(s.StaffLines.length-1);d=Math.max(t,d)}if(i.EndSymbolPositionAndShape){const e=o.render_options.glyph_point_size/20;u=h+3.4;const t=n.AbsolutePosition.x-l,r=t+1.5;d=Math.max(s.SkyBottomLineCalculator.getBottomLineMaxInRange(h,u),d),d=Math.max(a+2*e,d);const c=s.SkyBottomLineCalculator.getBottomLineMaxInRange(t,r);i.DepressText||(d=Math.max(d,c)),i.setLine(d-3-(s.StaffLines.length-1)),s.SkyBottomLineCalculator.updateBottomLineInRange(h,u,d+e),s.SkyBottomLineCalculator.updateBottomLineInRange(t,r,d+e)}else{const e=o.render_options.bracket_height/10;if(o.EndsStave)u=t?t.parentStaffEntry.parentMeasure.PositionAndShape.AbsolutePosition.x+t.parentStaffEntry.parentMeasure.PositionAndShape.Size.width-l:n.AbsolutePosition.x+n.Size.width;else switch(o.style){case r.BRACKET_OPEN_END:case r.BRACKET_OPEN_BOTH:case r.MIXED_OPEN_END:u=n.AbsolutePosition.x+n.BorderRight-l;break;default:u=n.AbsolutePosition.x+n.BorderLeft-l}const c=t?.parentStaffEntry?.vfClefBefore;if(c&&(u+=c.getWidth()/10),d=Math.max(s.SkyBottomLineCalculator.getBottomLineMaxInRange(h,u),d),d===1/0)return;if(d=Math.max(d,a+e),i.setLine(d-3-(s.StaffLines.length-1)),h>u){const e=u;u=h,h=e}s.SkyBottomLineCalculator.updateBottomLineInRange(h,u,d+e)}for(const e of s.Pedals){const t=e,i=t.getPedalMarking();if(d>i.line+3+(s.StaffLines.length-1)){const e=i.render_options.text_margin_right/10;let n,a=t.startVfVoiceEntry.PositionAndShape.AbsolutePosition.x-e;t.setLine(d-3-(s.StaffLines.length-1));let l=t.endVfVoiceEntry?.PositionAndShape;if(l||(l=t.endMeasure.PositionAndShape),t.EndSymbolPositionAndShape){const t=o.render_options.glyph_point_size/20;n=a+3.4;const i=l.AbsolutePosition.x-e,r=i+1.5;s.SkyBottomLineCalculator.updateBottomLineInRange(a,n,d+t),s.SkyBottomLineCalculator.updateBottomLineInRange(i,r,d+t)}else{const u=i.render_options.bracket_height/10;if(i.EndsStave)n=l.AbsolutePosition.x+l.Size.width-e;else switch(o.style){case r.BRACKET_OPEN_END:case r.BRACKET_OPEN_BOTH:case r.MIXED_OPEN_END:n=l.AbsolutePosition.x+l.BorderRight-e;break;default:n=l.AbsolutePosition.x+l.BorderLeft-e}const c=t.endVfVoiceEntry?.parentStaffEntry?.vfClefBefore;if(c&&(n+=c.getWidth()/10),a>n){const e=a;a=n,n=e}s.SkyBottomLineCalculator.updateBottomLineInRange(a,n,d+u)}}}}calculateOctaveShiftSkyBottomLine(e,t,i,s){if(!t)return void d.default.warn("octaveshift: no endStaffEntry");let n=t.PositionAndShape;i.graphicalEndAtMeasureEnd&&(n=t.parentMeasure.PositionAndShape);let r=e.PositionAndShape.Size.width,o=n.Size.width;e.hasOnlyRests()?r=-r:r/=2,i.graphicalEndAtMeasureEnd||(t.hasOnlyRests()?o*=2:o/=2,e===t&&(o*=2));let a=e.PositionAndShape.AbsolutePosition.x-r,l=n.AbsolutePosition.x+o;if(a>l){const e=a;a=l,l=e}i.PositionAndShape.Size.width=l-a;const u=i.getTextBracket(),c=u.font.size/10;if(u.position===h.TextBracket.Positions.TOP){const e=Math.ceil(s.SkyBottomLineCalculator.getSkyLineMinInRange(a,l));if(e===1/0)return;u.start.getStave().options.top_text_position=Math.abs(e),s.SkyBottomLineCalculator.updateSkyLineInRange(a,l,e-2*c)}else{const e=s.SkyBottomLineCalculator.getBottomLineMaxInRange(a,l);if(e===1/0)return;u.start.getStave().options.bottom_text_position=e,s.SkyBottomLineCalculator.updateBottomLineInRange(a,l,e+1.5*c)}}calculateWordRepetitionInstruction(e,t){let i;const s=this.graphicalMusicSheet.MeasureList[t];for(let e=0,t=s.length;e<t;++e){const t=s[e];if(t&&t.ParentStaffLine&&t.ParentStaff.isVisible()){i=t;break}}i&&i.addWordRepetition(e)}calculateSkyBottomLines(){const e=C.CollectionUtil.flat(this.musicSystems.map(e=>e.StaffLines));let t=0;for(const i of e)for(const e of i.Measures)e&&t++;if(this.rules.AlwaysSetPreferredSkyBottomLineBackendAutomatically&&this.rules.setPreferredSkyBottomLineBackendAutomatically(t),t>=this.rules.SkyBottomLineBatchMinMeasures)new a.SkyBottomLineBatchCalculator(e,this.rules.PreferredSkyBottomLineBatchCalculatorBackend).calculateLines();else for(const t of e)t.SkyBottomLineCalculator.calculateLines()}calculateExpressionAlignements(){for(const e of this.musicSystems)for(const t of e.StaffLines)try{t.AlignmentManager.alignDynamicExpressions(),t.AbstractExpressions.forEach(e=>{e.updateSkyBottomLine()})}catch(e){}}handleTiedGraphicalNote(e,t,i,s,n,r,o,a){}handleBeam(e,t,i){e.parentVoiceEntry.parentStaffEntry.parentMeasure.handleBeam(e,t)}handleVoiceEntryLyrics(e,t,i){e.LyricsEntries.forEach((e,s)=>{const n=new f.GraphicalLyricEntry(s,t,this.rules.LyricsHeight,this.rules.StaffHeight);if(t.LyricsEntries.push(n),n.GraphicalLabel.setLabelPositionAndShapeBorders(),s.Word){const e=s.Word.Syllables.indexOf(s);let t=i.indexOf(s.Word);if(-1===t&&(i.push(s.Word),t=i.indexOf(s.Word)),0===this.graphicalLyricWords.length||t>this.graphicalLyricWords.length-1){const t=new p.GraphicalLyricWord(s.Word);n.ParentLyricWord=t,t.GraphicalLyricsEntries[e]=n,this.graphicalLyricWords.push(t)}else{const s=this.graphicalLyricWords[t];n.ParentLyricWord=s,s.GraphicalLyricsEntries[e]=n,s.isFilled()&&(i.splice(t,1),this.graphicalLyricWords.splice(this.graphicalLyricWords.indexOf(s),1))}}})}handleVoiceEntryOrnaments(e,t,i){}handleVoiceEntryArticulations(e,t,i){}handleVoiceEntryTechnicalInstructions(e,t,i){}handleTuplet(e,t,i){e.parentVoiceEntry.parentStaffEntry.parentMeasure.handleTuplet(e,t)}findIndexGraphicalSlurFromSlur(e,t){for(let i=0;i<e.length;i++)if(e[i].slur===t)return i;return-1}indexOfGraphicalGlissFromGliss(e,t){for(let i=0;i<e.length;i++)if(e[i].Glissando===t)return i;return-1}calculateSlurs(){const e={};for(const t of this.graphicalMusicSheet.MeasureList[0])e[t.ParentStaff.idInMusicSheet]=[];for(const t of this.musicSystems)for(const i of t.StaffLines){const t=e[i.ParentStaff.idInMusicSheet];for(let e=0;e<t.length;e++){const s=t[e],n=new E.GraphicalSlur(s.slur,this.rules);i.addSlurToStaffline(n),t[e]=n}for(const e of i.Measures)for(const s of e.staffEntries){for(const e of s.graphicalVoiceEntries)for(const n of e.notes)for(const e of n.sourceNote.NoteSlurs)if(e.EndNote&&e.StartNote){if(e.StartNote===n.sourceNote){const s=new E.GraphicalSlur(e,this.rules);t.push(s),i.addSlurToStaffline(s)}if(e.EndNote===n.sourceNote){const i=this.findIndexGraphicalSlurFromSlur(t,e);if(i>=0){const e=t[i];-1===e.staffEntries.indexOf(s)&&e.staffEntries.push(s),t.splice(i,1)}}}for(const e of t)-1===e.staffEntries.indexOf(s)&&e.staffEntries.push(s)}}for(const e of this.musicSystems)for(const t of e.StaffLines){const e=t.GraphicalSlurs.sort(E.GraphicalSlur.Compare);for(const t of e)t.slur.isCrossed()||t.calculateCurve(this.rules)}}calculateGlissandi(){const e={};for(const t of this.graphicalMusicSheet.MeasureList[0])e[t.ParentStaff.idInMusicSheet]=[];for(const t of this.musicSystems)for(const i of t.StaffLines){const t=e[i.ParentStaff.idInMusicSheet];for(let e=0;e<t.length;e++){const s=t[e],n=new R.VexFlowGlissando(s.Glissando);i.addGlissandoToStaffline(n),t[e]=n}for(const e of i.Measures)for(const s of e.staffEntries){for(const e of s.graphicalVoiceEntries)for(const n of e.notes){const e=n.sourceNote.NoteGlissando;if(e?.EndNote&&e?.StartNote){if(e.StartNote===n.sourceNote){const s=new R.VexFlowGlissando(e);t.push(s),i.addGlissandoToStaffline(s)}if(e.EndNote===n.sourceNote){const i=this.indexOfGraphicalGlissFromGliss(t,e);if(i>=0){const e=t[i];-1===e.staffEntries.indexOf(s)&&e.staffEntries.push(s),t.splice(i,1)}}}}for(const e of t)-1===e.staffEntries.indexOf(s)&&e.staffEntries.push(s)}}for(const e of this.musicSystems)for(const t of e.StaffLines)for(const e of t.GraphicalGlissandi)if(t.ParentStaff.isTab){const t=e.Glissando.StartNote,i=e.Glissando.EndNote,s=e.staffEntries[0].findGraphicalNoteFromNote(t),n=e.staffEntries.last().findGraphicalNoteFromNote(i);if(!s&&!n)return;let r,o,a,l,u=1;t.FretNumber>i.FretNumber&&(u=-1),s&&s.vfnote&&s.vfnote.length>=2&&(a=s.vfnote[0],r=[0]),n&&n.vfnote&&n.vfnote.length>=2&&(l=n.vfnote[0],o=[0]);const c=new h.TabSlide({first_indices:r,first_note:a,last_indices:o,last_note:l},u),d=s?.parentVoiceEntry.parentStaffEntry.parentMeasure;d&&(d.vfTies.push(c),e.vfTie=c);const m=n?.parentVoiceEntry.parentStaffEntry.parentMeasure;m&&(m.vfTies.push(c),e.vfTie=c)}}}t.VexFlowMusicSheetCalculator=B},813:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.CollectionUtil=void 0,Array.prototype.last||Object.defineProperty(Array.prototype,"last",{enumerable:!1,writable:!0,value:function(){return this[this.length-1]}}),Array.prototype.clear||Object.defineProperty(Array.prototype,"clear",{enumerable:!1,writable:!0,value:function(){this.length=0}}),Array.prototype.contains||Object.defineProperty(Array.prototype,"contains",{enumerable:!1,writable:!0,value:function(e){return-1!==this.indexOf(e)}}),t.CollectionUtil=class{static contains2(e,t){for(let i=0;i<e.length;i++)if(e[i]===t)return!0;return!1}static last(e){return e[e.length-1]}static flat(e){return[].concat(...e)}static removeDictElementIfTrue(e,t,i){const s=[];t.forEach(function(t,n){i(e,t,n)&&s.push(t)});for(let e=0;e<s.length;e++)t.remove(s[e])}static getLastElement(e){return e[e.length-1]}static binarySearch(e,t,i,s=0,n=e.length-1){let r=1,o=-1;for(;s<=n&&(r=Math.floor((s+n)/2),r!==o);){const a=i(e[r],t);if(0===a)return r;a<0&&(s=r+1),0<a&&(n=r),o=r}return-r}}},995:(e,t,i)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.Clickable=void 0;const s=i(7741);class n extends s.GraphicalObject{}t.Clickable=n},1066:function(e,t,i){var s=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.GraphicalContinuousDynamicExpression=void 0;const n=i(6452),r=i(5875),o=i(9409),a=i(9490),l=i(6362),u=s(i(3065));class c extends a.AbstractGraphicalExpression{constructor(e,t,i){super(t,e,i),this.lines=[],this.isSplittedPart=!1,this.notToBeRemoved=!1}get StartMeasure(){return this.startMeasure}set StartMeasure(e){this.startMeasure=e}get EndMeasure(){return this.endMeasure}set EndMeasure(e){this.endMeasure=e}get EndStaffLine(){return this.endMeasure?this.endMeasure.ParentStaffLine:void 0}get IsSplittedPart(){return this.isSplittedPart}set IsSplittedPart(e){this.isSplittedPart=e}get IsVerbal(){return this.ContinuousDynamic.Label&&this.ContinuousDynamic.Label.length>0}get NotToBeRemoved(){return this.notToBeRemoved}set NotToBeRemoved(e){this.notToBeRemoved=e}get Lines(){return this.lines}get ContinuousDynamic(){return this.SourceExpression}updateSkyBottomLine(){const e=this.parentStaffLine.SkyBottomLineCalculator,t=this.IsVerbal?this.label.PositionAndShape.RelativePosition.x+this.label.PositionAndShape.BorderMarginLeft:0,i=this.IsVerbal?this.label.PositionAndShape.RelativePosition.x+this.label.PositionAndShape.BorderMarginRight:0;switch(!this.IsSoftAccent&&!this.IsVerbal&&this.lines.length<2&&u.default.warn("Not enough lines for SkyBottomLine calculation"),this.IsVerbal||this.ContinuousDynamic.DynamicType!==r.ContDynamicEnum.crescendo&&this.ContinuousDynamic.DynamicType!==r.ContDynamicEnum.diminuendo&&u.default.warn("GraphicalContinuousDynamicExpression.updateSkyBottomLine(): unhandled continuous dynamic type. start measure: "+this.startMeasure?.MeasureNumber),this.Placement){case l.PlacementEnum.Above:if(this.IsSoftAccent)e.updateSkyLineWithWedge(this.lines[0].Start,this.lines[0].End),e.updateSkyLineWithWedge(this.lines[2].End,this.lines[2].Start),e.updateSkyLineWithLine(this.lines[0].End,this.lines[2].End,this.lines[0].End.y);else if(this.IsVerbal){const s=this.label.PositionAndShape.BorderMarginTop+this.label.PositionAndShape.RelativePosition.y;e.updateSkyLineInRange(t,i,s)}else this.ContinuousDynamic.DynamicType===r.ContDynamicEnum.crescendo?e.updateSkyLineWithWedge(this.lines[0].Start,this.lines[0].End):this.ContinuousDynamic.DynamicType===r.ContDynamicEnum.diminuendo&&e.updateSkyLineWithWedge(this.lines[0].End,this.lines[0].Start);break;case l.PlacementEnum.Below:if(this.IsVerbal){const s=this.label.PositionAndShape.BorderMarginBottom+this.label.PositionAndShape.RelativePosition.y;e.updateBottomLineInRange(t,i,s)}else this.ContinuousDynamic.DynamicType===r.ContDynamicEnum.crescendo?e.updateBottomLineWithWedge(this.lines[1].Start,this.lines[1].End):this.ContinuousDynamic.DynamicType===r.ContDynamicEnum.diminuendo&&e.updateBottomLineWithWedge(this.lines[1].End,this.lines[1].Start);break;default:u.default.error("Placement for GraphicalContinuousDynamicExpression is unknown")}}createCrescendoLines(e,t,i,s=this.rules.WedgeOpeningLength,n=this.rules.WedgeLineWidth){const r=new o.PointF2D(e,i),a=new o.PointF2D(t,i-s/2),l=new o.PointF2D(t,i+s/2);this.addWedgeLines(r,a,l,n)}createFirstHalfCrescendoLines(e,t,i,s=this.rules.WedgeMeasureEndOpeningLength,n=this.rules.WedgeLineWidth){const r=new o.PointF2D(e,i),a=new o.PointF2D(t,i-s/2),l=new o.PointF2D(t,i+s/2);this.addWedgeLines(r,a,l,n)}createSecondHalfCrescendoLines(e,t,i,s=this.rules.WedgeMeasureBeginOpeningLength,n=this.rules.WedgeOpeningLength,r=this.rules.WedgeLineWidth){const a=new o.PointF2D(e,i-s/2),l=new o.PointF2D(e,i+s/2),u=new o.PointF2D(t,i-n/2),c=new o.PointF2D(t,i+n/2);this.addDoubleLines(a,u,l,c,r)}recalculateCrescendoLines(e,t,i){const s=Math.abs(this.lines[0].Start.y-this.lines[1].Start.y)>1e-4;this.lines.clear(),s?this.createSecondHalfCrescendoLines(e,t,i):this.isSplittedPart?this.createFirstHalfCrescendoLines(e,t,i):this.createCrescendoLines(e,t,i)}createDiminuendoLines(e,t,i,s=this.rules.WedgeOpeningLength,n=this.rules.WedgeLineWidth){const r=new o.PointF2D(e,i-s/2),a=new o.PointF2D(e,i+s/2),l=new o.PointF2D(t,i);this.addWedgeLines(l,r,a,n)}createFirstHalfDiminuendoLines(e,t,i,s=this.rules.WedgeOpeningLength,n=this.rules.WedgeMeasureEndOpeningLength,r=this.rules.WedgeLineWidth){const a=new o.PointF2D(e,i-s/2),l=new o.PointF2D(e,i+s/2),u=new o.PointF2D(t,i-n/2),c=new o.PointF2D(t,i+n/2);this.addDoubleLines(a,u,l,c,r)}createSecondHalfDiminuendoLines(e,t,i,s=this.rules.WedgeMeasureBeginOpeningLength,n=this.rules.WedgeLineWidth){const r=new o.PointF2D(e,i-s/2),a=new o.PointF2D(e,i+s/2),l=new o.PointF2D(t,i);this.addWedgeLines(l,r,a,n)}recalculateDiminuendoLines(e,t,i){const s=Math.abs(this.lines[0].End.y-this.lines[1].End.y)>1e-4;this.lines.clear(),s?this.createFirstHalfDiminuendoLines(e,t,i):this.isSplittedPart?this.createSecondHalfDiminuendoLines(e,t,i):this.createDiminuendoLines(e,t,i)}createFirstHalfLines(e,t,i,s=this.rules.WedgeOpeningLength,n=this.rules.WedgeMeasureEndOpeningLength,o=this.rules.WedgeLineWidth){this.ContinuousDynamic.DynamicType===r.ContDynamicEnum.crescendo?this.createFirstHalfCrescendoLines(e,t,i,n,o):this.ContinuousDynamic.DynamicType===r.ContDynamicEnum.diminuendo&&this.createFirstHalfDiminuendoLines(e,t,i,s,n,o)}createSecondHalfLines(e,t,i,s=this.rules.WedgeMeasureBeginOpeningLength,n=this.rules.WedgeOpeningLength,o=this.rules.WedgeLineWidth){this.ContinuousDynamic.DynamicType===r.ContDynamicEnum.crescendo?this.createSecondHalfCrescendoLines(e,t,i,s,n,o):this.ContinuousDynamic.DynamicType===r.ContDynamicEnum.diminuendo&&this.createSecondHalfDiminuendoLines(e,t,i,s,o)}createLines(e,t,i,s=this.rules.WedgeOpeningLength,n=this.rules.WedgeLineWidth){this.ContinuousDynamic.DynamicType===r.ContDynamicEnum.crescendo?this.createCrescendoLines(e,t,i,s,n):this.ContinuousDynamic.DynamicType===r.ContDynamicEnum.diminuendo&&this.createDiminuendoLines(e,t,i,s,n)}calcPsi(){this.IsVerbal?this.PositionAndShape.calculateBoundingBox():(this.PositionAndShape.RelativePosition=this.lines[0].Start,this.PositionAndShape.BorderMarginTop=this.lines[0].End.y-this.lines[0].Start.y,this.PositionAndShape.BorderMarginBottom=this.lines[1].End.y-this.lines[1].Start.y,this.PositionAndShape.Center.y=(this.PositionAndShape.BorderMarginTop+this.PositionAndShape.BorderMarginBottom)/2,this.IsSoftAccent?(this.PositionAndShape.BorderMarginLeft=0,this.PositionAndShape.BorderMarginRight=this.lines[3].Start.x-this.lines[0].Start.x):this.ContinuousDynamic.DynamicType===r.ContDynamicEnum.crescendo?(this.PositionAndShape.BorderMarginLeft=0,this.PositionAndShape.BorderMarginRight=this.lines[0].End.x-this.lines[0].Start.x):(this.PositionAndShape.BorderMarginLeft=this.lines[0].End.x-this.lines[0].Start.x,this.PositionAndShape.BorderMarginRight=0))}cleanUp(){this.lines.clear()}shiftYPosition(e){this.IsVerbal?(this.PositionAndShape.RelativePosition.y+=e,this.PositionAndShape.calculateBoundingBox()):(this.lines[0].Start.y+=e,this.lines[0].End.y+=e,this.lines[1].End.y+=e)}squeeze(e){this.IsVerbal||Math.abs(this.lines[0].End.x-this.lines[0].Start.x)<Math.abs(e)||(this.ContinuousDynamic.DynamicType===r.ContDynamicEnum.crescendo?e>0?this.lines[0].Start.x+=e:(this.lines[0].End.x+=e,this.lines[1].End.x+=e):e<0?this.lines[0].Start.x+=e:(this.lines[0].End.x+=e,this.lines[1].End.x+=e),this.calcPsi())}addWedgeLines(e,t,i,s){const r=new n.GraphicalLine(e,t,s),o=new n.GraphicalLine(e,i,s);this.rules.DefaultColorMusic&&(r.colorHex=this.rules.DefaultColorMusic,o.colorHex=this.rules.DefaultColorMusic),this.lines.push(r),this.lines.push(o)}addDoubleLines(e,t,i,s,r){const o=new n.GraphicalLine(e,t,r),a=new n.GraphicalLine(i,s,r);this.rules.DefaultColorMusic&&(o.colorHex=this.rules.DefaultColorMusic,a.colorHex=this.rules.DefaultColorMusic),this.lines.push(o),this.lines.push(a)}}t.GraphicalContinuousDynamicExpression=c},1083:(e,t,i)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.AlignmentManager=void 0;const s=i(2400),n=i(9409);t.AlignmentManager=class{constructor(e){this.parentStaffline=e,this.rules=this.parentStaffline.ParentMusicSystem.rules}alignDynamicExpressions(){const e=[];let t=new Array;for(let i=0;i<this.parentStaffline.AbstractExpressions.length-1;i++){const s=this.parentStaffline.AbstractExpressions[i],n=this.parentStaffline.AbstractExpressions[i+1],r=s?.SourceExpression?.Placement,o=n?.SourceExpression?.Placement;if(r===o){const i=this.getDistance(s.PositionAndShape,n.PositionAndShape);Math.abs(i.x)<this.rules.DynamicExpressionMaxDistance?(-1===t.indexOf(s)&&t.push(s),t.push(n)):(e.push(t),t=new Array)}}e.push(t);for(const t of e)if(t.length>0){const e=t.map(e=>e.PositionAndShape.Center.y),i=Math.max(...e);for(let n=0;n<t.length;n++){const r=t[n],o=e[n]-i;if(r instanceof s.VexFlowContinuousDynamicExpression?(r.shiftYPosition(-o),r.calcPsi()):(r.PositionAndShape.RelativePosition.y-=.8*o,r.PositionAndShape.calculateBoundingBox()),r.squeeze){const e=n<t.length-1?t[n+1]:void 0,i=n>0?t[n-1]:void 0;if(e){const t=this.getOverlap(r.PositionAndShape,e.PositionAndShape);r.squeeze(-(t.x+this.rules.DynamicExpressionSpacer))}if(i){const e=this.getOverlap(i.PositionAndShape,r.PositionAndShape);r.squeeze(e.x+this.rules.DynamicExpressionSpacer)}}}}}getDistance(e,t){const i=e.RelativePosition.x+e.BorderMarginRight,s=t.RelativePosition.x+t.BorderMarginLeft,r=e.RelativePosition.y+e.BorderMarginBottom,o=t.RelativePosition.y+t.BorderMarginTop;return new n.PointF2D(s-i,o-r)}getOverlap(e,t){return new n.PointF2D(e.RelativePosition.x+e.BorderMarginRight-(t.RelativePosition.x+t.BorderMarginLeft),e.RelativePosition.y+e.BorderMarginBottom-(t.RelativePosition.y+t.BorderMarginTop))}}},1110:(e,t,i)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.DynamicsContainer=void 0;const s=i(5875),n=i(9767);t.DynamicsContainer=class{constructor(e,t){e instanceof s.ContinuousDynamicExpression?this.continuousDynamicExpression=e:e instanceof n.InstantaneousDynamicExpression&&(this.instantaneousDynamicExpression=e),this.staffNumber=t}parMultiExpression(){return this.continuousDynamicExpression?this.continuousDynamicExpression.StartMultiExpression:this.instantaneousDynamicExpression?this.instantaneousDynamicExpression.ParentMultiExpression:void 0}CompareTo(e){return this.parMultiExpression().AbsoluteTimestamp.CompareTo(e.parMultiExpression().AbsoluteTimestamp)}}},1112:(e,t,i)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.UnknownExpression=void 0;const s=i(6362),n=i(7533);class r extends s.AbstractExpression{constructor(e,t,i,s){super(t),this.label=e,this.staffNumber=s,void 0===i&&(i=n.TextAlignmentEnum.LeftBottom),this.textAlignment=i}get Label(){return this.label}get Placement(){return this.placement}set Placement(e){this.placement=e}get StaffNumber(){return this.staffNumber}set StaffNumber(e){this.staffNumber=e}get TextAlignment(){return this.textAlignment}}t.UnknownExpression=r},1216:(e,t,i)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.VexFlowGlissando=void 0;const s=i(98);class n extends s.GraphicalGlissando{}t.VexFlowGlissando=n},1272:function(e,t,i){var s=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.InstrumentReader=void 0;const n=i(469),r=i(2369),o=i(164),a=i(4543),l=i(9288),u=i(2561),c=i(2148),h=i(7307),d=i(164),m=i(9288),f=i(4543),p=s(i(3065)),S=i(164),g=i(9536),y=i(5984),E=i(3186),M=i(1336),b=i(5282),P=i(6954);t.InstrumentReader=class{constructor(e,t,i,s){this.voiceGeneratorsDict={},this.staffMainVoiceGeneratorDict={},this.divisions=0,this.currentClefNumber=1,this.currentXmlMeasureIndex=0,this.activeKeyHasBeenInitialized=!1,this.abstractInstructions=[],this.repetitionInstructionReader=t,this.xmlMeasureList=i,this.musicSheet=s.GetMusicSheet,this.instrument=s,this.activeClefs=new Array(s.Staves.length),this.activeClefsHaveBeenInitialized=new Array(s.Staves.length);for(let e=0;e<s.Staves.length;e++)this.activeClefsHaveBeenInitialized[e]=!1;this.createExpressionGenerators(s.Staves.length),this.slurReader=new E.SlurReader(this.musicSheet),this.pluginManager=e}get ActiveKey(){return this.activeKey}get MaxTieNoteFraction(){return this.maxTieNoteFraction}get ActiveRhythm(){return this.activeRhythm}set ActiveRhythm(e){this.activeRhythm=e}readNextXmlMeasure(e,t,i){if(this.currentXmlMeasureIndex>=this.xmlMeasureList.length)return!1;this.currentMeasure=e,this.followingMultirestMeasures=Math.max(this.followingMultirestMeasures-1,0),this.inSourceMeasureInstrumentIndex=this.musicSheet.getGlobalStaffIndexOfFirstStaff(this.instrument),this.repetitionInstructionReader&&this.repetitionInstructionReader.prepareReadingMeasure(e,this.currentXmlMeasureIndex);let s=new u.Fraction(0,1),n=new u.Fraction(0,1),r=!1;this.maxTieNoteFraction=new u.Fraction(0,1);let o=!1;try{const a=this.xmlMeasureList[this.currentXmlMeasureIndex],l=a.elements();let d;e.Rules.UseXMLMeasureNumbers&&!Number.isInteger(e.MeasureNumberXML)&&(d=parseInt(a.attribute("number")?.value,10),Number.isInteger(d)&&(e.MeasureNumberXML=d));const m=a.attribute("osmdWidthFactor");if(m){const t=Number.parseFloat(m.value);"number"!=typeof t||isNaN(t)?p.default.info(`xml parse: osmdWidthFactor invalid for measure ${d}`):e.WidthFactor=t}let f;for(let a=0;a<l.length;a++){const d=l[a];if(a>0&&(f=l[a-1]),"print"===d.name){const t=d.attribute("new-system");"yes"===t?.value&&(e.printNewSystemXml=!0);const i=d.attribute("new-page");"yes"===i?.value&&(e.printNewPageXml=!0)}else if("attributes"===d.name){const t=d.element("divisions");if(t&&(this.divisions=parseInt(t.value,10),isNaN(this.divisions))){const e=c.ITextTranslation.translateText("ReaderErrorMessages/DivisionError","Invalid divisions value at Instrument: ");if(p.default.debug("InstrumentReader.readNextXmlMeasure",e),this.divisions=this.readDivisionsFromNotes(),!(this.divisions>0))throw r=!0,new h.MusicSheetReadingException(e+this.instrument.Name);this.musicSheet.SheetErrors.push(e+this.instrument.Name)}if(!d.element("divisions")&&0===this.divisions&&0===this.currentXmlMeasureIndex){const e=c.ITextTranslation.translateText("ReaderErrorMessages/DivisionError","Invalid divisions value at Instrument: ");if(this.divisions=this.readDivisionsFromNotes(),!(this.divisions>0))throw r=!0,new h.MusicSheetReadingException(e+this.instrument.Name);this.musicSheet.SheetErrors.push(e+this.instrument.Name)}this.addAbstractInstruction(d,i,f,s.clone()),s.Equals(new u.Fraction(0,1))&&this.isAttributesNodeAtBeginOfMeasure(this.xmlMeasureList[this.currentXmlMeasureIndex],d)&&this.saveAbstractInstructionList(this.instrument.Staves.length,!0),this.isAttributesNodeAtEndOfMeasure(this.xmlMeasureList[this.currentXmlMeasureIndex],d,s)&&this.saveClefInstructionAtEndOfMeasure();const n=d.elements("staff-details");for(const e of n){const t=e.element("staff-lines");if(t){let i=1;const s=e.attribute("number");s&&(i=parseInt(s.value,10)),this.instrument.Staves[i-1].StafflineCount=parseInt(t.value,10)}}const o=d.element("measure-style");if(o){const t=o.element("multiple-rest");if(t){const i=t.value;let s=0;try{s=Number.parseInt(i,10),void 0!==e.multipleRestMeasures&&s!==e.multipleRestMeasures?e.multipleRestMeasures=0:(e.multipleRestMeasures=s,this.currentMultirestStartMeasure=e,this.followingMultirestMeasures=s+1)}catch(e){console.log("multirest parse error: "+e)}}}}else if("note"===d.name){let e=!0;"no"===d.attribute("print-object")?.value&&(e=!1);const r=this.getNoteStaff(d);this.currentStaff=this.instrument.Staves[r-1];const a=void 0!==d.element("chord");if(d.element("voice")){const e=parseInt(d.element("voice").value,10);this.currentVoiceGenerator=this.getOrCreateVoiceGenerator(e,r-1)}else a&&this.currentVoiceGenerator||(this.currentVoiceGenerator=this.getOrCreateVoiceGenerator(1,r-1));let l,h=0,m=new u.Fraction(0,1),f=2;const S=void 0!==d.element("rest");if(d.element("duration")){if(h=parseInt(d.element("duration").value,10),isNaN(h)){const e=c.ITextTranslation.translateText("ReaderErrorMessages/NoteDurationError","Invalid Note Duration.");this.musicSheet.SheetErrors.pushMeasureError(e),p.default.debug("InstrumentReader.readNextXmlMeasure",e);continue}if(m=new u.Fraction(h,4*this.divisions),S&&m.RealValue>this.ActiveRhythm?.Rhythm.RealValue&&(m=this.ActiveRhythm.Rhythm.clone()),0===h?m=this.getNoteDurationFromTypeNode(d):l=this.getNoteDurationFromTypeNode(d),d.element("time-modification")){m=this.getNoteDurationForTuplet(d);const e=d.element("time-modification");e?.element("normal-notes")&&(f=parseInt(e.element("normal-notes").value,10))}}const g=d.combinedElement("notations"),y=void 0!==d.element("grace")||0===h||a&&o;let E=!1,M=!1;if(y){const e=d.element("grace");e&&e.attributes()&&e.attribute("slash")&&"yes"===e.attribute("slash").value&&(E=!0),m=this.getNoteDurationFromTypeNode(d),g&&g.element("slur")&&(M=!0)}const[b,P]=this.getCueNoteAndNoteTypeXml(d),[L,v,T]=this.getStemDirectionAndColors(d);let x,A=!1;if(g){const e=g.element("ornaments");e&&(x=this.getTremoloInfo(e),A=this.getVibratoStrokes(e))}const I=a?n.clone():s.clone();this.currentStaffEntry=this.currentMeasure.findOrCreateStaffEntry(I,this.inSourceMeasureInstrumentIndex+r-1,this.currentStaff).staffEntry,(!this.currentVoiceGenerator.hasVoiceEntry()||!a&&!y&&!o||y&&!o||y&&!a||!y&&o)&&this.currentVoiceGenerator.createVoiceEntry(I,this.currentStaffEntry,!S&&!y,y,E,M),y||a||(n=s.clone(),s.Add(m)),a&&void 0!==this.currentStaffEntry&&this.currentStaffEntry.ParentStaff!==this.currentStaff&&(this.currentStaffEntry=this.currentVoiceGenerator.checkForStaffEntryLink(this.inSourceMeasureInstrumentIndex+r-1,this.currentStaff,this.currentStaffEntry,this.currentMeasure));const w=void 0!==this.currentStaffEntry&&void 0!==this.currentStaffEntry.Timestamp&&this.currentStaffEntry.Timestamp.Equals(new u.Fraction(0,1))&&!this.currentStaffEntry.hasNotes();this.saveAbstractInstructionList(this.instrument.Staves.length,w),this.activeRhythm;const N=d.elements("dot").length;if(this.currentVoiceGenerator.read(d,m,l,P,f,S,this.currentStaffEntry,this.currentMeasure,t,this.maxTieNoteFraction,a,i,e,b,y,L,x,v,T,A,N),void 0!==g&&g.element("dynamics")){const e=this.expressionReaders[this.readExpressionStaffNumber(d)-1];e&&(e.readExpressionParameters(d,this.instrument,this.divisions,s,n,this.currentMeasure.MeasureNumber,!1),e.read(d,this.currentMeasure,n))}o=y}else if("forward"===d.name){const e=parseInt(d.element("duration").value,10);s.Add(new u.Fraction(e,4*this.divisions))}else if("backup"===d.name){const e=parseInt(d.element("duration").value,10);s.Sub(new u.Fraction(e,4*this.divisions)),s.IsNegative()&&(s=new u.Fraction(0,1)),n.Sub(new u.Fraction(e,4*this.divisions)),n.IsNegative()&&(n=new u.Fraction(0,1))}else if("direction"===d.name){const e=d.element("direction-type");let t=Math.min(1,s.RealValue);void 0!==this.activeRhythm&&this.activeRhythm.Rhythm&&(t/=this.activeRhythm.Rhythm.RealValue);let i=!1;if(this.repetitionInstructionReader&&(i=this.repetitionInstructionReader.handleRepetitionInstructionsFromWordsOrSymbols(e,t)),!i){let t=this.expressionReaders[0];const i=this.readExpressionStaffNumber(d)-1;i<this.expressionReaders.length&&(t=this.expressionReaders[i]),t&&(e.element("octave-shift")&&(t.readExpressionParameters(d,this.instrument,this.divisions,s,n,this.currentMeasure.MeasureNumber,!0),t.addOctaveShift(d,this.currentMeasure,n.clone())),e.element("pedal")&&(t.readExpressionParameters(d,this.instrument,this.divisions,s,n,this.currentMeasure.MeasureNumber,!0),t.addPedalMarking(d,this.currentMeasure,s.clone())),t.readExpressionParameters(d,this.instrument,this.divisions,s,n,this.currentMeasure.MeasureNumber,!1),t.read(d,this.currentMeasure,s,n.clone()))}}else if("barline"===d.name){this.repetitionInstructionReader&&this.repetitionInstructionReader.handleLineRepetitionInstructions(d)&&(this.currentMeasure.HasEndLine=!0);const e=d.attribute("location"),t=e?.value??"right";if(a===l.length-1||"right"===t){const e=d.element("bar-style")?.value;e&&(this.currentMeasure.endingBarStyleXml=e,this.currentMeasure.endingBarStyleEnum=P.SystemLinesEnumHelper.xmlBarlineStyleToSystemLinesEnum(e))}}else if("sound"===d.name)try{if(d.attribute("tempo")){const e=parseFloat(d.attribute("tempo").value);0===this.currentXmlMeasureIndex&&(this.musicSheet.DefaultStartTempoInBpm=e,this.musicSheet.HasBPMInfo=!0)}}catch(e){p.default.debug("InstrumentReader.readTempoInstruction",e)}else if("harmony"===d.name){const e=this.getNoteStaff(d);this.currentStaff=this.instrument.Staves[e-1];const t=s.clone();this.currentStaffEntry=this.currentMeasure.findOrCreateStaffEntry(t,this.inSourceMeasureInstrumentIndex+e-1,this.currentStaff).staffEntry,this.currentStaffEntry.ChordContainers.push(g.ChordSymbolReader.readChordSymbol(d,this.musicSheet,this.activeKey))}}for(const e in this.voiceGeneratorsDict)this.voiceGeneratorsDict.hasOwnProperty(e)&&this.voiceGeneratorsDict[e].checkForOpenBeam();if(this.currentXmlMeasureIndex===this.xmlMeasureList.length-1){for(let e=0;e<this.instrument.Staves.length;e++)this.activeClefsHaveBeenInitialized[e]||this.createDefaultClefInstruction(this.musicSheet.getGlobalStaffIndexOfFirstStaff(this.instrument)+e);this.activeKeyHasBeenInitialized||this.createDefaultKeyInstruction();for(let e=0;e<this.expressionReaders.length;e++){const t=this.expressionReaders[e];t&&t.closeOpenExpressions(this.currentMeasure,s)}}this.musicSheet.HasBPMInfo?0===e.TempoInBPM&&this.previousMeasure&&(this.currentMeasure.TempoInBPM=this.previousMeasure.TempoInBPM):this.currentMeasure.TempoInBPM=120}catch(e){if(r)throw new h.MusicSheetReadingException(e.Message);const t=c.ITextTranslation.translateText("ReaderErrorMessages/MeasureError","Error while reading Measure.");this.musicSheet.SheetErrors.pushMeasureError(t),p.default.debug("InstrumentReader.readNextXmlMeasure",t,e)}return this.previousMeasure=this.currentMeasure,this.currentXmlMeasureIndex+=1,!0}getStemDirectionAndColors(e){let t,i=M.StemDirectionType.Undefined;const s=e.element("stem");if(s){i=this.getStemDirectionType(s);const e=s.attribute("color");e&&(t=this.parseXmlColor(e.value))}let n=this.getNoteHeadColorXml(e);const r=this.getNoteColorXml(e);return r&&!n&&(n=r),r&&!t&&(t=r),[i,t,n]}parseXmlColor(e){return e}doCalculationsAfterDurationHasBeenSet(){for(const e in this.voiceGeneratorsDict)this.voiceGeneratorsDict.hasOwnProperty(e)&&this.voiceGeneratorsDict[e].checkOpenTies()}getOrCreateVoiceGenerator(e,t){const i=this.instrument.Staves[t];let s=this.voiceGeneratorsDict[e];if(s)-1===i.Voices.indexOf(s.GetVoice)&&i.Voices.push(s.GetVoice);else{const r=this.staffMainVoiceGeneratorDict[t];r?(s=new n.VoiceGenerator(this.pluginManager,i,e,this.slurReader,r.GetVoice),i.Voices.push(s.GetVoice),this.voiceGeneratorsDict[e]=s):(s=new n.VoiceGenerator(this.pluginManager,i,e,this.slurReader),i.Voices.push(s.GetVoice),this.voiceGeneratorsDict[e]=s,this.staffMainVoiceGeneratorDict[t]=s)}return s}createExpressionGenerators(e){this.expressionReaders=new Array(e);for(let t=0;t<e;t++)this.expressionReaders[t]=new y.ExpressionReader(this.musicSheet,this.instrument,t+1)}createDefaultClefInstruction(e){let t;t=this.musicSheet.SourceMeasures.length>0?this.musicSheet.SourceMeasures[0]:this.currentMeasure;const i=new o.ClefInstruction(d.ClefEnum.G,0,2);let s;t.FirstInstructionsStaffEntries[e]?(s=t.FirstInstructionsStaffEntries[e],s.removeFirstInstructionOfTypeClefInstruction()):(s=new r.SourceStaffEntry(void 0,void 0),t.FirstInstructionsStaffEntries[e]=s),i.Parent=s,s.Instructions.splice(0,0,i)}createDefaultKeyInstruction(){let e;e=this.musicSheet.SourceMeasures.length>0?this.musicSheet.SourceMeasures[0]:this.currentMeasure;const t=new a.KeyInstruction(void 0,0,f.KeyEnum.major);for(let i=this.inSourceMeasureInstrumentIndex;i<this.inSourceMeasureInstrumentIndex+this.instrument.Staves.length;i++)if(e.FirstInstructionsStaffEntries[i]){const s=e.FirstInstructionsStaffEntries[i];t.Parent=s,s.removeFirstInstructionOfTypeKeyInstruction(),s.Instructions[0]instanceof o.ClefInstruction?s.Instructions.splice(1,0,t):s.Instructions.splice(0,0,t)}else{const s=new r.SourceStaffEntry(void 0,void 0);e.FirstInstructionsStaffEntries[i]=s,t.Parent=s,s.Instructions.push(t)}}isAttributesNodeAtBeginOfMeasure(e,t){const i=e.elements(),s=i.indexOf(t);if(s>0&&"backup"===i[s-1].name)return!0;let n=-1;for(let e=0;e<i.length;e++)if("note"===i[e].name){n=e;break}return s<n&&n>0||n<0}isAttributesNodeAtEndOfMeasure(e,t,i){if(i.Equals(this.ActiveRhythm?.Rhythm))return!0;const s=e.elements().slice();let n=0;for(let e=0;e<s.length;e++)if(s[e]===t){n=e;break}let r=0;for(let e=n;e<s.length;e++)if("note"===s[e].name){r=e;break}return n>r}getNoteDurationFromTypeNode(e){const t=e.element("type");if(t){const e=t.value;return b.NoteTypeHandler.getNoteDurationFromType(e)}return new u.Fraction(0,4*this.divisions)}addAbstractInstruction(e,t,i,s){if(e.element("divisions")&&1===e.elements().length)return;const n=e.element("transpose");if(n){const e=n.element("chromatic");e&&(this.instrument.PlaybackTranspose=parseInt(e.value,10))}const r=e.elements("clef");let h;if(r.length>0)for(let e=0,t=r.length;e<t;++e){const t=r[e];let i=d.ClefEnum.G,n=2,a=1,l=0;const u=t.element("line");if(u)try{n=parseInt(u.value,10)}catch(e){h=c.ITextTranslation.translateText("ReaderErrorMessages/ClefLineError","Invalid clef line. Using default."),this.musicSheet.SheetErrors.pushMeasureError(h),n=2,p.default.debug("InstrumentReader.addAbstractInstruction",h,e)}const m=t.element("sign");if(m)try{i=d.ClefEnum[m.value],o.ClefInstruction.isSupportedClef(i)||(h=c.ITextTranslation.translateText("ReaderErrorMessages/ClefError","Unsupported clef. Using default."),this.musicSheet.SheetErrors.pushMeasureError(h),i=d.ClefEnum.G,n=2),i===d.ClefEnum.TAB&&(l=-1)}catch(e){h=c.ITextTranslation.translateText("ReaderErrorMessages/ClefError","Invalid clef. Using default."),this.musicSheet.SheetErrors.pushMeasureError(h),i=d.ClefEnum.G,n=2,p.default.debug("InstrumentReader.addAbstractInstruction",h,e)}const f=t.element("clef-octave-change");if(f)try{l=parseInt(f.value,10)}catch(e){h=c.ITextTranslation.translateText("ReaderErrorMessages/ClefOctaveError","Invalid clef octave. Using default."),this.musicSheet.SheetErrors.pushMeasureError(h),l=0}if(t.hasAttributes&&t.attribute("number"))try{a=parseInt(t.attribute("number").value,10),a>this.currentClefNumber&&(a=this.currentClefNumber),this.currentClefNumber=a+1}catch(e){h=c.ITextTranslation.translateText("ReaderErrorMessages/ClefError","Invalid clef. Using default."),this.musicSheet.SheetErrors.pushMeasureError(h),a=1,this.currentClefNumber=a+1}const S=new o.ClefInstruction(i,l,n);this.abstractInstructions.push([a,S,s])}if(void 0!==e.element("key")&&this.instrument.MidiInstrumentId!==S.MidiInstrument.Percussion){let t=0;const i=e.element("key").element("fifths");if(i)try{t=parseInt(i.value,10)}catch(e){h=c.ITextTranslation.translateText("ReaderErrorMessages/KeyError","Invalid key. Set to default."),this.musicSheet.SheetErrors.pushMeasureError(h),t=0,p.default.debug("InstrumentReader.addAbstractInstruction",h,e)}let n=f.KeyEnum.none,r=e.element("key");if(r&&(r=r.element("mode")),r)try{n=f.KeyEnum[r.value]}catch(e){h=c.ITextTranslation.translateText("ReaderErrorMessages/KeyError","Invalid key/mode. Set to default."),this.musicSheet.SheetErrors.pushMeasureError(h),n=f.KeyEnum.major,p.default.debug("InstrumentReader.addAbstractInstruction",h,e)}const o=new a.KeyInstruction(void 0,t,n);this.abstractInstructions.push([1,o,s])}if(e.element("time")){const t=e.element("time");let i=m.RhythmSymbolEnum.NONE,n=!0;if(void 0!==t&&t.hasAttributes){const e=t.attribute("symbol");e&&("common"===e.value?i=m.RhythmSymbolEnum.COMMON:"cut"===e.value&&(i=m.RhythmSymbolEnum.CUT));const s=t.attribute("print-object");s&&"no"===s.value&&(n=!1)}let r=0,o=0;const a=t&&void 0!==t.element("senza-misura"),d=e.elements("time"),f=[],S=[];for(let e=0,t=d.length;e<t;++e){const t=d[e];f.push.apply(f,t.elements("beats")),S.push.apply(S,t.elements("beat-type"))}if(a)this.abstractInstructions.push([1,new l.RhythmInstruction(new u.Fraction(4,4,0,!1),m.RhythmSymbolEnum.NONE),s]);else{try{if(void 0!==f&&f.length>0&&void 0!==S&&f.length===S.length){const e=f.length,t=new Array(e);let i=0;for(let s=0;s<e;s++){const e=f[s].value;let n=0,r=0;if(-1!==e.indexOf("+")){const t=e.split("+");for(let e=0,i=t.length;e<i;++e)n+=parseInt(t[e],10)}else n=parseInt(e,10);r=parseInt(S[s].value,10),i=Math.max(i,r),t[s]=new u.Fraction(n,r,0,!1)}for(let s=0;s<e;s++)t[s].Denominator===i?r+=t[s].Numerator:r+=i/t[s].Denominator*t[s].Numerator;o=i}else r=parseInt(e.element("time").element("beats").value,10),o=parseInt(e.element("time").element("beat-type").value,10)}catch(e){h=c.ITextTranslation.translateText("ReaderErrorMessages/RhythmError","Invalid rhythm. Set to default."),this.musicSheet.SheetErrors.pushMeasureError(h),r=4,o=4,p.default.debug("InstrumentReader.addAbstractInstruction",h,e)}const t=new l.RhythmInstruction(new u.Fraction(r,o,0,!1),i);t.PrintObject=n,this.abstractInstructions.push([1,t,s])}}}saveAbstractInstructionList(e,t){for(let i=this.abstractInstructions.length-1;i>=0;i--){const s=this.abstractInstructions[i],n=s[0],u=s[1],c=s[2];if(u instanceof o.ClefInstruction){const e=u;if(0===this.currentXmlMeasureIndex||n<=this.activeClefs.length&&e!==this.activeClefs[n-1])if(t||void 0===this.currentStaffEntry||this.currentStaffEntry.hasNotes()||n-1!==this.instrument.Staves.indexOf(this.currentStaffEntry.ParentStaff))if(t){if(0!==c.RealValue)continue;let t;if(this.currentMeasure){const s=e,a=this.inSourceMeasureInstrumentIndex+n-1,l=this.currentMeasure.FirstInstructionsStaffEntries[a];if(0===this.currentXmlMeasureIndex)if(l)if(void 0===this.currentMeasure.FirstInstructionsStaffEntries[a]||l.Instructions[0]instanceof o.ClefInstruction){const e=new r.SourceStaffEntry(void 0,void 0);this.currentMeasure.LastInstructionsStaffEntries[a]=e,s.Parent=e,e.Instructions.push(s)}else t=l,s.Parent=t,t.removeFirstInstructionOfTypeClefInstruction(),t.Instructions.splice(0,0,s),this.activeClefsHaveBeenInitialized[n-1]=!0;else t=new r.SourceStaffEntry(void 0,void 0),this.currentMeasure.FirstInstructionsStaffEntries[a]=t,s.Parent=t,t.Instructions.push(s),this.activeClefsHaveBeenInitialized[n-1]=!0;else if(this.activeClefsHaveBeenInitialized[n-1]){let e=this.previousMeasure;this.followingMultirestMeasures>0&&this.currentMeasure.Rules.RenderMultipleRestMeasures&&(e=this.currentMultirestStartMeasure);const t=new r.SourceStaffEntry(void 0,void 0);e.LastInstructionsStaffEntries[a]=t,s.Parent=t,t.Instructions.push(s)}else{const e=this.musicSheet.SourceMeasures[0];e.FirstInstructionsStaffEntries[a]?(t=e.FirstInstructionsStaffEntries[a],t.removeFirstInstructionOfTypeClefInstruction()):t=new r.SourceStaffEntry(void 0,void 0),s.Parent=t,t.Instructions.splice(0,0,s),this.activeClefsHaveBeenInitialized[n-1]=!0}this.activeClefs[n-1]=e,this.abstractInstructions.splice(i,1)}}else{let t;const s=this.activeRhythm.Rhythm;s.RealValue>0&&c.RealValue/s.RealValue>.9&&s.RealValue!==c.RealValue&&(this.currentMeasure.LastInstructionsStaffEntries[n-1]||(this.currentMeasure.LastInstructionsStaffEntries[n-1]=new r.SourceStaffEntry(void 0,this.instrument.Staves[n-1])),t=this.currentMeasure.LastInstructionsStaffEntries[n-1]),t&&(e.Parent=t,t.Instructions.push(e),this.activeClefs[n-1]=e,this.abstractInstructions.splice(i,1))}else{const t=e,s=this.currentStaffEntry;if(c&&Math.abs(c.RealValue-s.Timestamp.RealValue)>.01)continue;t.Parent=s,s.removeFirstInstructionOfTypeClefInstruction(),s.Instructions.push(t),this.activeClefs[n-1]=e,this.abstractInstructions.splice(i,1)}else n<=this.activeClefs.length&&e===this.activeClefs[n-1]&&this.abstractInstructions.splice(i,1)}if(u instanceof a.KeyInstruction){const t=u;if(this.activeKey&&this.activeKey.Key===t.Key)this.abstractInstructions.splice(i,1);else{let s;if(this.activeKey=t,this.abstractInstructions.splice(i,1),this.activeKeyHasBeenInitialized?s=this.currentMeasure:(this.activeKeyHasBeenInitialized=!0,s=this.currentXmlMeasureIndex>0?this.musicSheet.SourceMeasures[0]:this.currentMeasure),s)for(let i=this.inSourceMeasureInstrumentIndex;i<this.inSourceMeasureInstrumentIndex+e;i++){const e=t;if(s.FirstInstructionsStaffEntries[i]){const t=s.FirstInstructionsStaffEntries[i];e.Parent=t,t.removeFirstInstructionOfTypeKeyInstruction(),0===t.Instructions.length?t.Instructions.push(e):t.Instructions[0]instanceof o.ClefInstruction?t.Instructions.splice(1,0,e):t.Instructions.splice(0,0,e)}else{const t=new r.SourceStaffEntry(void 0,void 0);s.FirstInstructionsStaffEntries[i]=t,e.Parent=t,t.Instructions.push(e)}}}}if(u instanceof l.RhythmInstruction){const t=u;if(this.activeRhythm&&this.activeRhythm===t)this.abstractInstructions.splice(i,1);else if(this.activeRhythm=t,this.abstractInstructions.splice(i,1),this.currentMeasure)for(let i=this.inSourceMeasureInstrumentIndex;i<this.inSourceMeasureInstrumentIndex+e;i++){const e=t;let s;this.currentMeasure.FirstInstructionsStaffEntries[i]?(s=this.currentMeasure.FirstInstructionsStaffEntries[i],s.removeFirstInstructionOfTypeRhythmInstruction()):(s=new r.SourceStaffEntry(void 0,void 0),this.currentMeasure.FirstInstructionsStaffEntries[i]=s),e.Parent=s,s.Instructions.push(e)}}}}saveClefInstructionAtEndOfMeasure(){for(let e=this.abstractInstructions.length-1;e>=0;e--){const t=this.abstractInstructions[e][0],i=this.abstractInstructions[e][1];if(i instanceof o.ClefInstruction){const s=i;if(!this.activeClefs[t-1]||s.ClefType!==this.activeClefs[t-1].ClefType||s.ClefType===this.activeClefs[t-1].ClefType&&s.Line!==this.activeClefs[t-1].Line){const i=new r.SourceStaffEntry(void 0,void 0);this.currentMeasure.LastInstructionsStaffEntries[this.inSourceMeasureInstrumentIndex+t-1]=i;const n=s;n.Parent=i,i.Instructions.push(n),this.activeClefs[t-1]=s,this.abstractInstructions.splice(e,1)}}}}getNoteDurationForTuplet(e){const t=e.element("duration"),i=Number.parseInt(t.value,10);return new u.Fraction(i,4*this.divisions)}readExpressionStaffNumber(e){let t=1;if(e.element("staff")){const i=e.element("staff");if(i)try{t=parseInt(i.value,10)}catch(e){const i=c.ITextTranslation.translateText("ReaderErrorMessages/ExpressionStaffError","Invalid Expression staff number. Set to default.");this.musicSheet.SheetErrors.pushMeasureError(i),t=1,p.default.debug("InstrumentReader.readExpressionStaffNumber",i,e)}}return t}readDivisionsFromNotes(){let e=0,t=this.currentXmlMeasureIndex,i=!1;for(;!i;){const s=this.xmlMeasureList[t].elements();for(let t=0,n=s.length;t<n;++t){const n=s[t];if("note"===n.name&&!n.element("time-modification")){const t=n.element("duration"),i=n.element("type");if(void 0!==t&&i){const s=i.value;let n=0;try{n=parseInt(t.value,10)}catch(e){p.default.debug("InstrumentReader.readDivisionsFromNotes",e);continue}switch(s){case"1024th":e=n/4*1024;break;case"512th":e=n/4*512;break;case"256th":e=n/4*256;break;case"128th":e=n/4*128;break;case"64th":e=n/4*64;break;case"32nd":e=n/4*32;break;case"16th":e=n/4*16;break;case"eighth":e=n/4*8;break;case"quarter":e=n/4*4;break;case"half":e=n/4*2;break;case"whole":e=n/4;break;case"breve":e=n/4/2;break;case"long":e=n/4/4;break;case"maxima":e=n/4/8}}}if(e>0){i=!0;break}}if(0===e&&(t++,t===this.xmlMeasureList.length)){const e=c.ITextTranslation.translateText("ReaderErrorMEssages/DivisionsError","Invalid divisions value at Instrument: ");throw new h.MusicSheetReadingException(e+this.instrument.Name)}}return e}getCueNoteAndNoteTypeXml(e){let t=!1;e.element("cue")&&(t=!0);const i=e.element("type");let s=b.NoteType.UNDEFINED;if(i){const e=i.attribute("size");"cue"===e?.value&&(t=!0),s=b.NoteTypeHandler.StringToNoteType(i.value)}return[t,s]}getStemDirectionType(e){switch(e.value){case"down":return M.StemDirectionType.Down;case"up":return M.StemDirectionType.Up;case"double":return M.StemDirectionType.Double;case"none":return M.StemDirectionType.None;default:return M.StemDirectionType.Undefined}}getNoteHeadColorXml(e){const t=e.element("notehead");if(t){const e=t.attribute("color");if(e)return this.parseXmlColor(e.value)}return null}getNoteColorXml(e){const t=e.attribute("color");return t?this.parseXmlColor(t.value):null}getTremoloInfo(e){let t,i;const s=e.element("tremolo");if(s){const e=s.attribute("type");if(e){if("single"===e.value){const e=parseInt(s.value,10);e>0&&(t=e)}else t=0;"unmeasured"===e.value&&(i=!0)}}return{tremoloStrokes:t,tremoloUnmeasured:i}}getVibratoStrokes(e){const t=e.element("wavy-line");if(void 0!==t){const e=t.attribute("type");if(e&&"start"===e.value)return!0}return!1}getNoteStaff(e){let t=1;return this.instrument.Staves.length>1&&e.element("staff")&&(t=parseInt(e.element("staff").value,10),isNaN(t)&&(p.default.debug("InstrumentReader.readNextXmlMeasure.get staff number"),t=1)),t}}},1327:function(e,t,i){var s=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.SkyBottomLineBatchCalculator=void 0;const n=i(5955),r=i(735),o=i(3508),a=s(i(3065)),l=i(813);t.SkyBottomLineBatchCalculator=class{constructor(e,t){const i=new Map;for(const t of e){const e=t.ParentMusicSystem.rules;(()=>{if(i.has(e))return i.get(e);{const t=[];return i.set(e,t),t}})().push({skyBottomLineCalculator:t.SkyBottomLineCalculator,measures:t.Measures})}this.batches=new Map;for(const[e,s]of i.entries()){const i=l.CollectionUtil.flat(s.map(e=>e.measures)),u=(()=>{if(t===n.SkyBottomLineBatchCalculatorBackendType.Plain)return new r.PlainSkyBottomLineBatchCalculatorBackend(e,i).initialize();try{return new o.WebGLSkyBottomLineBatchCalculatorBackend(e,i).initialize()}catch{return a.default.info("Couldn't create WebGLBackend for Skyline. Using fallback."),new r.PlainSkyBottomLineBatchCalculatorBackend(e,i).initialize()}})();u.initialize(),this.batches.set(e,{backend:u,entries:s})}}calculateLines(){for(const[,{backend:e,entries:t}]of this.batches){const i=e.calculateLines();let s=0;for(const{skyBottomLineCalculator:e,measures:n}of t){const t=s+n.length;e.updateLines(i.slice(s,t)),s=t}}}}},1336:(e,t,i)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.StemDirectionType=t.ArticulationEnum=t.VoiceEntry=void 0;const s=i(2561),n=i(1850),r=i(8233),o=i(8215),a=i(8233),l=i(3263);class u{constructor(e,t,i,s=!1,n=!1,r=!1){if(this.notes=[],this.articulations=[],this.technicalInstructions=[],this.lyricsEntries=new l.Dictionary,this.wantedStemDirection=h.Undefined,this.stemDirectionXml=h.Undefined,this.stemDirection=h.Undefined,this.timestamp=e,this.parentVoice=t,this.parentSourceStaffEntry=i,this.isGrace=s,this.graceAfterMainNote=!1,this.graceNoteSlash=n,this.graceSlur=r,void 0!==i){const e=i.VoiceEntries;-1===e.indexOf(this)&&e.push(this)}}get ParentSourceStaffEntry(){return this.parentSourceStaffEntry}get ParentVoice(){return this.parentVoice}get Timestamp(){return this.timestamp}set Timestamp(e){this.timestamp=e}get Notes(){return this.notes}get IsGrace(){return this.isGrace}set IsGrace(e){this.isGrace=e}get GraceAfterMainNote(){return this.graceAfterMainNote}set GraceAfterMainNote(e){this.graceAfterMainNote=e}get GraceNoteSlash(){return this.graceNoteSlash}set GraceNoteSlash(e){this.graceNoteSlash=e}get GraceSlur(){return this.graceSlur}set GraceSlur(e){this.graceSlur=e}get Articulations(){return this.articulations}set Articulations(e){this.articulations=e}get TechnicalInstructions(){return this.technicalInstructions}get LyricsEntries(){return this.lyricsEntries}get Arpeggio(){return this.arpeggio}set Arpeggio(e){this.arpeggio=e}get OrnamentContainer(){return this.ornamentContainer}set OrnamentContainer(e){this.ornamentContainer=e}set WantedStemDirection(e){this.wantedStemDirection=e}get WantedStemDirection(){return this.wantedStemDirection}set StemDirectionXml(e){this.stemDirectionXml=e}get StemDirectionXml(){return this.stemDirectionXml}set StemDirection(e){this.stemDirection=e}get StemDirection(){return this.stemDirection}get StemColorXml(){return this.stemColorXml}set StemColorXml(e){this.stemColorXml=e}get StemColor(){return this.stemColor}set StemColor(e){this.stemColor=e}hasArticulation(e){for(const t of this.articulations)if(t.Equals(e))return!0;return!1}static isSupportedArticulation(e){switch(e){case c.accent:case c.strongaccent:case c.softaccent:case c.invertedstrongaccent:case c.staccato:case c.staccatissimo:case c.spiccato:case c.tenuto:case c.fermata:case c.invertedfermata:case c.breathmark:case c.caesura:case c.lefthandpizzicato:case c.naturalharmonic:case c.snappizzicato:case c.upbow:case c.downbow:case c.bend:return!0;default:return!1}}hasTie(){for(let e=0,t=this.Notes.length;e<t;++e)if(this.Notes[e].NoteTie)return!0;return!1}hasSlur(){for(let e=0,t=this.Notes.length;e<t;++e)if(this.Notes[e].NoteSlurs.length>0)return!0;return!1}isStaccato(){for(const e of this.Articulations)if(e.articulationEnum===c.staccato)return!0;return!1}isAccent(){for(const e of this.Articulations)if(e.articulationEnum===c.accent||e.articulationEnum===c.strongaccent)return!0;return!1}getVerseNumberForLyricEntry(e){let t="1";return this.lyricsEntries.forEach((i,s)=>{e===s&&(t=i)}),t}createVoiceEntriesForOrnament(e,t){e||(e=this);const i=[];if(!e.ornamentContainer)return;const n=this.notes[0],r=n.Length,l=e.ParentVoice,u=e.Timestamp;let c=s.Fraction.createFromFraction(u);switch(e.ornamentContainer.GetOrnament){case o.OrnamentEnum.Trill:{const o=new s.Fraction(r.Numerator,8*r.Denominator),h=n.Pitch.getTransposedPitch(1);let d=t.getAlterationForPitch(h);e.OrnamentContainer.AccidentalAbove!==a.AccidentalEnum.NONE&&(d=e.ornamentContainer.AccidentalAbove);for(let e=0;e<8;e++)c=s.Fraction.plus(u,new s.Fraction(e*o.Numerator,o.Denominator)),e%2==0?this.createBaseVoiceEntry(c,o,l,n,i):this.createAlteratedVoiceEntry(c,o,l,n.SourceMeasure,h,d,i);break}case o.OrnamentEnum.Turn:{const e=new s.Fraction(r.Numerator,4*r.Denominator),o=n.Pitch.getTransposedPitch(-1),a=t.getAlterationForPitch(o),u=n.Pitch.getTransposedPitch(1),h=t.getAlterationForPitch(u);this.createAlteratedVoiceEntry(c,e,l,n.SourceMeasure,u,h,i),c.Add(e),this.createBaseVoiceEntry(c,e,l,n,i),c.Add(e),this.createAlteratedVoiceEntry(c,e,l,n.SourceMeasure,o,a,i),c.Add(e),this.createBaseVoiceEntry(c,e,l,n,i);break}case o.OrnamentEnum.InvertedTurn:{const e=new s.Fraction(r.Numerator,4*r.Denominator),o=n.Pitch.getTransposedPitch(-1),a=t.getAlterationForPitch(o),u=n.Pitch.getTransposedPitch(1),h=t.getAlterationForPitch(u);this.createAlteratedVoiceEntry(c,e,l,n.SourceMeasure,o,a,i),c.Add(e),this.createBaseVoiceEntry(c,e,l,n,i),c.Add(e),this.createAlteratedVoiceEntry(c,e,l,n.SourceMeasure,u,h,i),c.Add(e),this.createBaseVoiceEntry(c,e,l,n,i);break}case o.OrnamentEnum.DelayedTurn:{const e=new s.Fraction(r.Numerator,2*r.Denominator),o=n.Pitch.getTransposedPitch(-1),a=t.getAlterationForPitch(o),h=n.Pitch.getTransposedPitch(1),d=t.getAlterationForPitch(h);this.createBaseVoiceEntry(c,e,l,n,i),c=s.Fraction.plus(u,e),e.Denominator=8*r.Denominator,this.createAlteratedVoiceEntry(c,e,l,n.SourceMeasure,h,d,i),c.Add(e),this.createBaseVoiceEntry(c,e,l,n,i),c.Add(e),this.createAlteratedVoiceEntry(c,e,l,n.SourceMeasure,o,a,i),c.Add(e),this.createBaseVoiceEntry(c,e,l,n,i);break}case o.OrnamentEnum.DelayedInvertedTurn:{const e=new s.Fraction(r.Numerator,2*r.Denominator),o=n.Pitch.getTransposedPitch(-1),a=t.getAlterationForPitch(o),h=n.Pitch.getTransposedPitch(1),d=t.getAlterationForPitch(h);this.createBaseVoiceEntry(c,e,l,n,i),c=s.Fraction.plus(u,e),e.Denominator=8*r.Denominator,this.createAlteratedVoiceEntry(c,e,l,n.SourceMeasure,o,a,i),c.Add(e),this.createBaseVoiceEntry(c,e,l,n,i),c.Add(e),this.createAlteratedVoiceEntry(c,e,l,n.SourceMeasure,h,d,i),c.Add(e),this.createBaseVoiceEntry(c,e,l,n,i);break}case o.OrnamentEnum.Mordent:{const e=new s.Fraction(r.Numerator,4*r.Denominator),o=n.Pitch.getTransposedPitch(1),a=t.getAlterationForPitch(o);this.createBaseVoiceEntry(c,e,l,n,i),c.Add(e),this.createAlteratedVoiceEntry(c,e,l,n.SourceMeasure,o,a,i),e.Denominator=2*r.Denominator,c=s.Fraction.plus(u,e),this.createBaseVoiceEntry(c,e,l,n,i);break}case o.OrnamentEnum.InvertedMordent:{const e=new s.Fraction(r.Numerator,4*r.Denominator),o=n.Pitch.getTransposedPitch(-1),a=t.getAlterationForPitch(o);this.createBaseVoiceEntry(c,e,l,n,i),c.Add(e),this.createAlteratedVoiceEntry(c,e,l,n.SourceMeasure,o,a,i),e.Denominator=2*r.Denominator,c=s.Fraction.plus(u,e),this.createBaseVoiceEntry(c,e,l,n,i);break}default:throw new RangeError}return i}createBaseVoiceEntry(e,t,i,s,o){const a=new u(e,i,s.ParentStaffEntry),l=new r.Pitch(s.Pitch.FundamentalNote,s.Pitch.Octave,s.Pitch.Accidental),c=new n.Note(a,void 0,t,l,s.SourceMeasure);a.Notes.push(c),o.push(a)}createAlteratedVoiceEntry(e,t,i,s,o,a,l){const c=new u(e,i,void 0),h=new r.Pitch(o.FundamentalNote,o.Octave,a),d=new n.Note(c,void 0,t,h,s);c.Notes.push(d),l.push(c)}}var c,h;t.VoiceEntry=u,function(e){e[e.accent=0]="accent",e[e.strongaccent=1]="strongaccent",e[e.softaccent=2]="softaccent",e[e.marcatoup=3]="marcatoup",e[e.marcatodown=4]="marcatodown",e[e.invertedstrongaccent=5]="invertedstrongaccent",e[e.staccato=6]="staccato",e[e.staccatissimo=7]="staccatissimo",e[e.spiccato=8]="spiccato",e[e.tenuto=9]="tenuto",e[e.fermata=10]="fermata",e[e.invertedfermata=11]="invertedfermata",e[e.breathmark=12]="breathmark",e[e.caesura=13]="caesura",e[e.lefthandpizzicato=14]="lefthandpizzicato",e[e.naturalharmonic=15]="naturalharmonic",e[e.snappizzicato=16]="snappizzicato",e[e.upbow=17]="upbow",e[e.downbow=18]="downbow",e[e.scoop=19]="scoop",e[e.plop=20]="plop",e[e.doit=21]="doit",e[e.falloff=22]="falloff",e[e.stress=23]="stress",e[e.unstress=24]="unstress",e[e.detachedlegato=25]="detachedlegato",e[e.otherarticulation=26]="otherarticulation",e[e.bend=27]="bend"}(c||(t.ArticulationEnum=c={})),function(e){e[e.Undefined=-1]="Undefined",e[e.Up=0]="Up",e[e.Down=1]="Down",e[e.None=2]="None",e[e.Double=3]="Double"}(h||(t.StemDirectionType=h={}))},1645:(e,t)=>{var i,s;Object.defineProperty(t,"__esModule",{value:!0}),t.AlignmentType=t.RepetitionInstructionEnum=t.RepetitionInstruction=t.RepetitionInstructionComparer=void 0,t.RepetitionInstructionComparer=class{static Compare(e,t){if(void 0!==e.parentRepetition&&t.parentRepetition){if(e.alignment===s.End&&t.alignment===s.End){if(e.parentRepetition.StartIndex<t.parentRepetition.StartIndex)return 1;if(e.parentRepetition.StartIndex>t.parentRepetition.StartIndex)return-1}if(e.alignment===s.Begin&&t.alignment===s.Begin){if(e.parentRepetition.EndIndex<t.parentRepetition.EndIndex)return 1;if(e.parentRepetition.EndIndex>t.parentRepetition.EndIndex)return-1}}return 0}},t.RepetitionInstruction=class{constructor(e,t,i=s.End,n=void 0,r=void 0){this.endingIndices=void 0,this.measureIndex=e,r&&(this.endingIndices=r.slice()),this.type=t,this.alignment=i,this.parentRepetition=n}CompareTo(e){const t=e;if(this.measureIndex>t.measureIndex)return 1;if(this.measureIndex<t.measureIndex)return-1;if(this.alignment===s.Begin){if(t.alignment===s.End)return-1;switch(this.type){case i.Ending:return 1;case i.StartLine:return t.type===i.Ending?-1:1;case i.Coda:case i.Segno:return t.type===i.Coda?1:-1}}else{if(t.alignment===s.Begin)return 1;switch(this.type){case i.Ending:return-1;case i.Fine:case i.ToCoda:return t.type===i.Ending?1:-1;case i.ForwardJump:switch(t.type){case i.Ending:case i.Fine:case i.ToCoda:return 1}return-1;case i.DalSegnoAlFine:case i.DaCapoAlFine:case i.DalSegnoAlCoda:case i.DaCapoAlCoda:case i.DaCapo:case i.DalSegno:case i.BackJumpLine:return 1}}return 0}equals(e){if(this.measureIndex!==e.measureIndex||this.type!==e.type||this.alignment!==e.alignment)return!1;if(this.endingIndices===e.endingIndices)return!0;if(!this.endingIndices||!e.endingIndices||this.endingIndices.length!==e.endingIndices.length)return!1;for(let t=0;t<this.endingIndices.length;t++)if(this.endingIndices[t]!==e.endingIndices[t])return!1;return!0}},function(e){e[e.StartLine=0]="StartLine",e[e.ForwardJump=1]="ForwardJump",e[e.BackJumpLine=2]="BackJumpLine",e[e.Ending=3]="Ending",e[e.DaCapo=4]="DaCapo",e[e.DalSegno=5]="DalSegno",e[e.Fine=6]="Fine",e[e.ToCoda=7]="ToCoda",e[e.DalSegnoAlFine=8]="DalSegnoAlFine",e[e.DaCapoAlFine=9]="DaCapoAlFine",e[e.DalSegnoAlCoda=10]="DalSegnoAlCoda",e[e.DaCapoAlCoda=11]="DaCapoAlCoda",e[e.Coda=12]="Coda",e[e.Segno=13]="Segno",e[e.None=14]="None"}(i||(t.RepetitionInstructionEnum=i={})),function(e){e[e.Begin=0]="Begin",e[e.End=1]="End"}(s||(t.AlignmentType=s={}))},1850:(e,t,i)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.Appearance=t.Note=void 0;const s=i(2561);var n;t.Note=class{constructor(e,t,i,s,n,r){this.slurs=[],this.playbackInstrumentId=void 0,this.notehead=void 0,this.printObject=!0,this.voiceEntry=e,this.parentStaffEntry=t,this.length=i,this.pitch=s,this.sourceMeasure=n,this.isRestFlag=r??!1,this.halfTone=s?s.getHalfTone():0}get NoteAsString(){return this.pitch.toString()}ToStringShort(e=0){return!this.Pitch||this.isRest()?"rest":this.Pitch?.ToStringShort(e)}get ToStringShortGet(){return this.ToStringShort(0)}get ParentVoiceEntry(){return this.voiceEntry}set ParentVoiceEntry(e){this.voiceEntry=e}get ParentStaffEntry(){return this.parentStaffEntry}get ParentStaff(){return this.parentStaffEntry.ParentStaff}get Length(){return this.length}set Length(e){this.length=e}get SourceMeasure(){return this.sourceMeasure}get TypeLength(){return this.typeLength}set TypeLength(e){this.typeLength=e}get NoteTypeXml(){return this.noteTypeXml}set NoteTypeXml(e){this.noteTypeXml=e}get NormalNotes(){return this.normalNotes}set NormalNotes(e){this.normalNotes=e}get Pitch(){return this.pitch}get NoteBeam(){return this.beam}set NoteBeam(e){this.beam=e}set Notehead(e){this.notehead=e}get Notehead(){return this.notehead}get NoteTuplet(){return this.tuplet}set NoteTuplet(e){this.tuplet=e}get NoteGlissando(){return this.glissando}set NoteGlissando(e){this.glissando=e}get NoteTie(){return this.tie}set NoteTie(e){this.tie=e}get NoteSlurs(){return this.slurs}set NoteSlurs(e){this.slurs=e}get PlaybackInstrumentId(){return this.playbackInstrumentId}set PlaybackInstrumentId(e){this.playbackInstrumentId=e}get PrintObject(){return this.printObject}set PrintObject(e){this.printObject=e}get Arpeggio(){return this.arpeggio}set Arpeggio(e){this.arpeggio=e}get IsCueNote(){return this.isCueNote}set IsCueNote(e){this.isCueNote=e}get StemDirectionXml(){return this.stemDirectionXml}set StemDirectionXml(e){this.stemDirectionXml=e}get TremoloStrokes(){return this.TremoloInfo?.tremoloStrokes}get StemColorXml(){return this.stemColorXml}set StemColorXml(e){this.stemColorXml=e}get NoteheadColorXml(){return this.noteheadColorXml}set NoteheadColorXml(e){this.noteheadColorXml=e}get NoteheadColor(){return this.noteheadColor}set NoteheadColor(e){this.noteheadColor=e}get NoteheadColorCurrentlyRendered(){return this.noteheadColorCurrentlyRendered}set NoteheadColorCurrentlyRendered(e){this.noteheadColorCurrentlyRendered=e}isRest(){return this.isRestFlag}isWholeRest(){return this.isRest()&&this.Length.RealValue===this.sourceMeasure.ActiveTimeSignature.RealValue}isWholeMeasureNote(){return this.Length.RealValue===this.sourceMeasure.ActiveTimeSignature.RealValue}ToString(){return this.pitch?this.Pitch.ToString()+", length: "+this.length.toString():"rest note, length: "+this.length.toString()}getAbsoluteTimestamp(){return s.Fraction.plus(this.voiceEntry.Timestamp,this.sourceMeasure.AbsoluteTimestamp)}isDuplicateSlur(e){for(let t=0,i=this.slurs.length;t<i;++t){const i=this.slurs[t];if(void 0!==i.StartNote&&void 0!==i.EndNote&&void 0!==e.StartNote&&e.StartNote===i.StartNote&&i.EndNote===this&&e.PlacementXml===i.PlacementXml)return!0}return!1}hasTabEffects(){return!1}},function(e){e[e.Normal=0]="Normal",e[e.Grace=1]="Grace",e[e.Cue=2]="Cue"}(n||(t.Appearance=n={}))},1888:(e,t,i)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.PagePlacementEnum=t.GraphicalMusicPage=void 0;const s=i(6438),n=i(7741),r=i(9409);class o extends n.GraphicalObject{constructor(e){super(),this.musicSystems=[],this.labels=[],this.parent=e,this.boundingBox=new s.BoundingBox(this,void 0)}get MusicSystems(){return this.musicSystems}set MusicSystems(e){this.musicSystems=e}get Labels(){return this.labels}set Labels(e){this.labels=e}get Parent(){return this.parent}set Parent(e){this.parent=e}get PageNumber(){return this.pageNumber}set PageNumber(e){this.pageNumber=e}setMusicPageAbsolutePosition(e,t){return new r.PointF2D(0,0)}}var a;t.GraphicalMusicPage=o,function(e){e[e.Down=0]="Down",e[e.Right=1]="Right",e[e.RightDown=2]="RightDown"}(a||(t.PagePlacementEnum=a={}))},1902:function(e,t,i){var s=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.VexFlowBackend=t.VexFlowBackends=void 0;var n=s(i(3206)).default.Flow;t.VexFlowBackends=class{},t.VexFlowBackend=class{getInnerElement(){return this.inner}getCanvas(){return this.canvas}getRenderElement(){let e=this.canvas;return this.getVexflowBackendType()===n.Renderer.Backends.CANVAS&&(e=this.inner),e}getRenderer(){return this.renderer}removeAllChildrenFromContainer(e){for(;0!==e.children.length;)e.removeChild(e.children.item(0))}removeFromContainer(e){const t=this.getRenderElement();for(let i=0;i<e.children.length;i++)if(e.children.item(i)===t){e.removeChild(t);break}}resize(e,t){this.renderer.resize(e,t),this.width=e,this.height=t}}},1910:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.Staff=void 0,t.Staff=class{constructor(e,t){this.isTab=!1,this.voices=[],this.volume=1,this.stafflineCount=5,this.hasLyrics=!1,this.openTieDict={},this.parentInstrument=e,this.id=t,this.audible=!0,this.Visible=!0,this.following=!0}get ParentInstrument(){return this.parentInstrument}set ParentInstrument(e){this.parentInstrument=e}get Voices(){return this.voices}get Id(){return this.id}get Volume(){return this.volume}set Volume(e){this.volume=e}get StafflineCount(){return this.stafflineCount}set StafflineCount(e){this.stafflineCount=e}isVisible(){return this.Visible&&this.ParentInstrument.Visible}}},1932:(e,t,i)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.MusicSheetDrawer=void 0;const s=i(6438),n=i(2683),r=i(6452),o=i(200),a=i(9409),l=i(8254),u=i(7435),c=i(7533),h=i(7307),d=i(4284),m=i(512),f=i(242),p=i(7499),S=i(298);t.MusicSheetDrawer=class{constructor(e,t){this.drawableBoundingBoxElement="None",this.skyLineVisible=!1,this.bottomLineVisible=!1,this.phonicScoreMode=f.PhonicScoreModes.Manual,this.textMeasurer=e,this.splitScreenLineColor=-1,this.drawingParameters=t,this.rules=t.Rules}set Mode(e){this.phonicScoreMode=e}drawSheet(e){if(this.graphicalMusicSheet=e,this.rules=e.ParentMusicSheet.Rules,this.drawSplitScreenLine(),this.drawingParameters.drawCursors)for(const t of e.Cursors){if(!t)continue;const e=new s.BoundingBox(t);e.AbsolutePosition=t.Start,e.BorderBottom=t.End.y-t.Start.y,e.BorderRight=t.Width/2,e.BorderLeft=-t.Width/2,this.isVisible(e)&&this.drawLineAsVerticalRectangle(t,n.GraphicalLayers.Cursor)}this.drawingParameters.drawScrollIndicator&&this.drawScrollIndicator();const t=Math.min(this.graphicalMusicSheet.MusicPages.length,this.rules.MaxPageToDrawNumber);for(let e=0;e<t;e++){const t=this.graphicalMusicSheet.MusicPages[e];this.drawPage(t)}}drawLineAsHorizontalRectangle(e,t){let i=new o.RectangleF2D(e.Start.x,e.End.y-e.Width/2,e.End.x-e.Start.x,e.Width);i=this.applyScreenTransformationForRect(i),this.renderRectangle(i,t,e.styleId,e.colorHex)}drawLineAsVerticalRectangle(e,t){const i=e.Start,s=e.Width;let n=new o.RectangleF2D(i.x-s/2,i.y,s,e.End.y-i.y);n=this.applyScreenTransformationForRect(n),this.renderRectangle(n,t,e.styleId)}drawLineAsHorizontalRectangleWithOffset(e,t,i){const s=new a.PointF2D(e.Start.x+t.x,e.Start.y+t.y),n=new a.PointF2D(e.End.x+t.x,e.End.y+t.y),r=e.Width;let l=new o.RectangleF2D(s.x,n.y-r/2,n.x-s.x,r);l=this.applyScreenTransformationForRect(l),this.renderRectangle(l,i,e.styleId)}drawLineAsVerticalRectangleWithOffset(e,t,i){const s=new a.PointF2D(e.Start.x+t.x,e.Start.y+t.y),n=new a.PointF2D(e.End.x+t.x,e.End.y+t.y),r=e.Width;let l=new o.RectangleF2D(s.x,s.y,r,n.y-s.y);l=this.applyScreenTransformationForRect(l),this.renderRectangle(l,i,e.styleId)}drawRectangle(e,t){const i=e.PositionAndShape;let s=new o.RectangleF2D(i.AbsolutePosition.x,i.AbsolutePosition.y,i.BorderRight,i.BorderBottom);s=this.applyScreenTransformationForRect(s),this.renderRectangle(s,t,e.style)}calculatePixelDistance(e){throw new Error("not implemented")}drawLabel(e,t){if(!this.isVisible(e.PositionAndShape))return;const i=e.Label;if(""===i.text.trim())return;const s=this.applyScreenTransformation(e.PositionAndShape.AbsolutePosition),n=this.calculatePixelDistance(i.fontHeight),r=this.calculatePixelDistance(e.PositionAndShape.Size.width),o=Math.ceil(r),a=Math.ceil(n*(.2+e.TextLines.length));switch(i.textAlignment){case c.TextAlignmentEnum.LeftTop:break;case c.TextAlignmentEnum.LeftCenter:s.y-=a/2;break;case c.TextAlignmentEnum.LeftBottom:s.y-=a;break;case c.TextAlignmentEnum.CenterTop:s.x-=o/2;break;case c.TextAlignmentEnum.CenterCenter:s.x-=o/2,s.y-=a/2;break;case c.TextAlignmentEnum.CenterBottom:s.x-=o/2,s.y-=a;break;case c.TextAlignmentEnum.RightTop:s.x-=o;break;case c.TextAlignmentEnum.RightCenter:s.x-=o,s.y-=a/2;break;case c.TextAlignmentEnum.RightBottom:s.x-=o,s.y-=a;break;default:throw new h.ArgumentOutOfRangeException("")}return this.renderLabel(e,t,o,a,n,s)}applyScreenTransformation(e){throw new Error("not implemented")}applyScreenTransformations(e){const t=[];for(const i of e)t.push(this.applyScreenTransformation(i));return t}applyScreenTransformationForRect(e){throw new Error("not implemented")}drawSplitScreenLine(){}renderRectangle(e,t,i,s=void 0,n=1){throw new Error("not implemented")}drawScrollIndicator(){}drawSelectionStartSymbol(e){}drawSelectionEndSymbol(e){}renderLabel(e,t,i,s,n,r){throw new Error("not implemented")}renderSystemToScreen(e,t,i){}drawMeasure(e){throw new Error("not implemented")}drawSkyLine(e){}drawBottomLine(e){}drawInstrumentBrace(e,t){}drawGroupBracket(e,t){}isVisible(e){return!0}drawMusicSystem(e){const t=this.getSystemAbsBoundingRect(e),i=this.getSytemBoundingBoxInPixels(t);this.drawMusicSystemComponents(e,i,t)}getSytemBoundingBoxInPixels(e){const t=this.applyScreenTransformationForRect(e);return t.x=Math.round(t.x),t.y=Math.round(t.y),t}getSystemAbsBoundingRect(e){const t=e.PositionAndShape.BoundingRectangle;return new o.RectangleF2D(e.PositionAndShape.AbsolutePosition.x+e.PositionAndShape.BorderLeft-1,e.PositionAndShape.AbsolutePosition.y+e.PositionAndShape.BorderTop-1,t.width+6,t.height+2)}drawMusicSystemComponents(e,t,i){const s=this.graphicalMusicSheet.SelectionStartSymbol,r=this.graphicalMusicSheet.SelectionEndSymbol;this.drawingParameters.drawSelectionStartSymbol&&void 0!==s&&this.isVisible(s.PositionAndShape)&&this.drawSelectionStartSymbol(s),this.drawingParameters.drawSelectionEndSymbol&&void 0!==r&&this.isVisible(r.PositionAndShape)&&this.drawSelectionEndSymbol(r);for(const t of e.StaffLines)this.drawStaffLine(t),this.rules.RenderLyrics&&(t.LyricsDashes.length>0&&this.drawDashes(t.LyricsDashes),t.LyricLines.length>0&&this.drawLyricLines(t.LyricLines,t));for(const t of e.SystemLines)this.drawSystemLineObject(t);if(this.rules.RenderSystemLabelsAfterFirstPage||e.Parent===e.Parent.Parent.MusicPages[0])for(const t of e.Labels)t.SVGNode=this.drawLabel(t,n.GraphicalLayers.Notes);const o=this.graphicalMusicSheet.ParentMusicSheet.Instruments,a=o.filter(e=>e.isVisible()).length;for(const t of e.InstrumentBrackets)this.drawInstrumentBrace(t,e);if(o.length>0)if(a>1)for(const t of e.GroupBrackets)this.drawGroupBracket(t,e);else for(const t of e.GroupBrackets)t.Visible=!1;if(!this.leadSheet)for(const t of e.MeasureNumberLabels)t.SVGNode=this.drawLabel(t,n.GraphicalLayers.Notes);for(const t of e.StaffLines)this.drawStaffLineSymbols(t);this.drawingParameters.drawMarkedAreas&&this.drawMarkedAreas(e),this.drawingParameters.drawComments&&this.drawComment(e)}activateSystemRendering(e,t,i,s){return!0}drawSystemLineObject(e){}drawStaffLine(e){for(const t of e.Measures)this.drawMeasure(t);this.rules.RenderLyrics&&e.LyricsDashes.length>0&&this.drawDashes(e.LyricsDashes),this.drawOctaveShifts(e),this.drawPedals(e),this.drawExpressions(e),this.skyLineVisible&&this.drawSkyLine(e),this.bottomLineVisible&&this.drawBottomLine(e)}drawLyricLines(e,t){t.LyricLines.forEach(e=>{e.Start.y+=t.PositionAndShape.AbsolutePosition.y,e.End.y+=t.PositionAndShape.AbsolutePosition.y,e.Start.x+=t.PositionAndShape.AbsolutePosition.x,e.End.x+=t.PositionAndShape.AbsolutePosition.x,this.drawGraphicalLine(e,this.rules.LyricUnderscoreLineWidth,e.colorHex)})}drawExpressions(e){}drawGraphicalLine(e,t,i="black"){return this.drawLine(e.Start,e.End,i,t)}drawLine(e,t,i="#FF0000FF",s){}drawDashes(e){e.forEach(e=>{e.SVGNode=this.drawLabel(e,n.GraphicalLayers.Notes),e.SVGNode?.classList.add("dash")})}drawOctaveShifts(e){}drawStaffLines(e){if(e.StaffLines){const t=e.PositionAndShape.AbsolutePosition;for(let i=0;i<5;i++)this.drawLineAsHorizontalRectangleWithOffset(e.StaffLines[i],t,n.GraphicalLayers.Notes)}}drawInstantaneousDynamic(e){throw new Error("not implemented")}drawContinuousDynamic(e){throw new Error("not implemented")}drawSymbol(e,t,i,s=1,r=n.GraphicalLayers.Notes){}get leadSheet(){return this.graphicalMusicSheet.LeadSheet}set leadSheet(e){this.graphicalMusicSheet.LeadSheet=e}drawPage(e){if(this.isVisible(e.PositionAndShape)){for(const t of e.MusicSystems)this.isVisible(t.PositionAndShape)&&this.drawMusicSystem(t);if(e===e.Parent.MusicPages[0])for(const t of e.Labels)t.SVGNode=this.drawLabel(t,n.GraphicalLayers.Notes);this.drawableBoundingBoxElement&&this.drawBoundingBoxes(e.PositionAndShape,0,this.drawableBoundingBoxElement)}}drawBoundingBoxes(e,t=0,i="all",s=!1){const n=e.DataObject.constructor.name;let r=!1;if("all"===i?r=!0:"VexFlowStaffEntry"===i?r=e.DataObject instanceof p.VexFlowStaffEntry:"VexFlowMeasure"===i?r=e.DataObject instanceof p.VexFlowMeasure:"VexFlowGraphicalNote"===i?r=e.DataObject instanceof p.VexFlowGraphicalNote:"VexFlowVoiceEntry"===i?r=e.DataObject instanceof p.VexFlowVoiceEntry:"GraphicalLabel"===i?r=e.DataObject instanceof l.GraphicalLabel:"VexFlowStaffLine"===i?r=e.DataObject instanceof p.VexFlowStaffLine:"SystemLine"===i?r=e.DataObject instanceof d.SystemLine:"StaffLineActivitySymbol"===i?r=e.DataObject instanceof S.StaffLineActivitySymbol:"VexFlowContinuousDynamicExpression"===i&&(r=e.DataObject instanceof p.VexFlowContinuousDynamicExpression),r||n===i){let i;s&&(i=n),this.drawBoundingBox(e,void 0,!0,i,t)}t++,e.ChildElements.forEach(e=>this.drawBoundingBoxes(e,t,i))}drawBoundingBox(e,t=void 0,i=!1,s=void 0,h=0){let d=new o.RectangleF2D(e.AbsolutePosition.x+e.BorderMarginLeft,e.AbsolutePosition.y+e.BorderMarginTop,e.BorderMarginRight-e.BorderMarginLeft,e.BorderMarginBottom-e.BorderMarginTop);i&&(this.drawLineAsHorizontalRectangle(new r.GraphicalLine(new a.PointF2D(e.AbsolutePosition.x-1,e.AbsolutePosition.y),new a.PointF2D(e.AbsolutePosition.x+1,e.AbsolutePosition.y),.1,n.OutlineAndFillStyleEnum.BaseWritingColor,t),h-1),this.drawLineAsVerticalRectangle(new r.GraphicalLine(new a.PointF2D(e.AbsolutePosition.x,e.AbsolutePosition.y-1),new a.PointF2D(e.AbsolutePosition.x,e.AbsolutePosition.y+1),.1,n.OutlineAndFillStyleEnum.BaseWritingColor,t),h-1)),d=this.applyScreenTransformationForRect(d);const m=this.renderRectangle(d,n.GraphicalLayers.Background,h,t,.5);if(s){const e=new u.Label(s),t=new l.GraphicalLabel(e,.8,c.TextAlignmentEnum.CenterCenter,this.rules);t.setLabelPositionAndShapeBorders(),this.renderLabel(t,h,d.width,d.height,d.height,new a.PointF2D(d.x,d.y+12))}return m}drawMarkedAreas(e){for(const t of e.GraphicalMarkedAreas)t&&(t.systemRectangle&&this.drawRectangle(t.systemRectangle,n.GraphicalLayers.Background),t.settings&&(t.settings.SVGNode=this.drawLabel(t.settings,n.GraphicalLayers.Comment)),t.labelRectangle&&this.drawRectangle(t.labelRectangle,n.GraphicalLayers.Background),t.label&&(t.label.SVGNode=this.drawLabel(t.label,n.GraphicalLayers.Comment)))}drawComment(e){for(const t of e.GraphicalComments)t&&(t.settings&&(t.settings.SVGNode=this.drawLabel(t.settings,n.GraphicalLayers.Comment)),t.label&&(t.label.SVGNode=this.drawLabel(t.label,n.GraphicalLayers.Comment)))}drawStaffLineSymbols(e){const t=e.ParentStaff.ParentInstrument,i=e.PositionAndShape.AbsolutePosition.x,s=e.PositionAndShape.AbsolutePosition.y+2,o=e.PositionAndShape.BorderRight;t.highlight&&this.drawingParameters.drawHighlights&&this.drawLineAsHorizontalRectangle(new r.GraphicalLine(new a.PointF2D(i,s),new a.PointF2D(i+o,s),4,n.OutlineAndFillStyleEnum.Highlighted),n.GraphicalLayers.Highlight);let l=f.MusicSymbolDrawingStyle.Disabled,u=m.MusicSymbol.PLAY,c=this.drawingParameters.drawActivitySymbols;switch(this.phonicScoreMode){case f.PhonicScoreModes.Midi:u=m.MusicSymbol.PLAY,this.midiPlaybackAvailable&&e.ParentStaff.audible&&(l=f.MusicSymbolDrawingStyle.PlaybackSymbols);break;case f.PhonicScoreModes.Following:u=m.MusicSymbol.MIC,e.ParentStaff.following&&(l=f.MusicSymbolDrawingStyle.FollowSymbols);break;default:c=!1}if(c){const e=new a.PointF2D(i+o+2,s);this.drawSymbol(u,l,e)}if(this.drawingParameters.drawErrors)for(const t of e.Measures){const e=t.PositionAndShape,i=e.AbsolutePosition.x,s=e.AbsolutePosition.y+2;t.hasError&&this.graphicalMusicSheet.ParentMusicSheet.DrawErroneousMeasures&&this.drawLineAsHorizontalRectangle(new r.GraphicalLine(new a.PointF2D(i,s),new a.PointF2D(i+e.BorderRight,s),4,n.OutlineAndFillStyleEnum.ErrorUnderlay),n.GraphicalLayers.MeasureError)}}}},2148:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.ITextTranslation=void 0,t.ITextTranslation=class{static translateText(e,t){if(!this.defaultTextTranslation)return t}}},2221:(e,t,i)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.ContinuousTempoType=t.ContinuousTempoExpression=void 0;const s=i(2561),n=i(9147);class r extends n.AbstractTempoExpression{constructor(e,t,i,s){super(e,t,i,s),this.setTempoType()}static isInputStringContinuousTempo(e){return!!e&&(r.isStringInStringList(r.listContinuousTempoFaster,e)||r.isStringInStringList(r.listContinuousTempoSlower,e))}static isIncreasingTempo(e){return e<=o.piuMosso}static isDecreasingTempo(e){return e>=o.allargando&&e<=o.ritenuto}get TempoType(){return this.tempoType}set TempoType(e){this.tempoType=e}get StartTempo(){return this.startTempo}set StartTempo(e){this.startTempo=e}get EndTempo(){return this.endTempo}set EndTempo(e){this.endTempo=e}get AbsoluteEndTimestamp(){return this.absoluteEndTimestamp}set AbsoluteEndTimestamp(e){this.absoluteEndTimestamp=e}get AbsoluteTimestamp(){return this.ParentMultiTempoExpression.AbsoluteTimestamp}getAbsoluteFloatTimestamp(){return this.ParentMultiTempoExpression.AbsoluteTimestamp.RealValue}getInterpolatedTempo(e){const t=s.Fraction.plus(this.parentMultiTempoExpression.SourceMeasureParent.AbsoluteTimestamp,this.parentMultiTempoExpression.Timestamp);if(e.lt(t))return-1;if(this.absoluteEndTimestamp.lt(e))return-2;const i=s.Fraction.minus(e,t).RealValue/s.Fraction.minus(this.absoluteEndTimestamp,t).RealValue;return Math.max(0,Math.min(250,this.startTempo+(this.endTempo-this.startTempo)*i))}setTempoType(){r.isStringInStringList(r.listContinuousTempoFaster,this.label)?this.tempoType=o.accelerando:r.isStringInStringList(r.listContinuousTempoSlower,this.label)&&(this.tempoType=o.ritardando)}}var o;t.ContinuousTempoExpression=r,r.listContinuousTempoFaster=["accelerando","piu mosso","poco piu","stretto"],r.listContinuousTempoSlower=["poco meno","meno mosso","piu lento","calando","allargando","rallentando","ritardando","ritenuto","ritard.","ritard","rit.","rit","riten.","riten"],function(e){e[e.accelerando=0]="accelerando",e[e.stretto=1]="stretto",e[e.stringendo=2]="stringendo",e[e.mosso=3]="mosso",e[e.piuMosso=4]="piuMosso",e[e.allargando=5]="allargando",e[e.calando=6]="calando",e[e.menoMosso=7]="menoMosso",e[e.rallentando=8]="rallentando",e[e.ritardando=9]="ritardando",e[e.ritard=10]="ritard",e[e.rit=11]="rit",e[e.ritenuto=12]="ritenuto",e[e.rubato=13]="rubato",e[e.precipitando=14]="precipitando"}(o||(t.ContinuousTempoType=o={}))},2257:function(e,t,i){var s=this&&this.__createBinding||(Object.create?function(e,t,i,s){void 0===s&&(s=i);var n=Object.getOwnPropertyDescriptor(t,i);n&&!("get"in n?!t.__esModule:n.writable||n.configurable)||(n={enumerable:!0,get:function(){return t[i]}}),Object.defineProperty(e,s,n)}:function(e,t,i,s){void 0===s&&(s=i),e[s]=t[i]}),n=this&&this.__exportStar||function(e,t){for(var i in e)"default"===i||Object.prototype.hasOwnProperty.call(t,i)||s(t,e,i)};Object.defineProperty(t,"__esModule",{value:!0}),n(i(4434),t),n(i(4146),t),n(i(2570),t),n(i(5951),t),n(i(7533),t),n(i(2514),t)},2317:(e,t,i)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.LyricsEntry=void 0;const s=i(2570);t.LyricsEntry=class{constructor(e,t,i,s,n=-1){this.text=e,this.word=i,this.parent=s,this.verseNumber=t,n>=0&&(this.syllableIndex=n)}get Text(){return this.text}set Text(e){this.text=e}get Word(){return this.word}get Parent(){return this.parent}set Parent(e){this.parent=e}get VerseNumber(){return this.verseNumber}get SyllableIndex(){return this.syllableIndex}get IsTranslation(){return this.VerseNumber.endsWith("translation")}get IsChorus(){return this.VerseNumber.startsWith("chorus")}get FontStyle(){return this.IsChorus||this.IsTranslation?s.FontStyles.Italic:s.FontStyles.Regular}}},2369:(e,t,i)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.SourceStaffEntry=void 0;const s=i(2561),n=i(164),r=i(4543),o=i(9288);t.SourceStaffEntry=class{constructor(e,t){this.voiceEntries=[],this.instructions=[],this.chordSymbolContainers=[],this.verticalContainerParent=e,this.parentStaff=t}get ParentStaff(){return this.parentStaff}get VerticalContainerParent(){return this.verticalContainerParent}get Timestamp(){if(this.VerticalContainerParent)return this.VerticalContainerParent.Timestamp}get AbsoluteTimestamp(){if(this.VerticalContainerParent)return s.Fraction.plus(this.VerticalContainerParent.ParentMeasure.AbsoluteTimestamp,this.VerticalContainerParent.Timestamp)}get VoiceEntries(){return this.voiceEntries}set VoiceEntries(e){this.voiceEntries=e}get Link(){return this.staffEntryLink}set Link(e){this.staffEntryLink=e}get Instructions(){return this.instructions}set Instructions(e){this.instructions=e}get ChordContainers(){return this.chordSymbolContainers}set ChordContainers(e){this.chordSymbolContainers=e}removeAllInstructionsOfTypeClefInstruction(){let e=0,t=0;for(;e<this.instructions.length;)this.instructions[e]instanceof n.ClefInstruction?(this.instructions.splice(e,1),t++):e++;return t}removeFirstInstructionOfTypeClefInstruction(){for(let e=0;e<this.instructions.length;e++)if(this.instructions[e]instanceof n.ClefInstruction)return this.instructions.splice(e,1),!0;return!1}removeAllInstructionsOfTypeKeyInstruction(){let e=0,t=0;for(;e<this.instructions.length;)this.instructions[e]instanceof r.KeyInstruction?(this.instructions.splice(e,1),t++):e++;return t}removeFirstInstructionOfTypeKeyInstruction(){for(let e=0;e<this.instructions.length;e++)if(this.instructions[e]instanceof r.KeyInstruction)return this.instructions.splice(e,1),!0;return!1}removeAllInstructionsOfTypeRhythmInstruction(){let e=0,t=0;for(;e<this.instructions.length;)this.instructions[e]instanceof o.RhythmInstruction?(this.instructions.splice(e,1),t++):e++;return t}removeFirstInstructionOfTypeRhythmInstruction(){for(let e=0;e<this.instructions.length;e++)if(this.instructions[e]instanceof o.RhythmInstruction)return this.instructions.splice(e,1),!0;return!1}calculateMinNoteLength(){let e=new s.Fraction(Number.MAX_VALUE,1);for(let t=0,i=this.VoiceEntries.length;t<i;++t){const i=this.VoiceEntries[t];for(let t=0,s=i.Notes.length;t<s;++t){const s=i.Notes[t];s.Length.lt(e)&&(e=s.Length)}}return e}calculateMaxNoteLength(e=!0){let t=new s.Fraction(0,1);for(let i=0,n=this.VoiceEntries.length;i<n;++i){const n=this.VoiceEntries[i];for(let i=0,r=n.Notes.length;i<r;++i){const r=n.Notes[i];if(e&&r.NoteTie){const e=s.Fraction.createFromFraction(r.Length);let i=!1;for(const t of r.NoteTie.Notes)t!==r?i&&e.Add(t.Length):i=!0;t.lt(e)&&(t=e)}else t.lt(r.Length)&&(t=r.Length)}}return t}hasNotes(){for(let e=0,t=this.VoiceEntries.length;e<t;++e)if(this.VoiceEntries[e].Notes.length>0)return!0;return!1}hasTie(){for(let e=0,t=this.VoiceEntries.length;e<t;++e)if(this.VoiceEntries[e].hasTie())return!0;return!1}findLinkedNotes(e){for(let t=0,i=this.voiceEntries.length;t<i;++t){const i=this.voiceEntries[t];for(let t=0,s=i.Notes.length;t<s;++t){const s=i.Notes[t];s.ParentStaffEntry===this&&e.push(s)}}}get hasOnlyRests(){for(const e of this.voiceEntries)for(const t of e.Notes)if(!t.isRest())return!1;return!0}}},2395:(e,t,i)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.GraphicalLyricEntry=void 0;const s=i(8254),n=i(7435),r=i(9409),o=i(7533);t.GraphicalLyricEntry=class{constructor(e,t,i,a){this.lyricsEntry=e,this.graphicalStaffEntry=t;const l=t.parentMeasure.parentSourceMeasure.Rules.LyricsAlignmentStandard;e.Text.length>=4&&e.Parent.Notes[0].Length.Denominator>4&&o.TextAlignmentEnum.LeftBottom;const u=new n.Label(e.Text),c=this.graphicalStaffEntry.parentMeasure.parentSourceMeasure.Rules;this.graphicalLabel=new s.GraphicalLabel(u,i,l,c,t.PositionAndShape),this.graphicalLabel.Label.colorDefault=c.DefaultColorLyrics,this.graphicalLabel.PositionAndShape.RelativePosition=new r.PointF2D(0,a),this.graphicalLabel.setLabelPositionAndShapeBorders(),this.graphicalLabel.PositionAndShape.Size.width<c.LyricsExtraXShiftForShortLyricsWidthThreshold&&(this.graphicalLabel.PositionAndShape.RelativePosition.x+=c.LyricsExtraXShiftForShortLyrics,this.graphicalLabel.CenteringXShift=c.LyricsExtraXShiftForShortLyrics),l===o.TextAlignmentEnum.LeftBottom&&(this.graphicalLabel.PositionAndShape.RelativePosition.x-=1)}hasDashFromLyricWord(){if(!this.ParentLyricWord)return!1;const e=this.ParentLyricWord.GraphicalLyricsEntries.indexOf(this);return this.ParentLyricWord.GraphicalLyricsEntries.length>1&&e<this.ParentLyricWord.GraphicalLyricsEntries.length-1}get LyricsEntry(){return this.lyricsEntry}get ParentLyricWord(){return this.graphicalLyricWord}set ParentLyricWord(e){this.graphicalLyricWord=e}get GraphicalLabel(){return this.graphicalLabel}set GraphicalLabel(e){this.graphicalLabel=e}get StaffEntryParent(){return this.graphicalStaffEntry}set StaffEntryParent(e){this.graphicalStaffEntry=e}}},2400:(e,t,i)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.VexFlowContinuousDynamicExpression=void 0;const s=i(1066),n=i(8254),r=i(7435),o=i(7533),a=i(2570);class l extends s.GraphicalContinuousDynamicExpression{constructor(e,t,i,s){if(super(e,t,i),this.IsVerbal){const t=new r.Label(e.Label);this.label=new n.GraphicalLabel(t,s||this.rules.ContinuousDynamicTextHeight,o.TextAlignmentEnum.LeftCenter,this.rules,this.PositionAndShape),this.label.Label.fontStyle=a.FontStyles.Italic,this.label.setLabelPositionAndShapeBorders(),this.PositionAndShape.calculateBoundingBox()}}}t.VexFlowContinuousDynamicExpression=l},2514:(e,t)=>{var i;Object.defineProperty(t,"__esModule",{value:!0}),t.TieTypes=void 0,function(e){e.SIMPLE="",e.HAMMERON="H",e.PULLOFF="P",e.SLIDE="S",e.TAPPING="T"}(i||(t.TieTypes=i={}))},2561:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.Fraction=void 0;class i{static max(e,t){return e.RealValue>t.RealValue?e:t}static Equal(e,t){return e.wholeValue===t.wholeValue&&e.Denominator===t.Denominator&&e.Numerator===t.Numerator}static createFromFraction(e){return new i(e.numerator,e.denominator,e.wholeValue,!1)}static plus(e,t){const i=e.clone();return i.Add(t),i}static minus(e,t){const i=e.clone();return i.Sub(t),i}static multiply(e,t){return new i((e.wholeValue*e.denominator+e.numerator)*(t.wholeValue*t.denominator+t.numerator),e.denominator*t.denominator)}static greatestCommonDenominator(e,t){if(0===e)return t;if(1===t)return 1;for(;Math.abs(t)>=1&&Math.abs(e)>=1;)e>t?e-=t:t-=e;const i=Math.round(e);return Math.max(i,1)}constructor(e=0,t=1,i=0,s=!0){this.numerator=0,this.denominator=1,this.wholeValue=0,this.numerator=e,this.denominator=t,this.wholeValue=i,s&&this.simplify(),this.setRealValue()}toString(){let e=this.numerator+"/"+this.denominator;return 0!==this.wholeValue&&(e=this.wholeValue+" "+e),e}clone(){return new i(this.numerator,this.denominator,this.wholeValue,!1)}get Numerator(){return this.numerator}set Numerator(e){this.numerator!==e&&(this.numerator=e,this.simplify(),this.setRealValue())}get Denominator(){return this.denominator}set Denominator(e){this.denominator!==e&&(this.denominator=e,0!==this.numerator&&this.simplify(),this.setRealValue())}get WholeValue(){return this.wholeValue}set WholeValue(e){this.wholeValue!==e&&(this.wholeValue=e,this.setRealValue())}GetExpandedNumerator(){return this.wholeValue*this.denominator+this.numerator}calculateNumberOfNeededDots(){let e=1,t=2;const i=this.GetExpandedNumerator();for(;t<i;)e++,t=Math.pow(2,e);return Math.min(3,e-1)}IsNegative(){return this.realValue<0}get RealValue(){return this.realValue}expand(e){this.numerator*=e,this.denominator*=e,0!==this.wholeValue&&(this.numerator+=this.wholeValue*this.denominator,this.wholeValue=0)}Add(e){return this.numerator=(this.wholeValue*this.denominator+this.numerator)*e.denominator+(e.wholeValue*e.denominator+e.numerator)*this.denominator,this.denominator=this.denominator*e.denominator,this.wholeValue=0,this.simplify(),this.setRealValue(),this}Sub(e){return this.numerator=(this.wholeValue*this.denominator+this.numerator)*e.denominator-(e.wholeValue*e.denominator+e.numerator)*this.denominator,this.denominator=this.denominator*e.denominator,this.wholeValue=0,this.simplify(),this.setRealValue(),this}Quantize(e){if(this.denominator<=e)return this;const t=new i(this.numerator+1,this.denominator,this.wholeValue);for(;t.Denominator>e;)t.Numerator++;if(this.numerator>this.denominator){const s=new i(this.numerator-1,this.denominator,this.wholeValue);for(;s.Denominator>e;)s.Numerator--;if(s.Denominator<t.Denominator)return s}return t}Equals(e){return this.realValue===e?.realValue}CompareTo(e){const t=this.realValue-e.realValue;return t?t<0?-1:1:0}lt(e){return this.realValue<e.realValue}lte(e){return this.realValue<=e.realValue}gt(e){return!this.lte(e)}gte(e){return!this.lt(e)}setRealValue(){this.realValue=this.wholeValue+this.numerator/this.denominator}simplify(){if(0===this.numerator)return void(this.denominator=1);const e=i.greatestCommonDenominator(Math.abs(this.numerator),Math.abs(this.denominator));this.numerator/=e,this.denominator/=e;const t=Math.floor(this.numerator/this.denominator);if(0!==t&&(this.wholeValue+=t,this.numerator-=t*this.denominator,0===this.numerator&&(this.denominator=1)),this.denominator>i.maximumAllowedNumber){const e=this.denominator/i.maximumAllowedNumber;this.numerator=Math.round(this.numerator/e),this.denominator=Math.round(this.denominator/e)}if(this.numerator>i.maximumAllowedNumber){const e=this.numerator/i.maximumAllowedNumber;this.numerator=Math.round(this.numerator/e),this.denominator=Math.round(this.denominator/e)}}isOnBeat(e){const t=this.distanceFromBeat(e);return Math.abs(t)<i.FloatInaccuracyTolerance}distanceFromBeat(e){const t=new i(1,e.Denominator);return this.RealValue%t.RealValue}}t.Fraction=i,i.maximumAllowedNumber=46340,i.FloatInaccuracyTolerance=1e-4},2570:(e,t)=>{var i;Object.defineProperty(t,"__esModule",{value:!0}),t.FontStyles=void 0,function(e){e[e.Regular=0]="Regular",e[e.Bold=1]="Bold",e[e.Italic=2]="Italic",e[e.BoldItalic=3]="BoldItalic",e[e.Underlined=4]="Underlined"}(i||(t.FontStyles=i={}))},2683:(e,t,i)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.AutoColorSet=t.NoteState=t.GraphicalLayers=t.StyleSets=t.OUTLINE_AND_FILL_STYLE_DICT=t.OutlineAndFillStyleEnum=void 0;const s=i(3263);var n,r,o,a,l;!function(e){e[e.BaseWritingColor=0]="BaseWritingColor",e[e.FollowingCursor=1]="FollowingCursor",e[e.AlternativeFollowingCursor=2]="AlternativeFollowingCursor",e[e.PlaybackCursor=3]="PlaybackCursor",e[e.Highlighted=4]="Highlighted",e[e.ErrorUnderlay=5]="ErrorUnderlay",e[e.Selected=6]="Selected",e[e.SelectionSymbol=7]="SelectionSymbol",e[e.DebugColor1=8]="DebugColor1",e[e.DebugColor2=9]="DebugColor2",e[e.DebugColor3=10]="DebugColor3",e[e.SplitScreenDivision=11]="SplitScreenDivision",e[e.GreyTransparentOverlay=12]="GreyTransparentOverlay",e[e.MarkedArea1=13]="MarkedArea1",e[e.MarkedArea2=14]="MarkedArea2",e[e.MarkedArea3=15]="MarkedArea3",e[e.MarkedArea4=16]="MarkedArea4",e[e.MarkedArea5=17]="MarkedArea5",e[e.MarkedArea6=18]="MarkedArea6",e[e.MarkedArea7=19]="MarkedArea7",e[e.MarkedArea8=20]="MarkedArea8",e[e.MarkedArea9=21]="MarkedArea9",e[e.MarkedArea10=22]="MarkedArea10",e[e.Comment1=23]="Comment1",e[e.Comment2=24]="Comment2",e[e.Comment3=25]="Comment3",e[e.Comment4=26]="Comment4",e[e.Comment5=27]="Comment5",e[e.Comment6=28]="Comment6",e[e.Comment7=29]="Comment7",e[e.Comment8=30]="Comment8",e[e.Comment9=31]="Comment9",e[e.Comment10=32]="Comment10"}(n||(t.OutlineAndFillStyleEnum=n={})),t.OUTLINE_AND_FILL_STYLE_DICT=new s.Dictionary,t.OUTLINE_AND_FILL_STYLE_DICT.setValue(n.BaseWritingColor,"Thistle"),t.OUTLINE_AND_FILL_STYLE_DICT.setValue(n.FollowingCursor,"Aqua"),t.OUTLINE_AND_FILL_STYLE_DICT.setValue(n.AlternativeFollowingCursor,"Azure"),t.OUTLINE_AND_FILL_STYLE_DICT.setValue(n.PlaybackCursor,"Bisque"),t.OUTLINE_AND_FILL_STYLE_DICT.setValue(n.Highlighted,"CadetBlue"),t.OUTLINE_AND_FILL_STYLE_DICT.setValue(n.ErrorUnderlay,"DarkBlue"),t.OUTLINE_AND_FILL_STYLE_DICT.setValue(n.Selected,"DarkGoldenRod"),t.OUTLINE_AND_FILL_STYLE_DICT.setValue(n.SelectionSymbol,"BlanchedAlmond"),t.OUTLINE_AND_FILL_STYLE_DICT.setValue(n.DebugColor1,"Chartreuse"),t.OUTLINE_AND_FILL_STYLE_DICT.setValue(n.DebugColor2,"DarkGreen"),t.OUTLINE_AND_FILL_STYLE_DICT.setValue(n.DebugColor3,"DarkOrange"),t.OUTLINE_AND_FILL_STYLE_DICT.setValue(n.SplitScreenDivision,"FireBrick"),t.OUTLINE_AND_FILL_STYLE_DICT.setValue(n.GreyTransparentOverlay,"DarkSalmon"),t.OUTLINE_AND_FILL_STYLE_DICT.setValue(n.MarkedArea1,"DarkSeaGreen"),t.OUTLINE_AND_FILL_STYLE_DICT.setValue(n.MarkedArea2,"DarkOrchid"),t.OUTLINE_AND_FILL_STYLE_DICT.setValue(n.MarkedArea3,"Aquamarine"),t.OUTLINE_AND_FILL_STYLE_DICT.setValue(n.MarkedArea4,"DarkKhaki"),t.OUTLINE_AND_FILL_STYLE_DICT.setValue(n.MarkedArea5,"ForestGreen"),t.OUTLINE_AND_FILL_STYLE_DICT.setValue(n.MarkedArea6,"AliceBlue"),t.OUTLINE_AND_FILL_STYLE_DICT.setValue(n.MarkedArea7,"DeepPink"),t.OUTLINE_AND_FILL_STYLE_DICT.setValue(n.MarkedArea8,"Coral"),t.OUTLINE_AND_FILL_STYLE_DICT.setValue(n.MarkedArea9,"DarkOliveGreen"),t.OUTLINE_AND_FILL_STYLE_DICT.setValue(n.MarkedArea10,"Chocolate"),t.OUTLINE_AND_FILL_STYLE_DICT.setValue(n.Comment1,"DodgerBlue"),t.OUTLINE_AND_FILL_STYLE_DICT.setValue(n.Comment2,"Blue"),t.OUTLINE_AND_FILL_STYLE_DICT.setValue(n.Comment3,"Beige"),t.OUTLINE_AND_FILL_STYLE_DICT.setValue(n.Comment4,"Crimson"),t.OUTLINE_AND_FILL_STYLE_DICT.setValue(n.Comment5,"Fuchsia"),t.OUTLINE_AND_FILL_STYLE_DICT.setValue(n.Comment6,"Brown"),t.OUTLINE_AND_FILL_STYLE_DICT.setValue(n.Comment7,"BlanchedAlmond"),t.OUTLINE_AND_FILL_STYLE_DICT.setValue(n.Comment8,"CornflowerBlue"),t.OUTLINE_AND_FILL_STYLE_DICT.setValue(n.Comment9,"Cornsilk"),t.OUTLINE_AND_FILL_STYLE_DICT.setValue(n.Comment10,"DarkGrey"),function(e){e[e.MarkedArea=0]="MarkedArea",e[e.Comment=1]="Comment"}(r||(t.StyleSets=r={})),function(e){e[e.Background=0]="Background",e[e.Highlight=1]="Highlight",e[e.MeasureError=2]="MeasureError",e[e.SelectionSymbol=3]="SelectionSymbol",e[e.Cursor=4]="Cursor",e[e.PSI_Debug=5]="PSI_Debug",e[e.Notes=6]="Notes",e[e.Comment=7]="Comment",e[e.Debug_above=8]="Debug_above"}(o||(t.GraphicalLayers=o={})),function(e){e[e.Normal=0]="Normal",e[e.Selected=1]="Selected",e[e.Follow_Confirmed=2]="Follow_Confirmed",e[e.QFeedback_NotFound=3]="QFeedback_NotFound",e[e.QFeedback_OK=4]="QFeedback_OK",e[e.QFeedback_Perfect=5]="QFeedback_Perfect",e[e.Debug1=6]="Debug1",e[e.Debug2=7]="Debug2",e[e.Debug3=8]="Debug3"}(a||(t.NoteState=a={})),function(e){e.C="#d82c6b",e.D="#F89D15",e.E="#FFE21A",e.F="#4dbd5c",e.G="#009D96",e.A="#43469d",e.B="#76429c",e.Rest="#000000"}(l||(t.AutoColorSet=l={}))},2768:(e,t,i)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.GraphicalOctaveShift=void 0;const s=i(7741),n=i(437),r=i(6438),o=i(512),a=i(7307);class l extends s.GraphicalObject{constructor(e,t){super(),this.getOctaveShift=e,this.setSymbol(),this.PositionAndShape=new r.BoundingBox(this,t)}setSymbol(){switch(this.getOctaveShift.Type){case n.OctaveEnum.VA8:this.octaveSymbol=o.MusicSymbol.VA8;break;case n.OctaveEnum.VB8:this.octaveSymbol=o.MusicSymbol.VB8;break;case n.OctaveEnum.MA15:this.octaveSymbol=o.MusicSymbol.MA15;break;case n.OctaveEnum.MB15:this.octaveSymbol=o.MusicSymbol.MB15;break;default:throw new a.ArgumentOutOfRangeException("")}}}t.GraphicalOctaveShift=l},2779:function(e,t,i){var s=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.SkyBottomLineCalculator=void 0;i(9409);const n=i(9479),r=s(i(3065)),o=i(5479),a=i(9834);t.SkyBottomLineCalculator=class{constructor(e){this.mStaffLineParent=e,this.mRules=e.ParentMusicSystem.rules}updateLines(e){const t=this.StaffLineParent.Measures;if(e.length!==t.length)if(r.default.warn("SkyBottomLineCalculator: lengths of calculation result array and measure array do not match"),e.length<t.length)for(;e.length<t.length;)e.push(new o.SkyBottomLineCalculationResult([],[]));else e=e.slice(0,t.length);const i=Math.max(Math.ceil(this.StaffLineParent.PositionAndShape.Size.width*this.SamplingUnit),1);this.mSkyLine=[],this.mBottomLine=[];for(const{skyLine:t,bottomLine:i}of e)this.mSkyLine.push(...t),this.mBottomLine.push(...i);const s=this.mSkyLine.length/i,a=[],l=[];for(let e=0;e<this.mSkyLine.length&&a.length!==i;e+=s){const t=Math.min(this.mSkyLine.length,e+s);let i=this.mSkyLine.slice(e,t+1);a.push(Math.min(...i)),i=this.mBottomLine.slice(e,t+1),l.push(Math.max(...i))}this.mSkyLine=a,this.mBottomLine=l,this.mSkyLine.length!==i&&r.default.debug(`SkyLine calculation was not correct (${this.mSkyLine.length} instead of ${i})`);const u=Math.max(...this.mSkyLine);this.mSkyLine=this.mSkyLine.map(e=>(e-u)/n.unitInPixels+this.StaffLineParent.TopLineOffset);const c=Math.min(...this.mBottomLine);this.mBottomLine=this.mBottomLine.map(e=>(e-c)/n.unitInPixels+this.StaffLineParent.BottomLineOffset)}calculateLines(){const e=this.mRules.SamplingUnit,t=[],i=new a.CanvasVexFlowBackend(this.mRules);for(const s of this.StaffLineParent.Measures){s.PositionAndShape.calculateAbsolutePositionsRecursive(0,0);const n=s.getVFStave();let a=n.getWidth();a>0||s.IsExtraGraphicalMeasure||(r.default.warn("SkyBottomLineCalculator: width not > 0 in measure "+s.MeasureNumber),a=50),i.initializeHeadless(a);const l=i.getContext(),u=i.getCanvas();a=u.width;const c=u.height;n.setY(n.y+100);const h=n.getWidth();n.setWidth(a),s.format(),n.setWidth(h);try{s.draw(l)}catch(e){r.default.warn("SkyBottomLineCalculator.calculateLines.draw",e)}const d=l.getImageData(0,0,a,c),m=4,f=Math.max(Math.ceil(s.PositionAndShape.Size.width*e),1),p=new Array(f),S=new Array(f);for(let e=0;e<a;e++){for(let t=0;t<c;t++){const i=t*a*m+e*m;if(d.data[i+3]>0){p[e]=t;break}}for(let t=c;t>0;t--){const i=t*a*m+e*m;if(d.data[i+3]>0){S[e]=t;break}}}for(let e=0;e<p.length;e++)void 0===p[e]&&(p[e]=Math.max(this.findPreviousValidNumber(e,p),this.findNextValidNumber(e,p)));for(let e=0;e<S.length;e++)void 0===S[e]&&(S[e]=Math.max(this.findPreviousValidNumber(e,S),this.findNextValidNumber(e,S)));t.push(new o.SkyBottomLineCalculationResult(p,S)),i.clear()}this.updateLines(t)}updateSkyLineWithLine(e,t,i){const s=Math.floor(e.x*this.SamplingUnit),n=Math.ceil(t.x*this.SamplingUnit);for(let e=s+1;e<Math.min(n,this.SkyLine.length);e++)this.SkyLine[e]=i}updateSkyLineWithWedge(e,t){let i=Math.floor(e.x*this.SamplingUnit),s=Math.ceil(t.x*this.SamplingUnit),n=(t.y-e.y)/(t.x-e.x);s-i<=1&&(s++,n=0),i<0&&(i=0),i>=this.BottomLine.length&&(i=this.BottomLine.length-1),s<0&&(s=0),s>=this.BottomLine.length&&(s=this.BottomLine.length),this.SkyLine[i]=e.y;for(let e=i+1;e<Math.min(s,this.SkyLine.length);e++)this.SkyLine[e]=this.SkyLine[e-1]+n/this.SamplingUnit}updateBottomLineWithWedge(e,t){let i=Math.floor(e.x*this.SamplingUnit),s=Math.ceil(t.x*this.SamplingUnit),n=(t.y-e.y)/(t.x-e.x);s-i<=1&&(s++,n=0),i<0&&(i=0),i>=this.BottomLine.length&&(i=this.BottomLine.length-1),s<0&&(s=0),s>=this.BottomLine.length&&(s=this.BottomLine.length),this.BottomLine[i]=e.y;for(let e=i+1;e<s;e++)this.BottomLine[e]=this.BottomLine[e-1]+n/this.SamplingUnit}updateSkyLineInRange(e,t,i){this.updateInRange(this.mSkyLine,e,t,i)}updateBottomLineInRange(e,t,i){this.updateInRange(this.BottomLine,e,t,i)}resetSkyLineInRange(e,t){this.updateInRange(this.SkyLine,e,t)}resetBottomLineInRange(e,t){this.setInRange(this.BottomLine,e,t)}setSkyLineWithValue(e){this.SkyLine.forEach(t=>e)}setBottomLineWithValue(e){this.BottomLine.forEach(t=>e)}getLeftIndexForPointX(e,t){const i=Math.floor(e*this.SamplingUnit);return i<0?0:i>=t?t-1:i}getRightIndexForPointX(e,t){const i=Math.ceil(e*this.SamplingUnit);return i<0?0:i>=t?t-1:i}updateStaffLineBorders(){this.mStaffLineParent.PositionAndShape.BorderTop=this.getSkyLineMin(),this.mStaffLineParent.PositionAndShape.BorderMarginTop=this.getSkyLineMin(),this.mStaffLineParent.PositionAndShape.BorderBottom=this.getBottomLineMax(),this.mStaffLineParent.PositionAndShape.BorderMarginBottom=this.getBottomLineMax()}getSkyLineMin(){return Math.min(...this.SkyLine.filter(e=>!isNaN(e)))}getSkyLineMinAtPoint(e){const t=Math.round(e*this.SamplingUnit);return this.mSkyLine[t]}getSkyLineMinInRange(e,t){return this.getMinInRange(this.SkyLine,e,t)}getBottomLineMax(){return Math.max(...this.BottomLine.filter(e=>!isNaN(e)))}getBottomLineMaxAtPoint(e){const t=Math.round(e*this.SamplingUnit);return this.mBottomLine[t]}getBottomLineMaxInRange(e,t){return this.getMaxInRange(this.BottomLine,e,t)}getBottomLineMaxInBoundingBox(e){const t=Math.floor(e.AbsolutePosition.x+e.BorderLeft),i=Math.ceil(e.AbsolutePosition.x+e.BorderRight);return this.getMaxInRange(this.mBottomLine,t,i)}updateWithBoundingBoxRecursively(e){if(e.ChildElements&&e.ChildElements.length>0)this.updateWithBoundingBoxRecursively(e);else{const t=e.BorderTop+e.AbsolutePosition.y,i=e.BorderBottom+e.AbsolutePosition.y;if(t<0){const i=Math.floor(e.AbsolutePosition.x+e.BorderLeft),s=Math.ceil(e.AbsolutePosition.x+e.BorderRight);this.updateInRange(this.mSkyLine,i,s,t)}else if(i>this.StaffLineParent.StaffHeight){const t=Math.floor(e.AbsolutePosition.x+e.BorderLeft),s=Math.ceil(e.AbsolutePosition.x+e.BorderRight);this.updateInRange(this.mBottomLine,t,s,i)}}}findPreviousValidNumber(e,t){for(let i=e;i>=0;i--)if(!isNaN(t[i]))return t[i];return 0}findNextValidNumber(e,t){if(e>=t.length)return t[e-1];for(let i=e;i<t.length;i++)if(!isNaN(t[i]))return t[i];return 0}drawPixel(e,t,i="#FF0000FF"){const s=t.getContext(),n=s.fillStyle;s.fillStyle=i,s.fillRect(e.x,e.y,2,2),s.fillStyle=n}updateInRange(e,t=0,i=e.length,s=0){if(t=Math.floor(t*this.SamplingUnit),(i=Math.ceil(i*this.SamplingUnit))<t)throw new Error("start index of line is greater than the end index");t<0&&(t=0),i>e.length&&(i=e.length);for(let n=t;n<i;n++)e[n]=Math.abs(s)>Math.abs(e[n])?s:e[n]}setInRange(e,t=0,i=e.length,s=0){if(t=Math.floor(t*this.SamplingUnit),(i=Math.ceil(i*this.SamplingUnit))<t)throw new Error("start index of line is greater then the end index");t<0&&(t=0),i>e.length&&(i=e.length);for(let n=t;n<i;n++)e[n]=s}getMinInRange(e,t,i){return t=Math.floor(t*this.SamplingUnit),i=Math.ceil(i*this.SamplingUnit),e?(t<0&&(t=0),t>=e.length&&(t=e.length-1),i<0&&(i=0),i>=e.length&&(i=e.length),t>=0&&i<=e.length?Math.min(...e.slice(t,i+1)):void 0):Number.MAX_VALUE}getMaxInRange(e,t,i){return t=Math.floor(t*this.SamplingUnit),i=Math.ceil(i*this.SamplingUnit),e?(t<0&&(t=0),t>=e.length&&(t=e.length-1),i<0&&(i=0),i>=e.length&&(i=e.length),t>=0&&i<=e.length?Math.max(...e.slice(t,i+1)):void 0):Number.MIN_VALUE}get SamplingUnit(){return this.mRules.SamplingUnit}get StaffLineParent(){return this.mStaffLineParent}get SkyLine(){return this.mSkyLine}get BottomLine(){return this.mBottomLine}}},2919:(e,t,i)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.StaffLine=void 0;const s=i(6438),n=i(7741),r=i(298),o=i(9409),a=i(2779);class l extends n.GraphicalObject{constructor(e,t){super(),this.measures=[],this.staffLines=new Array(5),this.octaveShifts=[],this.lyricLines=[],this.lyricsDashes=[],this.abstractExpressions=[],this.graphicalSlurs=[],this.graphicalGlissandi=[],this.Pedals=[],this.parentMusicSystem=e,this.parentStaff=t,this.boundingBox=new s.BoundingBox(this,e.PositionAndShape),this.skyBottomLine=new a.SkyBottomLineCalculator(this),this.staffHeight=this.parentMusicSystem.rules.StaffHeight,this.topLineOffset=0,this.bottomLineOffset=4,this.calculateStaffLineOffsets()}calculateStaffLineOffsets(){if(this.ParentStaff.isTab)5===this.ParentStaff.StafflineCount?this.staffHeight=this.bottomLineOffset=6*this.ParentStaff.ParentInstrument.GetMusicSheet.Rules.TabStaffInterlineHeight:this.staffHeight=this.bottomLineOffset=this.ParentStaff.ParentInstrument.GetMusicSheet.Rules.TabStaffInterlineHeight*this.ParentStaff.StafflineCount;else switch(this.ParentStaff.StafflineCount){case 4:this.bottomLineOffset=1;break;case 3:this.topLineOffset=1,this.bottomLineOffset=1;break;case 2:this.topLineOffset=2,this.bottomLineOffset=1;break;case 1:this.topLineOffset=2,this.bottomLineOffset=2}}get Measures(){return this.measures}set Measures(e){this.measures=e}get StaffLines(){return this.staffLines}set StaffLines(e){this.staffLines=e}get NextStaffLine(){const e=this.parentMusicSystem.StaffLines.indexOf(this);return e!==this.parentMusicSystem.StaffLines.length?this.parentMusicSystem.StaffLines[e+1]:void 0}get LyricLines(){return this.lyricLines}get AbstractExpressions(){return this.abstractExpressions}set AbstractExpressions(e){this.abstractExpressions=e}set LyricLines(e){this.lyricLines=e}get LyricsDashes(){return this.lyricsDashes}set LyricsDashes(e){this.lyricsDashes=e}get ParentMusicSystem(){return this.parentMusicSystem}set ParentMusicSystem(e){this.parentMusicSystem=e}get ParentStaff(){return this.parentStaff}set ParentStaff(e){this.parentStaff=e}get SkyBottomLineCalculator(){return this.skyBottomLine}get SkyLine(){return this.skyBottomLine.SkyLine}get BottomLine(){return this.skyBottomLine.BottomLine}get OctaveShifts(){return this.octaveShifts}set OctaveShifts(e){this.octaveShifts=e}get StaffHeight(){return this.staffHeight}get TopLineOffset(){return this.topLineOffset}get BottomLineOffset(){return this.bottomLineOffset}get GraphicalSlurs(){return this.graphicalSlurs}get GraphicalGlissandi(){return this.graphicalGlissandi}addSlurToStaffline(e){this.graphicalSlurs.push(e)}addGlissandoToStaffline(e){this.graphicalGlissandi.push(e),e.StaffLine=this}addActivitySymbolClickArea(){const e=new r.StaffLineActivitySymbol(this),t=this.PositionAndShape;e.PositionAndShape.RelativePosition=new o.PointF2D(t.RelativePosition.x+t.BorderRight+.5,t.RelativePosition.y+.5),e.PositionAndShape.Parent=this.parentMusicSystem.PositionAndShape}isPartOfMultiStaffInstrument(){return this.parentStaff.ParentInstrument.Staves.length>1}findClosestStaffEntry(e){let t;for(let i=0,s=this.Measures.length;i<s;++i){const s=this.Measures[i];for(let i=0,n=s.staffEntries.length;i<n;++i){const n=s.staffEntries[i];Math.abs(n.PositionAndShape.RelativePosition.x-e+s.PositionAndShape.RelativePosition.x)<5&&(t=n)}}return t}}t.StaffLine=l},3109:function(e,t,i){var s=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.VexFlowInstrumentBracket=void 0;var n=s(i(3206)).default.Flow;const r=i(7741),o=i(6438),a=i(9479);class l extends r.GraphicalObject{constructor(e,t,i=0){super(),this.Visible=!0,this.PositionAndShape=new o.BoundingBox(this,e.ParentMusicSystem.PositionAndShape);const s=e.Measures[0],r=t.Measures[0];this.addConnector(s.getVFStave(),r.getVFStave(),n.StaveConnector.type.BRACKET,i)}draw(e){this.Visible&&this.vexflowConnector.setContext(e).draw();const t=this.vexflowConnector,i=t.top_stave.getYForLine(0),s=t.bottom_stave.getYForLine(t.bottom_stave.getNumLines()-1)+t.thickness;this.PositionAndShape.AbsolutePosition.x=(t.top_stave.getX()-2+t.x_shift)/a.unitInPixels,this.PositionAndShape.AbsolutePosition.y=i/a.unitInPixels,this.PositionAndShape.Size.height=(s-i)/a.unitInPixels,this.PositionAndShape.Size.width=12/a.unitInPixels}addConnector(e,t,i,s){this.vexflowConnector=new n.StaveConnector(e,t).setType(i).setXShift(-5*s)}}t.VexFlowInstrumentBracket=l},3123:(e,t)=>{var i;Object.defineProperty(t,"__esModule",{value:!0}),t.TechnicalInstruction=t.TechnicalInstructionType=void 0,function(e){e[e.Fingering=0]="Fingering",e[e.String=1]="String"}(i||(t.TechnicalInstructionType=i={})),t.TechnicalInstruction=class{}},3173:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.AJAX=void 0,t.AJAX=class{static ajax(e,t=9e3){let i;const s=e.indexOf(".mxl")>-1?"text/plain; charset=x-user-defined":"application/xml";if(XMLHttpRequest)i=new XMLHttpRequest;else{if(!ActiveXObject)return Promise.reject(new Error("XMLHttp not supported."));i=new ActiveXObject("Microsoft.XMLHTTP")}return i.timeout=t,new Promise((t,n)=>{i.onreadystatechange=()=>{i.readyState===XMLHttpRequest.DONE&&(200===i.status||0===i.status&&i.responseText?t(i.responseText):n(new Error("Could not retrieve requested URL "+i.status)))},i.ontimeout=e=>{n(new Error("Server request Timeout"))},i.overrideMimeType(s),i.open("GET",e,!0),i.send()})}}},3186:function(e,t,i){var s=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.SlurReader=void 0;const n=i(6229),r=s(i(3065)),o=i(2148),a=i(4980),l=i(7718);t.SlurReader=class{constructor(e){this.openSlurDict={},this.musicSheet=e}addSlur(e,t){try{if(e)for(const i of e)if(i.attributes().length>0){const e=i.attribute("type").value;let s=1;try{i.attribute("number")&&(s=parseInt(i.attribute("number").value,10))}catch(e){r.default.debug("VoiceGenerator.addSlur number: ",e)}let o=a.PlacementEnum.NotYetDefined;const u=i.attribute("placement");u&&u.value&&("above"===u.value?o=a.PlacementEnum.Above:"below"===u.value&&(o=a.PlacementEnum.Below));const c=i.attribute("orientation");if(c&&c.value&&("over"===c.value?o=a.PlacementEnum.Above:"under"===c.value&&(o=a.PlacementEnum.Below)),"start"===e){let e=this.openSlurDict[s];e||(e=new n.Slur,this.openSlurDict[s]=e),e.StartNote=t,e.PlacementXml=o}else if("stop"===e){const e=this.openSlurDict[s];if(e){const n=i.name;if("slide"===n||"glissando"===n){const i=e.StartNote,n=new l.Glissando(i);n.AddNote(t),n.EndNote=t,t.NoteGlissando=n,delete this.openSlurDict[s]}else e.EndNote=t,t.isDuplicateSlur(e)||(t.NoteSlurs.push(e),e.StartNote.NoteSlurs.push(e)),delete this.openSlurDict[s]}}}}catch(e){const t=o.ITextTranslation.translateText("ReaderErrorMessages/SlurError","Error while reading slur.");this.musicSheet.SheetErrors.pushMeasureError(t)}}}},3236:(e,t,i)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.VerticalSourceStaffEntryContainer=void 0;const s=i(2561);t.VerticalSourceStaffEntryContainer=class{constructor(e,t,i){this.staffEntries=[],this.comments=[],this.timestamp=t,this.staffEntries=new Array(i),this.parentMeasure=e}$get$(e){return this.staffEntries[e]}$set$(e,t){this.staffEntries[e]=t}get Timestamp(){return this.timestamp}set Timestamp(e){this.timestamp=e}get StaffEntries(){return this.staffEntries}set StaffEntries(e){this.staffEntries=e}get Comments(){return this.comments}set Comments(e){this.comments=e}get ParentMeasure(){return this.parentMeasure}set ParentMeasure(e){this.parentMeasure=e}getAbsoluteTimestamp(){return s.Fraction.plus(this.timestamp,this.parentMeasure.AbsoluteTimestamp)}}},3253:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.Pedal=void 0,t.Pedal=class{constructor(e=!1,t=!0){this.ChangeEnd=!1,this.ChangeBegin=!1,this.EndsStave=!1,this.BeginsStave=!1,this.line=e,this.sign=t}get IsLine(){return this.line}get IsSign(){return this.sign}}},3361:(e,t,i)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.GraphicalInstantaneousTempoExpression=void 0;const s=i(9490);class n extends s.AbstractGraphicalExpression{constructor(e,t){super(t.PositionAndShape.Parent.DataObject,e,e.parentMeasure),this.label=t}get GraphicalLabel(){return this.label}updateSkyBottomLine(){}}t.GraphicalInstantaneousTempoExpression=n},3430:(e,t,i)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.GraphicalNote=void 0;const s=i(8233),n=i(7741),r=i(7921),o=i(6438);class a extends n.GraphicalObject{constructor(e,t,i,n=void 0){super(),this.DrawnAccidental=s.AccidentalEnum.NONE,this.lineShift=0,this.sourceNote=e,this.parentVoiceEntry=t,this.PositionAndShape=new o.BoundingBox(this,t.PositionAndShape),this.graphicalNoteLength=n||e.Length,this.numberOfDots=this.calculateNumberOfNeededDots(this.graphicalNoteLength),this.rules=i,this.rules.addGraphicalNoteToNoteMap(e,this)}Transpose(e,t,i,s){let n=this.sourceNote.Pitch;return r.MusicSheetCalculator.transposeCalculator&&(n=r.MusicSheetCalculator.transposeCalculator.transposePitch(this.sourceNote.Pitch,e,i)),n}calculateNumberOfNeededDots(e){return this.sourceNote&&this.sourceNote.NoteTuplet?0:e.calculateNumberOfNeededDots()}get ParentMusicPage(){return this.parentVoiceEntry.parentStaffEntry.parentMeasure.ParentMusicSystem?.Parent}static FromNote(e,t){return t.NoteToGraphicalNoteMap.getValue(e.NoteToGraphicalNoteObjectId)}ToStringShort(e=0){return this.sourceNote?.ToStringShort(e)}get ToStringShortGet(){return this.ToStringShort(0)}}t.GraphicalNote=a},3457:(e,t,i)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.SourceMusicPart=void 0;const s=i(7551),n=i(2561);class r extends s.PartListEntry{constructor(e,t,i){super(e),this.musicSheet=e,this.startIndex=t,this.endIndex=i}get MeasuresCount(){return this.endIndex-this.startIndex+1}get StartIndex(){return this.startIndex}get EndIndex(){return this.endIndex}get ParentRepetition(){return this.parentRepetition}set ParentRepetition(e){this.parentRepetition=e}get AbsoluteTimestamp(){return n.Fraction.createFromFraction(this.musicSheet.SourceMeasures[this.startIndex].AbsoluteTimestamp)}setStartIndex(e){this.startIndex=e}setEndIndex(e){this.endIndex=e}}t.SourceMusicPart=r},3508:function(e,t,i){var s=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.WebGLSkyBottomLineBatchCalculatorBackend=void 0;const n=i(5479),r=i(3667),o=s(i(5340)),a=s(i(5166)),l=s(i(3065)),u=i(813);function c(e,t,i){const s=e.createShader(t);if(!s)throw l.default.warn("WebGLSkyBottomLineCalculatorBackend: Could not create a WebGL shader"),new Error("Could not create a WebGL shader");if(e.shaderSource(s,i),e.compileShader(s),!e.getShaderParameter(s,e.COMPILE_STATUS))throw l.default.warn("Shader compilation failed\n"+e.getShaderInfoLog(s)),e.deleteShader(s),new Error("WebGL shader compilation failed");return s}class h extends r.SkyBottomLineBatchCalculatorBackend{constructor(e,t){super(e,t)}getPreferredRenderingConfiguration(e,t){const i=Math.min(4096,function(){const e=document.createElement("canvas").getContext("webgl");return e.getParameter(e.MAX_TEXTURE_SIZE)}()),s=Math.ceil(e);return{elementWidth:s,numColumns:Math.min(5,Math.floor(i/s)),numRows:Math.min(5,Math.floor(i/t))}}onInitialize(e){const{elementWidth:t,elementHeight:i,numColumns:s,numRows:n}=e,r=document.createElement("canvas");r.width=t*s,r.height=n;const h=r.getContext("webgl");if(!h)throw l.default.warn("WebGLSkyBottomLineCalculatorBackend: No WebGL support"),new Error("No WebGL support");this.gl=h;const d=function(e,t,i){const s=e.createProgram();if(!s)throw l.default.warn("WebGLSkyBottomLineCalculatorBackend: Could not create a WebGL program"),new Error("Could not create a WebGL program");if(e.attachShader(s,t),e.attachShader(s,i),e.linkProgram(s),!e.getProgramParameter(s,e.LINK_STATUS))throw l.default.warn("WebGLSkyBottomLineCalculatorBackend: WebGL program link failed\n"+e.getProgramInfoLog(s)),e.deleteProgram(s),new Error("WebGL program link failed");return s}(h,c(h,h.VERTEX_SHADER,o.default),c(h,h.FRAGMENT_SHADER,function(e,t){let i=e;for(const[e,s]of Object.entries(t)){const t=new RegExp(`#define ${e} .*`);i=i.replace(t,`#define ${e} ${s}`)}return i}(a.default,{NUM_ROWS:n,ELEMENT_HEIGHT:i})));!function(e,t){const i=e.createBuffer();if(!i)throw l.default.warn("WebGLSkyBottomLineCalculatorBackend: WebGL buffer creation failed"),new Error("WebGL buffer creation failed");e.bindBuffer(e.ARRAY_BUFFER,i),e.bufferData(e.ARRAY_BUFFER,new Float32Array(u.CollectionUtil.flat([[-1,-1],[1,-1],[1,1],[-1,-1],[1,1],[-1,1]])),e.STATIC_DRAW),e.useProgram(t);const s=e.getAttribLocation(t,"a_position");e.enableVertexAttribArray(s),e.vertexAttribPointer(s,2,e.FLOAT,!1,0,0)}(h,d),this.texture=function(e,t){const i=e.createTexture();if(!i)throw l.default.warn("WebGLSkyBottomLineCalculatorBackend: WebGL texture creation failed"),new Error("WebGL texture creation failed");e.activeTexture(e.TEXTURE0+0),e.bindTexture(e.TEXTURE_2D,i),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_S,e.CLAMP_TO_EDGE),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_T,e.CLAMP_TO_EDGE),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MIN_FILTER,e.NEAREST),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MAG_FILTER,e.NEAREST);const s=e.getUniformLocation(t,"u_image");if(!s)throw l.default.warn("WebGLSkyBottomLineCalculatorBackend: WebGL invalid uniform name"),new Error("WebGL invalid uniform name");return e.uniform1i(s,0),i}(h,d)}calculateFromCanvas(e,t,i,s,r){const o=this.gl,{elementWidth:a,elementHeight:l,numColumns:u}=r;o.viewport(0,0,o.canvas.width,o.canvas.height),o.bindTexture(o.TEXTURE_2D,this.texture),o.texImage2D(o.TEXTURE_2D,0,o.RGBA,o.RGBA,o.UNSIGNED_BYTE,e),o.drawArrays(o.TRIANGLES,0,6);const c=new Uint8Array(o.canvas.width*o.canvas.height*4);o.readPixels(0,0,o.canvas.width,o.canvas.height,o.RGBA,o.UNSIGNED_BYTE,c);const h=[];for(let e=0;e<i.length;++e){const t=i[e],r=Math.floor(t.getVFStave().getWidth()),o=Math.max(Math.ceil(t.PositionAndShape.Size.width*s),1),d=e%u*a*4,m=Math.floor(e/u)*a*u*4,f=new Array(Math.max(o,r)).fill(0),p=new Array(Math.max(o,r)).fill(0);for(let e=0;e<r;++e){const t=c[4*e+d+m],i=c[4*e+d+m+1],s=c[4*e+d+m+2],n=t+256*Math.floor(s/16),r=i+s%16*256;f[e]=n,p[e]=r}const S=Math.max(...f),g=Math.min(...p);for(let e=0;e<r;++e)f[e]=0===f[e]?S:f[e],p[e]=p[e]===l?g:p[e];h.push(new n.SkyBottomLineCalculationResult(f,p))}return h}}t.WebGLSkyBottomLineBatchCalculatorBackend=h},3661:(e,t,i)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.DrawingParameters=void 0;const s=i(9713),n=i(6362),r=i(4146);t.DrawingParameters=class{constructor(e=r.DrawingParametersEnum.default,t){this.drawCursors=!0,this.drawTitle=!0,this.drawSubtitle=!0,this.drawLyricist=!0,this.drawComposer=!0,this.drawCopyright=!1,this.drawCredits=!0,this.drawPartNames=!0,this.fingeringPosition=n.PlacementEnum.Left,this.drawHiddenNotes=!1,this.rules=t,this.rules||(this.rules=new s.EngravingRules),this.DrawingParametersEnum=e}set DrawingParametersEnum(e){switch(this.drawingParametersEnum=e,e){case r.DrawingParametersEnum.allon:this.setForAllOn();break;case r.DrawingParametersEnum.thumbnail:this.setForThumbnail();break;case r.DrawingParametersEnum.leadsheet:this.setForLeadsheet();break;case r.DrawingParametersEnum.compact:this.setForCompactMode();break;case r.DrawingParametersEnum.compacttight:this.setForCompactTightMode();break;case r.DrawingParametersEnum.default:default:this.setForDefault()}}get DrawingParametersEnum(){return this.drawingParametersEnum}setForAllOn(){this.drawHighlights=!0,this.drawErrors=!0,this.drawSelectionStartSymbol=!0,this.drawSelectionEndSymbol=!0,this.drawCursors=!0,this.drawActivitySymbols=!0,this.drawScrollIndicator=!0,this.drawComments=!0,this.drawMarkedAreas=!0,this.DrawTitle=!0,this.DrawSubtitle=!0,this.DrawComposer=!0,this.DrawLyricist=!0,this.drawCredits=!0,this.DrawPartNames=!0,this.drawHiddenNotes=!0,this.rules.CompactMode=!1}setForDefault(){this.rules.loadDefaultValues(),this.setForAllOn(),this.drawHiddenNotes=!1}setForThumbnail(){this.drawHighlights=!1,this.drawErrors=!1,this.drawSelectionStartSymbol=!1,this.drawSelectionStartSymbol=!1,this.drawCursors=!1,this.drawActivitySymbols=!1,this.drawScrollIndicator=!1,this.drawComments=!0,this.drawMarkedAreas=!0,this.drawHiddenNotes=!1}setForCompactMode(){this.rules.CompactMode=!0,this.DrawCredits=!1,this.drawHiddenNotes=!1}setForCompactTightMode(){this.setForCompactMode(),this.DrawPartNames=!1,this.rules.VoiceSpacingMultiplierVexflow=.65,this.rules.VoiceSpacingAddendVexflow=2,this.rules.MinSkyBottomDistBetweenStaves=1,this.rules.MinSkyBottomDistBetweenSystems=1,this.rules.BetweenStaffDistance=2.5,this.rules.StaffDistance=3.5,this.rules.MinimumDistanceBetweenSystems=1,this.rules.PageBottomMargin=0,this.rules.PageLeftMargin=2,this.rules.PageRightMargin=2}setForLeadsheet(){this.drawHighlights=!1,this.drawErrors=!1,this.drawSelectionStartSymbol=!0,this.drawSelectionEndSymbol=!0,this.drawCursors=!0,this.drawActivitySymbols=!1,this.drawScrollIndicator=!0,this.drawComments=!0,this.drawMarkedAreas=!0}get DrawCredits(){return this.drawCredits}set DrawCredits(e){this.drawCredits=e,this.DrawComposer=e,this.DrawTitle=e,this.DrawSubtitle=e,this.DrawLyricist=e,this.DrawCopyright=e}get DrawTitle(){return this.drawTitle}set DrawTitle(e){this.drawTitle=e,this.rules.RenderTitle=e,e||(this.DrawSubtitle=!1)}get DrawSubtitle(){return this.drawSubtitle}set DrawSubtitle(e){this.drawSubtitle=e,this.rules.RenderSubtitle=e,e&&(this.DrawTitle=!0)}get DrawComposer(){return this.drawComposer}set DrawComposer(e){this.drawComposer=e,this.rules.RenderComposer=e}get DrawLyricist(){return this.drawLyricist}set DrawLyricist(e){this.drawLyricist=e,this.rules.RenderLyricist=e}get DrawCopyright(){return this.drawCopyright}set DrawCopyright(e){this.drawCopyright=e,this.rules.RenderCopyright=e}get DrawPartNames(){return this.drawPartNames}set DrawPartNames(e){this.drawPartNames=e,this.rules.RenderPartNames=e,this.rules.RenderPartNames||(this.rules.RenderPartAbbreviations=!1)}get FingeringPosition(){return this.fingeringPosition}set FingeringPosition(e){this.fingeringPosition=e,this.rules.FingeringPosition=e}get Rules(){return this.rules}set Rules(e){this.rules=e}}},3667:function(e,t,i){var s=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.SkyBottomLineBatchCalculatorBackend=void 0;const n=i(9834),r=s(i(3065));t.SkyBottomLineBatchCalculatorBackend=class{constructor(e,t){this.elementHeight=300,this.canvas=new n.CanvasVexFlowBackend(e),this.measures=t,this.maxWidth=Math.max(...this.measures.map(e=>{let t=e.getVFStave().getWidth();return t>0||e.IsExtraGraphicalMeasure||(r.default.warn("SkyBottomLineBatchCalculatorBackend: width not > 0 in measure "+e.MeasureNumber),t=50),t})),this.samplingUnit=e.SamplingUnit}initialize(){if(this.tableConfiguration={...this.getPreferredRenderingConfiguration(this.maxWidth,this.elementHeight),elementHeight:this.elementHeight},this.tableConfiguration.numRows<1||this.tableConfiguration.numColumns<1)throw r.default.warn("SkyBottomLineBatchCalculatorBackend: numRows or numColumns in tableConfiguration is 0"),new Error("numRows or numColumns in tableConfiguration is 0");this.tableConfiguration.elementWidth<this.maxWidth&&r.default.warn("SkyBottomLineBatchCalculatorBackend: elementWidth in tableConfiguration is less than the width of widest measure");const e=this.tableConfiguration.elementWidth*this.tableConfiguration.numColumns,t=this.elementHeight*this.tableConfiguration.numRows;return this.canvas.initializeHeadless(e,t),this.onInitialize(this.tableConfiguration),this}calculateLines(){const{numColumns:e,numRows:t,elementWidth:i}=this.tableConfiguration,s=this.elementHeight,n=e*t,o=this.canvas.getContext(),a=o,l=this.canvas.getCanvas(),u=[];for(let t=0;t<this.measures.length;t+=n){o.clear();const c=this.measures.slice(t,t+n);for(let t=0;t<c.length;++t){const n=c[t],l=n.getVFStave(),u=t%e,h=Math.floor(t/e);let d=l.getWidth();d>0||n.IsExtraGraphicalMeasure||(d=50),d=Math.floor(d),n.PositionAndShape.calculateAbsolutePositionsRecursive(0,0);const m=0;l.setX(m);const f=l.y+100;l.setY(f);const p=l.getWidth();l.setWidth(d),n.format(),l.setWidth(p);try{a.translate(u*i,h*s),n.draw(o),a.translate(-u*i,-h*s)}catch(e){r.default.warn("SkyBottomLineBatchCalculatorBackend.calculateLines.draw",e)}}const h=this.calculateFromCanvas(l,o,c,this.samplingUnit,this.tableConfiguration);u.push(...h)}return u}}},3753:function(e,t,i){var s=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.VexFlowGraphicalSymbolFactory=void 0;var n=s(i(3206)).default.Flow;const r=i(4332),o=i(5246),a=i(6670),l=i(437),u=i(9635),c=i(6659),h=i(4134),d=i(6014),m=i(6173),f=i(5866),p=i(3849),S=i(6362);t.VexFlowGraphicalSymbolFactory=class{createMusicSystem(e,t){return new r.VexFlowMusicSystem(e,t)}createStaffLine(e,t){return new f.VexFlowStaffLine(e,t)}createGraphicalMeasure(e,t,i=!1){return new o.VexFlowMeasure(t,e,void 0)}createMultiRestMeasure(e,t,i){return new p.VexFlowMultiRestMeasure(t,e,i)}createTabStaffMeasure(e,t){return new m.VexFlowTabMeasure(t,e)}createExtraGraphicalMeasure(e){const t=new o.VexFlowMeasure(e.ParentStaff,void 0,e);return t.IsExtraGraphicalMeasure=!0,t.ExtraGraphicalMeasurePreviousMeasure=e.Measures.last(),t}createStaffEntry(e,t){return new a.VexFlowStaffEntry(t,e,void 0)}createVoiceEntry(e,t){return new h.VexFlowVoiceEntry(e,t)}createNote(e,t,i,s=l.OctaveEnum.NONE,n,r=void 0){return new u.VexFlowGraphicalNote(e,t,i,s,n,r)}createGraceNote(e,t,i,s,n=l.OctaveEnum.NONE){return new u.VexFlowGraphicalNote(e,t,i,n,s)}addGraphicalAccidental(e,t){e.setAccidental(t)}addFermataAtTiedEndNote(e,t){}createInStaffClef(e,t){const i=e,s=d.VexFlowConverter.Clef(t,"small");i.vfClefBefore=new n.ClefNote(s.type,s.size,s.annotation)}createChordSymbols(e,t,i,s){const n=t.parentMeasure.parentSourceMeasure.Rules;let r=0;const o=n.ChordSymbolXSpacing;for(const a of e.ChordContainers){if(!a)continue;let e=t.PositionAndShape;1===t.graphicalVoiceEntries.length&&1===t.graphicalVoiceEntries[0].notes.length&&t.graphicalVoiceEntries[0].notes[0].sourceNote.isWholeRest()&&(e=t.parentMeasure.PositionAndShape,r+=t.parentMeasure.beginInstructionsWidth,r+=n.ChordSymbolWholeMeasureRestXOffset);const l=new c.GraphicalChordSymbolContainer(a,e,n.ChordSymbolTextHeight,i,s,n),u=l.GetChordSymbolContainer.Placement,h=l.GraphicalLabel;u===S.PlacementEnum.Below?h.PositionAndShape.RelativePosition.y=n.StaffHeight+n.ChordSymbolYOffset:h.PositionAndShape.RelativePosition.y-=n.ChordSymbolYOffset,h.setLabelPositionAndShapeBorders();let d=0;h.PositionAndShape.Size.width<n.ChordSymbolExtraXShiftWidthThreshold&&(d=n.ChordSymbolExtraXShiftForShortChordSymbols),h.PositionAndShape.RelativePosition.x+=r+d,h.setLabelPositionAndShapeBorders(),l.PositionAndShape.calculateBoundingBox(),t.graphicalChordContainers.push(l),r+=h.PositionAndShape.Size.width+o}}createGraphicalTechnicalInstruction(e,t){}}},3849:function(e,t,i){var s=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.VexFlowMultiRestMeasure=void 0;var n=s(i(3206)).default.Flow;const r=i(5246);class o extends r.VexFlowMeasure{constructor(e,t=void 0,i=void 0){super(e,t,i),this.minimumStaffEntriesWidth=-1,i?this.rules=i.ParentMusicSystem.rules:t&&(this.rules=t.Rules),this.resetLayout(),this.multiRestElement=new n.MultiMeasureRest(t.multipleRestMeasures,{})}draw(e){const t=e.openGroup();t&&(t.classList?.add("vf-measure"),t.classList?.add("multi"),t.id=`${this.MeasureNumber}`),this.stave.setContext(e).draw(),this.multiRestElement.setStave(this.stave),this.multiRestElement.setContext(e),this.multiRestElement.draw(),e.closeGroup();for(const t of this.connectors)t.setContext(e).draw()}format(){for(const e of this.staffEntries){const t=this.PositionAndShape.Size.width-this.beginInstructionsWidth;e.PositionAndShape.RelativePosition.x=this.PositionAndShape.Size.width/2+this.beginInstructionsWidth/3,e.PositionAndShape.RelativePosition.y=0;const i=e.graphicalVoiceEntries[0]?.notes[0]?.PositionAndShape;i.BorderLeft=-t/3,i.BorderRight=t/3,i.BorderTop=1,i.BorderBottom=3,e.PositionAndShape.calculateBoundingBox()}}getVoicesWithinMeasure(){return[]}getGraphicalVoiceEntriesPerVoice(e){return[]}getRestFilledVexFlowStaveNotesPerVoice(e){return[]}handleBeam(e,t){}handleTuplet(e,t){}finalizeBeams(){}finalizeTuplets(){}layoutStaffEntry(e){}graphicalMeasureCreatedCalculations(){}createArticulations(){}createOrnaments(){}createFingerings(e){}getVFStave(){return this.stave}}t.VexFlowMultiRestMeasure=o},3902:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.IXmlElement=void 0;class i{constructor(e){if(this.hasAttributes=!1,!e)throw new Error("IXmlElement: expected Element, got undefined");this.elem=e,this.name=e.nodeName.toLowerCase(),e.hasAttributes()&&(this.hasAttributes=!0,this.firstAttribute=e.attributes[0]),this.hasElements=e.hasChildNodes(),1===e.childNodes.length&&e.childNodes[0].nodeType===Node.TEXT_NODE?this.value=e.childNodes[0].nodeValue:this.value=""}attribute(e){return this.elem.attributes.getNamedItem(e)}attributes(){if(!this.attrs){const e=this.elem.attributes,t=[];for(let i=0;i<e.length;i+=1)t.push(e[i]);this.attrs=t}return this.attrs}element(e){const t=this.elem.childNodes;for(let s=0,n=t.length;s<n;s+=1){const n=t[s];if(n.nodeType===Node.ELEMENT_NODE&&n.nodeName.toLowerCase()===e)return new i(n)}}elements(e){const t=this.elem.childNodes,s=[],n=!e;n||(e=e.toLowerCase());for(let r=0;r<t.length;r+=1){const o=t[r];o.nodeType!==Node.ELEMENT_NODE||!n&&o.nodeName.toLowerCase()!==e||s.push(new i(o))}return s}combinedElement(e){const t=this.elem.childNodes;if(t.length>0){let s;for(let i=0,n=t.length;i<n;i+=1){const n=t[i];if(n.nodeType===Node.ELEMENT_NODE&&n.nodeName.toLowerCase()===e)if(s){const e=n.childNodes;for(let t=0,i=e.length;t<i;t+=1){const i=e[t];s.appendChild(i.cloneNode(!0))}}else s=n}if(s)return new i(s)}}}t.IXmlElement=i},4022:function(e,t,i){var s=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.GraphicalSlur=void 0;const n=i(9409),r=i(6711),o=i(6362),a=i(6904),l=i(4249),u=i(2561),c=i(1336);var h=s(i(3206)).default.Flow;class d extends r.GraphicalCurve{constructor(e,t){super(),this.staffEntries=[],this.slur=e,this.rules=t}static Compare(e,t){if(e.staffEntries.length<1)return-1;if(t.staffEntries.length<1)return 1;const i=u.Fraction.minus(e.staffEntries[e.staffEntries.length-1].getAbsoluteTimestamp(),e.staffEntries[0].getAbsoluteTimestamp()),s=u.Fraction.minus(t.staffEntries[t.staffEntries.length-1].getAbsoluteTimestamp(),t.staffEntries[0].getAbsoluteTimestamp());return i.RealValue>s.RealValue?1:s.RealValue>i.RealValue?-1:0}calculateCurve(e){const t=this.staffEntries[0],i=this.staffEntries[this.staffEntries.length-1];let s=t.findGraphicalNoteFromNote(this.slur.StartNote);!s&&this.graceStart&&(s=t.findGraphicalNoteFromGraceNote(this.slur.StartNote)),s||(s=t.findEndTieGraphicalNoteFromNoteWithStartingSlur(this.slur.StartNote,this.slur));let r=i.findGraphicalNoteFromNote(this.slur.EndNote);!r&&this.graceEnd&&(r=i.findGraphicalNoteFromGraceNote(this.slur.EndNote));const l=t.parentMeasure.ParentStaffLine,u=l.SkyBottomLineCalculator;this.calculatePlacement(u,l);const c=this.calculateStartAndEnd(s,r,l,e,u),h=c.startX,d=c.endX;let m=c.startY,f=c.endY;const p=e.SlurTangentMinAngle,S=e.SlurTangentMaxAngle;let g;if(this.placement===o.PlacementEnum.Above){m-=e.SlurNoteHeadYOffset,f-=e.SlurNoteHeadYOffset;const t=new n.PointF2D(this.staffEntries[0].parentMeasure.PositionAndShape.RelativePosition.x+this.staffEntries[0].PositionAndShape.RelativePosition.x,m);s?t.x+=this.staffEntries[0].PositionAndShape.BorderRight:t.x=this.staffEntries[0].parentMeasure.beginInstructionsWidth,this.graceStart&&(t.x+=i.PositionAndShape.RelativePosition.x);const o=new n.PointF2D(this.staffEntries[this.staffEntries.length-1].parentMeasure.PositionAndShape.RelativePosition.x+this.staffEntries[this.staffEntries.length-1].PositionAndShape.RelativePosition.x,f);if(r?o.x+=this.staffEntries[this.staffEntries.length-1].PositionAndShape.BorderLeft:o.x=this.staffEntries[this.staffEntries.length-1].parentMeasure.PositionAndShape.RelativePosition.x+this.staffEntries[this.staffEntries.length-1].parentMeasure.PositionAndShape.Size.width,this.graceEnd&&(o.x+=i.staffEntryParent.PositionAndShape.RelativePosition.x),g=this.calculateTopPoints(t,o,l,u),0===g.length){const e=new n.PointF2D((o.x-t.x)/2+t.x,(o.y-t.y)/2+t.y);g.push(e)}const c=Math.atan((f-m)/(d-h)),y=new n.PointF2D(0,0);let E=new n.PointF2D(d-h,-(f-m));const M=a.Matrix2D.getRotationMatrix(c),b=M.getTransposeMatrix();E=M.vectorMultiplication(E);const P=this.calculateTranslatedAndRotatedPointListAbove(g,h,m,M),L=this.calculateMaxLeftSlope(P,y,E),v=this.calculateMaxRightSlope(P,y,E),T=y.y-y.x*L,x=E.y-E.x*v,A=new n.PointF2D;let I=!1;Math.abs(Math.abs(L)-Math.abs(v))<1e-4?(A.x=E.x/2,A.y=0,I=!0):(A.x=(x-T)/(L-v),A.y=L*A.x+T);const w=this.calculateHeightWidthRatio(E.x,P),N=0,C=0;let R=p,B=-p;if(!I){const e=this.calculateAngles(p,L,v,S);R=e.startAngle,B=e.endAngle}const D=this.calculateControlPoints(E.x,R,B,P,w,m,f);let F=D.startControlPoint,V=D.endControlPoint;F=b.vectorMultiplication(F),F.x+=h,F.y=-F.y+m,V=b.vectorMultiplication(V),V.x+=h,V.y=-V.y+m,this.bezierStartPt=new n.PointF2D(h,m-N),this.bezierStartControlPt=new n.PointF2D(F.x,F.y-N),this.bezierEndControlPt=new n.PointF2D(V.x,V.y-C),this.bezierEndPt=new n.PointF2D(d,f-C);const O=l.SkyLine.length,_=u.getLeftIndexForPointX(this.bezierStartPt.x,O),k=u.getLeftIndexForPointX(this.bezierEndPt.x,O),G=this.bezierEndPt.x-this.bezierStartPt.x,W=u.SamplingUnit;for(let e=_;e<k;e++){const t=e/W-this.bezierStartPt.x,i=this.calculateCurvePointAtIndex(Math.abs(t)/G);let s=u.getLeftIndexForPointX(i.x,O);s>=_&&(l.SkyLine[s]=Math.min(l.SkyLine[s],i.y)),s++,s<O&&(l.SkyLine[s]=Math.min(l.SkyLine[s],i.y))}}else{m+=e.SlurNoteHeadYOffset,f+=e.SlurNoteHeadYOffset;const t=new n.PointF2D(this.staffEntries[0].parentMeasure.PositionAndShape.RelativePosition.x+this.staffEntries[0].PositionAndShape.RelativePosition.x,m);s?t.x+=this.staffEntries[0].PositionAndShape.BorderRight:t.x=this.staffEntries[0].parentMeasure.beginInstructionsWidth,this.graceStart&&(t.x+=i.PositionAndShape.RelativePosition.x);const o=new n.PointF2D(this.staffEntries[this.staffEntries.length-1].parentMeasure.PositionAndShape.RelativePosition.x+this.staffEntries[this.staffEntries.length-1].PositionAndShape.RelativePosition.x,f);if(r?o.x+=this.staffEntries[this.staffEntries.length-1].PositionAndShape.BorderLeft:o.x=this.staffEntries[this.staffEntries.length-1].parentMeasure.PositionAndShape.RelativePosition.x+this.staffEntries[this.staffEntries.length-1].parentMeasure.PositionAndShape.Size.width,this.graceEnd&&(o.x+=i.staffEntryParent.PositionAndShape.RelativePosition.x),g=this.calculateBottomPoints(t,o,l,u),0===g.length){const e=new n.PointF2D((o.x-t.x)/2+t.x,(o.y-t.y)/2+t.y);g.push(e)}const c=Math.atan((f-m)/(d-h)),y=new n.PointF2D(0,0);let E=new n.PointF2D(d-h,f-m);const M=a.Matrix2D.getRotationMatrix(-c),b=M.getTransposeMatrix();E=M.vectorMultiplication(E);const P=this.calculateTranslatedAndRotatedPointListBelow(g,h,m,M),L=this.calculateMaxLeftSlope(P,y,E),v=this.calculateMaxRightSlope(P,y,E),T=y.y-y.x*L,x=E.y-E.x*v,A=new n.PointF2D;let I=!1;Math.abs(Math.abs(L)-Math.abs(v))<1e-4?(A.x=E.x/2,A.y=0,I=!0):(A.x=(x-T)/(L-v),A.y=L*A.x+T);const w=this.calculateHeightWidthRatio(E.x,P),N=0,C=0;let R=p,B=-p;if(!I){const e=this.calculateAngles(p,L,v,S);R=e.startAngle,B=e.endAngle}const D=this.calculateControlPoints(E.x,R,B,P,w,m,f);let F=D.startControlPoint,V=D.endControlPoint;F=b.vectorMultiplication(F),F.x+=h,F.y+=m,V=b.vectorMultiplication(V),V.x+=h,V.y+=m,this.bezierStartPt=new n.PointF2D(h,m+N),this.bezierStartControlPt=new n.PointF2D(F.x,F.y+N),this.bezierEndControlPt=new n.PointF2D(V.x,V.y+C),this.bezierEndPt=new n.PointF2D(d,f+C);const O=l.BottomLine.length,_=u.getLeftIndexForPointX(this.bezierStartPt.x,O),k=u.getLeftIndexForPointX(this.bezierEndPt.x,O),G=this.bezierEndPt.x-this.bezierStartPt.x,W=u.SamplingUnit;for(let e=_;e<k;e++){const t=e/W-this.bezierStartPt.x,i=this.calculateCurvePointAtIndex(Math.abs(t)/G);let s=u.getLeftIndexForPointX(i.x,O);s>=_&&(l.BottomLine[s]=Math.max(l.BottomLine[s],i.y)),s++,s<O&&(l.BottomLine[s]=Math.max(l.BottomLine[s],i.y))}}}calculateStartAndEnd(e,t,i,s,n){let r=0,a=0,l=0,u=0;if(e){r=e.PositionAndShape.RelativePosition.x+e.parentVoiceEntry.parentStaffEntry.PositionAndShape.RelativePosition.x+e.parentVoiceEntry.parentStaffEntry.parentMeasure.PositionAndShape.RelativePosition.x,this.graceStart&&(r+=e.parentVoiceEntry.parentStaffEntry.staffEntryParent.PositionAndShape.RelativePosition.x);const t=e.parentVoiceEntry;this.placement===o.PlacementEnum.Above?(a=t.PositionAndShape.RelativePosition.y+t.PositionAndShape.BorderTop,this.rules.SlurPlacementUseSkyBottomLine&&(a=Math.min(u,t.parentStaffEntry.getSkylineMin()))):(a=t.PositionAndShape.RelativePosition.y+t.PositionAndShape.BorderBottom,this.rules.SlurPlacementUseSkyBottomLine&&(a=Math.max(u,t.parentStaffEntry.getBottomlineMax()))),t.parentVoiceEntry.StemDirection===c.StemDirectionType.Down&&this.placement===o.PlacementEnum.Below&&(r-=.5),t.parentVoiceEntry.StemDirection===c.StemDirectionType.Up&&this.placement===o.PlacementEnum.Above&&(r+=.5)}else r=0;if(t){l=t.PositionAndShape.RelativePosition.x+t.parentVoiceEntry.parentStaffEntry.PositionAndShape.RelativePosition.x+t.parentVoiceEntry.parentStaffEntry.parentMeasure.PositionAndShape.RelativePosition.x,this.graceEnd&&(l+=t.parentVoiceEntry.parentStaffEntry.staffEntryParent.PositionAndShape.RelativePosition.x);const e=t.parentVoiceEntry;let i;for(const s of e.parentVoiceEntry.Articulations)if(i=s.placement,s.placement===o.PlacementEnum.NotYetDefined)for(const e of t.vfnote[0].modifiers)if(e.getCategory()===h.Articulation.CATEGORY){e.position===h.Modifier.Position.ABOVE?(s.placement=o.PlacementEnum.Above,i=o.PlacementEnum.Above):e.position===h.Modifier.Position.BELOW&&(s.placement=o.PlacementEnum.Below,i=o.PlacementEnum.Below);break}this.placement===o.PlacementEnum.Above?(u=e.PositionAndShape.RelativePosition.y+e.PositionAndShape.BorderTop,this.rules.SlurPlacementUseSkyBottomLine&&(u=Math.min(u,e.parentStaffEntry.getSkylineMin())),i===o.PlacementEnum.Above&&(u-=this.rules.SlurEndArticulationYOffset)):(u=e.PositionAndShape.RelativePosition.y+e.PositionAndShape.BorderBottom,this.rules.SlurPlacementUseSkyBottomLine&&(u=Math.max(u,e.parentStaffEntry.getBottomlineMax())),i===o.PlacementEnum.Below&&(u+=this.rules.SlurEndArticulationYOffset)),e.parentVoiceEntry.StemDirection===c.StemDirectionType.Down&&this.placement===o.PlacementEnum.Below&&(l-=.5),e.parentVoiceEntry.StemDirection===c.StemDirectionType.Up&&this.placement===o.PlacementEnum.Above&&(l+=.5)}else l=i.PositionAndShape.Size.width;return e||t||(a=-1.5,u=-1.5),e||(a=this.placement===o.PlacementEnum.Above?u-1:u+1),t||(u=this.placement===o.PlacementEnum.Above?a-1:a+1),this.slur.startNoteHasMoreStartingSlurs()&&this.slur.isSlurLonger()&&(this.placement===o.PlacementEnum.Above?a-=s.SlursStartingAtSameStaffEntryYOffset:a+=s.SlursStartingAtSameStaffEntryYOffset),this.slur.endNoteHasMoreEndingSlurs()&&this.slur.isSlurLonger()&&(this.placement===o.PlacementEnum.Above?u-=s.SlursStartingAtSameStaffEntryYOffset:u+=s.SlursStartingAtSameStaffEntryYOffset),this.placement===o.PlacementEnum.Above?(a=Math.min(a,1.5),u=Math.min(u,1.5)):(a=Math.max(a,i.StaffHeight-1.5),u=Math.max(u,i.StaffHeight-1.5)),{startX:r,startY:a,endX:l,endY:u}}calculatePlacement(e,t){if(this.rules.SlurPlacementFromXML&&this.slur.PlacementXml!==o.PlacementEnum.NotYetDefined)return void(this.placement=this.slur.PlacementXml);for(let e=0,t=this.staffEntries.length;e<t;++e)if(this.staffEntries[e].parentMeasure.hasMultipleVoices())return void(this.slur.StartNote.ParentVoiceEntry.ParentVoice instanceof l.LinkedVoice||this.slur.EndNote.ParentVoiceEntry.ParentVoice instanceof l.LinkedVoice?this.placement=o.PlacementEnum.Below:this.placement=o.PlacementEnum.Above);for(let e=0,t=this.staffEntries.length;e<t;++e)if(this.staffEntries[e].LyricsEntries.length>0)return void(this.placement=o.PlacementEnum.Above);const i=this.staffEntries[0],s=this.staffEntries[this.staffEntries.length-1],n=i.graphicalVoiceEntries[0].parentVoiceEntry.StemDirection;if(n===s.graphicalVoiceEntries[0].parentVoiceEntry.StemDirection)this.placement=n===c.StemDirectionType.Up?o.PlacementEnum.Below:o.PlacementEnum.Above,this.rules.SlurPlacementAtStems&&(this.placement=n===c.StemDirectionType.Up?o.PlacementEnum.Above:o.PlacementEnum.Below);else{let n=i.PositionAndShape.BorderLeft+i.PositionAndShape.RelativePosition.x+i.parentMeasure.PositionAndShape.RelativePosition.x,r=s.PositionAndShape.BorderRight+s.PositionAndShape.RelativePosition.x+s.parentMeasure.PositionAndShape.RelativePosition.x;this.graceStart&&(n+=s.PositionAndShape.RelativePosition.x),this.graceEnd&&(r+=s.staffEntryParent.PositionAndShape.RelativePosition.x);const a=-1*e.getSkyLineMinInRange(n,r),l=e.getBottomLineMaxInRange(n,r)-t.StaffHeight;this.placement=l>a?o.PlacementEnum.Above:o.PlacementEnum.Below}}calculateTopPoints(e,t,i,s){const r=[];let o=s.getRightIndexForPointX(e.x,i.SkyLine.length),a=s.getLeftIndexForPointX(t.x,i.SkyLine.length);o<0&&(o=0),a>=i.SkyLine.length&&(a=i.SkyLine.length-1);for(let e=o;e<a;e++){const t=i.SkyLine[e];if(0!==t){const i=new n.PointF2D((.5+e)/s.SamplingUnit,t);r.push(i)}}return r}calculateBottomPoints(e,t,i,s){const r=[];let o=s.getRightIndexForPointX(e.x,i.BottomLine.length),a=s.getLeftIndexForPointX(t.x,i.BottomLine.length);o<0&&(o=0),a>=i.BottomLine.length&&(a=i.BottomLine.length-1);for(let e=o;e<a;e++){const t=i.BottomLine[e];if(0!==t){const i=new n.PointF2D((.5+e)/s.SamplingUnit,t);r.push(i)}}return r}calculateMaxLeftSlope(e,t,i){let s=-Number.MAX_VALUE;const n=t.x,r=t.y;for(let t=0;t<e.length;t++)Math.abs(e[t].y-Number.MAX_VALUE)<1e-4||Math.abs(e[t].y- -Number.MAX_VALUE)<1e-4||(s=Math.max(s,(e[t].y-r)/(e[t].x-n)));return s=Math.max(s,Math.abs(i.y-r)/(i.x-n)),s=Math.min(s,5.6713),s}calculateMaxRightSlope(e,t,i){let s=Number.MAX_VALUE;const n=i.x,r=i.y;for(let t=0;t<e.length;t++)Math.abs(e[t].y-Number.MAX_VALUE)<1e-4||Math.abs(e[t].y- -Number.MAX_VALUE)<1e-4||(s=Math.min(s,(r-e[t].y)/(n-e[t].x)));return s=Math.min(s,(r-t.y)/(n-t.x)),s=Math.max(s,-5.6713),s}getPointListMaxY(e){let t=-Number.MAX_VALUE;for(let i=0,s=e.length;i<s;++i){const s=e[i];Math.abs(s.y- -Number.MAX_VALUE)<1e-4||Math.abs(s.y-Number.MAX_VALUE)<1e-4||(t=Math.max(t,s.y))}return t}calculateTranslatedAndRotatedPointListAbove(e,t,i,s){const r=[];for(let o=0;o<e.length;o++){if(Math.abs(e[o].y-Number.MAX_VALUE)<1e-4||Math.abs(e[o].y- -Number.MAX_VALUE)<1e-4)continue;let a=new n.PointF2D(e[o].x-t,-(e[o].y-i));a=s.vectorMultiplication(a),r.push(a)}return r}calculateTranslatedAndRotatedPointListBelow(e,t,i,s){const r=[];for(let o=0;o<e.length;o++){if(Math.abs(e[o].y-Number.MAX_VALUE)<1e-4||Math.abs(e[o].y- -Number.MAX_VALUE)<1e-4)continue;let a=new n.PointF2D(e[o].x-t,e[o].y-i);a=s.vectorMultiplication(a),r.push(a)}return r}calculateHeightWidthRatio(e,t){return 0===t.length?0:Math.max(0,this.getPointListMaxY(t))/e}calculateControlPoints(e,t,i,s,r,o,a){let l=this.rules.SlurHeightFactor,u=1;const c=this.rules.SlurHeightFlattenLongSlursCutoffAngle,h=this.rules.SlurHeightFlattenLongSlursCutoffWidth;t>c&&e>h&&(u+=e/70*this.rules.SlurHeightFlattenLongSlursFactorByWidth,u*=1+t/30*this.rules.SlurHeightFlattenLongSlursFactorByAngle,l/=u);const m=Math.min(.5,Math.max(.1,1.7*t/80*l*Math.pow(Math.max(r,.05),.4))),f=Math.min(.5,Math.max(.1,1.7*-i/80*l*Math.pow(Math.max(r,.05),.4))),p=new n.PointF2D;p.x=e*m*Math.cos(t*d.degreesToRadiansFactor),p.y=e*m*Math.sin(t*d.degreesToRadiansFactor);const S=new n.PointF2D;S.x=e-e*f*Math.cos(i*d.degreesToRadiansFactor),S.y=-e*f*Math.sin(i*d.degreesToRadiansFactor);let g=p.y-S.y;for(;this.rules.SlurMaximumYControlPointDistance&&Math.abs(g)>this.rules.SlurMaximumYControlPointDistance;)g<0?(p.y+=1,S.y-=1):(p.y-=1,S.y+=1),g=p.y-S.y;return{startControlPoint:p,endControlPoint:S}}calculateAngles(e,t,i,s){let n=Math.atan(t)/d.degreesToRadiansFactor;t>0?n+=20:n-=20;let r=Math.atan(i)/d.degreesToRadiansFactor;return i<0?r-=20:r+=20,{startAngle:Math.min(Math.max(e,n),s),endAngle:Math.max(Math.min(-e,r),-s)}}}t.GraphicalSlur=d,d.degreesToRadiansFactor=Math.PI/180},4064:function(e,t,i){var s=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.NoteHeadShape=t.Notehead=void 0;const n=s(i(3065));class r{constructor(e,t,i=void 0){this.sourceNote=e,this.setShapeFromXml(t,i)}setShapeFromXml(e,t=void 0){this.shape=r.ShapeTypeXmlToShape(e);let i=t;void 0===i&&(this.sourceNote?i=this.sourceNote.Length.Denominator>2:(n.default.warn("notehead: sourceNote and filledXmlAttribute undefined."),i=!0)),this.filled=i}get SourceNote(){return this.sourceNote}get Shape(){return this.shape}get Filled(){return this.filled}static ShapeTypeXmlToShape(e){switch(e.toLowerCase()){case"normal":return o.NORMAL;case"x":return o.X;case"slash":return o.SLASH;case"diamond":return o.DIAMOND;case"square":case"la":return o.SQUARE;case"do":case"triangle":return o.TRIANGLE;case"inverted triangle":return o.TRIANGLE_INVERTED;case"rectangle":return o.RECTANGLE;case"circle-x":return o.CIRCLEX;default:return n.default.info("unsupported/unhandled xml notehead '"+e+"'. Using normal notehead."),o.NORMAL}}}var o;t.Notehead=r,function(e){e[e.CIRCLEX=0]="CIRCLEX",e[e.DIAMOND=1]="DIAMOND",e[e.NORMAL=2]="NORMAL",e[e.RECTANGLE=3]="RECTANGLE",e[e.SLASH=4]="SLASH",e[e.SQUARE=5]="SQUARE",e[e.TRIANGLE=6]="TRIANGLE",e[e.TRIANGLE_INVERTED=7]="TRIANGLE_INVERTED",e[e.X=8]="X"}(o||(t.NoteHeadShape=o={}))},4127:function(e,t,i){var s=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.ArticulationReader=void 0;const n=i(1336),r=s(i(3065)),o=i(3123),a=i(8215),l=i(6362),u=i(8233),c=i(9003),h=i(9019),d=i(8045);t.ArticulationReader=class{constructor(e){this.rules=e}getAccEnumFromString(e){switch(e){case"sharp":return u.AccidentalEnum.SHARP;case"flat":return u.AccidentalEnum.FLAT;case"natural":return u.AccidentalEnum.NATURAL;case"double-sharp":case"sharp-sharp":return u.AccidentalEnum.DOUBLESHARP;case"double-flat":case"flat-flat":return u.AccidentalEnum.DOUBLEFLAT;case"triple-sharp":return u.AccidentalEnum.TRIPLESHARP;case"triple-flat":return u.AccidentalEnum.TRIPLEFLAT;case"quarter-sharp":return u.AccidentalEnum.QUARTERTONESHARP;case"quarter-flat":return u.AccidentalEnum.QUARTERTONEFLAT;case"three-quarters-sharp":return u.AccidentalEnum.THREEQUARTERSSHARP;case"three-quarters-flat":return u.AccidentalEnum.THREEQUARTERSFLAT;case"slash-quarter-sharp":return u.AccidentalEnum.SLASHQUARTERSHARP;case"slash-sharp":return u.AccidentalEnum.SLASHSHARP;case"double-slash-flat":return u.AccidentalEnum.DOUBLESLASHFLAT;case"sori":return u.AccidentalEnum.SORI;case"koron":return u.AccidentalEnum.KORON;default:return u.AccidentalEnum.NONE}}addArticulationExpression(e,t){if(void 0!==e&&e.elements().length>0){const i=e.elements();for(let e=0,s=i.length;e<s;++e){const s=i[e];let o=s.name;try{o=o.replace("-","");const e=n.ArticulationEnum[o];if(n.VoiceEntry.isSupportedArticulation(e)){let i=l.PlacementEnum.NotYetDefined;const r=s.attribute("placement")?.value;"above"===r?i=l.PlacementEnum.Above:"below"===r&&(i=l.PlacementEnum.Below);const a=new c.Articulation(e,i);if("staccato"===o)t.Articulations.length>0&&t.Articulations[0].articulationEnum!==n.ArticulationEnum.staccato&&t.Articulations.splice(0,0,a);else if("breathmark"===o)i===l.PlacementEnum.NotYetDefined&&(a.placement=l.PlacementEnum.Above);else if("strongaccent"===o){const e=s?.attribute("type")?.value;"up"===e?a.articulationEnum=n.ArticulationEnum.marcatoup:"down"===e&&(a.articulationEnum=n.ArticulationEnum.marcatodown)}else if(e===n.ArticulationEnum.softaccent){const e=t.ParentSourceStaffEntry.ParentStaff.Id-1;i===l.PlacementEnum.NotYetDefined&&(i=l.PlacementEnum.Above,e>0&&(i=l.PlacementEnum.Below));const s=t.ParentSourceStaffEntry.VerticalContainerParent.ParentMeasure,n=new h.MultiExpression(s,t.Timestamp);n.StartingContinuousDynamic=new d.ContinuousDynamicExpression(d.ContDynamicEnum.crescendo,i,e,s,-1),n.StartingContinuousDynamic.IsStartOfSoftAccent=!0,n.StartingContinuousDynamic.StartMultiExpression=n,n.StartingContinuousDynamic.EndMultiExpression=n,n.EndingContinuousDynamic=new d.ContinuousDynamicExpression(d.ContDynamicEnum.diminuendo,i,e,s,-1),n.EndingContinuousDynamic.StartMultiExpression=n,n.EndingContinuousDynamic.EndMultiExpression=n,s.StaffLinkedExpressions[e].push(n)}t.hasArticulation(a)||t.Articulations.push(a)}}catch(e){const t="Invalid note articulation.";return void r.default.debug("addArticulationExpression",t,e)}}}}addFermata(e,t){let i=n.ArticulationEnum.fermata;e.attributes().length>0&&e.attribute("type")&&"inverted"===e.attribute("type").value&&(i=n.ArticulationEnum.invertedfermata);let s=l.PlacementEnum.Above;"below"===e.attribute("placement")?.value&&(s=l.PlacementEnum.Below),t.Articulations.push(new c.Articulation(i,s))}addTechnicalArticulations(e,t,i){const s={bend:n.ArticulationEnum.bend,"down-bow":n.ArticulationEnum.downbow,"open-string":n.ArticulationEnum.naturalharmonic,"snap-pizzicato":n.ArticulationEnum.snappizzicato,stopped:n.ArticulationEnum.lefthandpizzicato,"up-bow":n.ArticulationEnum.upbow,harmonic:n.ArticulationEnum.naturalharmonic};for(const i in s){if(!s.hasOwnProperty(i))continue;const n=s[i],r=e.element(i);if(r){let e;"above"===r.attribute("placement")?.value&&(e=l.PlacementEnum.Above),"below"===r.attribute("placement")?.value&&(e=l.PlacementEnum.Below);const i=new c.Articulation(n,e);t.hasArticulation(i)||t.Articulations.push(i)}}const r=e.elements("fingering");for(const e of r){const s=this.createTechnicalInstruction(e,i);s.type=o.TechnicalInstructionType.Fingering,i.Fingering||(i.Fingering=s),t.TechnicalInstructions.push(s)}const a=e.element("string");if(a){const e=this.createTechnicalInstruction(a,i);e.type=o.TechnicalInstructionType.String,i.StringInstruction=e,t.TechnicalInstructions.push(e)}}createTechnicalInstruction(e,t){const i=new o.TechnicalInstruction;i.sourceNote=t,i.value=e.value;const s=e.attribute("placement");return this.rules.FingeringPositionFromXML&&(i.placement=this.getPlacement(s)),i}getPlacement(e,t=l.PlacementEnum.NotYetDefined){if(t!==l.PlacementEnum.NotYetDefined)return t;if(!e)return l.PlacementEnum.NotYetDefined;switch(e.value){case"above":return l.PlacementEnum.Above;case"below":return l.PlacementEnum.Below;case"left":return l.PlacementEnum.Left;case"right":return l.PlacementEnum.Right;default:return l.PlacementEnum.NotYetDefined}}addOrnament(e,t){if(e){let i;const s={"delayed-inverted-turn":a.OrnamentEnum.DelayedInvertedTurn,"delayed-turn":a.OrnamentEnum.DelayedTurn,"inverted-mordent":a.OrnamentEnum.InvertedMordent,"inverted-turn":a.OrnamentEnum.InvertedTurn,mordent:a.OrnamentEnum.Mordent,"trill-mark":a.OrnamentEnum.Trill,turn:a.OrnamentEnum.Turn};for(const t in s){if(!s.hasOwnProperty(t))continue;const n=e.element(t);if(n){i=new a.OrnamentContainer(s[t]);const e=n.attribute("placement");e&&"below"===e.value&&(i.placement=l.PlacementEnum.Below)}}if(i){const s=e.elements("accidental-mark");if(s){let e=l.PlacementEnum.Below,t=u.AccidentalEnum.NONE;const n=s;for(let s=0,r=n.length;s<r;++s){const r=n[s];let o=r.value;t=this.getAccEnumFromString(o);const a=r.attribute("placement");r.hasAttributes&&a&&(o=a.value,"above"===o?e=l.PlacementEnum.Above:"below"===o&&(e=l.PlacementEnum.Below)),e===l.PlacementEnum.Above?i.AccidentalAbove=t:e===l.PlacementEnum.Below&&(i.AccidentalBelow=t)}}t.OrnamentContainer=i}}}}},4134:(e,t,i)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.VexFlowVoiceEntry=void 0;const s=i(4548),n=i(9479),r=i(4434);class o extends s.GraphicalVoiceEntry{constructor(e,t,i){super(e,t,i)}applyBordersFromVexflow(){const e=this.vfStaveNote;if(!e.getNoteHeadBeginX)return;const t=e.getBoundingBox(),i=e.getNoteHeadBeginX()-t.x;this.PositionAndShape.RelativePosition.y=t.y/n.unitInPixels,this.PositionAndShape.BorderTop=0,this.PositionAndShape.BorderBottom=t.h/n.unitInPixels;const s=(e.width-(e.paddingRight??0))/2;this.PositionAndShape.BorderLeft=-(i+s)/n.unitInPixels,this.PositionAndShape.BorderRight=(t.w-i)/n.unitInPixels}set vfStaveNote(e){this.mVexFlowStaveNote=e}get vfStaveNote(){return this.mVexFlowStaveNote}applyCustomNoteheads(){const e=this.vfStaveNote;if(e)for(let t=0;t<this.notes.length;t++){const i=this.notes[t].sourceNote;e.note_heads&&i.CustomNoteheadVFCode&&(e.note_heads[t].glyph_code=i.CustomNoteheadVFCode)}}color(){const e=this.rules.DefaultColorNotehead,t=this.rules.DefaultColorRest,i=this.rules.DefaultColorStem,s="#00000000";let n,o;const a=this.vfStaveNote;for(let i=0;i<this.notes.length;i++){const l=this.notes[i];if(o=l.sourceNote.NoteheadColor,n=o,this.rules.ColoringMode===r.ColoringModes.AutoColoring||this.rules.ColoringMode===r.ColoringModes.CustomColorSet)if(l.sourceNote.isRest())n=this.rules.ColoringSetCurrent.getValue(-1);else{const e=l.sourceNote.Pitch.FundamentalNote;n=this.rules.ColoringSetCurrent.getValue(e)}if(l.sourceNote.PrintObject?n&&"#000000"!==n||(n=this.rules.DefaultColorNotehead):n=s,!o&&this.rules.ColoringMode===r.ColoringModes.XML&&l.sourceNote.PrintObject&&(!l.sourceNote.isRest()&&e?n=e:l.sourceNote.isRest()&&t&&(n=t)),n&&l.sourceNote.PrintObject)l.sourceNote.NoteheadColorCurrentlyRendered=n;else if(!n)continue;if(this.rules.ColoringEnabled&&l.sourceNote.NoteBeam&&this.rules.ColorBeams){const e=l.sourceNote.NoteBeam.Notes;let t=!0;for(let i=0;i<e.length;i++)e[i].NoteheadColorCurrentlyRendered!==n&&(t=!1);t&&a?.beam?.setStyle&&a.beam.setStyle({fillStyle:n,strokeStyle:n})}if(a){if(a.note_heads){const e=a.note_heads[i];e&&e.setStyle({fillStyle:n,strokeStyle:n})}a.setLedgerLineStyle&&(n===s?a.setLedgerLineStyle({fillStyle:n,strokeStyle:n,lineWidth:this.rules.LedgerLineWidth}):a.setLedgerLineStyle({fillStyle:this.rules.LedgerLineColorDefault,lineWidth:this.rules.LedgerLineWidth,strokeStyle:this.rules.LedgerLineColorDefault}))}}let l=i,u=!1;this.rules.ColoringEnabled&&(l=this.parentVoiceEntry.StemColor,l&&"#000000"!==l||(l=i),this.rules.ColorStemsLikeNoteheads&&n&&(l=n,u=!0));let c=!0;for(const e of this.parentVoiceEntry.Notes)if(e.PrintObject){c=!1;break}c&&(l=s);const h={fillStyle:l,strokeStyle:l};a&&a.setStemStyle&&(!c&&u&&(this.parentVoiceEntry.StemColor=l),a.setStemStyle(h),a.flag&&a.setFlagStyle&&this.rules.ColorFlags&&a.setFlagStyle(h))}}t.VexFlowVoiceEntry=o},4146:(e,t)=>{var i;Object.defineProperty(t,"__esModule",{value:!0}),t.DrawingParametersEnum=void 0,function(e){e.allon="allon",e.compact="compact",e.compacttight="compacttight",e.default="default",e.leadsheet="leadsheet",e.preview="preview",e.thumbnail="thumbnail"}(i||(t.DrawingParametersEnum=i={}))},4236:(e,t)=>{var i;Object.defineProperty(t,"__esModule",{value:!0}),t.ArpeggioType=t.Arpeggio=void 0,t.Arpeggio=class{constructor(e,t=i.ARPEGGIO_DIRECTIONLESS){this.parentVoiceEntry=e,this.type=t,this.notes=[]}addNote(e){this.notes.push(e),e.Arpeggio=this}},function(e){e[e.BRUSH_DOWN=1]="BRUSH_DOWN",e[e.BRUSH_UP=2]="BRUSH_UP",e[e.ROLL_DOWN=3]="ROLL_DOWN",e[e.ROLL_UP=4]="ROLL_UP",e[e.RASQUEDO_DOWN=5]="RASQUEDO_DOWN",e[e.RASQUEDO_UP=6]="RASQUEDO_UP",e[e.ARPEGGIO_DIRECTIONLESS=7]="ARPEGGIO_DIRECTIONLESS"}(i||(t.ArpeggioType=i={}))},4249:(e,t,i)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.LinkedVoice=void 0;const s=i(5534);class n extends s.Voice{constructor(e,t,i){super(e,t),this.master=i}get Master(){return this.master}}t.LinkedVoice=n},4268:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.Tuplet=void 0,t.Tuplet=class{constructor(e,t=!1){this.PlacementFromXml=!1,this.RenderTupletNumber=!0,this.notes=[],this.fractions=[],this.tupletLabelNumber=e,this.bracket=t}shouldBeBracketed(e,t,i,s=!1,n=!1){if(s)return n;if(e&&void 0!==this.BracketedXmlValue)return this.BracketedXmlValue;const r=this.Notes[0][0].NoteBeam;if(!r)return!0;for(const e of this.Notes)if(e[0].NoteBeam!==r)return!0;return this.Bracket||3===this.TupletLabelNumber&&i||3!==this.TupletLabelNumber&&t}get TupletLabelNumber(){return this.tupletLabelNumber}set TupletLabelNumber(e){this.tupletLabelNumber=e}get Notes(){return this.notes}set Notes(e){this.notes=e}get Fractions(){return this.fractions}set Fractions(e){this.fractions=e}get Bracket(){return this.bracket}set Bracket(e){this.bracket=e}getNoteIndex(e){for(let t=this.notes.length-1;t>=0;t--)for(let i=0;i<this.notes[t].length;i++)if(e===this.notes[t][i])return t;return 0}}},4284:(e,t,i)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.SystemLine=void 0;const s=i(6954),n=i(6438),r=i(7741);class o extends r.GraphicalObject{constructor(e,t,i,s,r=void 0){super(),this.lineType=e,this.linePosition=t,this.parentMusicSystem=i,this.topMeasure=s,this.bottomMeasure=r,this.parentTopStaffLine=s?.ParentStaffLine,this.boundingBox=new n.BoundingBox(this,i.PositionAndShape)}static getObjectWidthForLineType(e,t){switch(t){case s.SystemLinesEnum.SingleThin:return e.SystemThinLineWidth;case s.SystemLinesEnum.DoubleThin:return 2*e.SystemThinLineWidth+e.DistanceBetweenVerticalSystemLines;case s.SystemLinesEnum.ThinBold:return e.SystemThinLineWidth+e.SystemBoldLineWidth+e.DistanceBetweenVerticalSystemLines;case s.SystemLinesEnum.BoldThinDots:case s.SystemLinesEnum.DotsThinBold:return e.SystemThinLineWidth+e.SystemBoldLineWidth+e.DistanceBetweenVerticalSystemLines+e.SystemDotWidth+e.DistanceBetweenDotAndLine;case s.SystemLinesEnum.DotsBoldBoldDots:return 2*e.SystemBoldLineWidth+2*e.SystemDotWidth+2*e.DistanceBetweenDotAndLine+e.DistanceBetweenVerticalSystemLines;default:return 0}}}t.SystemLine=o},4332:(e,t,i)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.VexFlowMusicSystem=void 0;const s=i(5221),n=i(6954),r=i(4284),o=i(6014),a=i(3109),l=i(7098);class u extends s.MusicSystem{constructor(e,t){super(e),this.rules=t}calculateBorders(e){if(0===this.staffLines.length)return;const t=this.calcBracketsWidth();this.boundingBox.BorderLeft=-t,this.boundingBox.BorderMarginLeft=-t,this.boundingBox.XBordersHaveBeenSet=!0;const i=this.staffLines[0].SkyBottomLineCalculator.getSkyLineMin();this.boundingBox.BorderTop=i,this.boundingBox.BorderMarginTop=i;const s=this.staffLines[this.staffLines.length-1],n=s.SkyBottomLineCalculator.getBottomLineMax()+s.PositionAndShape.RelativePosition.y;this.boundingBox.BorderBottom=n,this.boundingBox.BorderMarginBottom=n,this.boundingBox.XBordersHaveBeenSet=!0,this.boundingBox.YBordersHaveBeenSet=!0}createSystemLine(e,t,i,s,a,l,u=void 0){const c=l;let h=!1;if(u&&(h=!0,u.lineTo(l,o.VexFlowConverter.line(i,s)),u.addMeasureLine(i,s),i===n.SystemLinesEnum.DotsBoldBoldDots)){const e=u.ParentStaffLine.Measures.indexOf(u)+1,t=u.ParentStaffLine.Measures[e],i=l.ParentStaffLine.Measures[e];t&&i&&(t.lineTo(i,o.VexFlowConverter.line(n.SystemLinesEnum.BoldThinDots,s)),t.addMeasureLine(n.SystemLinesEnum.BoldThinDots,s))}return c&&c.addMeasureLine(i,s,h),new r.SystemLine(i,s,this,l,u)}createInstrumentBracket(e,t){const i=e,s=t,n=new l.VexFlowInstrumentBrace(i,s);this.InstrumentBrackets.push(n)}createGroupBracket(e,t,i){const s=e,n=t;if(0===i){const e=new a.VexFlowInstrumentBracket(s,n,i);this.GroupBrackets.push(e)}else{const e=new l.VexFlowInstrumentBrace(s,n,i);this.GroupBrackets.push(e)}}}t.VexFlowMusicSystem=u},4356:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.StringUtil=void 0,t.StringUtil=class{static StringContainsSeparatedWord(e,t,i=!1){return new RegExp("( |^)"+t+"([ .]|$)",i?"i":void 0).test(e)}}},4387:(e,t,i)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.SourceMeasure=void 0;const s=i(2561),n=i(3236),r=i(2369),o=i(1645),a=i(1336),l=i(164),u=i(4543),c=i(6954);t.SourceMeasure=class{constructor(e,t){this.printNewSystemXml=!1,this.printNewPageXml=!1,this.IsSystemStartMeasure=!1,this.WidthFactor=1,this.hasLyrics=!1,this.hasMoodExpressions=!1,this.allRests=!1,this.isReducedToMultiRest=!1,this.multipleRestMeasureNumber=0,this.staffLinkedExpressions=[],this.tempoExpressions=[],this.verticalSourceStaffEntryContainers=[],this.graphicalMeasureErrors=[],this.firstRepetitionInstructions=[],this.lastRepetitionInstructions=[],this.completeNumberOfStaves=e,this.implicitMeasure=!1,this.hasEndLine=!1,this.endingBarStyleXml="",this.endingBarStyleEnum=c.SystemLinesEnum.SingleThin,this.firstInstructionsStaffEntries=new Array(e),this.lastInstructionsStaffEntries=new Array(e),this.rules=t,this.TempoInBPM=0;for(let t=0;t<e;t++)this.graphicalMeasureErrors.push(!1),this.staffLinkedExpressions.push([])}get MeasureNumber(){return this.measureNumber}set MeasureNumber(e){this.measureNumber=e}getPrintedMeasureNumber(){return this.rules.UseXMLMeasureNumbers&&Number.isInteger(this.MeasureNumberXML)?(this.MeasureNumberPrinted=this.MeasureNumberXML,this.MeasureNumberPrinted):(this.MeasureNumberPrinted=this.MeasureNumber,this.MeasureNumberPrinted)}get AbsoluteTimestamp(){return this.absoluteTimestamp}set AbsoluteTimestamp(e){this.absoluteTimestamp=e}get CompleteNumberOfStaves(){return this.completeNumberOfStaves}get Duration(){return this.duration}set Duration(e){this.duration=e}get ActiveTimeSignature(){return this.activeTimeSignature}set ActiveTimeSignature(e){this.activeTimeSignature=e}get ImplicitMeasure(){return this.implicitMeasure}set ImplicitMeasure(e){this.implicitMeasure=e}get HasEndLine(){return this.hasEndLine}set HasEndLine(e){this.hasEndLine=e}get StaffLinkedExpressions(){return this.staffLinkedExpressions}get TempoExpressions(){return this.tempoExpressions}get VerticalSourceStaffEntryContainers(){return this.verticalSourceStaffEntryContainers}get FirstInstructionsStaffEntries(){return this.firstInstructionsStaffEntries}get LastInstructionsStaffEntries(){return this.lastInstructionsStaffEntries}get FirstRepetitionInstructions(){return this.firstRepetitionInstructions}get LastRepetitionInstructions(){return this.lastRepetitionInstructions}getErrorInMeasure(e){return this.graphicalMeasureErrors[e]}setErrorInGraphicalMeasure(e,t){this.graphicalMeasureErrors[e]=t}getNextMeasure(e){return e[this.measureListIndex+1]}getPreviousMeasure(e){if(this.measureListIndex>1)return e[this.measureListIndex-1]}get Rules(){return this.rules}get VerticalMeasureList(){return this.verticalMeasureList}set VerticalMeasureList(e){this.verticalMeasureList=e}get TempoInBPM(){return this.tempoInBPM}set TempoInBPM(e){this.tempoInBPM=e}findOrCreateStaffEntry(e,t,i){let s,o;for(const t of this.verticalSourceStaffEntryContainers)if(t.Timestamp.Equals(e)){o=t;break}if(o)return o.StaffEntries[t]?s=o.StaffEntries[t]:(s=new r.SourceStaffEntry(o,i),o.StaffEntries[t]=s),{createdNewContainer:!1,staffEntry:s};const a=this.verticalSourceStaffEntryContainers[this.verticalSourceStaffEntryContainers.length-1];if(0===this.verticalSourceStaffEntryContainers.length||a.Timestamp.lt(e)){const o=new n.VerticalSourceStaffEntryContainer(this,e.clone(),this.completeNumberOfStaves);this.verticalSourceStaffEntryContainers.push(o),s=new r.SourceStaffEntry(o,i),o.StaffEntries[t]=s}else for(let o=this.verticalSourceStaffEntryContainers.length-1;o>=0;o--){if(this.verticalSourceStaffEntryContainers[o].Timestamp.lt(e)){const a=new n.VerticalSourceStaffEntryContainer(this,e.clone(),this.completeNumberOfStaves);this.verticalSourceStaffEntryContainers.splice(o+1,0,a),s=new r.SourceStaffEntry(a,i),a.StaffEntries[t]=s;break}if(0===o){const a=new n.VerticalSourceStaffEntryContainer(this,e.clone(),this.completeNumberOfStaves);this.verticalSourceStaffEntryContainers.splice(o,0,a),s=new r.SourceStaffEntry(a,i),a.StaffEntries[t]=s;break}}return{createdNewContainer:!0,staffEntry:s}}findOrCreateVoiceEntry(e,t){let i,s=!1;for(const s of e.VoiceEntries)if(s.ParentVoice===t){i=s;break}return i||(i=new a.VoiceEntry(e.Timestamp,t,e),s=!0),{createdVoiceEntry:s,voiceEntry:i}}getPreviousSourceStaffEntryFromIndex(e,t){for(let i=t-1;i>=0;i--)if(this.verticalSourceStaffEntryContainers[i][e])return this.verticalSourceStaffEntryContainers[i][e]}getVerticalContainerIndexByTimestamp(e){for(let t=0,i=this.VerticalSourceStaffEntryContainers.length;t<i;++t)if(this.VerticalSourceStaffEntryContainers[t].Timestamp.Equals(e))return t;return-1}getVerticalContainerByTimestamp(e){for(let t=0,i=this.VerticalSourceStaffEntryContainers.length;t<i;++t){const i=this.VerticalSourceStaffEntryContainers[t];if(i.Timestamp.Equals(e))return i}}checkForEmptyVerticalContainer(e){let t=0;for(let i=0;i<this.completeNumberOfStaves;i++)this.verticalSourceStaffEntryContainers[e][i]||t++;t===this.completeNumberOfStaves&&this.verticalSourceStaffEntryContainers.splice(e,1)}reverseCheck(e,t){let i=new s.Fraction(0,1);const n=[];for(let t=0;t<e.Instruments.length;t++){let i=new s.Fraction(0,1);const r=e.getGlobalStaffIndexOfFirstStaff(e.Instruments[t]);for(let n=0;n<e.Instruments[t].Staves.length;n++){const e=this.getLastSourceStaffEntryForInstrument(r+n);if(void 0!==e&&!e.hasTie())for(let t=this.verticalSourceStaffEntryContainers.indexOf(e.VerticalContainerParent)-1;t>=0;t--){const e=this.verticalSourceStaffEntryContainers[t][r+n];if(void 0!==e&&e.hasTie()&&i.lt(s.Fraction.plus(e.Timestamp,e.calculateMaxNoteLength()))){i=s.Fraction.plus(e.Timestamp,e.calculateMaxNoteLength());break}}}n.push(i)}for(let e=0,t=n.length;e<t;++e){const t=n[e];i.lt(t)&&(i=t)}return s.Fraction.max(i,t)}calculateInstrumentsDuration(e,t){const i=[];for(let n=0;n<e.Instruments.length;n++){let r=new s.Fraction(0,1);const o=e.getGlobalStaffIndexOfFirstStaff(e.Instruments[n]);for(let t=0;t<e.Instruments[n].Staves.length;t++){const e=this.getLastSourceStaffEntryForInstrument(o+t);if(void 0!==e&&e.Timestamp){const t=e.calculateMaxNoteLength(!1);r.lt(s.Fraction.plus(e.Timestamp,t))&&(r=s.Fraction.plus(e.Timestamp,t))}}r.lt(t[n])&&(r=t[n]),i.push(r)}return i}getEntriesPerStaff(e){const t=[];for(const i of this.VerticalSourceStaffEntryContainers){const s=i.StaffEntries[e];s&&t.push(s)}return t}hasBeginInstructions(){for(let e=0,t=this.FirstInstructionsStaffEntries.length;e<t;e++){const t=this.FirstInstructionsStaffEntries[e];if(void 0!==t&&t.Instructions.length>0)return!0}return!1}beginsWithLineRepetition(){for(let e=0,t=this.FirstRepetitionInstructions.length;e<t;++e){const t=this.FirstRepetitionInstructions[e];if(t.type===o.RepetitionInstructionEnum.StartLine)return!0;if(void 0!==t.parentRepetition&&t===t.parentRepetition.startMarker&&!t.parentRepetition.FromWords)return!0}return!1}endsWithLineRepetition(){for(let e=0,t=this.LastRepetitionInstructions.length;e<t;++e){const t=this.LastRepetitionInstructions[e];if(t.type===o.RepetitionInstructionEnum.BackJumpLine)return!0;const i=t.parentRepetition;if(i&&!i.FromWords)for(let e=0,s=i.BackwardJumpInstructions.length;e<s;++e)if(t===i.BackwardJumpInstructions[e])return!0}return!1}beginsWithWordRepetition(){for(let e=0,t=this.FirstRepetitionInstructions.length;e<t;++e){const t=this.FirstRepetitionInstructions[e];if(void 0!==t.parentRepetition&&t===t.parentRepetition.startMarker&&t.parentRepetition.FromWords)return!0}return!1}endsWithWordRepetition(){for(let e=0,t=this.LastRepetitionInstructions.length;e<t;++e){const t=this.LastRepetitionInstructions[e],i=t.parentRepetition;if(i&&i.FromWords){for(let e=0,s=i.BackwardJumpInstructions.length;e<s;++e)if(t===i.BackwardJumpInstructions[e])return!0;if(t===i.forwardJumpInstruction)return!0}}return!1}beginsRepetitionEnding(){for(const e of this.FirstRepetitionInstructions)if(e.type===o.RepetitionInstructionEnum.Ending&&e.alignment===o.AlignmentType.Begin)return!0;return!1}endsRepetitionEnding(){for(const e of this.LastRepetitionInstructions)if(e.type===o.RepetitionInstructionEnum.Ending&&e.alignment===o.AlignmentType.End)return!0;return!1}getKeyInstruction(e){if(this.FirstInstructionsStaffEntries[e]){const t=this.FirstInstructionsStaffEntries[e];for(let e=0,i=t.Instructions.length;e<i;++e){const i=t.Instructions[e];if(i instanceof u.KeyInstruction)return i}}}getLastSourceStaffEntryForInstrument(e,t=!0){let i;for(let s=this.verticalSourceStaffEntryContainers.length-1;s>=0;s--)if(i=this.verticalSourceStaffEntryContainers[s].StaffEntries[e],i&&(!t||i.VoiceEntries.length>0))return i}canBeReducedToMultiRest(){if(this.firstRepetitionInstructions.length>0||this.lastRepetitionInstructions.length>0)return!1;let e=!0,t=!1;for(const i of this.verticalSourceStaffEntryContainers)if(i)for(const s of i.StaffEntries)if(s&&s.ParentStaff.isVisible()){if(s.ChordContainers.length>0)return!1;s.ParentStaff.hasLyrics&&(t=!0);for(const t of s.VoiceEntries){for(const i of t.Notes)if(!i.isRest()){e=!1;break}if(!e)break}}if(!e||t||this.hasMoodExpressions||this.tempoExpressions.length>0)return!1;for(const e of this.staffLinkedExpressions)if(e.length>0)return!1;for(const e of this.lastInstructionsStaffEntries)for(let t=0,i=e?.Instructions.length;t<i;++t)if(e.Instructions[t]instanceof l.ClefInstruction)return!1;return this.Duration?.RealValue===this.ActiveTimeSignature?.RealValue}}},4434:(e,t)=>{var i;Object.defineProperty(t,"__esModule",{value:!0}),t.ColoringModes=void 0,function(e){e[e.XML=0]="XML",e[e.AutoColoring=1]="AutoColoring",e[e.CustomColorSet=2]="CustomColorSet"}(i||(t.ColoringModes=i={}))},4543:(e,t,i)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.KeyEnum=t.NoteEnumToHalfToneLink=t.KeyInstruction=void 0;const s=i(5364),n=i(8233),r=i(8233);class o extends s.AbstractNotationInstruction{constructor(e=void 0,t=0,i=a.major){super(e),this.isTransposedBy=0,this.Key=t,this.keyTypeOriginal=t,this.mode=i,this.alteratedNotes=this.calcAlteratedNotes()}static copy(e){const t=new o(e.parent,e.Key,e.Mode);return t.keyTypeOriginal=e.keyTypeOriginal,t}static getAllPossibleMajorKeyInstructions(){const e=[];for(let t=-7;t<7;t++){const i=new o(void 0,t,a.major);e.push(i)}return e}get Key(){return this.keyType}set Key(e){this.keyType=e,this.alteratedNotes=this.calcAlteratedNotes()}get Mode(){return this.mode}set Mode(e){this.mode=e}get AlteratedNotes(){return this.alteratedNotes}calcAlteratedNotes(){const e=[];if(this.keyType>0)for(let t=0;t<this.keyType;t++)e.push(o.sharpPositionList[t]);else if(this.keyType<0)for(let t=0;t<-this.keyType;t++)e.push(o.flatPositionList[t]);return e}willAlterateNote(e){return this.alteratedNotes.indexOf(e)>=0}getAlterationForPitch(e){return this.keyType>0&&this.alteratedNotes.indexOf(e.FundamentalNote)<=this.keyType?r.AccidentalEnum.SHARP:this.keyType<0&&this.alteratedNotes.indexOf(e.FundamentalNote)<=Math.abs(this.keyType)?r.AccidentalEnum.FLAT:r.AccidentalEnum.NONE}ToString(){return"Key: "+this.keyType+this.mode}OperatorEquals(e){const t=this;return t===e||!(!t||!e)&&t.Key===e.Key&&t.Mode===e.Mode}OperatorNotEqual(e){return!this.OperatorEquals(e)}}var a;t.KeyInstruction=o,o.sharpPositionList=[n.NoteEnum.F,n.NoteEnum.C,n.NoteEnum.G,n.NoteEnum.D,n.NoteEnum.A,n.NoteEnum.E,n.NoteEnum.B],o.flatPositionList=[n.NoteEnum.B,n.NoteEnum.E,n.NoteEnum.A,n.NoteEnum.D,n.NoteEnum.G,n.NoteEnum.C,n.NoteEnum.F],t.NoteEnumToHalfToneLink=class{constructor(e,t){this.note=e,this.halfTone=t}},function(e){e[e.major=0]="major",e[e.minor=1]="minor",e[e.none=2]="none",e[e.dorian=3]="dorian",e[e.phrygian=4]="phrygian",e[e.lydian=5]="lydian",e[e.mixolydian=6]="mixolydian",e[e.aeolian=7]="aeolian",e[e.ionian=8]="ionian",e[e.locrian=9]="locrian"}(a||(t.KeyEnum=a={}))},4548:(e,t,i)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.GraphicalVoiceEntry=void 0;const s=i(7741),n=i(6438),r=i(9713);class o extends s.GraphicalObject{constructor(e,t,i){super(),this.parentVoiceEntry=e,this.parentStaffEntry=t,this.PositionAndShape=new n.BoundingBox(this,t?t.PositionAndShape:void 0,!0),this.notes=[],this.rules=i||(t?t.parentMeasure.parentSourceMeasure.Rules:new r.EngravingRules)}sort(){return this.notes.sort((e,t)=>(t.sourceNote.Pitch?.getHalfTone()??0)-(e.sourceNote.Pitch?.getHalfTone()??0)),this.notes}sortForVexflow(){return this.notes.sort((e,t)=>(e.sourceNote.Pitch?.getHalfTone()??0)-(t.sourceNote.Pitch.getHalfTone()??0)),this.notes}applyCustomNoteheads(){}color(){}}t.GraphicalVoiceEntry=o},4980:function(e,t,i){var s=this&&this.__createBinding||(Object.create?function(e,t,i,s){void 0===s&&(s=i);var n=Object.getOwnPropertyDescriptor(t,i);n&&!("get"in n?!t.__esModule:n.writable||n.configurable)||(n={enumerable:!0,get:function(){return t[i]}}),Object.defineProperty(e,s,n)}:function(e,t,i,s){void 0===s&&(s=i),e[s]=t[i]}),n=this&&this.__exportStar||function(e,t){for(var i in e)"default"===i||Object.prototype.hasOwnProperty.call(t,i)||s(t,e,i)};Object.defineProperty(t,"__esModule",{value:!0}),n(i(6362),t),n(i(9147),t),n(i(6990),t),n(i(9767),t),n(i(9161),t),n(i(9803),t),n(i(9019),t),n(i(5332),t),n(i(9157),t),n(i(1112),t)},5023:function(e,t,i){var s=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.GraphicalInstantaneousDynamicExpression=void 0;const n=i(9490),r=i(6362),o=s(i(3065));class a extends n.AbstractGraphicalExpression{constructor(e,t,i){super(t,e,i.parentSourceMeasure),this.mInstantaneousDynamicExpression=e,this.mMeasure=i}updateSkyBottomLine(){const e=this.parentStaffLine.SkyBottomLineCalculator,t=this.PositionAndShape.RelativePosition.x+this.PositionAndShape.BorderMarginLeft,i=this.PositionAndShape.RelativePosition.x+this.PositionAndShape.BorderMarginRight;let s=0;switch(this.Placement){case r.PlacementEnum.Above:s=this.PositionAndShape.RelativePosition.y+this.PositionAndShape.BorderMarginTop,e.updateSkyLineInRange(t,i,s);break;case r.PlacementEnum.Below:s=this.PositionAndShape.RelativePosition.y+this.PositionAndShape.BorderMarginBottom,e.updateBottomLineInRange(t,i,s);break;default:o.default.error("Placement for GraphicalInstantaneousDynamicExpression is unknown")}}}t.GraphicalInstantaneousDynamicExpression=a},5054:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.GraphicalTie=void 0,t.GraphicalTie=class{constructor(e,t=void 0,i=void 0){this.tie=e,this.startNote=t,this.endNote=i}get SVGElement(){return this.vfTie.getAttribute("el")}get GetTie(){return this.tie}get StartNote(){return this.startNote}get Tie(){return this.tie}set StartNote(e){this.startNote=e}get EndNote(){return this.endNote}set EndNote(e){this.endNote=e}}},5166:e=>{e.exports="precision mediump float;\r\nuniform sampler2D u_image;\r\nvarying vec4 v_position;\r\n\r\n#define NUM_ROWS 5\r\n#define ELEMENT_HEIGHT 300\r\n\r\nvoid main() {\r\n    const float halfPixel = 1.0 / float(ELEMENT_HEIGHT * 2);\r\n\r\n    vec2 absolutePosition = (v_position.xy + vec2(1.0)) / vec2(2.0);\r\n    float absX = absolutePosition.x;\r\n    float absY = absolutePosition.y;\r\n\r\n    int skyLine = 0;\r\n    for (int i = 0; i < ELEMENT_HEIGHT; ++i) {\r\n        float ratioY = float(i) / float(ELEMENT_HEIGHT);\r\n        float relY = (ratioY - 0.5 + halfPixel) / float(NUM_ROWS);\r\n        float x = absX;\r\n        float y = absY + relY;\r\n\r\n        float currentAlpha = texture2D(u_image, vec2(x, y)).a;\r\n        if (currentAlpha > 0.0) {\r\n            skyLine = i;\r\n            break;\r\n        }\r\n    }\r\n\r\n    int bottomLine = ELEMENT_HEIGHT;\r\n    for (int i = ELEMENT_HEIGHT - 1; i >= 0; --i) {\r\n        float ratioY = float(i) / float(ELEMENT_HEIGHT);\r\n        float relY = (ratioY - 0.5 + halfPixel) / float(NUM_ROWS);\r\n        float x = absX;\r\n        float y = absY + relY;\r\n\r\n        float currentAlpha = texture2D(u_image, vec2(x, y)).a;\r\n        if (currentAlpha > 0.0) {\r\n            bottomLine = i;\r\n            break;\r\n        }\r\n    }\r\n\r\n    int r = skyLine;\r\n    if (r > 256) {\r\n        r -= 256;\r\n    }\r\n    int g = bottomLine;\r\n    if (g > 256) {\r\n        g -= 256;\r\n    }\r\n    int b = (skyLine / 256 * 16) + (bottomLine / 256);\r\n\r\n    gl_FragColor = vec4(float(r) / 255.0, float(g) / 255.0, float(b) / 255.0, 1.0);\r\n}\r\n"},5221:(e,t,i)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.MusicSystem=void 0;const s=i(9252),n=i(6438),r=i(2561),o=i(7533),a=i(8254),l=i(7741),u=i(9409),c=i(6954),h=i(3263),d=i(67),m=i(7435);class f extends l.GraphicalObject{constructor(e){super(),this.needsToBeRedrawn=!0,this.staffLines=[],this.graphicalMeasures=[],this.labels=new h.Dictionary,this.measureNumberLabels=[],this.objectsToRedraw=[],this.instrumentBrackets=[],this.groupBrackets=[],this.graphicalMarkedAreas=[],this.graphicalComments=[],this.systemLines=[],this.breaksPage=!1,this.id=e,this.boundingBox=new n.BoundingBox(this),this.maxLabelLength=0}get Parent(){return this.parent}set Parent(e){if(this.parent){const e=this.parent.MusicSystems.indexOf(this,0);e>-1&&this.parent.MusicSystems.splice(e,1)}this.parent=e,this.boundingBox.Parent=e.PositionAndShape}get NextSystem(){const e=this.Parent.MusicSystems.indexOf(this);return e!==this.Parent.MusicSystems.length?this.Parent.MusicSystems[e+1]:void 0}get StaffLines(){return this.staffLines}set StaffLines(e){this.staffLines=e}get GraphicalMeasures(){return this.graphicalMeasures}get MeasureNumberLabels(){return this.measureNumberLabels}get Labels(){return this.labels.values()}get ObjectsToRedraw(){return this.objectsToRedraw}get InstrumentBrackets(){return this.instrumentBrackets}get GroupBrackets(){return this.groupBrackets}get GraphicalMarkedAreas(){return this.graphicalMarkedAreas}get GraphicalComments(){return this.graphicalComments}get SystemLines(){return this.systemLines}get Id(){return this.id}createSystemLeftLine(e,t,i){let s=-e/2;i&&(s=this.maxLabelLength+t-e/2);const n=this.staffLines[0].Measures[0];let r;this.staffLines.length>1&&(r=this.staffLines[this.staffLines.length-1].Measures[0]);const o=this.createSystemLine(s,e,c.SystemLinesEnum.SingleThin,d.SystemLinePosition.MeasureBegin,this,n,r);this.SystemLines.push(o),o.PositionAndShape.RelativePosition=new u.PointF2D(s,0),o.PositionAndShape.BorderLeft=0,o.PositionAndShape.BorderRight=e,o.PositionAndShape.BorderTop=o.PositionAndShape.Parent.BorderTop,o.PositionAndShape.BorderBottom=o.PositionAndShape.Parent.BorderBottom,this.createLinesForSystemLine(o)}createVerticalLineForMeasure(e,t,i,s,n,r){const o=r.ParentStaffLine,a=new u.PointF2D(o.PositionAndShape.RelativePosition.x,o.PositionAndShape.RelativePosition.y),l=o.ParentStaff.ParentInstrument.Staves;if(o.ParentStaff===l[0]){let c;l.length>1&&(c=this.getBottomStaffLine(o).Measures[n]);const h=this.createSystemLine(e,t,i,s,this,r,c),d=a.x+e;h.PositionAndShape.RelativePosition=new u.PointF2D(d,0),h.PositionAndShape.BorderLeft=0,h.PositionAndShape.BorderRight=t,this.SystemLines.push(h)}}setYPositionsToVerticalLineObjectsAndCreateLines(e){}calculateBorders(e){}alignBeginInstructions(){}GetLeftBorderAbsoluteXPosition(){return this.StaffLines[0].PositionAndShape.AbsolutePosition.x+this.StaffLines[0].Measures[0].beginInstructionsWidth}GetRightBorderAbsoluteXPosition(){return this.StaffLines[0].PositionAndShape.AbsolutePosition.x+this.StaffLines[0].StaffLines[0].End.x}AddGraphicalMeasures(e){for(let t=0,i=e.length;t<i;++t)e[t].ParentMusicSystem=this;this.graphicalMeasures.push(e)}GetSystemsFirstTimeStamp(){return this.graphicalMeasures[0][0].parentSourceMeasure.AbsoluteTimestamp}GetSystemsLastTimeStamp(){const e=this.graphicalMeasures[this.graphicalMeasures.length-1][0].parentSourceMeasure;return r.Fraction.plus(e.AbsoluteTimestamp,e.Duration)}createInstrumentBrackets(e,t){for(let t=0,i=e.length;t<i;++t){const i=e[t];if(i.Staves.length>1){let e,t;for(let s=0,n=this.staffLines.length;s<n;++s){const n=this.staffLines[s];n.ParentStaff===i.Staves[0]&&n.ParentStaff.Visible&&(e=n),n.ParentStaff===i.Staves[i.Staves.length-1]&&n.ParentStaff.Visible&&(t=n)}e&&t&&this.createInstrumentBracket(e,t)}}}createGroupBrackets(e,t,i){for(let s=0,n=e.length;s<n;++s){const n=e[s];if(n.InstrumentalGroups.length<1)continue;const r=this.findFirstVisibleInstrumentInInstrumentalGroup(n),o=this.findLastVisibleInstrumentInInstrumentalGroup(n);if(!r||!o)continue;let a,l;for(let e=0,t=this.staffLines.length;e<t;++e){const t=this.staffLines[e];t.ParentStaff===r.Staves[0]&&(a=t),t.ParentStaff===o.Staves[0]&&(l=t)}a&&l&&this.createGroupBracket(a,l,i),n.InstrumentalGroups.length<1||this.createGroupBrackets(n.InstrumentalGroups,t,i+1)}}createMusicSystemLabel(e,t,i,s=!1){const n=t;for(let i=0,n=this.staffLines.length;i<n;++i){const n=this.staffLines[i].ParentStaff.ParentInstrument;let r;if(s)r=n.NameLabel,this.rules.RenderPartNames&&r?.print||(r=new m.Label("",n.NameLabel.textAlignment,n.NameLabel.font),t=0);else{if(!this.rules.RenderPartAbbreviations||!this.rules.RenderPartNames||1===this.staffLines.length||!n.PartAbbreviation||""===n.PartAbbreviation)return;const e=n.PartAbbreviation;r=new m.Label(e,n.NameLabel.textAlignment,n.NameLabel.font)}if(n?.NameLabel?.print){const t=new a.GraphicalLabel(r,e,o.TextAlignmentEnum.LeftCenter,this.rules,this.boundingBox);t.setLabelPositionAndShapeBorders(),this.labels.setValue(n,t)}else t=0}this.maxLabelLength=0;const r=this.labels.values();for(let e=0,i=r.length;e<i;++e){const i=r[e];i.Label.print&&i.PositionAndShape.Size.width>this.maxLabelLength&&(this.maxLabelLength=i.PositionAndShape.Size.width,t=n)}this.updateMusicSystemStaffLineXPosition(t)}setMusicSystemLabelsYPosition(){this.labels.forEach((e,t)=>{let i=0,s=0;for(let t=0;t<this.staffLines.length;t++)if(this.staffLines[t].ParentStaff.ParentInstrument===e){for(let n=t;n<this.staffLines.length;n++){const t=this.staffLines[n];if(t.ParentStaff.ParentInstrument!==e)break;i+=t.PositionAndShape.RelativePosition.y,s++}break}s>0&&(t.PositionAndShape.RelativePosition=new u.PointF2D(0,i/s+2))})}checkStaffEntriesForStaffEntryLink(){let e=!1,t=!1;for(let i=0;i<this.staffLines.length-1;i++){for(let t=0,s=this.staffLines[i].Measures.length;t<s;++t){const s=this.staffLines[i].Measures[t];for(let t=0,i=s.staffEntries.length;t<i;++t)s.staffEntries[t].sourceStaffEntry.Link&&(e=!0)}for(let e=0,s=this.staffLines[i+1].Measures.length;e<s;++e){const s=this.staffLines[i+1].Measures[e];for(let e=0,i=s.staffEntries.length;e<i;++e)s.staffEntries[e].sourceStaffEntry.Link&&(t=!0)}}return!(!e||!t)}getBottomStaffLine(e){const t=e.ParentStaff.ParentInstrument.Staves;let i;for(let e=t.length-1;e>=0;e--)if(t[e]?.Visible){i=t[e];break}for(const t of e.ParentMusicSystem.staffLines)if(t.ParentStaff===i)return t}createSystemLine(e,t,i,s,n,r,o=void 0){throw new Error("not implemented")}createLinesForSystemLine(e){}calcBracketsWidth(){let e=0;for(let t=0,i=this.GroupBrackets.length;t<i;++t){const i=this.GroupBrackets[t];e=Math.max(e,i.PositionAndShape.Size.width)}for(let t=0,i=this.InstrumentBrackets.length;t<i;++t){const i=this.InstrumentBrackets[t];e=Math.max(e,i.PositionAndShape.Size.width)}return e}createInstrumentBracket(e,t){}createGroupBracket(e,t,i){}findFirstVisibleInstrumentInInstrumentalGroup(e){for(let t=0,i=e.InstrumentalGroups.length;t<i;++t){const i=e.InstrumentalGroups[t];if(!(i instanceof s.Instrument))return this.findFirstVisibleInstrumentInInstrumentalGroup(i);if(i.isVisible())return i}}findLastVisibleInstrumentInInstrumentalGroup(e){let t;for(let i=e.InstrumentalGroups.length-1;i>=0;i--){if(t=e.InstrumentalGroups[i],!(t instanceof s.Instrument))return this.findLastVisibleInstrumentInInstrumentalGroup(t);if(t.isVisible())return t}}updateMusicSystemStaffLineXPosition(e){for(let t=0,i=this.StaffLines.length;t<i;++t){const i=this.StaffLines[t],s=i.PositionAndShape.RelativePosition;s.x=this.maxLabelLength+e,i.PositionAndShape.RelativePosition=s,i.PositionAndShape.BorderRight=this.boundingBox.Size.width-this.maxLabelLength-e;for(let e=0;e<i.StaffLines.length;e++){const t=new u.PointF2D(i.PositionAndShape.Size.width,i.StaffLines[e].End.y);i.StaffLines[e].End=t}}}}t.MusicSystem=f},5246:function(e,t,i){var s=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.StavePositionEnum=t.VexFlowMeasure=void 0;var n=s(i(3206)).default.Flow;const r=i(5748),o=i(6954),a=i(164),l=i(6014),u=i(8365);var c=n.NoteSubGroup;const h=s(i(3065)),d=i(9479),m=i(1645),f=i(67),p=i(1336),S=i(4134),g=i(2561),y=i(9713),E=i(3123),M=i(6362),b=i(5282);class P extends r.GraphicalMeasure{constructor(e,t,i){super(e,t,i),this.octaveOffset=3,this.vfVoices={},this.vfTies=[],this.vfRepetitionWords=[],this.hasMetronomeMark=!1,this.connectors=[],this.beams={},this.autoVfBeams=[],this.autoTupletVfBeams=[],this.vfbeams={},this.tuplets={},this.vftuplets={},this.minimumStaffEntriesWidth=-1,this.rules=i?i.ParentMusicSystem.rules:t?t.Rules:new y.EngravingRules,this.resetLayout()}setAbsoluteCoordinates(e,t){this.stave.setX(e).setY(t)}resetLayout(){this.stave=new n.Stave(0,0,0,{fill_style:this.rules.StaffLineColor,space_above_staff_ln:0,space_below_staff_ln:0}),this.InitiallyActiveClef&&(this.stave.clef=l.VexFlowConverter.Clef(this.InitiallyActiveClef).type),this.stave.MeasureNumber=this.MeasureNumber,this.hasMetronomeMark=!1,this.ParentStaff&&this.setLineNumber(this.ParentStaff.StafflineCount),this.stave.setBegBarType(n.Barline.type.NONE),this.parentSourceMeasure&&this.parentSourceMeasure.endingBarStyleEnum===o.SystemLinesEnum.None&&this.stave.setEndBarType(n.Barline.type.NONE),this.updateInstructionWidth()}clean(){this.vfTies.length=0,this.connectors=[],this.resetLayout()}getLineWidth(e){switch(e){case o.SystemLinesEnum.BoldThinDots:case o.SystemLinesEnum.DotsThinBold:return 10/d.unitInPixels;case o.SystemLinesEnum.DotsBoldBoldDots:return 10/d.unitInPixels+this.rules.RepeatEndStartPadding;default:return 0}}addClefAtBegin(e){if(this.rules.RenderClefsAtBeginningOfStaffline){if(this.octaveOffset=e.OctaveOffset,e.ClefType===a.ClefEnum.TAB)this.stave.addClef("tab",void 0,void 0,void 0);else{const t=l.VexFlowConverter.Clef(e,"default");this.stave.addClef(t.type,t.size,t.annotation,n.StaveModifier.Position.BEGIN)}this.updateInstructionWidth()}}setLineNumber(e){5!==e&&(0===e?(this.stave.setNumLines(0),this.stave.getBottomLineY=function(){return this.getYForLine(this.options.num_lines)}):1===e?(this.stave.options.line_config=[{visible:!1},{visible:!1},{visible:!0},{visible:!1},{visible:!1}],this.stave.getBottomLineY=function(){return this.getYForLine(2)}):2===e?(this.stave.options.line_config=[{visible:!1},{visible:!1},{visible:!0},{visible:!0},{visible:!1}],this.stave.getBottomLineY=function(){return this.getYForLine(3)}):3===e?(this.stave.options.line_config=[{visible:!1},{visible:!0},{visible:!0},{visible:!0},{visible:!1}],this.stave.getBottomLineY=function(){return this.getYForLine(2)}):(this.stave.setNumLines(e),this.stave.getBottomLineY=function(){return this.getYForLine(this.options.num_lines)}))}addKeyAtBegin(e,t,i){if(this.rules.RenderKeySignatures&&this.ShowKeySignature&&(!this.isTabMeasure||this.rules.TabKeySignatureRendered||this.rules.TabKeySignatureSpacingAdded)&&(!this.parentSourceMeasure?.isReducedToMultiRest||this.rules.MultipleRestMeasureAddKeySignature)){if(this.stave.setKeySignature(l.VexFlowConverter.keySignature(e),l.VexFlowConverter.keySignature(t),void 0),this.isTabMeasure&&!this.rules.TabKeySignatureRendered){const e=this.stave.getModifiers();for(const t of e)if(t instanceof n.KeySignature){t.setStyle({fillStyle:"#00000000"}),t.hidden=!0;break}}this.updateInstructionWidth()}}addRhythmAtBegin(e){if(this.isTabMeasure&&!this.rules.TabTimeSignatureRendered&&!this.rules.TabTimeSignatureSpacingAdded)return;const t=l.VexFlowConverter.TimeSignature(e);this.stave.addModifier(t,n.StaveModifier.Position.BEGIN),(!this.ShowTimeSignature||this.isTabMeasure&&!this.rules.TabTimeSignatureRendered)&&(t.setStyle({fillStyle:"#00000000"}),t.hidden=!0),this.updateInstructionWidth()}addClefAtEnd(e,t=!0){if(this.isTabMeasure)return;const i=l.VexFlowConverter.Clef(e,"small");if(t||!this.stave.endClef){this.stave.setEndClef(i.type,i.size,i.annotation);for(const e of this.stave.getModifiers())if(t){const t=e.originalStrokeStyle,i=e.originalFillStyle;e.getStyle()&&(t&&i?(e.getStyle().strokeStyle=t,e.getStyle().fillStyle=i):(e.getStyle().strokeStyle=null,e.getStyle().fillStyle=null))}else if("clefs"===e.getCategory()&&e.getPosition()===n.StaveModifier.Position.END&&e.type===i.type){const t="#12345600",i=e.getStyle();i&&(e.originalStrokeStyle=i.strokeStyle,e.originalFillStyle=i.fillStyle),e.setStyle({strokeStyle:t,fillStyle:t})}return this.parentSourceMeasure.hasEndClef=!0,this.updateInstructionWidth()}}addMeasureLine(e,t,i=!0){switch(t){case f.SystemLinePosition.MeasureBegin:e===o.SystemLinesEnum.BoldThinDots&&(i||(this.stave.modifiers[0].draw=function(e){switch(e.checkContext(),this.setRendered(),this.type){case n.Barline.type.SINGLE:this.drawVerticalBar(e,this.x,!1);break;case n.Barline.type.DOUBLE:this.drawVerticalBar(e,this.x,!0);break;case n.Barline.type.END:this.drawVerticalEndBar(e,this.x);break;case n.Barline.type.REPEAT_BEGIN:this.drawRepeatBar(e,this.x,!0);break;case n.Barline.type.REPEAT_END:this.drawRepeatBar(e,this.x,!1);break;case n.Barline.type.REPEAT_BOTH:this.drawRepeatBar(e,this.x,!1),this.drawRepeatBar(e,this.x,!0)}}),this.stave.setBegBarType(n.Barline.type.REPEAT_BEGIN));break;case f.SystemLinePosition.MeasureEnd:switch(e){case o.SystemLinesEnum.DotsBoldBoldDots:this.stave.setEndBarType(n.Barline.type.REPEAT_BOTH);break;case o.SystemLinesEnum.DotsThinBold:this.stave.setEndBarType(n.Barline.type.REPEAT_END);break;case o.SystemLinesEnum.DoubleThin:this.stave.setEndBarType(n.Barline.type.DOUBLE);break;case o.SystemLinesEnum.ThinBold:this.stave.setEndBarType(n.Barline.type.END);break;case o.SystemLinesEnum.DoubleBold:this.stave.setEndBarType(8);break;case o.SystemLinesEnum.None:this.stave.setEndBarType(n.Barline.type.NONE)}}}addMeasureNumber(){const e=this.MeasureNumber.toString(),t=L.ABOVE;this.stave.setText(e,t,{justification:1,shift_x:0,shift_y:0})}addWordRepetition(e){let t,i=n.StaveModifier.Position.END;const s=this.beginInstructionsWidth;switch(e.type){case m.RepetitionInstructionEnum.Segno:t=n.Repetition.type.SEGNO_LEFT,i=n.StaveModifier.Position.LEFT;break;case m.RepetitionInstructionEnum.Coda:t=n.Repetition.type.CODA_LEFT,i=n.StaveModifier.Position.LEFT;break;case m.RepetitionInstructionEnum.DaCapo:t=n.Repetition.type.DC;break;case m.RepetitionInstructionEnum.DalSegno:t=n.Repetition.type.DS;break;case m.RepetitionInstructionEnum.Fine:t=n.Repetition.type.FINE;break;case m.RepetitionInstructionEnum.ToCoda:t=n.Repetition.type.TO_CODA;break;case m.RepetitionInstructionEnum.DaCapoAlFine:t=n.Repetition.type.DC_AL_FINE;break;case m.RepetitionInstructionEnum.DaCapoAlCoda:t=n.Repetition.type.DC_AL_CODA;break;case m.RepetitionInstructionEnum.DalSegnoAlFine:t=n.Repetition.type.DS_AL_FINE;break;case m.RepetitionInstructionEnum.DalSegnoAlCoda:t=n.Repetition.type.DS_AL_CODA}if(t){const e=new n.Repetition(t,s,-this.rules.RepetitionSymbolsYOffset);return e.xShiftAsPercentOfStaveWidth=this.rules.RepetitionEndInstructionXShiftAsPercentOfStaveWidth,void this.stave.addModifier(e,i)}this.addVolta(e)}addVolta(e){let t=n.Volta.type.BEGIN;if(e.type===m.RepetitionInstructionEnum.Ending){switch(e.alignment){case m.AlignmentType.Begin:t=this.parentSourceMeasure.endsRepetitionEnding()?n.Volta.type.BEGIN_END:n.Volta.type.BEGIN;break;case m.AlignmentType.End:if(this.parentSourceMeasure.beginsRepetitionEnding())return;t=n.Volta.type.END}const i=this.ParentStaffLine.SkyBottomLineCalculator,s=this.PositionAndShape.AbsolutePosition.x+this.PositionAndShape.BorderMarginLeft+.4,r=Math.max(this.PositionAndShape.AbsolutePosition.x+this.PositionAndShape.BorderMarginRight,s+.4),o=i.getSkyLineMinInRange(s,r)-2;let a,l=-6.1+this.rules.VoltaOffset,u=this.rules.VoltaOffset;o<l&&(u+=o-l,l=o);const c=this.parentSourceMeasure.MeasureNumber;for(let e=0;e<this.ParentStaffLine.Measures.length;e++){const t=this.ParentStaffLine.Measures[e];t instanceof P&&(t.MeasureNumber!==c-1&&t.MeasureNumber+t.parentSourceMeasure?.multipleRestMeasures!==c||(a=t))}if(a){const e=a.stave.getModifiers();for(let t=0;t<e.length;t++){const i=e[t];if(i.hasOwnProperty("volta")){const e=a.ParentStaffLine.SkyBottomLineCalculator,t=a.PositionAndShape.AbsolutePosition.x+a.PositionAndShape.BorderMarginLeft+.4,s=Math.max(a.PositionAndShape.AbsolutePosition.x+a.PositionAndShape.BorderMarginRight,t+.4),n=e.getSkyLineMinInRange(t,s);n<=l?(u+=n-l,l=n):(i.y_shift=u*d.unitInPixels,a.ParentStaffLine.SkyBottomLineCalculator.updateSkyLineInRange(t,s,l))}}}u*=10,this.stave.setVoltaType(t,e.endingIndices[0],u),i.updateSkyLineInRange(s,r,l)}}setWidth(e){super.setWidth(e),this.stave.setWidth(e*d.unitInPixels)}layoutSymbols(){}draw(e){const t=e.openGroup();t&&(t.classList?.add("vf-measure"),t.id=`${this.MeasureNumber}`),this.stave.setContext(e).draw();for(const t in this.vfVoices)this.vfVoices.hasOwnProperty(t)&&(e.save(),this.vfVoices[t].draw(e,this.stave),e.restore());for(const t in this.vfbeams)if(this.vfbeams.hasOwnProperty(t))for(const i of this.vfbeams[t])i.setContext(e).draw();if(this.autoVfBeams)for(const t of this.autoVfBeams)t.setContext(e).draw();if(!this.isTabMeasure||this.rules.TupletNumbersInTabs){if(this.autoTupletVfBeams)for(const t of this.autoTupletVfBeams)t.setContext(e).draw();for(const t in this.vftuplets)if(this.vftuplets.hasOwnProperty(t))for(let i=0;i<this.tuplets[t].length;i++){const s=this.tuplets[t][i][0],n=this.vftuplets[t][i];n&&(!s.RenderTupletNumber||s.ShowNumberNoneGivenInXml&&this.rules.TupletNumberUseShowNoneXMLValue?n.RenderTupletNumber=!1:n.RenderTupletNumber=!0,n.setContext(e).draw())}}for(const t of this.vfTies){if(t instanceof n.TabSlide)return;t.setContext(e),t.draw()}e.closeGroup();for(const t of this.connectors)e.openGroup("connector"),t.setContext(e).draw(),e.closeGroup();this.correctNotePositions()}format(){this.formatVoices&&this.formatVoices((this.PositionAndShape.Size.width-this.beginInstructionsWidth-this.endInstructionsWidth)*d.unitInPixels,this)}correctNotePositions(){if(this.isTabMeasure)for(const e of this.getVoicesWithinMeasure())for(const t of e.VoiceEntries)for(const e of t.Notes){const t=e,i=this.rules.GNote(e);t.StringNumberTab>=0&&(i.parentVoiceEntry.PositionAndShape.RelativePosition.y=(t.StringNumberTab-1)*this.rules.TabStaffInterlineHeightForBboxes)}else for(const e of this.getVoicesWithinMeasure())for(const t of e.VoiceEntries)for(const e of t.Notes){const t=this.rules.GNote(e);if(!t?.vfnote)return;const i=t.vfnote[0];let s=0;t.parentVoiceEntry.parentVoiceEntry.StemDirection===p.StemDirectionType.Up&&"w"!==t.vfnote[0].getDuration()?s+=3.5:s+=.5,s+=-t.notehead(i).line+t.parentVoiceEntry.notes.last().notehead().line,t.PositionAndShape.RelativePosition.y=s}}getVoicesWithinMeasure(){const e=[];for(const t of this.staffEntries)for(const i of t.graphicalVoiceEntries)-1===e.indexOf(i.parentVoiceEntry.ParentVoice)&&e.push(i.parentVoiceEntry.ParentVoice);return e}getGraphicalVoiceEntriesPerVoice(e){const t=[];for(const i of this.staffEntries)for(const s of i.graphicalVoiceEntries)s.parentVoiceEntry.ParentVoice===e&&t.push(s);return t}getRestFilledVexFlowStaveNotesPerVoice(e){let t,i=this.getGraphicalVoiceEntriesPerVoice(e);for(let e=0;e<i.length;e++){const s=i[e],n=s.notes[0].sourceNote.getAbsoluteTimestamp();let r=new g.Fraction;for(const e of s.notes){const t=g.Fraction.plus(e.sourceNote.getAbsoluteTimestamp(),e.sourceNote.Length);r.lt(t)&&(r=t)}if(t){const s=g.Fraction.minus(n,t);if(s.RealValue>0){h.default.trace(`Ghost Found in between (measure ${this.MeasureNumber})`);const t=this.createGhostGves(s);i.splice(e,0,...t),e+=t.length}}else{const t=g.Fraction.minus(n,this.parentSourceMeasure.AbsoluteTimestamp);if(t.RealValue>0){h.default.trace(`Ghost Found at start (measure ${this.MeasureNumber})`);const s=this.createGhostGves(t);i.splice(0,0,...s),e+=s.length}}t=r}const s=g.Fraction.plus(this.parentSourceMeasure.AbsoluteTimestamp,this.parentSourceMeasure.Duration),n=g.Fraction.minus(s,t);if(n.RealValue>0){h.default.trace(`Ghost Found at end (measure ${this.MeasureNumber})`);const e=this.createGhostGves(n);i=i.concat(e)}return i}createGhostGves(e){const t=l.VexFlowConverter.GhostNotes(e),i=[];for(const e of t){const t=new S.VexFlowVoiceEntry(void 0,void 0,this.rules);t.vfStaveNote=e,i.push(t)}return i}handleBeam(e,t){const i=e.sourceNote.ParentVoiceEntry.ParentVoice.VoiceId;let s,n=this.beams[i];n||(n=this.beams[i]=[]);for(const e of n)e[0]===t&&(s=e);s||(s=[t,[]],n.push(s));const r=e.parentVoiceEntry;s[1].indexOf(r)<0&&s[1].push(r)}handleTuplet(e,t){const i=e.sourceNote.ParentVoiceEntry.ParentVoice.VoiceId;t=e.sourceNote.NoteTuplet;let s,n=this.tuplets[i];n||(n=this.tuplets[i]=[]);for(const e of n)e[0]===t&&(s=e);s||(s=[t,[]],n.push(s));const r=e.parentVoiceEntry;s[1].indexOf(r)<0&&s[1].push(r)}finalizeBeams(){if(this.vfbeams={},this.isTabMeasure&&!this.rules.TabBeamsRendered)return;const e=[];for(const t in this.beams)if(this.beams.hasOwnProperty(t)){let i=this.vfbeams[t];i||(i=this.vfbeams[t]=[]);for(const s of this.beams[t]){let t=!1;for(const e of s[0].Notes)if(e.Length.RealValue>=new g.Fraction(1,4).RealValue&&(!e.TypeLength||e.TypeLength.RealValue>.125)){t=!0;break}if(t){h.default.debug("Beam between note >= quarter, likely tremolo, currently unsupported. continuing.");continue}const r=[],o=s[0],a=s[1];let l=!0;for(const e of a)e.parentVoiceEntry.ParentVoice===o.Notes[0].ParentVoiceEntry.ParentVoice&&(l=e.parentVoiceEntry.WantedStemDirection===p.StemDirectionType.Undefined);let u,c=!1;const d=[];for(const t of a){const i=t.vfStaveNote;i&&(r.push(i),e.push(i)),t.parentVoiceEntry.IsGrace&&(c=!0),t.parentVoiceEntry.StemColor&&this.rules.ColoringEnabled&&d.push(t.parentVoiceEntry.StemColor)}if(r.length>1){const e=new n.Beam(r,l);if(c&&(e.render_options.beam_width=3,e.render_options.partial_beam_length=4),d.length>=2&&this.rules.ColorBeams){u=d[0];for(const e of d)if(e!==u){u=void 0;break}e.setStyle({fillStyle:u,strokeStyle:u})}this.rules.FlatBeams&&(e.render_options.flat_beams=!0,e.render_options.flat_beam_offset=this.rules.FlatBeamOffset,e.render_options.flat_beam_offset_per_beam=this.rules.FlatBeamOffsetPerBeam),i.push(e)}else h.default.debug("Warning! Beam with no notes!")}}this.rules.AutoBeamNotes&&this.autoBeamNotes(e)}autoBeamNotes(e){if(!this.rules.AutoBeamTabs&&this.isTabMeasure)return;let t,i=60,s=[],r=[],o=[];this.autoTupletVfBeams=[];const a=[];this.autoVfBeams=[];let l=this.parentSourceMeasure.ActiveTimeSignature;l||(l=this.parentSourceMeasure.Duration);for(const c of this.staffEntries)for(const h of c.graphicalVoiceEntries){const d=h.vfStaveNote,m=h.notes[0],f={vfStaveNote:d,sourceNote:m.sourceNote},p=c.relInMeasureTimestamp.isOnBeat(l),S=r.length>=2,y=m.sourceNote.Length.RealValue-new g.Fraction(1,4).RealValue>-g.Fraction.FloatInaccuracyTolerance,E=h.parentVoiceEntry.IsGrace||y||e.contains(d);if(E||p){if(S){for(const e of r)s.push(e);a.push(s.slice()),s=[]}if(r=[],E)continue}const M=h.notes[0].sourceNote.NoteTuplet;if(M){let e=!1;for(const t of M.Notes){for(const i of t)if(i.NoteTypeXml>=b.NoteType.QUARTER||i.ParentVoiceEntry.IsGrace||i.isRest()&&!this.rules.AutoBeamOptions.beam_rests){e=!0;break}if(e)break}if(t){if(t!==M){if(o.length>1){const e=[];for(const t of o)e.push(t.vfStaveNote);const t=new n.Beam(e,!0);this.rules.FlatBeams&&(t.render_options.flat_beams=!0,t.render_options.flat_beam_offset=this.rules.FlatBeamOffset,t.render_options.flat_beam_offset_per_beam=this.rules.FlatBeamOffsetPerBeam),this.autoTupletVfBeams.push(t);const s=new u.Beam(i++);s.AutoGenerated=!0;for(const e of o)s.addNoteToBeam(e.sourceNote)}o=[],t=M}}else t=M;e||o.push(f);continue}t=void 0,r.push(f)}if(o.length>=2){const e=[];for(const t of o)e.push(t.vfStaveNote);const t=new n.Beam(e,!0);this.rules.FlatBeams&&(t.render_options.flat_beams=!0,t.render_options.flat_beam_offset=this.rules.FlatBeamOffset,t.render_options.flat_beam_offset_per_beam=this.rules.FlatBeamOffsetPerBeam),this.autoTupletVfBeams.push(t);const s=new u.Beam(i++);s.AutoGenerated=!0;for(const e of o)s.addNoteToBeam(e.sourceNote)}if(r.length>=2){for(const e of r)s.push(e);a.push(s)}const c=this.rules.AutoBeamOptions,h={beam_middle_only:c.beam_middle_rests_only,beam_rests:c.beam_rests,maintain_stem_directions:c.maintain_stem_directions};if(c.groups&&c.groups.length){const e=[];for(const t of c.groups)e.push(new n.Fraction(t[0],t[1]));h.groups=e}for(const e of a){const t=[];for(const i of e)t.push(i.vfStaveNote);const i=n.Beam.generateBeams(t,h);for(const e of i)this.rules.FlatBeams&&(e.render_options.flat_beams=!0,e.render_options.flat_beam_offset=this.rules.FlatBeamOffset,e.render_options.flat_beam_offset_per_beam=this.rules.FlatBeamOffsetPerBeam),this.autoVfBeams.push(e)}}finalizeTuplets(){this.vftuplets={};for(const e in this.tuplets)if(this.tuplets.hasOwnProperty(e)){let t=this.vftuplets[e];t||(t=this.vftuplets[e]=[]);for(const i of this.tuplets[e]){const e=[],s=i[1];for(const t of s)e.push(t.vfStaveNote);if(e.length>1){const s=i[0],r=s.Notes[0][0].NormalNotes,o=s.shouldBeBracketed(this.rules.TupletsBracketedUseXMLValue,this.rules.TupletsBracketed,this.rules.TripletsBracketed,this.isTabMeasure,this.rules.TabTupletsBracketed);let a=n.Tuplet.LOCATION_TOP;s.tupletLabelNumberPlacement===M.PlacementEnum.Below&&(a=n.Tuplet.LOCATION_BOTTOM);let l=0;if(this.isTabMeasure&&(l=10*this.rules.TabTupletYOffsetBottom,a===n.Tuplet.LOCATION_TOP)){l=-10*this.rules.TabTupletYOffsetTop;const e=s.Notes[0][0];e?.hasTabEffects()&&(l-=10*this.rules.TabTupletYOffsetEffects)}const u=new n.Tuplet(e,{bracketed:o,location:a,notes_occupied:r,num_notes:s.TupletLabelNumber,ratioed:this.rules.TupletsRatioed,y_offset:l});t.push(u)}else h.default.debug("Warning! Tuplet with no notes! Trying to ignore, but this is a serious problem.")}}}layoutStaffEntry(e){}graphicalMeasureCreatedCalculations(){let e,t=[];const i=[];for(const s of this.staffEntries){e=!1,t=[];for(const r of s.graphicalVoiceEntries)if(r.parentVoiceEntry.IsGrace)t.push(r),i.push(r),e||(e=r.parentVoiceEntry.GraceSlur);else if(r.vfStaveNote=l.VexFlowConverter.StaveNote(r),t.length>0){const i=[];for(let e=0;e<t.length;e++){const s=t[e];s.GraceSlash=s.parentVoiceEntry.GraceNoteSlash,e>0&&(s.GraceSlash=!1);const n=l.VexFlowConverter.StaveNote(s);s.vfStaveNote=n,i.push(n)}const s=new n.GraceNoteGroup(i,e);let o=this.rules.GraceNoteGroupXMargin;i.length>1&&(o/=3),s.spacing=10*o,r.vfStaveNote.addModifier(0,s),t=[]}}if(t.length>0)for(const e of t)e.vfStaveNote=l.VexFlowConverter.StaveNote(e),e.parentVoiceEntry.GraceAfterMainNote=!0;this.finalizeBeams(),this.finalizeTuplets();const s=this.getVoicesWithinMeasure();if(this.rules.RenderFingerings)for(const e of this.staffEntries)e.setModifierXOffsets();for(const e of s){if(!e)continue;this.vfVoices[e.VoiceId]=new n.Voice({beat_value:this.parentSourceMeasure.ActiveTimeSignature.Denominator,num_beats:this.parentSourceMeasure.ActiveTimeSignature.Numerator,resolution:n.RESOLUTION}).setMode(n.Voice.Mode.SOFT);const t=this.getRestFilledVexFlowStaveNotesPerVoice(e);for(const i of t){if(i.parentVoiceEntry&&i.parentVoiceEntry.IsGrace&&!i.parentVoiceEntry.GraceAfterMainNote)continue;const t=i;if(0===t.vfStaveNote.getTicks().denominator&&(t.vfStaveNote.getTicks().denominator=1),0===i.notes.length||!i.notes[0]||!i.notes[0].sourceNote.PrintObject){this.vfVoices[e.VoiceId].addTickable(t.vfStaveNote);continue}const s=t.parentStaffEntry;if(s&&s.vfClefBefore){const e=new c([s.vfClefBefore]);t.vfStaveNote.getCategory&&"stavenotes"===t.vfStaveNote.getCategory()&&t.vfStaveNote.addModifier(0,e)}i.parentVoiceEntry&&this.rules.RenderFingerings&&(this.rules.FingeringPosition!==M.PlacementEnum.Left&&this.rules.FingeringPosition!==M.PlacementEnum.Right||this.createFingerings(i),this.createStringNumber(i)),this.createArpeggio(i),this.vfVoices[e.VoiceId].addTickable(t.vfStaveNote)}}this.setStemDirectionFromVexFlow();for(const e of i)this.createFingerings(e),this.createStringNumber(e),this.createArpeggio(e);this.createArticulations(),this.createOrnaments()}createArpeggio(e){if(e.parentVoiceEntry&&e.parentVoiceEntry.Arpeggio){const t=e.parentVoiceEntry.Arpeggio;if(e.notes&&e.notes.length>1){const i=l.VexFlowConverter.StrokeTypeFromArpeggioType(t.type),s=new n.Stroke(i,{all_voices:this.rules.ArpeggiosGoAcrossVoices});this.rules.RenderArpeggios&&e.vfStaveNote.addStroke(0,s)}else h.default.debug(`[OSMD] arpeggio in measure ${this.MeasureNumber} could not be drawn.\n                voice entry had less than two notes, arpeggio is likely between voice entries, not currently supported in Vexflow.`)}}setStemDirectionFromVexFlow(){for(const e of this.staffEntries)for(const t of e.graphicalVoiceEntries)for(const e of t.notes){const i=e.vfnote;if(i&&i[0])switch(i[0].getStemDirection()){case n.Stem.UP:t.parentVoiceEntry.StemDirection=p.StemDirectionType.Up;break;case n.Stem.DOWN:t.parentVoiceEntry.StemDirection=p.StemDirectionType.Down}}}createArticulations(){for(let e=0,t=this.staffEntries.length;e<t;++e){const t=this.staffEntries[e].graphicalVoiceEntries;for(const e of t){const t=e.vfStaveNote;l.VexFlowConverter.generateArticulations(t,e.notes[0],this.rules)}}}createOrnaments(){for(let e=0,t=this.staffEntries.length;e<t;++e){const t=this.staffEntries[e].graphicalVoiceEntries;for(const e in t)if(t.hasOwnProperty(e)){const i=t[e].vfStaveNote,s=t[e].notes[0].sourceNote.ParentVoiceEntry.OrnamentContainer;s&&l.VexFlowConverter.generateOrnaments(i,s)}}}createFingerings(e){const t=e;let i=0;for(const t of e.notes)t.sourceNote.Fingering&&i++;const s=[];for(const t of e.parentVoiceEntry.TechnicalInstructions)t.type===E.TechnicalInstructionType.Fingering&&s.push(t);if(s.length>i){let t=0;for(const i of e.notes)if(i.sourceNote.Fingering)t++;else{if(t>s.length-1)break;i.sourceNote.Fingering=s[t],t++}}let r=-1;for(const s of e.notes){const o=s.sourceNote.Fingering;if(!o){r++;continue}r++;let a=this.rules.FingeringPosition;this.rules.FingeringPositionGrace===M.PlacementEnum.AboveOrBelow&&(this.isUpperStaffOfInstrument()?a=M.PlacementEnum.Above:this.isLowerStaffOfInstrument()&&(a=M.PlacementEnum.Below)),o.placement!==M.PlacementEnum.NotYetDefined&&(a=o.placement);let l,u=this.rules.FingeringOffsetX;switch(a){default:case M.PlacementEnum.Left:l=n.StaveModifier.Position.LEFT,u-=s.baseFingeringXOffset*d.unitInPixels;break;case M.PlacementEnum.Right:l=n.StaveModifier.Position.RIGHT,u+=s.baseFingeringXOffset*d.unitInPixels;break;case M.PlacementEnum.Above:l=n.StaveModifier.Position.ABOVE;break;case M.PlacementEnum.Below:l=n.StaveModifier.Position.BELOW;break;case M.PlacementEnum.NotYetDefined:const t=e.parentStaffEntry.sourceStaffEntry.ParentStaff;e.notes.length>1||e.parentStaffEntry.graphicalVoiceEntries.length>1?l=n.StaveModifier.Position.LEFT:0===t.idInMusicSheet?(l=n.StaveModifier.Position.ABOVE,a=M.PlacementEnum.Above):(l=n.StaveModifier.Position.BELOW,a=M.PlacementEnum.Below)}const c=new n.FretHandFinger(o.value);if(c.setPosition(l),c.setOffsetX(u),a===M.PlacementEnum.Above||a===M.PlacementEnum.Below){const e=a===M.PlacementEnum.Above?-1:1,s=a===M.PlacementEnum.Above?r:i-1-r;if(this.rules.FingeringInsideStafflines&&i>1){const t=c.getWidth()/2,n=2.5*i;c.setOffsetY(e*(s+n)*t)}else if(!this.rules.FingeringInsideStafflines){const i=new n.StringNumber(o.value);i.radius=0,i.setPosition(l),i.setOffsetY(e*s*i.getWidth()*2/3),t.vfStaveNote.addModifier(r,i);continue}}t.vfStaveNote.addModifier(r,c)}}createStringNumber(e){if(!this.rules.RenderStringNumbersClassical)return;const t=e;e.notes.forEach((i,s)=>{const r=i.sourceNote.StringInstruction;if(r){let o=r.value;switch(o){case"1":o="I";break;case"2":o="II";break;case"3":o="III";break;case"4":o="IV";break;case"5":o="V";break;case"6":o="VI"}const a=new n.StringNumber(o);a.radius=0;const l=-this.rules.StringNumberOffsetY;e.notes.length>1||e.parentStaffEntry.graphicalVoiceEntries.length>1?(a.setOffsetX(13*i.baseStringNumberXOffset),a.setPosition(n.Modifier.Position.RIGHT)):a.setPosition(n.Modifier.Position.ABOVE),a.setOffsetY(l),t.vfStaveNote.addModifier(s,a)}})}lineTo(e,t){const i=new n.StaveConnector(e.getVFStave(),this.stave);i.setType(t),this.connectors.push(i)}getVFStave(){return this.stave}updateInstructionWidth(){let e=0,t=0;const i=this.stave.getModifiers();for(const s of i)s.getPosition()===L.BEGIN?e+=s.getWidth()+s.getPadding(void 0):s.getPosition()===L.END&&(t+=s.getWidth()+s.getPadding(void 0));this.beginInstructionsWidth=(e??0)/d.unitInPixels,this.endInstructionsWidth=(t??0)/d.unitInPixels}addStaveTie(e,t){this.vfTies.push(e),t.vfTie=e,t.Tie.TieDirection===M.PlacementEnum.Below&&e.setDirection(1)}}var L;t.VexFlowMeasure=P,function(e){e[e.LEFT=1]="LEFT",e[e.RIGHT=2]="RIGHT",e[e.ABOVE=3]="ABOVE",e[e.BELOW=4]="BELOW",e[e.BEGIN=5]="BEGIN",e[e.END=6]="END"}(L||(t.StavePositionEnum=L={}))},5274:function(e,t,i){var s=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.Tie=void 0;const n=i(2561),r=i(6362),o=s(i(3065));t.Tie=class{constructor(e,t){this.notes=[],this.TieNumber=1,this.TieDirection=r.PlacementEnum.NotYetDefined,this.NoteIndexToTieDirection={},this.AddNote(e),this.type=t}getTieDirection(e){if(!e)return this.TieDirection;for(let t=0;t<this.Notes.length;t++)if(this.Notes[t]===e){return this.NoteIndexToTieDirection[t]||this.TieDirection}return o.default.debug("tie.getTieDuration note not in tie.Notes"),this.TieDirection}get Notes(){return this.notes}get Type(){return this.type}get StartNote(){return this.notes[0]}get Duration(){const e=new n.Fraction;for(const t of this.notes)e.Add(t.Length);return e}get Pitch(){return this.StartNote.Pitch}AddNote(e){this.notes.push(e),e.NoteTie=this}}},5282:(e,t,i)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.NoteTypeHandler=t.NoteType=void 0;const s=i(2561),n=i(2148),r=i(7307);var o;!function(e){e[e.UNDEFINED=0]="UNDEFINED",e[e._1024th=1]="_1024th",e[e._512th=2]="_512th",e[e._256th=3]="_256th",e[e._128th=4]="_128th",e[e._64th=5]="_64th",e[e._32nd=6]="_32nd",e[e._16th=7]="_16th",e[e.EIGTH=8]="EIGTH",e[e.QUARTER=9]="QUARTER",e[e.HALF=10]="HALF",e[e.WHOLE=11]="WHOLE",e[e.BREVE=12]="BREVE",e[e.LONG=13]="LONG",e[e.MAXIMA=14]="MAXIMA"}(o||(t.NoteType=o={}));class a{static NoteTypeToString(e){return this.NoteTypeXmlValues[e]}static StringToNoteType(e){const t=this.NoteTypeXmlValues.indexOf(e);return-1!==t?t:o.UNDEFINED}static getNoteDurationFromType(e){switch(e){case"1024th":return new s.Fraction(1,1024);case"512th":return new s.Fraction(1,512);case"256th":return new s.Fraction(1,256);case"128th":return new s.Fraction(1,128);case"64th":return new s.Fraction(1,64);case"32th":case"32nd":return new s.Fraction(1,32);case"16th":return new s.Fraction(1,16);case"eighth":return new s.Fraction(1,8);case"quarter":return new s.Fraction(1,4);case"half":return new s.Fraction(1,2);case"whole":return new s.Fraction(1,1);case"breve":return new s.Fraction(2,1);case"long":return new s.Fraction(4,1);case"maxima":return new s.Fraction(8,1);default:{const e=n.ITextTranslation.translateText("ReaderErrorMessages/NoteDurationError","Invalid note duration.");throw new r.MusicSheetReadingException(e)}}}}t.NoteTypeHandler=a,a.NoteTypeXmlValues=["","1024th","512th","256th","128th","64th","32nd","16th","eigth","quarter","half","whole","breve","long","maxima"]},5294:function(e,t,i){var s=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.SubInstrument=void 0;const n=i(164),r=s(i(3065));class o{constructor(e){this.parentInstrument=e,this.fixedKey=-1,this.name=this.parseMidiInstrument(this.parentInstrument.Name),this.midiInstrumentID=o.midiInstrument[this.name],this.volume=1}get ParentInstrument(){return this.parentInstrument}static isPianoInstrument(e){return e===n.MidiInstrument.Acoustic_Grand_Piano||e===n.MidiInstrument.Bright_Acoustic_Piano||e===n.MidiInstrument.Electric_Grand_Piano||e===n.MidiInstrument.Electric_Piano_1||e===n.MidiInstrument.Electric_Piano_2}setMidiInstrument(e){this.midiInstrumentID=o.midiInstrument[this.parseMidiInstrument(e)]}parseMidiInstrument(e){try{if(e){const t=e.toLowerCase().trim();for(const e in o.midiInstrument)if(-1!==t.indexOf(e))return e}if(this.parentInstrument.Name){const e=this.parentInstrument.Name.toLowerCase().trim();for(const t in o.midiInstrument)if(-1!==e.indexOf(t))return t}}catch(e){r.default.error("Error parsing MIDI Instrument. Default to Grand Piano.")}return"unnamed"}}t.SubInstrument=o,o.midiInstrument={alt:n.MidiInstrument.Synth_Voice,alto:n.MidiInstrument.Synth_Voice,banjo:n.MidiInstrument.Banjo,bariton:n.MidiInstrument.Synth_Voice,baritone:n.MidiInstrument.Synth_Voice,bass:n.MidiInstrument.Synth_Voice,blockfloete:n.MidiInstrument.Recorder,brass:n.MidiInstrument.Trombone,bratsche:n.MidiInstrument.Viola,cello:n.MidiInstrument.Cello,clarinet:n.MidiInstrument.Clarinet,contrabass:n.MidiInstrument.Contrabass,drums:n.MidiInstrument.Percussion,flute:n.MidiInstrument.Flute,floete:n.MidiInstrument.Flute,frenchhorn:n.MidiInstrument.French_Horn,gitarre:n.MidiInstrument.Acoustic_Guitar_nylon,guitar:n.MidiInstrument.Acoustic_Guitar_nylon,harfe:n.MidiInstrument.Orchestral_Harp,harp:n.MidiInstrument.Orchestral_Harp,klarinette:n.MidiInstrument.Clarinet,klavier:n.MidiInstrument.Acoustic_Grand_Piano,kontrabass:n.MidiInstrument.Contrabass,oboe:n.MidiInstrument.Oboe,organ:n.MidiInstrument.Church_Organ,orgel:n.MidiInstrument.Church_Organ,orgue:n.MidiInstrument.Church_Organ,percussion:n.MidiInstrument.Percussion,piano:n.MidiInstrument.Acoustic_Grand_Piano,piccolo:n.MidiInstrument.Piccolo,posaune:n.MidiInstrument.Trombone,recorder:n.MidiInstrument.Recorder,sax:n.MidiInstrument.Tenor_Sax,schlagwerk:n.MidiInstrument.Percussion,schlagzeug:n.MidiInstrument.Percussion,sopran:n.MidiInstrument.Synth_Voice,steeldrum:n.MidiInstrument.Steel_Drums,streicher:n.MidiInstrument.String_Ensemble_1,strings:n.MidiInstrument.String_Ensemble_1,tenor:n.MidiInstrument.Synth_Voice,tpt:n.MidiInstrument.Trumpet,trombone:n.MidiInstrument.Trombone,trompete:n.MidiInstrument.Trumpet,trumpet:n.MidiInstrument.Trumpet,tuba:n.MidiInstrument.Tuba,unnamed:n.MidiInstrument.Acoustic_Grand_Piano,viola:n.MidiInstrument.Viola,violin:n.MidiInstrument.Violin,"violon-c":n.MidiInstrument.Cello,"violon.":n.MidiInstrument.Violin,voice:n.MidiInstrument.Synth_Voice,woodblock:n.MidiInstrument.Woodblock}},5332:(e,t,i)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.TempoExpressionEntry=t.MultiTempoExpression=void 0;const s=i(2561),n=i(9161),r=i(6362),o=i(2570),a=i(2221);t.MultiTempoExpression=class{constructor(e,t){this.expressions=[],this.sourceMeasure=e,this.timestamp=t}get Timestamp(){return this.timestamp}get AbsoluteTimestamp(){return s.Fraction.plus(this.sourceMeasure.AbsoluteTimestamp,this.timestamp)}get SourceMeasureParent(){return this.sourceMeasure}set SourceMeasureParent(e){this.sourceMeasure=e}get InstantaneousTempo(){return this.instantaneousTempo}get ContinuousTempo(){return this.continuousTempo}get EntriesList(){return this.expressions}get CombinedExpressionsText(){return this.combinedExpressionsText}set CombinedExpressionsText(e){this.combinedExpressionsText=e}getPlacementOfFirstEntry(){let e=r.PlacementEnum.Above;return this.expressions.length>0&&(this.expressions[0].Expression instanceof n.InstantaneousTempoExpression||this.expressions[0].Expression instanceof a.ContinuousTempoExpression)&&(e=this.expressions[0].Expression.Placement),e}getFontstyleOfFirstEntry(){let e=o.FontStyles.Regular;return this.expressions[0].Expression instanceof n.InstantaneousTempoExpression?e=o.FontStyles.Bold:this.expressions[0].Expression instanceof a.ContinuousTempoExpression&&(e=o.FontStyles.Italic),e}addExpression(e,t){if(this.checkIfAlreadyExists(e))return;e instanceof n.InstantaneousTempoExpression?this.instantaneousTempo=e:e instanceof a.ContinuousTempoExpression&&(this.continuousTempo=e);const i=new l;i.prefix=t,i.Expression=e,i.label=e.Label,this.expressions.push(i)}CompareTo(e){return this.Timestamp.RealValue>e.Timestamp.RealValue?1:this.Timestamp.RealValue<e.Timestamp.RealValue?-1:0}checkIfAlreadyExists(e){for(const t of this.expressions)if(t.label===e.Label)return!0;return!1}};class l{get Expression(){return this.expression}set Expression(e){this.expression=e}}t.TempoExpressionEntry=l},5340:e=>{e.exports="attribute vec4 a_position;\r\nvarying vec4 v_position;\r\n\r\nvoid main() {\r\n    gl_Position = a_position;\r\n    v_position = a_position;\r\n}\r\n"},5364:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.AbstractNotationInstruction=void 0,t.AbstractNotationInstruction=class{constructor(e){this.printObject=!0,this.parent=e}get Parent(){return this.parent}set Parent(e){this.parent=e}get PrintObject(){return this.printObject}set PrintObject(e){this.printObject=e}}},5468:function(e,t,i){var s=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.VexFlowSlur=t.CurvePositionEnum=void 0;var n,r=s(i(3206)).default.Flow;!function(e){e[e.NEAR_HEAD=1]="NEAR_HEAD",e[e.NEAR_TOP=2]="NEAR_TOP"}(n||(t.CurvePositionEnum=n={}));class o{constructor(e){this.vfStartNote=void 0,this.vfEndNote=void 0,this.parentSlur=e}static createFromVexflowSlur(e){return new o(e.parentSlur)}get vfSlur(){return this.parentSlur}curve_Options(){return{cps:[{x:0,y:10},{x:0,y:10}],invert:!1,position:n.NEAR_TOP,position_end:n.NEAR_TOP,spacing:2,thickness:2,x_shift:0,y_shift:10}}createVexFlowCurve(){this.vfCurve=new r.Curve(this.vfStartNote,this.vfEndNote,void 0)}}t.VexFlowSlur=o},5479:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.SkyBottomLineCalculationResult=void 0,t.SkyBottomLineCalculationResult=class{constructor(e,t){this.skyLine=e,this.bottomLine=t}}},5534:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.Voice=void 0,t.Voice=class{constructor(e,t){this.voiceEntries=[],this.volume=1,this.parent=e,this.visible=!0,this.audible=!0,this.following=!0,this.voiceId=t}get VoiceEntries(){return this.voiceEntries}get Parent(){return this.parent}get Visible(){return this.visible}set Visible(e){this.visible=e}get Audible(){return this.audible}set Audible(e){this.audible=e}get Following(){return this.following}set Following(e){this.following=e}get VoiceId(){return this.voiceId}get Volume(){return this.volume}set Volume(e){this.volume=e}}},5748:(e,t,i)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.GraphicalMeasure=void 0;const s=i(7741),n=i(2561),r=i(6438),o=i(9409);class a extends s.GraphicalObject{constructor(e=void 0,t=void 0,i=void 0){super(),this.hasOnlyRests=!1,this.measureNumber=-1,this.ShowTimeSignature=!0,this.ShowKeySignature=!0,this.isTabMeasure=!1,this.parentStaff=e,this.parentSourceMeasure=t,this.parentStaffLine=i,i?(this.parentStaff=i.ParentStaff,this.PositionAndShape=new r.BoundingBox(this,i.PositionAndShape)):this.PositionAndShape=new r.BoundingBox(this),this.PositionAndShape.BorderBottom=4,this.parentSourceMeasure&&(this.measureNumber=this.parentSourceMeasure.MeasureNumber),this.staffEntries=[]}get ParentStaff(){return this.parentStaff}get ParentMusicSystem(){return this.parentMusicSystem}set ParentMusicSystem(e){this.parentMusicSystem=e}get MeasureNumber(){return this.measureNumber}get FirstInstructionStaffEntry(){return this.firstInstructionStaffEntry}set FirstInstructionStaffEntry(e){this.firstInstructionStaffEntry=e}get LastInstructionStaffEntry(){return this.lastInstructionStaffEntry}set LastInstructionStaffEntry(e){this.lastInstructionStaffEntry=e}get ParentStaffLine(){return this.parentStaffLine}set ParentStaffLine(e){this.parentStaffLine=e,this.parentStaffLine&&(this.PositionAndShape.Parent=this.parentStaffLine.PositionAndShape)}resetLayout(){throw new Error("not implemented")}getLineWidth(e){throw new Error("not implemented")}addClefAtBegin(e){throw new Error("not implemented")}addKeyAtBegin(e,t,i){throw new Error("not implemented")}addRhythmAtBegin(e){throw new Error("not implemented")}addClefAtEnd(e,t=!0){throw new Error("not implemented")}setPositionInStaffline(e){this.PositionAndShape.RelativePosition=new o.PointF2D(e,0)}setWidth(e){this.PositionAndShape.BorderRight=e}layoutSymbols(){throw new Error("not implemented")}findGraphicalStaffEntryFromTimestamp(e){for(let t=0,i=this.staffEntries.length;t<i;++t){const i=this.staffEntries[t];if(i.relInMeasureTimestamp?.Equals(e))return i}}findGraphicalStaffEntryFromVerticalContainerTimestamp(e){for(let t=0,i=this.staffEntries.length;t<i;++t){const i=this.staffEntries[t];if(i.sourceStaffEntry.VerticalContainerParent.getAbsoluteTimestamp().Equals(e))return i}}hasSameDurationWithSourceMeasureParent(){const e=new n.Fraction(0,1);for(let t=0,i=this.staffEntries.length;t<i;++t){const i=this.staffEntries[t];e.Add(i.findStaffEntryMinNoteLength())}return e.Equals(this.parentSourceMeasure.Duration)}hasMultipleVoices(){if(0===this.staffEntries.length)return!1;const e=[];for(let t=0,i=this.staffEntries.length;t<i;++t){const i=this.staffEntries[t];for(let t=0,s=i.sourceStaffEntry.VoiceEntries.length;t<s;++t){const s=i.sourceStaffEntry.VoiceEntries[t];e.indexOf(s.ParentVoice)<0&&e.push(s.ParentVoice)}}return e.length>1}isVisible(){return this.ParentStaff.isVisible()}getGraphicalMeasureDurationFromStaffEntries(){let e=new n.Fraction(0,1);const t=[];for(let e=0,i=this.staffEntries.length;e<i;++e){const i=this.staffEntries[e];for(let e=0,s=i.sourceStaffEntry.VoiceEntries.length;e<s;++e){const s=i.sourceStaffEntry.VoiceEntries[e];t.indexOf(s.ParentVoice)<0&&t.push(s.ParentVoice)}}for(let i=0,s=t.length;i<s;++i){const s=t[i],r=new n.Fraction(0,1);for(const e of this.staffEntries)for(const t of e.graphicalVoiceEntries)t.parentVoiceEntry.ParentVoice===s&&t.notes.length>0&&r.Add(t.notes[0].graphicalNoteLength);e.lt(r)&&(e=n.Fraction.createFromFraction(r))}return e}addGraphicalStaffEntry(e){this.staffEntries.push(e)}addGraphicalStaffEntryAtTimestamp(e){if(e)if(0===this.staffEntries.length||this.staffEntries[this.staffEntries.length-1].relInMeasureTimestamp.lt(e.relInMeasureTimestamp))this.staffEntries.push(e);else for(let t=this.staffEntries.length-1;t>=0;t--){if(this.staffEntries[t].relInMeasureTimestamp.lt(e.relInMeasureTimestamp)){this.staffEntries.splice(t+1,0,e);break}0===t&&this.staffEntries.splice(t,0,e)}}isPianoRightHand(){return this.isUpperStaffOfInstrument()}isPianoLeftHand(){return this.isLowerStaffOfInstrument()}isUpperStaffOfInstrument(){return 1===this.parentStaff.ParentInstrument.Staves.length||this.ParentStaff===this.parentStaff.ParentInstrument.Staves[0]}isLowerStaffOfInstrument(){return 1!==this.parentStaff.ParentInstrument.Staves.length&&this.ParentStaff===this.ParentStaff.ParentInstrument.Staves.last()}beginsWithLineRepetition(){const e=this.parentSourceMeasure;return!!e&&e.beginsWithLineRepetition()}endsWithLineRepetition(){const e=this.parentSourceMeasure;return!!e&&e.endsWithLineRepetition()}beginsWithWordRepetition(){const e=this.parentSourceMeasure;return!!e&&e.beginsWithWordRepetition()}endsWithWordRepetition(){const e=this.parentSourceMeasure;return!!e&&e.endsWithWordRepetition()}getTransposedHalftones(){return this.parentStaff.ParentInstrument.GetMusicSheet.Transpose+this.parentStaff.ParentInstrument.Transpose}}t.GraphicalMeasure=a},5749:(e,t,i)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.MusicSymbolModuleFactory=void 0;const s=i(7631),n=i(6302);t.MusicSymbolModuleFactory=class{static createRepetitionInstructionReader(){return new s.RepetitionInstructionReader}static createRepetitionCalculator(){return new n.RepetitionCalculator}}},5824:function(e,t,i){var s=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.GraphicalUnknownExpression=void 0;const n=i(9490),r=i(6362),o=s(i(3065));class a extends n.AbstractGraphicalExpression{constructor(e,t,i,s,n=void 0){super(e,new r.AbstractExpression(i),s),this.label=t,this.sourceMultiExpression=n}updateSkyBottomLine(){const e=this.parentStaffLine.SkyBottomLineCalculator,t=this.label.PositionAndShape.RelativePosition.x+this.label.PositionAndShape.BorderMarginLeft,i=this.label.PositionAndShape.RelativePosition.x+this.label.PositionAndShape.BorderMarginRight;switch(this.Placement){case r.PlacementEnum.Above:const s=this.label.PositionAndShape.BorderMarginTop+this.label.PositionAndShape.RelativePosition.y;e.updateSkyLineInRange(t,i,s);break;case r.PlacementEnum.Below:const n=this.label.PositionAndShape.BorderMarginBottom+this.label.PositionAndShape.RelativePosition.y;e.updateBottomLineInRange(t,i,n);break;default:o.default.error("Placement for GraphicalUnknownExpression is unknown")}}}t.GraphicalUnknownExpression=a},5866:(e,t,i)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.VexFlowStaffLine=void 0;const s=i(2919),n=i(1083);class r extends s.StaffLine{constructor(e,t){super(e,t),this.slursInVFStaffLine=[],this.alignmentManager=new n.AlignmentManager(this)}get SlursInVFStaffLine(){return this.slursInVFStaffLine}addVFSlurToVFStaffline(e){this.slursInVFStaffLine.push(e)}get AlignmentManager(){return this.alignmentManager}}t.VexFlowStaffLine=r},5875:(e,t,i)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.ContDynamicEnum=t.ContinuousDynamicExpression=void 0;const s=i(6362),n=i(2561);class r extends s.AbstractExpression{constructor(e,t,i,s,n,r=""){super(t),this.parentMeasure=s,this.NumberXml=n,this.dynamicType=e,this.label=r,this.staffNumber=i,this.startVolume=-1,this.endVolume=-1,""!==r&&this.setType()}get DynamicType(){return this.dynamicType}set DynamicType(e){this.dynamicType=e}get StartMultiExpression(){return this.startMultiExpression}set StartMultiExpression(e){this.startMultiExpression=e}get EndMultiExpression(){return this.endMultiExpression}set EndMultiExpression(e){this.endMultiExpression=e}get Placement(){return this.placement}set Placement(e){this.placement=e}get StartVolume(){return this.startVolume}set StartVolume(e){this.startVolume=e}get EndVolume(){return this.endVolume}set EndVolume(e){this.endVolume=e}get StaffNumber(){return this.staffNumber}set StaffNumber(e){this.staffNumber=e}get Label(){return this.label}set Label(e){this.label=e,this.setType()}static isInputStringContinuousDynamic(e){return!!e&&(r.isStringInStringList(r.listContinuousDynamicIncreasing,e)||r.isStringInStringList(r.listContinuousDynamicDecreasing,e))}getInterpolatedDynamic(e){const t=this.StartMultiExpression.AbsoluteTimestamp;let i;if(i=this.EndMultiExpression?this.EndMultiExpression.AbsoluteTimestamp:n.Fraction.plus(this.startMultiExpression.SourceMeasureParent.AbsoluteTimestamp,this.startMultiExpression.SourceMeasureParent.Duration),e.lt(t))return-1;if(i.lt(e))return-2;const s=n.Fraction.minus(e,t).RealValue/n.Fraction.minus(i,t).RealValue;return Math.max(0,Math.min(99.9,this.startVolume+(this.endVolume-this.startVolume)*s))}isWedge(){return!this.label}setType(){r.isStringInStringList(r.listContinuousDynamicIncreasing,this.label)?this.dynamicType=o.crescendo:r.isStringInStringList(r.listContinuousDynamicDecreasing,this.label)&&(this.dynamicType=o.diminuendo)}}var o;t.ContinuousDynamicExpression=r,r.listContinuousDynamicIncreasing=["crescendo","cresc","cresc.","cres."],r.listContinuousDynamicDecreasing=["decrescendo","decresc","decr.","diminuendo","dim.","dim"],function(e){e[e.crescendo=0]="crescendo",e[e.diminuendo=1]="diminuendo"}(o||(t.ContDynamicEnum=o={}))},5951:(e,t)=>{var i;Object.defineProperty(t,"__esModule",{value:!0}),t.Fonts=void 0,function(e){e[e.TimesNewRoman=0]="TimesNewRoman",e[e.Kokila=1]="Kokila"}(i||(t.Fonts=i={}))},5955:function(e,t,i){var s=this&&this.__createBinding||(Object.create?function(e,t,i,s){void 0===s&&(s=i);var n=Object.getOwnPropertyDescriptor(t,i);n&&!("get"in n?!t.__esModule:n.writable||n.configurable)||(n={enumerable:!0,get:function(){return t[i]}}),Object.defineProperty(e,s,n)}:function(e,t,i,s){void 0===s&&(s=i),e[s]=t[i]}),n=this&&this.__exportStar||function(e,t){for(var i in e)"default"===i||Object.prototype.hasOwnProperty.call(t,i)||s(t,e,i)};Object.defineProperty(t,"__esModule",{value:!0}),n(i(3173),t),n(i(6597),t),n(i(624),t),n(i(7103),t)},5984:function(e,t,i){var s=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.ExpressionReader=void 0;const n=i(2561),r=i(5332),o=i(5875),a=i(2221),l=i(9767),u=i(437),c=i(9019),h=i(9161),d=i(9803),m=i(1112),f=i(6362),p=i(7533),S=i(2148),g=s(i(3065)),y=i(2570),E=i(9157),M=i(3253);t.ExpressionReader=class{constructor(e,t,i){this.openContinuousDynamicExpressions=[],this.musicSheet=e,this.staffNumber=i,this.globalStaffIndex=e.getGlobalStaffIndexOfFirstStaff(t)+(i-1),this.initialize()}readExpressionParameters(e,t,i,s,r,o,a){this.initialize(),this.divisions=i;const l=e.element("offset");if(void 0!==l&&!a)try{this.offsetDivisions=parseInt(l.value,10)}catch(e){const t="ReaderErrorMessages/ExpressionOffsetError, Invalid expression offset -> set to default.";g.default.debug("ExpressionReader.readExpressionParameters",t,e),this.musicSheet.SheetErrors.pushMeasureError(t),this.offsetDivisions=0}this.directionTimestamp=n.Fraction.createFromFraction(s);let u,c=new n.Fraction(Math.abs(this.offsetDivisions),4*i);this.offsetDivisions>0?s.RealValue>0?(c=n.Fraction.multiply(n.Fraction.minus(s,r),c),this.directionTimestamp=n.Fraction.plus(c,s)):this.directionTimestamp=n.Fraction.createFromFraction(c):this.offsetDivisions<0&&(s.RealValue>0?(c=n.Fraction.multiply(n.Fraction.minus(s,r),c),this.directionTimestamp=n.Fraction.minus(s,c)):this.directionTimestamp=n.Fraction.createFromFraction(c));const h=e.element("direction-type");let d;if(h&&(d=h.element("wedge"),d)){const e=d.attribute("default-y");e&&(u=this.readPosition(e))}this.WedgeYPosXml=u;const m=e.attribute("placement");if(m)try{const e=m.value;"below"===e?this.placement=f.PlacementEnum.Below:"above"===e&&(this.placement=f.PlacementEnum.Above)}catch(e){const t=S.ITextTranslation.translateText("ReaderErrorMessages/ExpressionPlacementError","Invalid expression placement -> set to default.");g.default.debug("ExpressionReader.readExpressionParameters",t,e),this.musicSheet.SheetErrors.pushMeasureError(t),this.placement=f.PlacementEnum.Below}if(this.placement===f.PlacementEnum.NotYetDefined)try{if(h){const e=h.element("dynamics");if(e){const t=e.attribute("default-y");t&&this.readExpressionPlacement(t,"read dynamics y pos")}if(d){const e=d.attribute("default-y");e&&this.readExpressionPlacement(e,"read wedge y pos")}const t=h.element("words");if(t){const e=t.attribute("default-y");e&&this.readExpressionPlacement(e,"read words y pos")}const i=h.element("rehearsal");if(i){const e=i.attribute("default-y");e&&this.readExpressionPlacement(e,"read rehearsal pos")}}}catch(e){const t=S.ITextTranslation.translateText("ReaderErrorMessages/ExpressionPlacementError","Invalid expression placement. Set to default.");g.default.debug("ExpressionReader.readExpressionParameters",t,e),this.musicSheet.SheetErrors.pushMeasureError(t),this.placement=f.PlacementEnum.Below}this.placement===f.PlacementEnum.NotYetDefined&&(t.Staves.length>1?this.placement=f.PlacementEnum.Below:t.HasLyrics?this.placement=f.PlacementEnum.Above:this.placement=f.PlacementEnum.Below)}read(e,t,i,s=void 0){let r=!1,o=!1;const a=i.clone(),l=e.element("offset");if(l?.value){const e=Number.parseInt(l.value,10);a.Add(new n.Fraction(e,4*this.divisions))}const u=e.element("sound");if(u){const e=u.attribute("tempo"),i=u.attribute("dynamics");if(e){const i=e.value.match(/^(\d+)(\.\d+)?$/);i?.length>0?this.soundTempo=Math.round(Number.parseFloat(e.value)):(g.default.info("invalid xml tempo: "+e.value),this.soundTempo=100),t.TempoInBPM=this.soundTempo,0===this.musicSheet.DefaultStartTempoInBpm&&(this.musicSheet.DefaultStartTempoInBpm=this.soundTempo),this.musicSheet.HasBPMInfo=!0,r=!0}if(i){const e=i.value.match(/\d+/);this.soundDynamic=void 0!==e?parseInt(e[0],10):100,o=!0}}const c=e.element("direction-type");if(!c)return;let d=c.element("metronome");if(d){const e=d.element("beat-unit"),i=void 0!==d.element("beat-unit-dot"),s=d.element("per-minute");if(void 0!==e&&s){d.hasAttributes&&void 0!==d.attribute("default-x")&&(this.directionTimestamp=n.Fraction.createFromFraction(a));const r=parseFloat(s.value);this.createNewTempoExpressionIfNeeded(t);const o=new h.InstantaneousTempoExpression(void 0,this.placement,this.staffNumber,r,this.currentMultiTempoExpression,!0);o.parentMeasure=t,this.soundTempo=r,t.TempoInBPM=this.soundTempo*(i?1.5:1),0===this.musicSheet.DefaultStartTempoInBpm&&(this.musicSheet.DefaultStartTempoInBpm=this.soundTempo),this.musicSheet.HasBPMInfo=!0,o.dotted=i,o.beatUnit=e.value,this.currentMultiTempoExpression.addExpression(o,""),this.currentMultiTempoExpression.CombinedExpressionsText="test"}return}if(d=c.element("dynamics"),d){const i=void 0!==e.element("notations");return void this.interpretInstantaneousDynamics(d,t,a,i)}if(d=c.element("words"),d)if(r){this.createNewTempoExpressionIfNeeded(t),this.currentMultiTempoExpression.CombinedExpressionsText=d.value;const e=new h.InstantaneousTempoExpression(d.value,this.placement,this.staffNumber,this.soundTempo,this.currentMultiTempoExpression);this.currentMultiTempoExpression.addExpression(e,"")}else o||this.interpretWords(d,t,a);else d=c.element("wedge"),d?this.interpretWedge(e,d,t,s,t.MeasureNumber):(d=c.element("rehearsal"),d&&this.interpretRehearsalMark(d,t,i,t.MeasureNumber))}closeOpenExpressions(e,t){for(const i of this.openContinuousDynamicExpressions)this.createNewMultiExpressionIfNeeded(e,i.NumberXml,t),this.closeOpenContinuousDynamic(i,e,t);this.openContinuousTempoExpression&&this.closeOpenContinuousTempo(n.Fraction.plus(e.AbsoluteTimestamp,t))}addOctaveShift(e,t,i){let s=1;const n=e.element("staff");if(n)try{s=parseInt(n.value,10)}catch(e){const t=S.ITextTranslation.translateText("ReaderErrorMessages/OctaveShiftStaffError","Invalid octave shift staff number. Set to default");this.musicSheet.SheetErrors.pushMeasureError(t),s=1,g.default.debug("ExpressionReader.addOctaveShift",t,e)}const r=e.element("direction-type");if(r){const n=r.element("octave-shift"),o=this.readPlacement(e);if(void 0!==n&&n.hasAttributes)try{const e=this.readNumber(n);if(n.attribute("size")){const r=parseInt(n.attribute("size").value,10);let a=0;8===r?a=1:15===r&&(a=2);let l=n.attribute("type")?.value;if(l||(o===f.PlacementEnum.Above?l="down":o===f.PlacementEnum.Below&&(l="up")),"up"===l||"down"===l){const i=new u.OctaveShift(l,a);i.StaffNumber=s,this.getMultiExpression=this.createNewMultiExpressionIfNeeded(t,e),this.getMultiExpression.OctaveShiftStart=i,i.ParentStartMultiExpression=this.getMultiExpression,this.openOctaveShift=i}else"stop"===l?this.openOctaveShift&&(this.getMultiExpression=this.createNewMultiExpressionIfNeeded(t,this.openOctaveShift.numberXml,i),this.getMultiExpression.OctaveShiftEnd=this.openOctaveShift,this.openOctaveShift.ParentEndMultiExpression=this.getMultiExpression,this.openOctaveShift=void 0):l||g.default.debug("octave-shift missing type in xml")}}catch(e){const t=S.ITextTranslation.translateText("ReaderErrorMessages/OctaveShiftError","Error while reading octave shift.");this.musicSheet.SheetErrors.pushMeasureError(t),g.default.debug("ExpressionReader.addOctaveShift",t,e)}}}addPedalMarking(e,t,i){const s=e.element("direction-type");if(s){const e=s.element("pedal");if(void 0!==e&&e.hasAttributes){let s=!1,n=!1;try{switch("yes"===e.attribute("line")?.value?n=!0:"no"===e.attribute("line")?.value?(n=!1,s=!0):"yes"===e.attribute("sign")?.value?s=!0:(s=!1,n=!0),e.attribute("type").value){case"start":this.openPedal&&this.openPedal.IsLine&&this.endOpenPedal(t),this.createNewMultiExpressionIfNeeded(t,-1),this.openPedal=new M.Pedal(n,s),this.getMultiExpression.PedalStart=this.openPedal,this.openPedal.ParentStartMultiExpression=this.getMultiExpression;break;case"stop":this.openPedal&&this.endOpenPedal(t,i);break;case"change":this.openPedal&&this.openPedal.IsLine&&(this.openPedal.ChangeEnd=!0,this.createNewMultiExpressionIfNeeded(t,-1),this.getMultiExpression.PedalEnd=this.openPedal,this.openPedal.ParentEndMultiExpression=this.getMultiExpression,this.createNewMultiExpressionIfNeeded(t,-1),this.openPedal=new M.Pedal(n,s),this.openPedal.ChangeBegin=!0,this.getMultiExpression.PedalStart=this.openPedal,this.openPedal.ParentStartMultiExpression=this.getMultiExpression)}}catch(e){const t=S.ITextTranslation.translateText("ReaderErrorMessages/PedalError","Error while reading pedal.");this.musicSheet.SheetErrors.pushMeasureError(t),g.default.debug("ExpressionReader.addPedalMarking",t,e)}}}}endOpenPedal(e,t){this.createNewMultiExpressionIfNeeded(e,-1,t),this.getMultiExpression.PedalEnd=this.openPedal,this.openPedal.ParentEndMultiExpression=this.getMultiExpression,this.openPedal=void 0}initialize(){this.placement=f.PlacementEnum.NotYetDefined,this.soundTempo=0,this.soundDynamic=0,this.offsetDivisions=0}readPlacement(e){const t=e.attribute("placement")?.value;return"above"===t?f.PlacementEnum.Above:"below"===t?f.PlacementEnum.Below:f.PlacementEnum.NotYetDefined}readExpressionPlacement(e,t){try{const t=this.readPosition(e);t<0?this.placement=f.PlacementEnum.Below:t>0&&(this.placement=f.PlacementEnum.Above)}catch(e){g.default.debug("ExpressionReader.readExpressionParameters",t,e)}}readPosition(e){try{const t=parseInt(e.value,10);return t<0?this.placement=f.PlacementEnum.Below:t>0&&(this.placement=f.PlacementEnum.Above),t}catch(e){g.default.debug("ExpressionReader.readExpressionParameters",e)}}interpretInstantaneousDynamics(e,t,i,s){if(e.hasElements){e.hasAttributes&&e.attribute("default-x")&&(this.directionTimestamp=n.Fraction.createFromFraction(i));const r=this.readNumber(e);let o=e.elements()[0]?.name;if("other-dynamics"===o&&(o=e.elements()[0].value),o){if(t.Rules?.IgnoreRepeatedDynamics){let e;try{e=l.DynamicEnum[o]}catch(e){const t=S.ITextTranslation.translateText("ReaderErrorMessages/DynamicError","Error while reading dynamic.");return void this.musicSheet.SheetErrors.pushMeasureError(t)}if(this.activeInstantaneousDynamic?.DynEnum===e)return}s?this.createNewMultiExpressionIfNeeded(t,r,n.Fraction.createFromFraction(i)):this.createNewMultiExpressionIfNeeded(t,r);const e=new l.InstantaneousDynamicExpression(o,this.soundDynamic,this.placement,this.staffNumber,t);e.InMeasureTimestamp=i.clone(),this.getMultiExpression.addExpression(e,""),this.initialize(),this.activeInstantaneousDynamic?this.activeInstantaneousDynamic.DynEnum=e.DynEnum:this.activeInstantaneousDynamic=new l.InstantaneousDynamicExpression(o,0,f.PlacementEnum.NotYetDefined,1,t)}}}interpretWords(e,t,i){const s=e.value;if(t.Rules.IgnoreBracketsWords&&(/^\(\s*\)$/.test(s)||/^\[\s*\]$/.test(s)))return;let r;const o=e.attribute("font-style");let a,l,u;o&&(a=o.value,"italic"===a&&(r=y.FontStyles.Italic));const c=e.attribute("font-weight");c&&(l=c.value,"bold"===l&&(r=y.FontStyles.Bold,"italic"===a&&(r=y.FontStyles.BoldItalic)));const h=e.attribute("color");let d;if(h&&(u=h.value),t.Rules.PlaceWordsInsideStafflineFromXml){const t=e.attribute("default-y")?.value;t?.length>0&&(d=Number.parseInt(t,10))}if(s.length>0){if(e.hasAttributes&&e.attribute("default-x")&&(this.directionTimestamp=n.Fraction.createFromFraction(i)),this.checkIfWordsNodeIsRepetitionInstruction(s))return;this.fillMultiOrTempoExpression(s,t,i,r,u,d),this.initialize()}}readNumber(e){let t=1;const i=e.attribute("number")?.value;return i&&(t=Number.parseInt(i,10)),t}interpretWedge(e,t,i,s,r){void 0!==t&&t.hasAttributes&&t.attribute("default-x")&&(this.directionTimestamp=n.Fraction.createFromFraction(s));const a=this.readNumber(t),l=t.attribute("type")?.value?.toLowerCase();this.lastWedge&&this.lastWedge.parentMeasure.MeasureNumberXML===i.MeasureNumberXML&&this.lastWedge.StaffNumber===this.staffNumber&&this.placement===this.lastWedge.Placement&&void 0!==this.WedgeYPosXml&&this.lastWedge.YPosXml===this.WedgeYPosXml&&this.lastWedge.StartMultiExpression.Timestamp.Equals(this.directionTimestamp)&&this.lastWedge.DynamicType===o.ContDynamicEnum[l]||("stop"===l?(this.createNewMultiExpressionIfNeeded(i,a,s),this.getMultiExpression.EndOffsetFraction=new n.Fraction(this.offsetDivisions,4*this.divisions)):this.createNewMultiExpressionIfNeeded(i,a),this.addWedge(t,i,s),this.initialize())}interpretRehearsalMark(e,t,i,s){t.rehearsalExpression=new E.RehearsalExpression(e.value,this.placement)}createNewMultiExpressionIfNeeded(e,t,i=void 0){i||(i=this.directionTimestamp);let s=this.getMultiExpression;return(!s||s&&(s.SourceMeasureParent!==e||s.numberXml!==t||s.SourceMeasureParent===e&&!s.Timestamp.Equals(i)))&&(this.getMultiExpression=s=new c.MultiExpression(e,n.Fraction.createFromFraction(i)),this.getMultiExpression.numberXml=t,e.StaffLinkedExpressions[this.globalStaffIndex].push(s)),s}createNewTempoExpressionIfNeeded(e){this.currentMultiTempoExpression&&this.currentMultiTempoExpression.SourceMeasureParent===e&&this.currentMultiTempoExpression.Timestamp===this.directionTimestamp||(this.currentMultiTempoExpression=new r.MultiTempoExpression(e,n.Fraction.createFromFraction(this.directionTimestamp)),e.TempoExpressions.push(this.currentMultiTempoExpression))}addWedge(e,t,i){if(void 0!==e&&e.hasAttributes){const s=this.readNumber(e),n=e.attribute("type").value.toLowerCase();try{if("crescendo"===n||"diminuendo"===n){const e=new o.ContinuousDynamicExpression(o.ContDynamicEnum[n],this.placement,this.staffNumber,t,s);this.lastWedge=e,this.lastWedge.YPosXml=this.WedgeYPosXml,this.openContinuousDynamicExpressions.push(e);let i=this.getMultiExpression;i||(i=this.createNewMultiExpressionIfNeeded(t,s)),i.StartingContinuousDynamic=e,e.StartMultiExpression=i,void 0!==this.activeInstantaneousDynamic&&this.activeInstantaneousDynamic.StaffNumber===e.StaffNumber&&(this.activeInstantaneousDynamic=void 0)}else if("stop"===n)for(const e of this.openContinuousDynamicExpressions)e.NumberXml===s&&this.closeOpenContinuousDynamic(e,t,i)}catch(e){const t="ReaderErrorMessages/WedgeError, Error while reading Crescendo / Diminuendo.";this.musicSheet.SheetErrors.pushMeasureError(t),g.default.debug("ExpressionReader.addWedge",t,e)}}}fillMultiOrTempoExpression(e,t,i,s,n,r=void 0){if(!e)return;const o=e.trim();this.createExpressionFromString("",o,t,i,e,s,n,r)}createExpressionFromString(e,t,i,s,n,r,l,u=void 0){if(h.InstantaneousTempoExpression.isInputStringInstantaneousTempo(t)||a.ContinuousTempoExpression.isInputStringContinuousTempo(t)){if(i.TempoExpressions.length>0)for(let e=0,s=i.TempoExpressions.length;e<s;++e){const s=i.TempoExpressions[e];if(s.Timestamp===this.directionTimestamp&&void 0!==s.InstantaneousTempo&&-1!==s.InstantaneousTempo.Label.indexOf(t))return!1}if(this.createNewTempoExpressionIfNeeded(i),this.currentMultiTempoExpression.CombinedExpressionsText=n,h.InstantaneousTempoExpression.isInputStringInstantaneousTempo(t)){const i=new h.InstantaneousTempoExpression(t,this.placement,this.staffNumber,this.soundTempo,this.currentMultiTempoExpression);return i.ColorXML=l,this.currentMultiTempoExpression.addExpression(i,e),!0}if(a.ContinuousTempoExpression.isInputStringContinuousTempo(t)){const i=new a.ContinuousTempoExpression(t,this.placement,this.staffNumber,this.currentMultiTempoExpression);return i.ColorXML=l,this.currentMultiTempoExpression.addExpression(i,e),!0}}if(o.ContinuousDynamicExpression.isInputStringContinuousDynamic(t)){const n=new o.ContinuousDynamicExpression(void 0,this.placement,this.staffNumber,i,-1,t);n.ColorXML=l;const r=this.getMultiExpression;return r&&this.closeOpenContinuousDynamic(r.StartingContinuousDynamic,i,s),this.createNewMultiExpressionIfNeeded(i,-1),void 0!==this.activeInstantaneousDynamic&&this.activeInstantaneousDynamic.StaffNumber===n.StaffNumber&&(this.activeInstantaneousDynamic=void 0),this.openContinuousDynamicExpressions.push(n),n.StartMultiExpression=this.getMultiExpression,this.getMultiExpression.addExpression(n,e),!0}if(d.MoodExpression.isInputStringMood(t)){const s=this.createNewMultiExpressionIfNeeded(i,-1);i.hasMoodExpressions=!0;const n=new d.MoodExpression(t,this.placement,this.staffNumber);return n.fontStyle=r,n.ColorXML=l,s.addExpression(n,e),!0}const c=this.createNewMultiExpressionIfNeeded(i,-1,s);if(i.TempoExpressions.length>0)for(let e=0,s=i.TempoExpressions.length;e<s;++e){const s=i.TempoExpressions[e];if(s.Timestamp===this.directionTimestamp&&void 0!==s.InstantaneousTempo&&s.EntriesList.length>0&&!this.hasDigit(t)&&this.globalStaffIndex>0){if(s.EntriesList[0].label.indexOf(t)>=0)return!1;break}}let f=p.TextAlignmentEnum.CenterBottom;this.musicSheet.Rules.CompactMode&&(f=p.TextAlignmentEnum.LeftBottom);const S=new m.UnknownExpression(t,this.placement,f,this.staffNumber);return S.fontStyle=r,S.ColorXML=l,S.defaultYXml=u,c.addExpression(S,e),!1}closeOpenContinuousDynamic(e,t,i){if(!e)return;const s=e.NumberXml;e.EndMultiExpression=this.createNewMultiExpressionIfNeeded(t,s,i),e.StartMultiExpression.EndingContinuousDynamic=e,this.openContinuousDynamicExpressions=this.openContinuousDynamicExpressions.filter(t=>t!==e)}closeOpenContinuousTempo(e){this.openContinuousTempoExpression.AbsoluteEndTimestamp=e,this.openContinuousTempoExpression=void 0}checkIfWordsNodeIsRepetitionInstruction(e){return"coda"===(e=e.trim().toLowerCase())||"tocoda"===e||"to coda"===e||"fine"===e||"d.c."===e||"dacapo"===e||"da capo"===e||"d.s."===e||"dalsegno"===e||"dal segno"===e||"d.c. al fine"===e||"d.s. al fine"===e||"d.c. al coda"===e||"d.s. al coda"===e}hasDigit(e){return/\d/.test(e)}}},6001:function(e,t,i){var s=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.RepetitionEndingPart=t.Repetition=void 0;const n=i(3457),r=i(2561),o=i(7551),a=s(i(3065));class l extends o.PartListEntry{constructor(e,t){super(e),this.backwardJumpInstructions=[],this.endingParts=[],this.endingIndexDict={},this.userNumberOfRepetitions=0,this.visibles=[],this.fromWords=!1,this.repetitonIterationOrder=[],this.numberOfEndings=1,this.musicSheet2=e,this.virtualOverallRepetition=t}get BackwardJumpInstructions(){return this.backwardJumpInstructions}get EndingIndexDict(){return this.endingIndexDict}get EndingParts(){return this.endingParts}get Visibles(){return this.visibles}set Visibles(e){this.visibles=e}get DefaultNumberOfRepetitions(){let e=2;return this.virtualOverallRepetition&&(e=1),Math.max(e,Object.keys(this.endingIndexDict).length,this.checkRepetitionForMultipleLyricVerses())}get UserNumberOfRepetitions(){return this.userNumberOfRepetitions}set UserNumberOfRepetitions(e){this.userNumberOfRepetitions=e,this.repetitonIterationOrder=[];const t=this.userNumberOfRepetitions-this.NumberOfEndings;for(let e=1;e<=this.userNumberOfRepetitions;e++)e<=t?this.repetitonIterationOrder.push(1):this.repetitonIterationOrder.push(e-t)}getForwardJumpTargetForIteration(e){const t=this.repetitonIterationOrder[e-1];return this.endingIndexDict[t]?this.endingIndexDict[t].part.StartIndex:-1}getBackwardJumpTarget(){return this.startMarker.measureIndex}SetEndingStartIndex(e,t){const i=new u(new n.SourceMusicPart(this.musicSheet2,t,t));this.endingParts.push(i);for(const t of e)try{this.endingIndexDict[t]=i,i.endingIndices.push(t),this.numberOfEndings<t&&(this.numberOfEndings=t)}catch(e){a.default.error("Repetition: Exception.",e)}}setEndingEndIndex(e,t){this.endingIndexDict[e]&&this.endingIndexDict[e].part.setEndIndex(t)}get NumberOfEndings(){return this.numberOfEndings}get FromWords(){return this.fromWords}set FromWords(e){this.fromWords=e}get AbsoluteTimestamp(){return r.Fraction.createFromFraction(this.musicSheet2.SourceMeasures[this.startMarker.measureIndex].AbsoluteTimestamp)}get StartIndex(){return this.startMarker.measureIndex}get EndIndex(){if(0===this.BackwardJumpInstructions.length)return this.StartIndex;let e=this.backwardJumpInstructions[this.backwardJumpInstructions.length-1].measureIndex;return this.endingIndexDict[this.NumberOfEndings]&&(e=Math.max(this.endingIndexDict[this.NumberOfEndings].part.EndIndex,e)),e}checkRepetitionForMultipleLyricVerses(){let e=0;const t=this.StartIndex,i=this.EndIndex;for(let s=t;s<=i;s++){const t=this.musicSheet2.SourceMeasures[s];for(let i=0;i<t.CompleteNumberOfStaves;i++)for(const s of t.VerticalSourceStaffEntryContainers[i].StaffEntries)if(s){let t=0;for(const e of s.VoiceEntries)t+=Object.keys(e.LyricsEntries).length;e=Math.max(e,t)}}return e}get FirstSourceMeasureNumber(){return this.getFirstSourceMeasure().MeasureNumber}get LastSourceMeasureNumber(){return this.getLastSourceMeasure().MeasureNumber}}t.Repetition=l;class u{constructor(e){this.endingIndices=[],this.part=e}ToString(){return this.endingIndices.join(", ")}}t.RepetitionEndingPart=u},6014:function(e,t,i){var s=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.VexFlowConverter=void 0;var n=s(i(3206)).default.Flow;const r=i(164),o=i(8233),a=i(2561),l=i(9288),u=i(4543),c=i(8233),h=i(8233),d=i(6954),m=i(2570),f=i(5951),p=i(2683),S=s(i(3065)),g=i(1336),y=i(67),E=i(8215),M=i(4064),b=i(9479),P=i(4236),L=i(9647),v=i(6362);class T{static durations(e,t){const i=[],s=e.clone();for(;s.RealValue>1e-4;){const e=s.RealValue;if(e>=2)i.push("1/2"),s.Sub(new a.Fraction(2,1));else if(e>=1)i.push("w"),s.Sub(new a.Fraction(1,1));else if(e<1&&e>=.5){if(t&&e>.5)return["w"];i.push("h"),s.Sub(new a.Fraction(1,2))}else if(e<.5&&e>=.25){if(t&&e>.25)return["h"];i.push("q"),s.Sub(new a.Fraction(1,4))}else if(e<.25&&e>=.125){if(t&&e>.125)return["q"];i.push("8"),s.Sub(new a.Fraction(1,8))}else if(e<.125&&e>=.0625){if(t&&e>.0625)return["8"];i.push("16"),s.Sub(new a.Fraction(1,16))}else if(e<.0625&&e>=.03125){if(t&&e>.03125)return["16"];i.push("32"),s.Sub(new a.Fraction(1,32))}else if(e<.03125&&e>=.015625){if(t&&e>.015625)return["32"];i.push("64"),s.Sub(new a.Fraction(1,64))}else{if(t)return["64"];i.push("128"),s.Sub(new a.Fraction(1,128))}}return i}static pitch(e,t,i,s=void 0,n=void 0){let a=n;void 0===n&&(a=3),t&&void 0===n&&(a=0,i.ClefType===r.ClefEnum.F&&(a=2),i.ClefType===r.ClefEnum.C&&(a=2));const l=h.NoteEnum[e.FundamentalNote].toLowerCase(),u=o.Pitch.accidentalVexflow(e.Accidental),c=e.Octave-i.OctaveOffset+a;let d="";return s&&(d=this.NoteHeadCode(s)),[l+"n/"+c+d,u,i]}static restToNotePitch(e,t){let i=e.Octave;switch(t){case r.ClefEnum.C:case r.ClefEnum.F:i+=2;case r.ClefEnum.G:}return new o.Pitch(e.FundamentalNote,i,c.AccidentalEnum.NONE)}static NoteHeadCode(e){const t=e.Filled?"2":"1";switch(e.Shape){case M.NoteHeadShape.NORMAL:return"";case M.NoteHeadShape.DIAMOND:return"/D"+t;case M.NoteHeadShape.TRIANGLE:return"/T"+t;case M.NoteHeadShape.TRIANGLE_INVERTED:return"/TI";case M.NoteHeadShape.X:return"/X"+t;case M.NoteHeadShape.CIRCLEX:return"/X3";case M.NoteHeadShape.RECTANGLE:return"/R"+t;case M.NoteHeadShape.SQUARE:return"/S"+t;case M.NoteHeadShape.SLASH:default:return""}}static GhostNotes(e){const t=[],i=T.durations(e,!1);for(const e of i)t.push(new n.GhostNote({duration:e}));return t}static StaveNote(e){e.sortForVexflow();const t=e.notes,i=e.parentStaffEntry.parentMeasure.parentSourceMeasure.Rules,s=t[0];let l=[];const u=[],c=s.graphicalNoteLength,h=void 0!==s.sourceNote.NoteTuplet;let d,m=T.durations(c,h)[0];void 0!==s.sourceNote.TypeLength&&s.sourceNote.TypeLength!==c&&0!==s.sourceNote.TypeLength.RealValue&&(m=T.durations(s.sourceNote.TypeLength,h)[0],s.numberOfDots=s.sourceNote.DotsXml);let f,p,S=s.numberOfDots,y=!1,E=0,P=!1;for(const s of t){if(S<s.numberOfDots&&(S=s.numberOfDots),s.sourceNote.isRest()){if(P=!0,s.sourceNote.Pitch){l=[s.vfpitch[0]];break}{l=["b/4"];const e=s.parentVoiceEntry?.parentVoiceEntry;if(e){const t=s.parentVoiceEntry?.parentStaffEntry.parentMeasure.staffEntries;let i,n,r=-1;for(let i=0;i<t.length;i++)if(t[i]?.graphicalVoiceEntries[0].parentVoiceEntry===e){r=i;break}if(r>=1&&t.length-1>=r+1&&(i=t[r-1]?.graphicalVoiceEntries[0]?.parentVoiceEntry,n=t[r+1]?.graphicalVoiceEntries[0]?.parentVoiceEntry,i&&n)){const e=i.Notes[0],t=n.Notes[0];if(e.NoteBeam?.Notes.includes(t)){const e=i.Notes.last().Pitch,t=s.Clef();l=[T.pitch(T.restToNotePitch(e.getTransposedPitch(-2),t.ClefType),!1,t)[0]]}}}}if((s.sourceNote.IsWholeMeasureRest||c.RealValue===s.sourceNote.SourceMeasure.ActiveTimeSignature.RealValue)&&(l=["d/5"],1===e.parentStaffEntry.parentMeasure.ParentStaff.StafflineCount&&(l=["b/4"]),m="w",S=0,y=!0,E=i.WholeRestXShiftVexflow*b.unitInPixels),s.sourceNote.ParentStaff.Voices.length>1){const e=s.parentVoiceEntry.parentStaffEntry.graphicalVoiceEntries,t=s.parentVoiceEntry.parentVoiceEntry.ParentVoice.VoiceId;let n,a;for(const r of e)for(const e of r.notes){if(e===s||e.sourceNote.isRest()||!e.sourceNote.PrintObject)continue;const r=e.parentVoiceEntry.parentVoiceEntry.WantedStemDirection,o=1===t||5===t,l=o?1:-1,u=e.sourceNote.Pitch.getHalfTone();(!n||1===l&&u>n||-1===l&&u<n)&&(n=u,a=0,o&&r===g.StemDirectionType.Up?a+=7:o||r!==g.StemDirectionType.Down?a+=o?1:2:a+=7,m.includes("8")||r===g.StemDirectionType.Up&&-1===l&&(a+=1),e.sourceNote.NoteBeam&&(a+=1),m.includes("w")&&(a/=2),a+=.5*Math.ceil(i.RestCollisionYPadding),a*=l,s.lineShift=a)}if(n>0){let e=3;const t=s.Clef();switch(t.ClefType){case r.ClefEnum.F:e=5;break;case r.ClefEnum.C:e=4}f=o.Pitch.fromHalftone(n),l=[T.pitch(f,!0,t,void 0,e)[0]]}}break}const t=s.vfpitch;l.push(t[0]),u.push(t[1]),d||(d=T.Clef(t[2]).type)}for(let e=0,t=S;e<t;++e)m+="d";1===t.length&&t[0].sourceNote.Notehead?.Shape===M.NoteHeadShape.SLASH&&(m+="s"),P&&(m+="r");const L={align_center:y,auto_stem:!0,clef:d,duration:m,keys:l,slash:e.GraceSlash},v=e.notes[0].sourceNote;if(v.IsCueNote&&(L.glyph_font_scale=n.DEFAULT_NOTATION_FONT_SCALE*n.GraceNote.SCALE,L.stroke_px=n.GraceNote.LEDGER_LINE_OFFSET),e.parentVoiceEntry.IsGrace||e.notes[0].sourceNote.IsCueNote)p=new n.GraceNote(L);else{p=new n.StaveNote(L),p.stagger_same_whole_notes=i.StaggerSameWholeNotes;const s=e.parentStaffEntry.LyricsEntries;let r=!0,o=0;if(s.length>0&&i.RenderLyrics&&i.LyricsUseXPaddingForLongLyrics){const t=e.parentStaffEntry.parentMeasure,i=[];for(let s=t.staffEntries.indexOf(e.parentStaffEntry)+1;s<t.staffEntries.length;s++){const e=t.staffEntries[s];e.graphicalVoiceEntries[0]&&i.push(e)}let s,n=e.parentStaffEntry.relInMeasureTimestamp.clone();for(const t of i){const i=t.relInMeasureTimestamp.clone();if(s=a.Fraction.minus(i,e.parentVoiceEntry.Timestamp),s.RealValue>.25){r=!1;break}if(t.LyricsEntries.length>0)break;o+=32*a.Fraction.minus(i,n).RealValue,n=i}}if(i.RenderLyrics&&i.LyricsUseXPaddingForLongLyrics&&s.length>0&&r){let n=!1,r=0;for(const e of t)if(e.sourceNote.Length.RealValue<=.125){n=!0;break}let a=!1;for(const t of s){const s=i.LyricsXPaddingWidthThreshold;let l=t.GraphicalLabel.PositionAndShape.Size.width;if(t.hasDashFromLyricWord()&&(l+=.5),l>s){r+=l-s;const t=e.parentStaffEntry,u=t.parentMeasure.staffEntries,c=u.indexOf(t)===u.length-1;c&&(o+=i.LyricsXPaddingReductionForLastNoteInMeasure),n||(o+=i.LyricsXPaddingReductionForLongNotes),!i.LyricsXPaddingForLastNoteInMeasure&&c||l>s+o&&(a=!0,r-=o);break}}a&&(p.paddingRight=10*i.LyricsXPaddingFactorForLongLyrics*r)}}const x=e.notes[0].lineShift;if(0!==x&&(p.getKeyProps()[0].line+=x),t.length>1)for(let e=0;e<t.length;e++){const i=t[e];i.sourceNote.Notehead?.Shape===M.NoteHeadShape.SLASH&&(p.note_heads[e].note_type="s")}if(p.getKeyProps().forEach(({line:t},i)=>e.notes[i].staffLine=t),(i.LedgerLineWidth||i.LedgerLineStrokeStyle)&&(p.ledgerLineStyle||(p.ledgerLineStyle={}),i.LedgerLineWidth&&(p.ledgerLineStyle.lineWidth=i.LedgerLineWidth),i.LedgerLineStrokeStyle&&(p.ledgerLineStyle.strokeStyle=i.LedgerLineStrokeStyle)),i.ColoringEnabled){const t=i.DefaultColorStem;let s=e.parentVoiceEntry.StemColor;!s&&t&&(s=t);const n={fillStyle:s,strokeStyle:s};s&&(p.setStemStyle(n),p.flag&&i.ColorFlags&&p.setFlagStyle(n))}if(p.x_shift=E,e.parentVoiceEntry.IsGrace&&e.notes[0].sourceNote.NoteBeam&&(e.parentVoiceEntry.WantedStemDirection=e.notes[0].sourceNote.NoteBeam.Notes[0].ParentVoiceEntry.WantedStemDirection),e.parentVoiceEntry)switch(e.parentVoiceEntry.WantedStemDirection){case g.StemDirectionType.Up:p.setStemDirection(n.Stem.UP),e.parentVoiceEntry.StemDirection=g.StemDirectionType.Up;break;case g.StemDirectionType.Down:p.setStemDirection(n.Stem.DOWN),e.parentVoiceEntry.StemDirection=g.StemDirectionType.Down}for(let e=0,s=t.length;e<s;e+=1){if(t[e].setIndex(p,e),u[e]){if("###"===u[e]){p.addAccidental(e,new n.Accidental("##")),p.addAccidental(e,new n.Accidental("#"));continue}if("bbs"===u[e]){p.addAccidental(e,new n.Accidental("bb")),p.addAccidental(e,new n.Accidental("b"));continue}p.addAccidental(e,new n.Accidental(u[e]))}const s=t[e].sourceNote.TremoloStrokes;if(s>0){const t=new n.Tremolo(s);t.extra_stroke_scale=i.TremoloStrokeScale,t.y_spacing_scale=i.TremoloYSpacingScale,p.addModifier(e,t)}}if(.25===v.Length.RealValue&&v.Notehead&&!1===v.Notehead.Filled){const e=p.getKeyProps();for(let t=0;t<e.length;t++)e[t].code="v81"}for(let e=0,t=S;e<t;++e)p.addDotToAll();return p}static generateArticulations(e,t,i){if(e&&"GhostNote"!==e.getAttribute("type"))for(const s of t.sourceNote.ParentVoiceEntry.Articulations){let r,o=n.Modifier.Position.ABOVE;if(e.getStemDirection()===n.Stem.UP&&(o=n.Modifier.Position.BELOW,i.ArticulationAboveNoteForStemUp)){const e=t.parentVoiceEntry.parentStaffEntry.parentMeasure,i=e?.ParentStaff,s=i?.ParentInstrument.Staves;(1===s.length||2===s.length&&i!==s[1])&&(o=n.Modifier.Position.ABOVE)}const a=s.articulationEnum;switch(i.ArticulationPlacementFromXML&&(s.placement===v.PlacementEnum.Above?o=n.Modifier.Position.ABOVE:s.placement===v.PlacementEnum.Below&&(o=n.Modifier.Position.BELOW)),a){case g.ArticulationEnum.accent:{r=new n.Articulation("a>");const e=t.sourceNote.NoteSlurs;for(const s of e)s.StartNote===t.sourceNote&&(s.PlacementXml===v.PlacementEnum.Above?r.setYShift(10*-i.SlurStartArticulationYOffsetOfArticulation):s.PlacementXml===v.PlacementEnum.Below&&r.setYShift(10*i.SlurStartArticulationYOffsetOfArticulation));break}case g.ArticulationEnum.breathmark:r=new n.Articulation("abr"),s.placement===v.PlacementEnum.Above&&(o=n.Modifier.Position.ABOVE),r.breathMarkDistance=i.BreathMarkDistance;break;case g.ArticulationEnum.downbow:r=new n.Articulation("am"),void 0===s.placement&&(o=n.Modifier.Position.ABOVE,s.placement=v.PlacementEnum.Above);break;case g.ArticulationEnum.fermata:r=new n.Articulation("a@a"),o=n.Modifier.Position.ABOVE,s.placement=v.PlacementEnum.Above;break;case g.ArticulationEnum.marcatodown:r=new n.Articulation("a|");break;case g.ArticulationEnum.marcatoup:r=new n.Articulation("a^"),o=n.Modifier.Position.ABOVE;break;case g.ArticulationEnum.invertedfermata:{const e=t.sourceNote.ParentVoiceEntry;if(e!==t.sourceNote.ParentVoiceEntry.ParentSourceStaffEntry.VoiceEntries.last()){e.Articulations=e.Articulations.slice(e.Articulations.indexOf(s)),e.ParentSourceStaffEntry.VoiceEntries.last().Articulations.push(s);continue}r=new n.Articulation("a@u"),o=n.Modifier.Position.BELOW,s.placement=v.PlacementEnum.Below;break}case g.ArticulationEnum.lefthandpizzicato:r=new n.Articulation("a+");break;case g.ArticulationEnum.naturalharmonic:r=new n.Articulation("ah");break;case g.ArticulationEnum.snappizzicato:r=new n.Articulation("ao");break;case g.ArticulationEnum.staccatissimo:r=new n.Articulation("av");break;case g.ArticulationEnum.staccato:r=new n.Articulation("a.");break;case g.ArticulationEnum.tenuto:r=new n.Articulation("a-");break;case g.ArticulationEnum.upbow:r=new n.Articulation("a|"),void 0===s.placement&&(o=n.Modifier.Position.ABOVE,s.placement=v.PlacementEnum.Above);break;case g.ArticulationEnum.strongaccent:r=new n.Articulation("a^")}r&&(r.setPosition(o),e.addModifier(0,r))}}static generateOrnaments(e,t){let i,s=n.Modifier.Position.ABOVE;switch(t.placement===v.PlacementEnum.Below&&(s=n.Modifier.Position.BELOW),t.GetOrnament){case E.OrnamentEnum.DelayedInvertedTurn:i=new n.Ornament("turn_inverted"),i.setDelayed(!0);break;case E.OrnamentEnum.DelayedTurn:i=new n.Ornament("turn"),i.setDelayed(!0);break;case E.OrnamentEnum.InvertedMordent:i=new n.Ornament("mordent"),i.setDelayed(!1);break;case E.OrnamentEnum.InvertedTurn:i=new n.Ornament("turn_inverted"),i.setDelayed(!1);break;case E.OrnamentEnum.Mordent:i=new n.Ornament("mordent_inverted"),i.setDelayed(!1);break;case E.OrnamentEnum.Trill:i=new n.Ornament("tr"),i.setDelayed(!1);break;case E.OrnamentEnum.Turn:i=new n.Ornament("turn"),i.setDelayed(!1);break;default:return void S.default.warn("unhandled OrnamentEnum type: "+t.GetOrnament)}i&&(t.AccidentalBelow!==c.AccidentalEnum.NONE&&i.setLowerAccidental(o.Pitch.accidentalVexflow(t.AccidentalBelow)),t.AccidentalAbove!==c.AccidentalEnum.NONE&&i.setUpperAccidental(o.Pitch.accidentalVexflow(t.AccidentalAbove)),i.setPosition(s),e.addModifier(0,i))}static StrokeTypeFromArpeggioType(e){switch(e){case P.ArpeggioType.ARPEGGIO_DIRECTIONLESS:return n.Stroke.Type.ARPEGGIO_DIRECTIONLESS;case P.ArpeggioType.BRUSH_DOWN:return n.Stroke.Type.BRUSH_UP;case P.ArpeggioType.BRUSH_UP:return n.Stroke.Type.BRUSH_DOWN;case P.ArpeggioType.RASQUEDO_DOWN:return n.Stroke.Type.RASQUEDO_UP;case P.ArpeggioType.RASQUEDO_UP:return n.Stroke.Type.RASQUEDO_DOWN;case P.ArpeggioType.ROLL_DOWN:return n.Stroke.Type.ROLL_UP;case P.ArpeggioType.ROLL_UP:return n.Stroke.Type.ROLL_DOWN;default:return n.Stroke.Type.ARPEGGIO_DIRECTIONLESS}}static CreateTabNote(e){const t=[],i=e.notes.reverse(),s=[],r=e.notes[0].graphicalNoteLength,o=void 0!==e.notes[0].sourceNote.NoteTuplet;let a=T.durations(r,o)[0],l=0,u=!1;const c=e.parentStaffEntry.parentMeasure.parentSourceMeasure.Rules;let h=!1;for(const i of e.notes){const r=i.sourceNote;let o={str:r.StringNumberTab,fret:r.FretNumber};i.sourceNote instanceof L.TabNote||(S.default.info(`invalid tab note: ${i.sourceNote.Pitch.ToString()} in measure ${e.parentStaffEntry.parentMeasure.MeasureNumber}, likely missing XML string+fret number.`),o={str:1,fret:0}),c.TabUseXNoteheadShapeForTabNote&&i.sourceNote.Notehead?.Shape===M.NoteHeadShape.X&&(o.fret="x",h=!0),t.push(o),r.BendArray&&r.BendArray.forEach(function(e){let t;const i=e.bendalter-o.fret;t=i>1?"Full":1===i?"1/2":"1/4","up"===e.direction?s.push({type:n.Bend.UP,text:t,width:10}):s.push({type:n.Bend.DOWN,text:t,width:10})}),r.VibratoStroke&&(u=!0),l<i.numberOfDots&&(l=i.numberOfDots)}for(let e=0,t=l;e<t;++e)a+="d";const d=new n.TabNote({duration:a,positions:t});h&&(d.render_options.scale=c.TabXNoteheadScale,d.render_options.TabUseXNoteheadAlternativeGlyph=c.TabUseXNoteheadAlternativeGlyph,d.updateWidth()),c.UsePageBackgroundColorForTabNotes&&(d.BackgroundColor=c.PageBackgroundColor);for(let e=0,t=i.length;e<t;e+=1)i[e].setIndex(d,e);return s.forEach(function(e){e.type===n.Bend.UP?d.addModifier(new n.Bend(e.text,!1)):d.addModifier(new n.Bend(e.text,!0))}),u&&d.addModifier(new n.Vibrato),d}static Clef(e,t="default"){let i,s;switch("default"!==t&&"small"!==t&&(S.default.warn(`Invalid VexFlow clef size "${t}" specified. Using "default".`),t="default"),e.ClefType){case r.ClefEnum.G:switch(e.Line){case 1:i="french";break;case 2:i="treble";break;default:i="treble",S.default.error(`Clef ${r.ClefEnum[e.ClefType]} on line ${e.Line} not supported by VexFlow. Using default value "${i}".`)}break;case r.ClefEnum.F:switch(e.Line){case 4:i="bass";break;case 3:i="baritone-f";break;case 5:i="subbass";break;default:i="bass",S.default.error(`Clef ${r.ClefEnum[e.ClefType]} on line ${e.Line} not supported by VexFlow. Using default value "${i}".`)}break;case r.ClefEnum.C:switch(e.Line){case 3:i="alto";break;case 4:i="tenor";break;case 1:i="soprano";break;case 2:i="mezzo-soprano";break;default:i="alto",S.default.error(`Clef ${r.ClefEnum[e.ClefType]} on line ${e.Line} not supported by VexFlow. Using default value "${i}".`)}break;case r.ClefEnum.percussion:i="percussion";break;case r.ClefEnum.TAB:i="treble";break;default:S.default.info("bad clef type: "+e.ClefType),i="treble"}return 1===e.OctaveOffset&&"bass"!==i?s="8va":-1===e.OctaveOffset&&(s="8vb"),{type:i,size:t,annotation:s}}static TimeSignature(e){let t;switch(e.SymbolEnum){case l.RhythmSymbolEnum.NONE:t=e.Rhythm.Numerator+"/"+e.Rhythm.Denominator;break;case l.RhythmSymbolEnum.COMMON:t="C";break;case l.RhythmSymbolEnum.CUT:t="C|"}return new n.TimeSignature(t)}static keySignature(e){if(!e)return;let t;switch(e.Mode){case u.KeyEnum.minor:t=T.minorMap[e.Key]+"m";break;case u.KeyEnum.major:case u.KeyEnum.none:t=T.majorMap[e.Key];break;default:t="C"}return t}static line(e,t){switch(e){case d.SystemLinesEnum.SingleThin:return t===y.SystemLinePosition.MeasureBegin?n.StaveConnector.type.SINGLE:n.StaveConnector.type.SINGLE_RIGHT;case d.SystemLinesEnum.DoubleThin:return n.StaveConnector.type.THIN_DOUBLE;case d.SystemLinesEnum.ThinBold:return n.StaveConnector.type.BOLD_DOUBLE_RIGHT;case d.SystemLinesEnum.BoldThinDots:return n.StaveConnector.type.BOLD_DOUBLE_LEFT;case d.SystemLinesEnum.DotsThinBold:case d.SystemLinesEnum.DotsBoldBoldDots:return n.StaveConnector.type.BOLD_DOUBLE_RIGHT;case d.SystemLinesEnum.None:return n.StaveConnector.type.NONE}}static font(e,t=m.FontStyles.Regular,i=f.Fonts.TimesNewRoman,s,n=void 0){let r="normal",o="normal",a=`'${s.DefaultFontFamily}'`;switch(t){case m.FontStyles.Bold:o="bold";break;case m.FontStyles.Italic:r="italic";break;case m.FontStyles.BoldItalic:r="italic",o="bold";case m.FontStyles.Underlined:}return f.Fonts.Kokila,n&&"default"!==n&&(a=`'${n}'`),r+" "+o+" "+Math.floor(e)+"px "+a}static fontStyle(e){switch(e){case m.FontStyles.Bold:return"bold";case m.FontStyles.Italic:return"italic";case m.FontStyles.BoldItalic:return"italic bold";default:return"normal"}}static style(e){return p.OUTLINE_AND_FILL_STYLE_DICT.getValue(e)}}t.VexFlowConverter=T,T.majorMap={"-1":"F","-2":"Bb","-3":"Eb","-4":"Ab","-5":"Db","-6":"Gb","-7":"Cb","-8":"Fb",0:"C",1:"G",2:"D",3:"A",4:"E",5:"B",6:"F#",7:"C#",8:"G#"},T.minorMap={"-1":"D","-2":"G","-3":"C","-4":"F","-5":"Bb","-6":"Eb","-7":"Ab","-8":"Db",0:"A",1:"E",2:"B",3:"F#",4:"C#",5:"G#",6:"D#",7:"A#",8:"E#"}},6030:(e,t,i)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.LyricsReader=void 0;const s=i(649),n=i(2317),r=i(2148);t.LyricsReader=class{constructor(e){this.openLyricWords={},this.musicSheet=e}addLyricEntry(e,t){if(e){const i=e;for(let e=0,o=i.length;e<o;++e){const o=i[e];try{let e="single";if(o.element("text")){let i=o.element("text");if(o.element("syllabic")&&(e=o.element("syllabic").value),i){let r="";const a=o.elements();for(const e of a)"text"!==e.name&&"elision"!==e.name||(r+=e.value);if(r=r.replace("  "," "),void 0!==o.element("elision")&&"-"===r){const t=o.elements();let s,n,r=0;for(let e=0;e<t.length;e++)if("elision"===t[e].name){r=e;break}if(r>0)for(let e=r;e<t.length;e++){const i=t[e];"text"===i.name&&(s=i),"syllabic"===i.name&&(n=i)}void 0!==s&&n&&(i=s,e="middle")}let l,u="1";if(void 0!==o.attributes()&&o.attribute("number")&&(u=o.attribute("number").value),"single"===e||"end"===e){if(this.openLyricWords[u]){this.currentLyricWord=this.openLyricWords[u];const e=this.currentLyricWord.Syllables.length;l=new n.LyricsEntry(r,u,this.currentLyricWord,t,e),this.currentLyricWord.Syllables.push(l),delete this.openLyricWords[u],this.currentLyricWord=void 0}else l=new n.LyricsEntry(r,u,void 0,t);l.extend=void 0!==o.element("extend")}else if("begin"===e)this.openLyricWords[u]&&(delete this.openLyricWords[u],this.currentLyricWord=void 0),this.currentLyricWord=new s.LyricWord,this.openLyricWords[u]=this.currentLyricWord,l=new n.LyricsEntry(r,u,this.currentLyricWord,t,0),this.currentLyricWord.Syllables.push(l);else if("middle"===e)if(this.openLyricWords[u]){this.currentLyricWord=this.openLyricWords[u];const e=this.currentLyricWord.Syllables.length;l=new n.LyricsEntry(r,u,this.currentLyricWord,t,e),this.currentLyricWord.Syllables.push(l)}else l=new n.LyricsEntry(r,u,void 0,t);l&&(t.LyricsEntries[u]||(t.LyricsEntries.setValue(u,l),t.ParentSourceStaffEntry?.VerticalContainerParent?.ParentMeasure&&(t.ParentSourceStaffEntry.VerticalContainerParent.ParentMeasure.hasLyrics=!0)),t.ParentVoice.Parent.LyricVersesNumbers.includes(u)||t.ParentVoice.Parent.LyricVersesNumbers.push(u))}}}catch(e){const t=r.ITextTranslation.translateText("ReaderErrorMessages/LyricError","Error while reading lyric entry.");this.musicSheet.SheetErrors.pushMeasureError(t);continue}}}}}},6173:function(e,t,i){var s=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.VexFlowTabMeasure=void 0;var n=s(i(3206)).default.Flow;const r=i(5246),o=i(6014),a=s(i(3065)),l=i(164);class u extends r.VexFlowMeasure{constructor(e,t=void 0,i=void 0){super(e,t,i),this.isTabMeasure=!0}resetLayout(){const e=this.ParentStaff.StafflineCount??6;this.stave=new n.TabStave(0,0,0,{space_above_staff_ln:0,space_below_staff_ln:0,num_lines:e}),this.updateInstructionWidth()}graphicalMeasureCreatedCalculations(){for(let e=0,t=this.staffEntries.length;e<t;++e){const t=this.staffEntries[e];for(const e of t.graphicalVoiceEntries)if(e.notes[0].sourceNote.isRest()){const t=o.VexFlowConverter.GhostNotes(e.notes[0].sourceNote.Length);e.vfStaveNote=t[0],e.vfGhostNotes=t}else e.vfStaveNote=o.VexFlowConverter.CreateTabNote(e)}this.finalizeTuplets();const e=this.getVoicesWithinMeasure();for(const t of e){if(!t)continue;this.vfVoices[t.VoiceId]=new n.Voice({beat_value:this.parentSourceMeasure.Duration.Denominator,num_beats:this.parentSourceMeasure.Duration.Numerator,resolution:n.RESOLUTION}).setMode(n.Voice.Mode.SOFT);const e=this.getRestFilledVexFlowStaveNotesPerVoice(t);for(const i of e){if(i.parentVoiceEntry&&i.parentVoiceEntry.IsGrace&&!i.parentVoiceEntry.GraceAfterMainNote)continue;const e=i;if(0!==i.notes.length&&i.notes[0]&&i.notes[0].sourceNote.PrintObject){if(i.parentVoiceEntry&&i.parentVoiceEntry.Arpeggio){const t=i.parentVoiceEntry.Arpeggio;if(i.notes&&i.notes.length>1){const i=o.VexFlowConverter.StrokeTypeFromArpeggioType(t.type),s=new n.Stroke(i,{all_voices:this.rules.ArpeggiosGoAcrossVoices});this.rules.RenderArpeggios&&e.vfStaveNote.addStroke(0,s)}else a.default.debug(`[OSMD] arpeggio in measure ${this.MeasureNumber} could not be drawn.\n                        voice entry had less than two notes, arpeggio is likely between voice entries, not currently supported in Vexflow.`)}if(e.vfGhostNotes)for(const i of e.vfGhostNotes)this.vfVoices[t.VoiceId].addTickable(i);else this.vfVoices[t.VoiceId].addTickable(e.vfStaveNote)}else if(e.vfGhostNotes)for(const i of e.vfGhostNotes)this.vfVoices[t.VoiceId].addTickable(i);else this.vfVoices[t.VoiceId].addTickable(e.vfStaveNote)}}}addClefAtBegin(e){e.ClefType===l.ClefEnum.TAB&&super.addClefAtBegin(e)}draw(e){super.draw(e);const t=this.parentSourceMeasure;t.multipleRestMeasures&&this.rules.RenderMultipleRestMeasures&&(this.multiRestElement=new n.MultiMeasureRest(t.multipleRestMeasures,{}),this.multiRestElement.setStave(this.stave),this.multiRestElement.setContext(e),this.multiRestElement.draw())}}t.VexFlowTabMeasure=u},6229:(e,t,i)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.Slur=void 0;const s=i(2561);t.Slur=class{constructor(){}get StartNote(){return this.startNote}set StartNote(e){this.startNote=e}get EndNote(){return this.endNote}set EndNote(e){this.endNote=e}startNoteHasMoreStartingSlurs(){if(!this.startNote)return!1;for(let e=0,t=this.startNote.NoteSlurs.length;e<t;++e){const t=this.startNote.NoteSlurs[e];if(t!==this&&t.StartNote===this.startNote)return!0}return!1}endNoteHasMoreEndingSlurs(){if(!this.endNote)return!1;for(let e=0,t=this.endNote.NoteSlurs.length;e<t;++e){const t=this.endNote.NoteSlurs[e];if(t!==this&&t.EndNote===this.endNote)return!0}return!1}isCrossed(){return this.startNote.ParentStaffEntry.ParentStaff!==this.endNote.ParentStaffEntry.ParentStaff}isSlurLonger(){if(!this.endNote||!this.startNote)return!1;const e=s.Fraction.minus(this.endNote.getAbsoluteTimestamp(),this.startNote.getAbsoluteTimestamp());for(let t=0,i=this.startNote.NoteSlurs.length;t<i;++t){const i=this.startNote.NoteSlurs[t];if(i!==this&&void 0!==i.EndNote&&void 0!==i.StartNote&&-1===s.Fraction.minus(i.EndNote.getAbsoluteTimestamp(),i.StartNote.getAbsoluteTimestamp()).CompareTo(e))return!0}for(let t=0,i=this.endNote.NoteSlurs.length;t<i;++t){const i=this.endNote.NoteSlurs[t];if(i!==this&&void 0!==i.EndNote&&void 0!==i.StartNote&&s.Fraction.minus(i.EndNote.getAbsoluteTimestamp(),i.StartNote.getAbsoluteTimestamp()).CompareTo(e))return!0}return!1}}},6302:(e,t,i)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.RepetitionCalculator=void 0;const s=i(1645),n=i(1645),r=i(7307);t.RepetitionCalculator=class{constructor(){this.repetitionInstructions=[]}calculateRepetitions(e,t){this.musicSheet=e,this.repetitionInstructions=t;const i=this.musicSheet.SourceMeasures;for(let e=0,t=this.repetitionInstructions.length;e<t;++e){const t=this.repetitionInstructions[e];this.currentMeasureIndex=t.measureIndex,this.currentMeasure=i[this.currentMeasureIndex],this.handleRepetitionInstructions(t)}for(let e=0,t=this.musicSheet.SourceMeasures.length;e<t;++e){const t=this.musicSheet.SourceMeasures[e];t.FirstRepetitionInstructions.length>1&&t.FirstRepetitionInstructions.sort(n.RepetitionInstructionComparer.Compare),t.LastRepetitionInstructions.length>1&&t.LastRepetitionInstructions.sort(n.RepetitionInstructionComparer.Compare)}}handleRepetitionInstructions(e){if(!this.currentMeasure)return!1;switch(e.type){case s.RepetitionInstructionEnum.StartLine:this.currentMeasure.FirstRepetitionInstructions.push(e);break;case s.RepetitionInstructionEnum.BackJumpLine:this.currentMeasure.LastRepetitionInstructions.push(e);break;case s.RepetitionInstructionEnum.Ending:if(e.alignment===s.AlignmentType.Begin)this.currentMeasure.FirstRepetitionInstructions.push(e);else for(let t=0,i=e.endingIndices.length;t<i;++t)this.currentMeasure.LastRepetitionInstructions.push(e);break;case s.RepetitionInstructionEnum.Segno:this.currentMeasure.FirstRepetitionInstructions.push(e);break;case s.RepetitionInstructionEnum.Fine:case s.RepetitionInstructionEnum.ToCoda:case s.RepetitionInstructionEnum.Coda:case s.RepetitionInstructionEnum.DaCapo:case s.RepetitionInstructionEnum.DalSegno:case s.RepetitionInstructionEnum.DalSegnoAlFine:case s.RepetitionInstructionEnum.DaCapoAlFine:case s.RepetitionInstructionEnum.DalSegnoAlCoda:case s.RepetitionInstructionEnum.DaCapoAlCoda:this.currentMeasure.LastRepetitionInstructions.push(e);break;case s.RepetitionInstructionEnum.None:break;default:throw new r.ArgumentOutOfRangeException("currentRepetitionInstruction")}return!0}}},6362:(e,t)=>{var i;Object.defineProperty(t,"__esModule",{value:!0}),t.PlacementEnum=t.AbstractExpression=void 0,t.AbstractExpression=class{constructor(e){this.placement=e}static isStringInStringList(e,t){for(let i=0,s=e.length;i<s;++i){const s=e[i];if(t.toLowerCase()===s.toLowerCase().trim())return!0}return!1}get Placement(){return this.placement}static PlacementEnumFromString(e){switch(e.toLowerCase()){case"above":return i.Above;case"below":return i.Below;case"aboveorbelow":case"abovebelow":return i.AboveOrBelow;case"left":return i.Left;case"right":return i.Right;default:return i.NotYetDefined}}},function(e){e[e.Above=0]="Above",e[e.Below=1]="Below",e[e.Left=2]="Left",e[e.Right=3]="Right",e[e.NotYetDefined=4]="NotYetDefined",e[e.AboveOrBelow=5]="AboveOrBelow"}(i||(t.PlacementEnum=i={}))},6438:function(e,t,i){var s=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.ColDirEnum=t.BoundingBox=void 0;const n=s(i(3065)),r=i(7307),o=i(9409),a=i(6864),l=i(200),u=i(7741);var c;t.BoundingBox=class{constructor(e=void 0,t=void 0,i=!1){this.isSymbol=!1,this.relativePositionHasBeenSet=!1,this.xBordersHaveBeenSet=!1,this.yBordersHaveBeenSet=!1,this.absolutePosition=new o.PointF2D,this.relativePosition=new o.PointF2D,this.size=new a.SizeF2D,this.marginSize=new a.SizeF2D,this.upperLeftCorner=new o.PointF2D,this.upperLeftMarginCorner=new o.PointF2D,this.borderLeft=0,this.borderRight=0,this.borderTop=0,this.borderBottom=0,this.borderMarginLeft=0,this.borderMarginRight=0,this.borderMarginTop=0,this.borderMarginBottom=0,this.childElements=[],this.parent=t,this.dataObject=e,this.isSymbol=i,this.xBordersHaveBeenSet=!1,this.yBordersHaveBeenSet=!1,t&&(this.Parent=t)}get RelativePositionHasBeenSet(){return this.relativePositionHasBeenSet}get XBordersHaveBeenSet(){return this.xBordersHaveBeenSet}set XBordersHaveBeenSet(e){this.xBordersHaveBeenSet=e}get YBordersHaveBeenSet(){return this.yBordersHaveBeenSet}set YBordersHaveBeenSet(e){this.yBordersHaveBeenSet=e}get AbsolutePosition(){return this.absolutePosition}set AbsolutePosition(e){this.absolutePosition=e}get RelativePosition(){return this.relativePosition}set RelativePosition(e){this.relativePosition=e,this.relativePositionHasBeenSet=!0}get Size(){return this.size}set Size(e){this.size=e}get MarginSize(){return this.marginSize}get UpperLeftCorner(){return this.upperLeftCorner}get UpperLeftMarginCorner(){return this.upperLeftMarginCorner}get BorderLeft(){return this.borderLeft}set BorderLeft(e){this.borderLeft=e,this.calculateRectangle()}get BorderRight(){return this.borderRight}set BorderRight(e){this.borderRight=e,this.calculateRectangle()}get BorderTop(){return this.borderTop}set BorderTop(e){this.borderTop=e,this.calculateRectangle()}get BorderBottom(){return this.borderBottom}set BorderBottom(e){this.borderBottom=e,this.calculateRectangle()}get BorderMarginLeft(){return this.borderMarginLeft>this.borderLeft?this.borderLeft:this.borderMarginLeft}set BorderMarginLeft(e){this.borderMarginLeft=e,this.calculateMarginRectangle()}get BorderMarginRight(){return this.borderMarginRight<this.borderRight?this.borderRight:this.borderMarginRight}set BorderMarginRight(e){this.borderMarginRight=e,this.calculateMarginRectangle()}get BorderMarginTop(){return this.borderMarginTop>this.borderTop?this.borderTop:this.borderMarginTop}set BorderMarginTop(e){this.borderMarginTop=e,this.calculateMarginRectangle()}get BorderMarginBottom(){return this.borderMarginBottom<this.borderBottom?this.borderBottom:this.borderMarginBottom}set BorderMarginBottom(e){this.borderMarginBottom=e,this.calculateMarginRectangle()}get BoundingRectangle(){return this.boundingRectangle}get BoundingMarginRectangle(){return this.boundingMarginRectangle}get ChildElements(){return this.childElements}set ChildElements(e){this.childElements=e}get Parent(){return this.parent}set Parent(e){if(this.parent){const e=this.parent.ChildElements.indexOf(this,0);e>-1&&this.parent.ChildElements.splice(e,1)}this.parent=e,this.parent.ChildElements.indexOf(this)>-1?n.default.error("BoundingBox of "+this.dataObject.constructor.name+" already in children list of "+this.parent.dataObject.constructor.name+"'s BoundingBox"):this.parent.ChildElements.push(this)}get DataObject(){return this.dataObject}get Center(){return new o.PointF2D(this.RelativePosition.x+(this.BorderMarginRight+this.BorderMarginLeft),this.RelativePosition.y+(this.BorderMarginBottom+this.BorderMarginTop))}setAbsolutePositionFromParent(){this.parent?(this.absolutePosition.x=this.parent.AbsolutePosition.x+this.relativePosition.x,this.absolutePosition.y=this.parent.AbsolutePosition.y+this.relativePosition.y):this.absolutePosition=this.relativePosition}calculateAbsolutePosition(){this.absolutePosition.x=this.relativePosition.x,this.absolutePosition.y=this.relativePosition.y;let e=this.parent;for(;e;)this.absolutePosition.x+=e.relativePosition.x,this.absolutePosition.y+=e.relativePosition.y,e=e.parent}calculateAbsolutePositionsRecursiveWithoutTopelement(){this.absolutePosition.x=0,this.absolutePosition.y=0;for(let e=0,t=this.ChildElements.length;e<t;++e)this.ChildElements[e].calculateAbsolutePositionsRecursive(this.absolutePosition.x,this.absolutePosition.y)}calculateAbsolutePositionsRecursive(e,t){this.absolutePosition.x=this.relativePosition.x+e,this.absolutePosition.y=this.relativePosition.y+t;for(let e=0,t=this.ChildElements.length;e<t;++e)this.ChildElements[e].calculateAbsolutePositionsRecursive(this.absolutePosition.x,this.absolutePosition.y)}calculateAbsolutePositionsOfChildren(){for(let e=0,t=this.ChildElements.length;e<t;++e)this.ChildElements[e].calculateAbsolutePositionsRecursive(this.absolutePosition.x,this.absolutePosition.y)}calculateBoundingBox(e=[]){if(0===this.childElements.length)return;for(let t=0,i=this.ChildElements.length;t<i;++t){const i=this.ChildElements[t];let s=!0;for(const t of e){const e=i.DataObject;if(e.isInstanceOfClass&&e.isInstanceOfClass(t)){s=!1;break}}s&&i.calculateBoundingBox(e)}let t=Number.MAX_VALUE,i=Number.MIN_VALUE,s=Number.MAX_VALUE,n=Number.MIN_VALUE,r=Number.MAX_VALUE,o=Number.MIN_VALUE,a=Number.MAX_VALUE,l=Number.MIN_VALUE;this.isSymbol&&(t=this.borderLeft,i=this.borderRight,s=this.borderTop,n=this.borderBottom,r=this.borderMarginLeft,o=this.borderMarginRight,a=this.borderMarginTop,l=this.borderMarginBottom);for(let e=0,u=this.ChildElements.length;e<u;++e){const u=this.ChildElements[e];t=Math.min(t,u.relativePosition.x+u.borderLeft),i=Math.max(i,u.relativePosition.x+u.borderRight),s=Math.min(s,u.relativePosition.y+u.borderTop),n=Math.max(n,u.relativePosition.y+u.borderBottom),r=Math.min(r,u.relativePosition.x+u.borderMarginLeft),o=Math.max(o,u.relativePosition.x+u.borderMarginRight),a=Math.min(a,u.relativePosition.y+u.borderMarginTop),l=Math.max(l,u.relativePosition.y+u.borderMarginBottom)}this.borderLeft=t,this.borderRight=i,this.borderTop=s,this.borderBottom=n,this.borderMarginLeft=r,this.borderMarginRight=o,this.borderMarginTop=a,this.borderMarginBottom=l,this.calculateRectangle(),this.calculateMarginRectangle(),this.xBordersHaveBeenSet=!0,this.yBordersHaveBeenSet=!0}calculateTopBottomBorders(){if(0===this.childElements.length)return;for(let e=0,t=this.ChildElements.length;e<t;++e)this.ChildElements[e].calculateTopBottomBorders();let e=Number.MAX_VALUE,t=Number.MIN_VALUE,i=Number.MAX_VALUE,s=Number.MIN_VALUE;this.yBordersHaveBeenSet&&(e=this.borderTop,t=this.borderBottom,i=this.borderMarginTop,s=this.borderMarginBottom);for(let n=0,r=this.ChildElements.length;n<r;++n){const r=this.ChildElements[n];e=Math.min(e,r.relativePosition.y+r.borderTop),t=Math.max(t,r.relativePosition.y+r.borderBottom),i=Math.min(i,r.relativePosition.y+r.borderMarginTop),s=Math.max(s,r.relativePosition.y+r.borderMarginBottom)}this.borderTop=e,this.borderBottom=t,this.borderMarginTop=i,this.borderMarginBottom=s,this.calculateRectangle(),this.calculateMarginRectangle()}computeNonOverlappingPositionWithMargin(e,t,i){this.RelativePosition=new o.PointF2D(i.x,i.y),this.setAbsolutePositionFromParent();let s=0,n=!1;do{switch(t){case c.Left:case c.Right:s=this.relativePosition.x,e.calculateMarginPositionAlongDirection(this,t),n=Math.abs(s-this.relativePosition.x)>.001;break;case c.Up:case c.Down:s=this.relativePosition.y,e.calculateMarginPositionAlongDirection(this,t),n=Math.abs(s-this.relativePosition.y)>.001;break;default:throw new r.ArgumentOutOfRangeException("direction")}}while(n)}collisionDetection(e){const t=Math.min(this.AbsolutePosition.x+this.borderRight,e.absolutePosition.x+e.borderRight)-Math.max(this.AbsolutePosition.x+this.borderLeft,e.absolutePosition.x+e.borderLeft),i=Math.min(this.AbsolutePosition.y+this.borderBottom,e.absolutePosition.y+e.borderBottom)-Math.max(this.AbsolutePosition.y+this.borderTop,e.absolutePosition.y+e.borderTop);return t>=0&&i>=0}liesInsideBorders(e){const t=this.AbsolutePosition.x+this.borderLeft<=e.absolutePosition.x+e.borderLeft&&e.absolutePosition.x+e.borderLeft<=this.AbsolutePosition.x+this.borderRight,i=this.AbsolutePosition.x+this.borderLeft<=e.absolutePosition.x+e.borderRight&&e.absolutePosition.x+e.borderRight<=this.AbsolutePosition.x+this.borderRight;if(t&&i){const t=this.AbsolutePosition.y+this.borderTop<=e.absolutePosition.y+e.borderTop&&e.absolutePosition.y+e.borderTop<=this.AbsolutePosition.y+this.borderBottom,i=this.AbsolutePosition.y+this.borderTop<=e.absolutePosition.y+e.borderBottom&&e.absolutePosition.y+e.borderBottom<=this.AbsolutePosition.y+this.borderBottom;if(t&&i)return!0}return!1}pointLiesInsideBorders(e){return this.AbsolutePosition.x+this.borderLeft<=e.x&&e.x<=this.AbsolutePosition.x+this.borderRight&&this.AbsolutePosition.y+this.borderTop<=e.y&&e.y<=this.AbsolutePosition.y+this.borderBottom}marginCollisionDetection(e){const t=Math.min(this.AbsolutePosition.x+this.borderMarginRight,e.absolutePosition.x+e.borderMarginRight)-Math.max(this.AbsolutePosition.x+this.borderMarginLeft,e.absolutePosition.x+e.borderMarginLeft),i=Math.min(this.AbsolutePosition.y+this.borderMarginBottom,e.absolutePosition.y+e.borderMarginBottom)-Math.max(this.AbsolutePosition.y+this.borderMarginTop,e.absolutePosition.y+e.borderMarginTop);return t>0&&i>0}liesInsideMargins(e){const t=this.AbsolutePosition.x+this.borderMarginLeft<=e.absolutePosition.x+e.borderMarginLeft&&e.absolutePosition.x+e.borderMarginLeft<=this.AbsolutePosition.x+this.borderMarginRight,i=this.AbsolutePosition.x+this.borderMarginLeft<=e.absolutePosition.x+e.borderMarginRight&&e.absolutePosition.x+e.borderMarginRight<=this.AbsolutePosition.x+this.borderMarginRight;if(t&&i){const t=this.AbsolutePosition.y+this.borderMarginTop<=e.absolutePosition.y+e.borderMarginTop&&e.absolutePosition.y+e.borderMarginTop<=this.AbsolutePosition.y+this.borderMarginBottom,i=this.AbsolutePosition.y+this.borderMarginTop<=e.absolutePosition.y+e.borderMarginBottom&&e.absolutePosition.y+e.borderMarginBottom<=this.AbsolutePosition.y+this.borderMarginBottom;if(t&&i)return!0}return!1}pointLiesInsideMargins(e){return this.AbsolutePosition.x+this.borderMarginLeft<=e.x&&e.x<=this.AbsolutePosition.x+this.borderMarginRight&&this.AbsolutePosition.y+this.borderMarginTop<=e.y&&e.y<=this.AbsolutePosition.y+this.borderMarginBottom}computeNonOverlappingPosition(e,t,i){this.RelativePosition=new o.PointF2D(i.x,i.y),this.setAbsolutePositionFromParent();let s=0,n=!1;do{switch(t){case c.Left:case c.Right:s=this.relativePosition.x,e.calculatePositionAlongDirection(this,t),n=Math.abs(s-this.relativePosition.x)>1e-4;break;case c.Up:case c.Down:s=this.relativePosition.y,e.calculatePositionAlongDirection(this,t),n=Math.abs(s-this.relativePosition.y)>1e-4;break;default:throw new r.ArgumentOutOfRangeException("direction")}}while(n)}getClickedObjectOfType(e){const t=this.dataObject;if(this.pointLiesInsideBorders(e)&&t)return t;for(let t=0,i=this.childElements.length;t<i;++t){const i=this.childElements[t].getClickedObjectOfType(e);if(i)return i}}getObjectsInRegion(e,t=!0,i=u.GraphicalObject.name){let s=[];for(const n of this.childElements)s=s.concat(n.getObjectsInRegion(e,t,i));return this.dataObject&&this.dataObject.isInstanceOfClass(i)&&(t?e.liesInsideBorders(this)&&s.push(this.dataObject):e.collisionDetection(this)&&s.push(this.dataObject)),s}calculateRectangle(){this.upperLeftCorner=new o.PointF2D(this.BorderLeft,this.BorderTop),this.size=new a.SizeF2D(this.BorderRight-this.BorderLeft,this.BorderBottom-this.BorderTop),this.boundingRectangle=l.RectangleF2D.createFromLocationAndSize(this.upperLeftCorner,this.size)}calculateMarginRectangle(){this.upperLeftMarginCorner=new o.PointF2D(this.BorderMarginLeft,this.BorderMarginTop),this.marginSize=new a.SizeF2D(this.BorderMarginRight-this.BorderMarginLeft,this.BorderMarginBottom-this.BorderMarginTop),this.boundingMarginRectangle=l.RectangleF2D.createFromLocationAndSize(this.upperLeftMarginCorner,this.marginSize)}calculateMarginPositionAlongDirection(e,t){if(this!==e){if(this.isSymbol&&this.marginCollisionDetection(e)){let i=0;switch(t){case c.Left:return i=this.absolutePosition.x+this.borderMarginLeft-(e.absolutePosition.x+e.borderMarginRight),e.relativePosition.x+=i,void(e.absolutePosition.x+=i);case c.Right:return i=this.absolutePosition.x+this.borderMarginRight-(e.absolutePosition.x+e.borderMarginLeft),e.relativePosition.x+=i,void(e.absolutePosition.x+=i);case c.Up:return i=this.absolutePosition.y+this.borderMarginTop-(e.absolutePosition.y+e.borderMarginBottom),e.relativePosition.y+=i,void(e.absolutePosition.y+=i);case c.Down:return i=this.absolutePosition.y+this.borderMarginBottom-(e.absolutePosition.y+e.borderMarginTop),e.relativePosition.y+=i,void(e.absolutePosition.y+=i);default:throw new r.ArgumentOutOfRangeException("direction")}}for(let i=0,s=this.ChildElements.length;i<s;++i)this.ChildElements[i].calculateMarginPositionAlongDirection(e,t)}}calculatePositionAlongDirection(e,t){if(this!==e){if(this.isSymbol&&this.collisionDetection(e)){let i;switch(t){case c.Left:return i=this.absolutePosition.x+this.borderLeft-(e.absolutePosition.x+e.borderRight),e.relativePosition.x+=i,void(e.absolutePosition.x+=i);case c.Right:return i=this.absolutePosition.x+this.borderRight-(e.absolutePosition.x+e.borderLeft),e.relativePosition.x+=i,void(e.absolutePosition.x+=i);case c.Up:return i=this.absolutePosition.y+this.borderTop-(e.absolutePosition.y+e.borderBottom),e.relativePosition.y+=i,void(e.absolutePosition.y+=i);case c.Down:return i=this.absolutePosition.y+this.borderBottom-(e.absolutePosition.y+e.borderTop),e.relativePosition.y+=i,void(e.absolutePosition.y+=i);default:throw new r.ArgumentOutOfRangeException("direction")}}for(let i=0,s=this.ChildElements.length;i<s;++i)this.ChildElements[i].calculatePositionAlongDirection(e,t)}}},function(e){e[e.Left=0]="Left",e[e.Right=1]="Right",e[e.Up=2]="Up",e[e.Down=3]="Down",e[e.NotYetDefined=4]="NotYetDefined"}(c||(t.ColDirEnum=c={}))},6452:(e,t,i)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.GraphicalLine=void 0;const s=i(2683);t.GraphicalLine=class{constructor(e,t,i=0,n=s.OutlineAndFillStyleEnum.BaseWritingColor,r=void 0){this.start=e,this.end=t,this.width=i,this.styleId=n,this.colorHex=r}get Start(){return this.start}set Start(e){this.start=e}get End(){return this.end}set End(e){this.end=e}get Width(){return this.width}set Width(e){this.width=e}}},6597:(e,t,i)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.Cursor=void 0;const s=i(2561),n=i(624);t.Cursor=class{constructor(e,t,i){this.hidden=!0,this.currentPageNumber=1,this.skipInvisibleNotes=!0,this.container=e,this.openSheetMusicDisplay=t,this.rules=this.openSheetMusicDisplay.EngravingRules,this.cursorOptions=i;let s=0;for(this.cursorElementId="cursorImg-0";document.getElementById(this.cursorElementId);)s++,this.cursorElementId=`cursorImg-${s}`;const n=document.createElement("img");n.id=this.cursorElementId,n.style.position="absolute",!0===this.cursorOptions.follow?(this.wantedZIndex="-1",n.style.zIndex=this.wantedZIndex):(this.wantedZIndex="-2",n.style.zIndex=this.wantedZIndex),this.cursorElement=n,this.container.appendChild(n)}adjustToBackgroundColor(){let e;e=this.rules.PageBackgroundColor?"1":this.wantedZIndex,this.cursorElement.style.zIndex=e}init(e,t){this.manager=e,this.graphic=t,this.reset(),this.hidden=!0,this.hide()}show(){this.hidden=!1,this.update(),this.adjustToBackgroundColor()}resetIterator(){if(!this.openSheetMusicDisplay.Sheet||!this.openSheetMusicDisplay.Sheet.SourceMeasures)return void console.log("OSMD.Cursor.resetIterator(): sheet or measures were null/undefined.");const e=this.openSheetMusicDisplay.Sheet.SourceMeasures.length-1;let t=this.rules.MinMeasureToDrawIndex;t=Math.min(t,e);let i=this.rules.MaxMeasureToDrawIndex;if(i=Math.min(i,e),this.openSheetMusicDisplay.Sheet&&this.openSheetMusicDisplay.Sheet.SourceMeasures.length>t&&(this.openSheetMusicDisplay.Sheet.SelectionStart=this.openSheetMusicDisplay.Sheet.SourceMeasures[t].AbsoluteTimestamp),this.openSheetMusicDisplay.Sheet&&this.openSheetMusicDisplay.Sheet.SourceMeasures.length>i){const e=this.openSheetMusicDisplay.Sheet.SourceMeasures[i];this.openSheetMusicDisplay.Sheet.SelectionEnd=s.Fraction.plus(e.AbsoluteTimestamp,e.Duration)}this.iterator=this.manager.getIterator(),this.iterator.SkipInvisibleNotes=this.skipInvisibleNotes}getStaffEntryFromVoiceEntry(e){const t=e.ParentSourceStaffEntry.VerticalContainerParent.ParentMeasure.measureListIndex,i=e.ParentSourceStaffEntry.ParentStaff.idInMusicSheet;return this.graphic.findGraphicalStaffEntryFromMeasureList(i,t,e.ParentSourceStaffEntry)}update(){if(this.hidden||void 0===this.hidden||null===this.hidden)return;this.updateCurrentPage();const e=this.iterator;let t,i=e.CurrentVisibleVoiceEntries(),s=e.CurrentMeasureIndex,n=0,r=0,o=0;if(0!==i.length||e.FrontReached||e.EndReached||(e.moveToPrevious(),i=e.CurrentVisibleVoiceEntries(),e.moveToNext()),e.FrontReached&&0===i.length){e.moveToNext(),i=e.CurrentVisibleVoiceEntries();const s=this.findVisibleGraphicalMeasure(e.CurrentMeasureIndex);n=s.PositionAndShape.AbsolutePosition.x,t=s.ParentMusicSystem,e.moveToPrevious()}else if(e.EndReached||!e.CurrentVoiceEntries||0===i.length){e.moveToPrevious(),i=e.CurrentVisibleVoiceEntries(),s=e.CurrentMeasureIndex;const r=this.findVisibleGraphicalMeasure(e.CurrentMeasureIndex);n=r.PositionAndShape.AbsolutePosition.x+r.PositionAndShape.Size.width,t=r.ParentMusicSystem,e.moveToNext()}else if(e.CurrentMeasure.isReducedToMultiRest){const i=this.findVisibleGraphicalMeasure(e.CurrentMeasureIndex),s=i.parentSourceMeasure.multipleRestMeasures,r=e.CurrentMeasure.multipleRestMeasureNumber/(s+1),o=i.PositionAndShape.Size.width-i.beginInstructionsWidth;n=i.PositionAndShape.AbsolutePosition.x+i.beginInstructionsWidth+r*o,t=i.ParentMusicSystem}else{const e=i.map(e=>this.getStaffEntryFromVoiceEntry(e)).sort((e,t)=>e?.PositionAndShape?.AbsolutePosition?.x<=t?.PositionAndShape?.AbsolutePosition?.x?-1:1)[0];e&&(n=e.PositionAndShape.AbsolutePosition.x,t=e.parentMeasure.ParentMusicSystem)}if(!t?.StaffLines[0])return;r=t.PositionAndShape.AbsolutePosition.y+t.StaffLines[0].PositionAndShape.RelativePosition.y;let a=t.PositionAndShape.AbsolutePosition.y;const l=t.StaffLines[t.StaffLines.length-1];l&&(a+=l.PositionAndShape.RelativePosition.y+l.StaffHeight),o=a-r;const u=this.findVisibleGraphicalMeasure(s);if(!u)return;const c=u.PositionAndShape;if(this.updateWidthAndStyle(c,n,r,o),this.openSheetMusicDisplay.FollowCursor&&this.cursorOptions.follow)if(this.openSheetMusicDisplay.EngravingRules.RenderSingleHorizontalStaffline)this.cursorElement.scrollIntoView({behavior:"smooth",inline:"center"});else{const e=this.cursorElement.getBoundingClientRect().top;this.cursorElement.scrollIntoView({behavior:e<1e3?"smooth":"auto",block:"center"})}this.cursorElement.style.display=""}findVisibleGraphicalMeasure(e){for(let e=0;e<this.graphic.NumberOfStaves;e++){const t=this.graphic.findGraphicalMeasure(this.iterator.CurrentMeasureIndex,e);if(t?.ParentStaff.isVisible())return t}}updateWidthAndStyle(e,t,i,s){const r=this.cursorElement;let o=0;switch(this.cursorOptions.type){case n.CursorType.ThinLeft:r.style.top=10*i*this.openSheetMusicDisplay.zoom+"px",r.style.left=10*(t-1.5)*this.openSheetMusicDisplay.zoom+"px",r.height=10*s*this.openSheetMusicDisplay.zoom,o=5*this.openSheetMusicDisplay.zoom;break;case n.CursorType.ShortThinTopLeft:r.style.top=10*(i-2.5)*this.openSheetMusicDisplay.zoom+"px",r.style.left=10*t*this.openSheetMusicDisplay.zoom+"px",r.height=15*this.openSheetMusicDisplay.zoom,o=5*this.openSheetMusicDisplay.zoom;break;case n.CursorType.CurrentArea:r.style.top=10*e.AbsolutePosition.y*this.openSheetMusicDisplay.zoom+"px",r.style.left=10*e.AbsolutePosition.x*this.openSheetMusicDisplay.zoom+"px",r.height=10*s*this.openSheetMusicDisplay.zoom,o=10*e.Size.width*this.openSheetMusicDisplay.zoom;break;case n.CursorType.CurrentAreaLeft:r.style.top=10*e.AbsolutePosition.y*this.openSheetMusicDisplay.zoom+"px",r.style.left=10*e.AbsolutePosition.x*this.openSheetMusicDisplay.zoom+"px",r.height=10*s*this.openSheetMusicDisplay.zoom,o=10*(t-e.AbsolutePosition.x)*this.openSheetMusicDisplay.zoom;break;default:r.style.top=10*i*this.openSheetMusicDisplay.zoom+"px",r.style.left=10*(t-1.5)*this.openSheetMusicDisplay.zoom+"px",r.height=10*s*this.openSheetMusicDisplay.zoom,o=30*this.openSheetMusicDisplay.zoom}r.width=o,this.cursorOptionsRendered!==this.cursorOptions&&this.updateStyle(o,this.cursorOptions)}hide(){this.cursorElement.style.display="none",this.hidden=!0}previous(){this.iterator.moveToPreviousVisibleVoiceEntry(!1),this.update()}next(){this.iterator.moveToNextVisibleVoiceEntry(!1),this.update()}reset(){this.resetIterator(),this.update()}updateStyle(e,t=void 0){void 0!==t&&(this.cursorOptions=t);const i=document.createElement("canvas");i.width=this.cursorElement.width,i.height=1;const s=i.getContext("2d");s.globalAlpha=this.cursorOptions.alpha;const r=s.createLinearGradient(0,0,this.cursorElement.width,0);switch(this.cursorOptions.type){case n.CursorType.ThinLeft:case n.CursorType.ShortThinTopLeft:case n.CursorType.CurrentArea:case n.CursorType.CurrentAreaLeft:r.addColorStop(1,this.cursorOptions.color);break;default:r.addColorStop(0,"white"),r.addColorStop(.2,this.cursorOptions.color),r.addColorStop(.8,this.cursorOptions.color),r.addColorStop(1,"white")}s.fillStyle=r,s.fillRect(0,0,e,1),this.cursorOptionsRendered={...this.cursorOptions},this.cursorElement.src=i.toDataURL("image/png")}get Iterator(){return this.iterator}get Hidden(){return this.hidden}VoicesUnderCursor(e){return this.iterator.CurrentVisibleVoiceEntries(e)}NotesUnderCursor(e){const t=this.VoicesUnderCursor(e),i=[];return t.forEach(e=>{i.push.apply(i,e.Notes)}),i}GNotesUnderCursor(e){const t=this.VoicesUnderCursor(e),i=[];return t.forEach(e=>{i.push(...e.Notes.map(e=>this.rules.GNote(e)))}),i}updateCurrentPage(){let e=this.iterator.currentTimeStamp;e.RealValue<0&&(e=new s.Fraction(0,0));for(const t of this.graphic.MusicPages)if(t.MusicSystems.last().GetSystemsLastTimeStamp().gt(e)){const e=t.PageNumber;return e!==this.currentPageNumber&&(this.container.removeChild(this.cursorElement),this.container=document.getElementById("osmdCanvasPage"+e),this.container.appendChild(this.cursorElement)),this.currentPageNumber=e}return 1}get SkipInvisibleNotes(){return this.skipInvisibleNotes}set SkipInvisibleNotes(e){this.skipInvisibleNotes=e,this.iterator.SkipInvisibleNotes=e}get CursorOptions(){return this.cursorOptions}set CursorOptions(e){this.cursorOptions=e}Dispose(){this.hide(),this.container.removeChild(this.cursorElement),this.rules=void 0,this.openSheetMusicDisplay=void 0,this.cursorOptions=void 0}}},6644:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.StaffEntryLink=void 0,t.StaffEntryLink=class{constructor(e){this.linkStaffEntries=[],this.voiceEntry=e}get GetVoiceEntry(){return this.voiceEntry}get LinkStaffEntries(){return this.linkStaffEntries}set LinkStaffEntries(e){this.linkStaffEntries=e}}},6659:(e,t,i)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.GraphicalChordSymbolContainer=void 0;const s=i(7435),n=i(8254),r=i(9719),o=i(6438),a=i(7741),l=i(9409),u=i(4980);class c extends a.GraphicalObject{constructor(e,t,i,s,n,r){super(),this.chordSymbolContainer=e,this.boundingBox=new o.BoundingBox(this,t),this.rules=r,this.calculateLabel(i,n,s)}get GetChordSymbolContainer(){return this.chordSymbolContainer}get GraphicalLabel(){return this.graphicalLabel}calculateLabel(e,t,i){const o=r.ChordSymbolContainer.calculateChordText(this.chordSymbolContainer,t,i),a=this.GetChordSymbolContainer.Placement===u.PlacementEnum.Above?this.rules.ChordSymbolTextAlignmentTop:this.rules.ChordSymbolTextAlignmentBottom;this.graphicalLabel=new n.GraphicalLabel(new s.Label(o),e,a,this.rules,this.boundingBox),this.graphicalLabel.PositionAndShape.RelativePosition=new l.PointF2D(this.rules.ChordSymbolRelativeXOffset,0),this.graphicalLabel.Label.colorDefault=this.rules.DefaultColorChordSymbol}}t.GraphicalChordSymbolContainer=c},6670:(e,t,i)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.VexFlowStaffEntry=void 0;const s=i(348),n=i(9479),r=i(8233);class o extends s.GraphicalStaffEntry{constructor(e,t,i){super(e,t,i)}calculateXPosition(){const e=this.parentMeasure.getVFStave();let t=0;for(const i of this.graphicalVoiceEntries)if(i.vfStaveNote){if(i.vfStaveNote.setStave(e),!i.vfStaveNote.preFormatted)continue;i.applyBordersFromVexflow();let s=!1,r=this.PositionAndShape;i.notes[0].sourceNote.isWholeRest()&&!this.hasOnlyRests()&&(s=!0,r=i.PositionAndShape),this.parentMeasure.ParentStaff.isTab?r.RelativePosition.x=(i.vfStaveNote.getAbsoluteX()+i.vfStaveNote.glyph.getWidth())/n.unitInPixels:(r.RelativePosition.x=i.vfStaveNote.getBoundingBox().getX()/n.unitInPixels,s&&(r.RelativePosition.x-=e.getNoteStartX()/n.unitInPixels,r.RelativePosition.x-=1.3));const o=i.notes[0].sourceNote;o.isRest()&&o.Length.RealValue===this.parentMeasure.parentSourceMeasure.ActiveTimeSignature.RealValue&&(r.RelativePosition.x+=this.parentMeasure.parentSourceMeasure.Rules.WholeRestXShiftVexflow-.1,i.PositionAndShape.BorderLeft=-.7,i.PositionAndShape.BorderRight=.7),i.PositionAndShape.BorderLeft<t&&(t=i.PositionAndShape.BorderLeft)}this.PositionAndShape.RelativePosition.x-=t,this.PositionAndShape.calculateBoundingBox()}setMaxAccidentals(){for(const e of this.graphicalVoiceEntries)for(const t of e.notes)if(t.DrawnAccidental!==r.AccidentalEnum.NONE)return this.MaxAccidentals=1;return this.MaxAccidentals=0}setModifierXOffsets(){let e=[];for(const t of this.graphicalVoiceEntries)e=e.concat(t.notes);const t=e.map(e=>e.staffLine),i=this.calculateModifierXOffsets(t,1),s=this.calculateModifierXOffsets(t,.5);e.forEach((e,t)=>{e.baseFingeringXOffset=s[t],e.baseStringNumberXOffset=i[t]})}calculateModifierXOffsets(e,t){const i=[];for(let s=0;s<e.length;s++){let n=0,r=!0;for(;r;)for(let o=s;o>=0;o--){if(Math.abs(e[s]-e[o])<=t&&n===i[o]){n++,r=!0;break}r=!1}i.push(n)}return i}}t.VexFlowStaffEntry=o},6711:(e,t,i)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.GraphicalCurve=void 0;const s=i(9409);class n{constructor(){n.tPow3=new Array(n.bezierCurveStepSize),n.oneMinusTPow3=new Array(n.bezierCurveStepSize),n.bezierFactorOne=new Array(n.bezierCurveStepSize),n.bezierFactorTwo=new Array(n.bezierCurveStepSize);for(let e=0;e<n.bezierCurveStepSize;e++){const t=e/n.bezierCurveStepSize;n.tPow3[e]=Math.pow(t,3),n.oneMinusTPow3[e]=Math.pow(1-t,3),n.bezierFactorOne[e]=3*Math.pow(1-t,2)*t,n.bezierFactorTwo[e]=3*(1-t)*Math.pow(t,2)}}calculateCurvePointAtIndex(e){const t=Math.round(e*n.bezierCurveStepSize);return t<0||t>=n.bezierCurveStepSize?new s.PointF2D:new s.PointF2D(n.oneMinusTPow3[t]*this.bezierStartPt.x+n.bezierFactorOne[t]*this.bezierStartControlPt.x+n.bezierFactorTwo[t]*this.bezierEndControlPt.x+n.tPow3[t]*this.bezierEndPt.x,n.oneMinusTPow3[t]*this.bezierStartPt.y+n.bezierFactorOne[t]*this.bezierStartControlPt.y+n.bezierFactorTwo[t]*this.bezierEndControlPt.y+n.tPow3[t]*this.bezierEndPt.y)}}t.GraphicalCurve=n,n.bezierCurveStepSize=1e3},6723:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.VerticalGraphicalStaffEntryContainer=void 0,t.VerticalGraphicalStaffEntryContainer=class{constructor(e,t){this.staffEntries=[],this.absoluteTimestamp=t,this.staffEntries=new Array(e)}get Index(){return this.index}set Index(e){this.index=e}get AbsoluteTimestamp(){return this.absoluteTimestamp}get StaffEntries(){return this.staffEntries}set StaffEntries(e){this.staffEntries=e}static compareByTimestamp(e,t){const i=e.absoluteTimestamp.RealValue,s=t.absoluteTimestamp.RealValue;return i<s?-1:i>s?1:0}getFirstNonNullStaffEntry(){for(let e=0,t=this.staffEntries.length;e<t;++e){const t=this.staffEntries[e];if(t)return t}}}},6864:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.SizeF2D=void 0,t.SizeF2D=class{constructor(e=0,t=0){this.width=e,this.height=t}}},6888:function(e,t,i){var s=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.MXLHelper=void 0;const n=i(3902),r=s(i(1710)),o=s(i(3065));t.MXLHelper=class{static MXLtoIXmlElement(e){return this.MXLtoXMLstring(e).then(e=>{const t=(new DOMParser).parseFromString(e,"text/xml"),i=new n.IXmlElement(t.documentElement);return Promise.resolve(i)},e=>{throw new Error("extractSheetFromMxl: "+e.message)})}static MXLtoXMLstring(e){const t=new r.default;return t.loadAsync(e).then(async e=>{let i=await t.file("META-INF/container.xml").async("text");if(!i.startsWith("<")){const e=await t.file("META-INF/container.xml").async("uint8array");i=new TextDecoder("utf-8").decode(e)}if(!i.startsWith("<")){const e=await t.file("META-INF/container.xml").async("uint8array");i=new TextDecoder("utf-16").decode(e)}const s=(new DOMParser).parseFromString(i,"text/xml").getElementsByTagName("rootfile")[0].getAttribute("full-path"),n=await t.file(s).async("text");if(!n.substring(0,1).startsWith("<")){const e=await t.file(s).async("uint8array");return new TextDecoder("utf-16").decode(e)}return n},e=>{throw o.default.error(e),e})}}},6904:(e,t,i)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.Matrix2D=void 0;const s=i(9409);class n{constructor(){this.matrix=[];for(let e=0;e<2;e++){this.matrix[e]=[];for(let t=0;t<2;t++)this.matrix[e][t]=0}}static getRotationMatrix(e){const t=new n,i=Math.cos(e),s=Math.sin(e);return t.matrix[0][0]=i,t.matrix[0][1]=-s,t.matrix[1][0]=s,t.matrix[1][1]=i,t}scalarMultiplication(e){for(let t=0;t<2;t++)for(let i=0;i<2;i++)this.matrix[t][i]*=e}getTransposeMatrix(){const e=new n;for(let t=0;t<2;t++)for(let i=0;i<2;i++)e.matrix[t][i]=this.matrix[i][t];return e}vectorMultiplication(e){const t=new s.PointF2D;return t.x=e.x*this.matrix[0][0]+e.y*this.matrix[0][1],t.y=e.x*this.matrix[1][0]+e.y*this.matrix[1][1],t}}t.Matrix2D=n},6954:(e,t)=>{var i;Object.defineProperty(t,"__esModule",{value:!0}),t.SystemLinesEnumHelper=t.SystemLinesEnum=void 0,function(e){e[e.SingleThin=0]="SingleThin",e[e.DoubleThin=1]="DoubleThin",e[e.ThinBold=2]="ThinBold",e[e.BoldThinDots=3]="BoldThinDots",e[e.DotsThinBold=4]="DotsThinBold",e[e.DotsBoldBoldDots=5]="DotsBoldBoldDots",e[e.None=6]="None",e[e.Dotted=7]="Dotted",e[e.Dashed=8]="Dashed",e[e.Bold=9]="Bold",e[e.BoldThin=10]="BoldThin",e[e.DoubleBold=11]="DoubleBold",e[e.Tick=12]="Tick",e[e.Short=13]="Short"}(i||(t.SystemLinesEnum=i={})),t.SystemLinesEnumHelper=class{static xmlBarlineStyleToSystemLinesEnum(e){return"regular"===e?i.SingleThin:"dotted"===e?i.Dotted:"dashed"===e?i.Dashed:"heavy"===e?i.Bold:"light-light"===e?i.DoubleThin:"light-heavy"===e?i.ThinBold:"heavy-light"===e?i.BoldThin:"heavy-heavy"===e?i.DoubleBold:"tick"===e?i.Tick:"short"===e?i.Short:"none"===e?i.None:i.SingleThin}}},6990:(e,t)=>{var i;Object.defineProperty(t,"__esModule",{value:!0}),t.DynamicExpressionSymbolEnum=void 0,function(e){e[e.p=0]="p",e[e.f=1]="f",e[e.s=2]="s",e[e.z=3]="z",e[e.m=4]="m",e[e.r=5]="r"}(i||(t.DynamicExpressionSymbolEnum=i={}))},7066:(e,t,i)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.MeasureBuildParameters=t.SystemBuildParameters=t.MusicSystemBuilder=void 0;const s=i(1888),n=i(9288),r=i(4543),o=i(164),a=i(9409),l=i(6452),u=i(6954),c=i(7921),h=i(164),d=i(813),m=i(67);t.MusicSystemBuilder=class{constructor(){this.musicSystems=[],this.globalSystemIndex=0,this.leadSheet=!1}initialize(e,t,i){this.leadSheet=e.LeadSheet,this.graphicalMusicSheet=e,this.rules=this.graphicalMusicSheet.ParentMusicSheet.Rules,this.measureList=t,this.numberOfVisibleStaffLines=i,this.activeRhythm=new Array(this.numberOfVisibleStaffLines),this.activeKeys=new Array(this.numberOfVisibleStaffLines),this.activeClefs=new Array(this.numberOfVisibleStaffLines),this.initializeActiveInstructions(this.measureList[0])}buildMusicSystems(){const e=this.getFullPageSystemWidth();let t=!1;for(this.measureListIndex=0,this.currentSystemParams=new f,this.currentSystemParams.currentSystem=this.initMusicSystem();this.measureListIndex<this.measureList.length;){const i=this.measureList[this.measureListIndex];if(!i||!i[0]){this.measureListIndex++;continue}for(let e=0,t=i.length;e<t;++e)i[e].resetLayout();const s=i[0].parentSourceMeasure,n=s.HasEndLine,r=n&&this.rules.NewPartAndSystemAfterFinalBarline,o=this.currentSystemParams.IsSystemStartMeasure();s.IsSystemStartMeasure=o;const a=s===this.graphicalMusicSheet.ParentMusicSheet.getFirstSourceMeasure();let l=this.rules.MeasureLeftMargin,u=0;const c=this.getMeasureStartLine();if(l+=this.getLineWidth(i[0],c,o),!this.leadSheet){let e=!1;t&&this.rules.ShowRhythmAgainAfterPartEndOrFinalBarline&&(e=!0),l+=this.addBeginInstructions(i,o,a||e),u+=this.addEndInstructions(i)}let h=0;for(let e=0;e<this.numberOfVisibleStaffLines;e++)h=Math.max(h,i[e].minimumStaffEntriesWidth);const d=this.getMeasureEndLine();u+=this.getLineWidth(i[0],d,o);let m,f=this.rules.MeasureLeftMargin;if(this.measureListIndex+1<this.measureList.length){const e=this.measureList[this.measureListIndex+1];m=e[0]?.parentSourceMeasure,m?.hasBeginInstructions()&&(f+=this.addBeginInstructions(e,!1,!1))}let p=l+u+h;i[0]?.parentSourceMeasure?.multipleRestMeasures&&(p=this.rules.MultipleRestMeasureDefaultWidth);const S=this.currentSystemParams.systemMeasures.length,g=this.currentSystemParams.currentWidth+p+f<e,y=this.rules.NewPageAtXMLNewPageAttribute&&s.printNewPageXml,E=y||this.rules.NewSystemAtXMLNewPageAttribute&&s.printNewPageXml||this.rules.NewSystemAtXMLNewSystemAttribute&&s.printNewSystemXml||S===this.rules.RenderXMeasuresPerLineAkaSystem&&S>0;if(o||g&&!E){if(this.addMeasureToSystem(i,c,d,p,l,h,u),this.updateActiveClefs(s,i),this.measureListIndex++,r){if(this.rules.MaxSystemToDrawNumber===this.musicSystems.length)return this.finalizeCurrentSystem(i,!this.rules.StretchLastSystemLine,!1),this.musicSystems;this.finalizeCurrentAndCreateNewSystem(i,!this.rules.StretchLastSystemLine,!1)}t=n}else{if(this.rules.MaxSystemToDrawNumber===this.musicSystems.length)return this.finalizeCurrentSystem(i,!1,!0,y),this.musicSystems;this.finalizeCurrentAndCreateNewSystem(i,!1,!0,y)}}if(this.currentSystemParams.systemMeasures.length>0){if(this.rules.MaxSystemToDrawNumber===this.musicSystems.length)return this.finalizeCurrentSystem(this.measureList[this.measureList.length-1],!this.rules.StretchLastSystemLine,!1),this.musicSystems;this.finalizeCurrentAndCreateNewSystem(this.measureList[this.measureList.length-1],!this.rules.StretchLastSystemLine,!1)}return this.musicSystems}calculateSystemYLayout(){for(const e of this.musicSystems)this.optimizeDistanceBetweenStaffLines(e);this.calculateMusicSystemsRelativePositions()}setMeasureWidth(e,t,i,s){for(let n=0,r=e.length;n<r;++n){const r=e[n];r.setWidth(t),i>0&&(r.beginInstructionsWidth=i),s>0&&(r.endInstructionsWidth=s)}}finalizeCurrentAndCreateNewSystem(e,t=!1,i=!0,s=!1){this.finalizeCurrentSystem(e,t,i,s),this.currentSystemParams=new f,void 0!==e&&this.measureListIndex<this.measureList.length&&(this.currentSystemParams.currentSystem=this.initMusicSystem())}finalizeCurrentSystem(e,t=!1,i=!0,s=!1){this.currentSystemParams.currentSystem.breaksPage=s,this.adaptRepetitionLineWithIfNeeded(),void 0!==e&&i&&this.checkAndCreateExtraInstructionMeasure(e),this.stretchMusicSystem(t)}adaptRepetitionLineWithIfNeeded(){const e=this.currentSystemParams.systemMeasures;if(e.length>=1){const t=this.currentSystemParams.currentSystem.GraphicalMeasures[this.currentSystemParams.currentSystem.GraphicalMeasures.length-1];let i=0;const s=e[e.length-1];s.endLine===u.SystemLinesEnum.DotsBoldBoldDots&&(s.endLine=u.SystemLinesEnum.DotsThinBold,i=t[0].getLineWidth(u.SystemLinesEnum.DotsBoldBoldDots)/2-t[0].getLineWidth(u.SystemLinesEnum.DotsThinBold)),this.currentSystemParams.currentSystemFixWidth-=i;for(let e=0,s=t.length;e<s;++e)t[e].endInstructionsWidth-=i}}addMeasureToSystem(e,t,i,s,n,r,o){this.currentSystemParams.systemMeasures.push({beginLine:t,endLine:i}),this.setMeasureWidth(e,s,n,o),this.addStaveMeasuresToSystem(e),this.currentSystemParams.currentWidth+=s,this.currentSystemParams.currentSystemFixWidth+=n+o,this.currentSystemParams.currentSystemVarWidth+=r,this.currentSystemParams.systemMeasureIndex++}initMusicSystem(){const e=c.MusicSheetCalculator.symbolFactory.createMusicSystem(this.globalSystemIndex++,this.rules);return this.musicSystems.push(e),this.layoutSystemStaves(e),e.createMusicSystemLabel(this.rules.InstrumentLabelTextHeight,this.rules.SystemLabelsRightMargin,this.rules.LabelMarginBorderFactor,1===this.musicSystems.length),e}getFullPageSystemWidth(){return this.graphicalMusicSheet.ParentMusicSheet.pageWidth-this.rules.PageLeftMargin-this.rules.PageRightMargin-this.rules.SystemLeftMargin-this.rules.SystemRightMargin}layoutSystemStaves(e){const t=this.getFullPageSystemWidth(),i=e.PositionAndShape;i.BorderLeft=0,i.BorderRight=t,i.BorderTop=0;const s=[],n=this.graphicalMusicSheet.ParentMusicSheet.Instruments;for(let e=0,t=n.length;e<t;++e){const t=n[e];if(t.isVisible()&&0!==t.Voices.length)for(let e=0,i=t.Staves.length;e<i;++e){const i=t.Staves[e];i?.Visible&&s.push(i)}}let r=!1;if(this.leadSheet)for(let e=0,t=s.length;e<t;++e)if(s[e].ParentInstrument.LyricVersesNumbers.length>1){r=!0;break}let o=0;for(let t=0;t<s.length;t++)if(this.addStaffLineToMusicSystem(e,o,s[t]),o+=this.rules.StaffHeight,t+1<s.length){let e=0;e=this.leadSheet&&!r?2.5:s[t].ParentInstrument===s[t+1].ParentInstrument?this.rules.BetweenStaffDistance:this.rules.StaffDistance,o+=e}i.BorderBottom=o}addStaffLineToMusicSystem(e,t,i){if(e){const s=c.MusicSheetCalculator.symbolFactory.createStaffLine(e,i);e.StaffLines.push(s);const n=s.PositionAndShape,r=new a.PointF2D;r.x=0,n.BorderRight=e.PositionAndShape.Size.width,r.y=t,n.RelativePosition=r,n.BorderLeft=0,n.BorderTop=0,n.BorderBottom=this.rules.StaffHeight;for(let e=0;e<5;e++){const t=new a.PointF2D;t.x=0,t.y=e*this.rules.StaffHeight/4;const i=new a.PointF2D;i.x=s.PositionAndShape.Size.width,i.y=e*this.rules.StaffHeight/4,this.leadSheet&&(t.y=i.y=0),s.StaffLines[e]=new l.GraphicalLine(t,i,this.rules.StaffLineWidth)}}}initializeActiveInstructions(e){const t=this.graphicalMusicSheet.ParentMusicSheet.getFirstSourceMeasure();if(t){this.visibleStaffIndices=this.graphicalMusicSheet.getVisibleStavesIndicesFromSourceMeasure(e);for(let e=0,i=this.visibleStaffIndices.length;e<i;e++){const i=this.visibleStaffIndices[e],s=this.graphicalMusicSheet.getGraphicalMeasureFromSourceMeasureAndIndex(t,i);this.activeClefs[e]=t.FirstInstructionsStaffEntries[i].Instructions[0],s.InitiallyActiveClef=this.activeClefs[e];const n=t.FirstInstructionsStaffEntries[i].Instructions[1];if(n){let t=r.KeyInstruction.copy(n);t=this.transposeKeyInstruction(t,s),this.activeKeys[e]=t}const o=t.FirstInstructionsStaffEntries[i].Instructions[2];this.activeRhythm[e]=o}}}transposeKeyInstruction(e,t){const i=t.getTransposedHalftones();return i!==e.isTransposedBy&&t.ParentStaff.ParentInstrument.MidiInstrumentId!==h.MidiInstrument.Percussion&&void 0!==c.MusicSheetCalculator.transposeCalculator&&c.MusicSheetCalculator.transposeCalculator.transposeKey(e,i),e}addBeginInstructions(e,t,i){const s=e.length;if(0===s)return 0;let n=0;const r=e[0].parentSourceMeasure,o=[];for(let a=0;a<s;++a){const s=e[a];s&&o.push(s.getVFStave());const l=this.visibleStaffIndices[a],u=r.FirstInstructionsStaffEntries[l],c=this.AddInstructionsAtMeasureBegin(u,s,a,i,t);n=Math.max(n,c)}return o[0].formatBegModifiers(o),n}addEndInstructions(e){const t=e.length;if(0===t)return 0;let i=.5;const s=e[0].parentSourceMeasure;for(let n=0;n<t;n++){const t=e[n],r=this.visibleStaffIndices[n],o=s.LastInstructionsStaffEntries[r],a=this.addInstructionsAtMeasureEnd(o,t,e);i=Math.max(i,a)}return i}AddInstructionsAtMeasureBegin(e,t,i,s,a){let l,u,c,h=0;if(e)for(let t=0,i=e.Instructions.length;t<i;++t){const i=e.Instructions[t];i instanceof o.ClefInstruction?l=i:i instanceof r.KeyInstruction?u=i:i instanceof n.RhythmInstruction&&(c=i)}t.InitiallyActiveClef=l??this.activeClefs[i],a&&(l||(l=this.activeClefs[i]),u||(u=r.KeyInstruction.copy(this.activeKeys[i])),s&&!c&&(c=this.activeRhythm[i]));let d=!1,m=!1,f=!1;if(l?(t.addClefAtBegin(l),d=!0):l=this.activeClefs[i],u){u=this.transposeKeyInstruction(u,t);const e=a?void 0:this.activeKeys[i];t.addKeyAtBegin(u,e,l),m=!0}if(void 0!==c&&c.PrintObject&&this.rules.RenderTimeSignatures){let e=!0;const i=t.MeasureNumber-1-this.rules.MinMeasureToDrawIndex;if(t.MeasureNumber-1>=0&&this.measureList[i]){const t=this.measureList[i],s=t[0]?.parentSourceMeasure;s?.ImplicitMeasure&&s?.RhythmPrinted&&(e=!1)}e&&(t.addRhythmAtBegin(c),t.parentSourceMeasure.RhythmPrinted=c,f=!0)}return(d||m||f)&&(h+=t.beginInstructionsWidth,f&&(h+=this.rules.RhythmRightMargin)),h}addInstructionsAtMeasureEnd(e,t,i){if(!e||!e.Instructions||0===e.Instructions.length)return 0;for(let s=0,n=e.Instructions.length;s<n;++s){const n=e.Instructions[s];if(n instanceof o.ClefInstruction){const e=n;t.addClefAtEnd(e);for(const s of i)s!==t&&s.addClefAtEnd(e,!1)}}return this.rules.MeasureRightMargin+t.endInstructionsWidth}updateActiveClefs(e,t){for(let i=0,s=t.length;i<s;i++){const t=this.visibleStaffIndices[i],s=e.FirstInstructionsStaffEntries[t];if(s)for(let e=0,t=s.Instructions.length;e<t;++e){const t=s.Instructions[e];t instanceof o.ClefInstruction?this.activeClefs[i]=t:t instanceof r.KeyInstruction?this.activeKeys[i]=t:t instanceof n.RhythmInstruction&&(this.activeRhythm[i]=t)}const a=e.getEntriesPerStaff(t);for(let e=0,t=a.length;e<t;++e){const t=a[e];if(t.Instructions)for(let e=0,s=t.Instructions.length;e<s;++e){const s=t.Instructions[e];s instanceof o.ClefInstruction&&(this.activeClefs[i]=s)}}const l=e.LastInstructionsStaffEntries[t];if(l){const e=l.Instructions;for(let t=0,s=e.length;t<s;++t){const s=e[t];s instanceof o.ClefInstruction&&(this.activeClefs[i]=s)}}}}checkAndCreateExtraInstructionMeasure(e){const t=e[0].parentSourceMeasure.FirstInstructionsStaffEntries,i=[];for(let s=0,n=e.length;s<n;++s){const n=e[s];i.push(t[n.ParentStaff.idInMusicSheet])}let s=0;for(let e=0,t=i.length;e<t;++e){const t=i[e];if(!t)continue;const o=t.Instructions;let a,l;for(let t=0,i=o.length;t<i;++t){const i=o[t];i instanceof r.KeyInstruction&&i.Key!==this.activeKeys[e].Key&&(a=i),i instanceof n.RhythmInstruction&&i!==this.activeRhythm[e]&&(l=i)}if(void 0!==a||l){const t=this.addExtraInstructionMeasure(e,a,l);s=Math.max(s,t)}}s>0&&(this.currentSystemParams.systemMeasures.push({beginLine:u.SystemLinesEnum.None,endLine:u.SystemLinesEnum.None}),this.currentSystemParams.currentWidth+=s,this.currentSystemParams.currentSystemFixWidth+=s)}addExtraInstructionMeasure(e,t,i){const s=this.currentSystemParams.currentSystem,n=c.MusicSheetCalculator.symbolFactory.createExtraGraphicalMeasure(s.StaffLines[e]);[].push(n),t&&n.addKeyAtBegin(t,this.activeKeys[e],this.activeClefs[e]),void 0!==i&&i.PrintObject&&n.addRhythmAtBegin(i),n.PositionAndShape.BorderLeft=0,n.PositionAndShape.BorderTop=0,n.PositionAndShape.BorderBottom=this.rules.StaffHeight;const r=this.rules.MeasureLeftMargin+n.beginInstructionsWidth+this.rules.MeasureRightMargin;return n.PositionAndShape.BorderRight=r,s.StaffLines[e].Measures.push(n),r}addStaveMeasuresToSystem(e){if(e[0]){const t=[];for(let i=0;i<e.length;i++)t.push(e[i]);const i=this.currentSystemParams.currentSystem;for(let e=0;e<this.numberOfVisibleStaffLines;e++){const s=t[e];i.StaffLines[e].Measures.push(s),s.ParentStaffLine=i.StaffLines[e]}i.AddGraphicalMeasures(t)}}getMeasureStartLine(){if(this.thisMeasureBeginsLineRepetition()){const e=0===this.measureListIndex;if(e&&this.rules.RepetitionAllowFirstMeasureBeginningRepeatBarline)return u.SystemLinesEnum.BoldThinDots;const t=this.currentSystemParams.IsSystemStartMeasure();if(this.previousMeasureEndsLineRepetition()&&!t)return u.SystemLinesEnum.DotsBoldBoldDots;if(!e)return u.SystemLinesEnum.BoldThinDots}return u.SystemLinesEnum.None}getMeasureEndLine(){let e;try{if(e=this.measureList[this.measureListIndex][0].parentSourceMeasure,this.rules.RenderMultipleRestMeasures&&e.multipleRestMeasures>1){const t=Math.min(this.graphicalMusicSheet.ParentMusicSheet.SourceMeasures.length-1,e.measureListIndex+e.multipleRestMeasures-1);e=this.graphicalMusicSheet.ParentMusicSheet.SourceMeasures[t]}}finally{}return this.nextMeasureBeginsLineRepetition()&&this.thisMeasureEndsLineRepetition()?u.SystemLinesEnum.DotsBoldBoldDots:this.thisMeasureEndsLineRepetition()?u.SystemLinesEnum.DotsThinBold:this.nextMeasureHasKeyInstructionChange()||this.thisMeasureEndsWordRepetition()||this.nextMeasureBeginsWordRepetition()?u.SystemLinesEnum.DoubleThin:e&&void 0!==e.endingBarStyleEnum?e.endingBarStyleEnum:u.SystemLinesEnum.SingleThin}getLineWidth(e,t,i){let s=e.getLineWidth(t);return t===u.SystemLinesEnum.DotsBoldBoldDots&&(s/=2),i&&t===u.SystemLinesEnum.BoldThinDots&&(s+=this.rules.DistanceBetweenLastInstructionAndRepetitionBarline),s}previousMeasureEndsLineRepetition(){if(0===this.measureListIndex)return!1;for(let e=0,t=this.measureList[this.measureListIndex-1].length;e<t;++e)if(this.measureList[this.measureListIndex-1][e].endsWithLineRepetition())return!0;return!1}thisMeasureBeginsLineRepetition(){for(let e=0,t=this.measureList[this.measureListIndex].length;e<t;++e)if(this.measureList[this.measureListIndex][e].beginsWithLineRepetition())return!0;return!1}nextMeasureBeginsLineRepetition(){const e=this.measureListIndex+1;if(e>=this.graphicalMusicSheet.ParentMusicSheet.SourceMeasures.length||!this.measureList[e])return!1;for(let t=0,i=this.measureList[e].length;t<i;++t)if(this.measureList[e][t].beginsWithLineRepetition())return!0;return!1}thisMeasureEndsLineRepetition(){for(let e=0,t=this.measureList[this.measureListIndex].length;e<t;++e){const t=this.measureList[this.measureListIndex][e];if(t.endsWithLineRepetition())return!0;if(t.parentSourceMeasure?.isReducedToMultiRest){const e=this.graphicalMusicSheet.ParentMusicSheet;let i=t.parentSourceMeasure;const s=e.SourceMeasures.indexOf(i);let n=i.multipleRestMeasureNumber;for(let t=s+1;t<e.SourceMeasures.length;t++){const s=e.SourceMeasures[t];if(!(s.multipleRestMeasureNumber>=n))break;i=s,n=s.multipleRestMeasureNumber}return i.endsWithLineRepetition()}}return!1}nextMeasureBeginsWordRepetition(){const e=this.measureListIndex+1;if(e>=this.graphicalMusicSheet.ParentMusicSheet.SourceMeasures.length||e>this.measureList.length-1)return!1;for(let t=0,i=this.measureList[e].length;t<i;++t)if(this.measureList[e][t].beginsWithWordRepetition())return!0;return!1}thisMeasureEndsWordRepetition(){for(let e=0,t=this.measureList[this.measureListIndex].length;e<t;++e)if(this.measureList[this.measureListIndex][e].endsWithWordRepetition())return!0;return!1}nextMeasureHasKeyInstructionChange(){return void 0!==this.getNextMeasureKeyInstruction()}getNextMeasureKeyInstruction(){if(this.measureListIndex<this.measureList.length-1)for(let e=0;e<this.measureList[this.measureListIndex].length;e++){const t=this.measureList[this.measureListIndex+1][e]?.parentSourceMeasure;if(!t)return;return t.getKeyInstruction(this.visibleStaffIndices[e])}}calculateXScalingFactor(e,t){return Math.abs(t-0)<1e-5||Math.abs(e-0)<1e-5?1:(this.currentSystemParams.currentSystem.StaffLines[0].PositionAndShape.Size.width-e)/t}stretchMusicSystem(e){let t=this.calculateXScalingFactor(this.currentSystemParams.currentSystemFixWidth,this.currentSystemParams.currentSystemVarWidth);e&&(t=Math.min(t,this.rules.LastSystemMaxScalingFactor));const i=this.currentSystemParams.currentSystem;for(let e=0,s=i.StaffLines.length;e<s;++e){const s=i.StaffLines[e];let n=0;for(let e=0;e<s.Measures.length;e++){const r=s.Measures[e];r.setPositionInStaffline(n);const o=r.beginInstructionsWidth;if(r.setWidth(o+r.minimumStaffEntriesWidth*t+r.endInstructionsWidth),e<this.currentSystemParams.systemMeasures.length){const t=this.currentSystemParams.systemMeasures[e].beginLine,s=r.getLineWidth(u.SystemLinesEnum.BoldThinDots);if(t===u.SystemLinesEnum.BoldThinDots){let o=n;0===e&&(o=n+r.beginInstructionsWidth-s),i.createVerticalLineForMeasure(o,s,t,m.SystemLinePosition.MeasureBegin,e,r)}}if(r.staffEntriesScaleFactor=t,r.layoutSymbols(),!(e+1<this.currentSystemParams.systemMeasures.length&&this.currentSystemParams.systemMeasures[e+1].beginLine===u.SystemLinesEnum.BoldThinDots)){let t=u.SystemLinesEnum.SingleThin;e<this.currentSystemParams.systemMeasures.length&&(t=this.currentSystemParams.systemMeasures[e].endLine);const s=r.getLineWidth(t);let n=r.PositionAndShape.RelativePosition.x+r.PositionAndShape.BorderRight-s;t===u.SystemLinesEnum.DotsBoldBoldDots&&(n-=s/2),i.createVerticalLineForMeasure(n,s,t,m.SystemLinePosition.MeasureEnd,e,r)}n=r.PositionAndShape.RelativePosition.x+r.PositionAndShape.BorderRight}}e&&this.decreaseMusicSystemBorders()}decreaseMusicSystemBorders(){const e=this.currentSystemParams.currentSystem,t=d.CollectionUtil.last(e.StaffLines[0].Measures).PositionAndShape,i=t.RelativePosition.x+t.Size.width;for(let t=0,s=e.StaffLines.length;t<s;++t){const s=e.StaffLines[t];s.PositionAndShape.BorderRight=i;for(let e=0,t=s.StaffLines.length;e<t;++e){const t=s.StaffLines[e];t.End=new a.PointF2D(i,t.End.y)}}e.PositionAndShape.BorderRight=i+this.currentSystemParams.maxLabelLength+this.rules.SystemLabelsRightMargin}updateStaffLinesRelativePosition(e,t,i){for(let s=t;s<e.StaffLines.length;s++)e.StaffLines[s].PositionAndShape.RelativePosition.y=i;e.PositionAndShape.BorderBottom+=i}createMusicPage(){const e=new s.GraphicalMusicPage(this.graphicalMusicSheet);return this.graphicalMusicSheet.MusicPages.push(e),e.PageNumber=this.graphicalMusicSheet.MusicPages.length,e.PositionAndShape.BorderLeft=0,e.PositionAndShape.BorderRight=this.graphicalMusicSheet.ParentMusicSheet.pageWidth,e.PositionAndShape.BorderTop=0,e.PositionAndShape.BorderBottom=this.rules.PageHeight,e.PositionAndShape.RelativePosition=new a.PointF2D(0,0),e}addSystemToPage(e,t){e.MusicSystems.push(t),t.Parent=e}optimizeDistanceBetweenStaffLines(e){if(!e.checkStaffEntriesForStaffEntryLink())for(let t=0;t<e.StaffLines.length-1;t++){const i=e.StaffLines[t].BottomLine,s=e.StaffLines[t+1].SkyLine;let n=0;for(let e=0;e<i.length;e++){const t=i[e],r=Math.max(0,e-6),o=Math.min(s.length-1,e+6);let a=0;for(let e=r;e<=o;e++)a=Math.min(a,s[e]);const l=t-a;n=Math.max(l,n)}n+=this.rules.MinSkyBottomDistBetweenStaves,n=Math.max(n,this.rules.StaffHeight+this.rules.MinimumStaffLineDistance);const r=n+e.StaffLines[t].PositionAndShape.RelativePosition.y;this.updateStaffLinesRelativePosition(e,t+1,r)}const t=e.StaffLines[0];e.PositionAndShape.BorderTop=t.PositionAndShape.RelativePosition.y+t.PositionAndShape.BorderTop;const i=e.StaffLines[e.StaffLines.length-1];e.PositionAndShape.BorderBottom=i.PositionAndShape.RelativePosition.y+i.PositionAndShape.BorderBottom}calculateMusicSystemsRelativePositions(){let e=this.createMusicPage(),t=0,i=this.musicSystems[0],s=0;for(let n=0;n<this.musicSystems.length;n++)if(i=this.musicSystems[n],0===e.MusicSystems.length){this.addSystemToPage(e,i),t=this.rules.CompactMode?this.rules.PageTopMarginNarrow:this.rules.PageTopMargin,1===this.graphicalMusicSheet.MusicPages.length&&this.rules.RenderTitle&&(t+=this.rules.TitleTopDistance+this.rules.SheetTitleHeight+this.rules.TitleBottomDistance);const n=new a.PointF2D(this.rules.PageLeftMargin+this.rules.SystemLeftMargin,t);i.PositionAndShape.RelativePosition=n,t+i.PositionAndShape.BorderBottom>this.rules.PageHeight-this.rules.PageBottomMargin&&(s++,s<=4&&console.log(`warning: could not fit a single system on page ${e.PageNumber} and measure number ${i.GraphicalMeasures[0][0].MeasureNumber}.\n                            The PageFormat may be too small for this sheet."\n                            Will not give further warnings for all pages, only total.`))}else{const s=this.musicSystems[n-1],r=s.StaffLines[s.StaffLines.length-1],o=r.PositionAndShape;let l=this.findRequiredDistanceWithSkyBottomLine(s,i);l+=this.rules.MinSkyBottomDistBetweenSystems,l=Math.max(l,this.rules.MinimumDistanceBetweenSystems+r.StaffHeight);const u=t+o.RelativePosition.y+l,c=u+i.PositionAndShape.BorderMarginBottom;if(this.rules.NewPageAtXMLNewPageAttribute&&s.breaksPage||!(c<this.rules.PageHeight-this.rules.PageBottomMargin)){e=this.createMusicPage(),n-=1;continue}{this.addSystemToPage(e,i),t=u;const s=new a.PointF2D(this.rules.PageLeftMargin+this.rules.SystemLeftMargin,t);i.PositionAndShape.RelativePosition=s}}s>0&&console.log(`total amount of pages that couldn't fit a single music system: ${s} of ${e.PageNumber}`)}findRequiredDistanceWithSkyBottomLine(e,t){const i=e.StaffLines[e.StaffLines.length-1],s=t.StaffLines[0],n=i.BottomLine,r=s.SkyLine,o=i.PositionAndShape,a=s.PositionAndShape,l=1/this.rules.SamplingUnit;let u=0;for(let e=0;e<n.length;e++){const t=n[e],i=e+Math.round((o.RelativePosition.x-a.RelativePosition.x)*l);if(i<0)continue;if(i>=r.length)break;const s=Math.max(0,i-6),c=Math.min(r.length-1,i+6);let h=0;for(let e=s;e<=c;e++)h=Math.min(h,r[e]);const d=t-h;u=Math.max(d,u)}return 0===u&&(u=o.BorderBottom-a.BorderTop),u}};class f{constructor(){this.systemMeasures=[],this.systemMeasureIndex=0,this.currentWidth=0,this.currentSystemFixWidth=0,this.currentSystemVarWidth=0,this.maxLabelLength=0}IsSystemStartMeasure(){return 0===this.systemMeasureIndex}}t.SystemBuildParameters=f,t.MeasureBuildParameters=class{}},7098:function(e,t,i){var s=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.VexFlowInstrumentBrace=void 0;var n=s(i(3206)).default.Flow;const r=i(3109);class o extends r.VexFlowInstrumentBracket{constructor(e,t,i=0){super(e,t,i),this.vexflowConnector.setType(n.StaveConnector.type.BRACE)}}t.VexFlowInstrumentBrace=o},7103:function(e,t,i){var s=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.OpenSheetMusicDisplay=void 0;const n=i(3902),r=i(806),o=i(9099),a=i(8724),l=i(7921),u=i(9479),c=i(9436),h=i(9834),d=i(6597),m=i(6888),f=i(3173),p=s(i(3065)),S=i(3661),g=i(4146),y=i(4434),E=i(624),M=i(9713),b=i(6362),P=i(3263),L=i(2683),v=i(8233);class T{constructor(e,t=E.OSMDOptions.OSMDOptionsStandard()){if(this.version="1.9.0-dev",this.cursorsOptions=[],this.cursors=[],this.zoom=1,this.zoomUpdated=!1,this.loadUrlTimeout=5e3,"string"==typeof e?this.container=document.getElementById(e):e&&"appendChild"in e&&(this.container=e),!this.container)throw new Error("Please pass a valid div container to OpenSheetMusicDisplay");void 0===t.autoResize&&(t.autoResize=!0),this.backendType=E.BackendType.SVG,this.setOptions(t)}get cursor(){return this.cursors[0]}get Cursor(){return this.cursor}load(e,t="Untitled Score"){if(this.reset(),"string"==typeof e){const t=e,i=this;if(t.startsWith("PK"))return p.default.debug("[OSMD] This is a zip file, unpack it first: "+t),m.MXLHelper.MXLtoXMLstring(t).then(e=>i.load(e),e=>{throw p.default.debug(e),new Error("OpenSheetMusicDisplay: Invalid MXL file")});if(t.startsWith(""))return p.default.debug("[OSMD] UTF with BOM detected, truncate first 3 bytes and pass along: "+t),i.load(t.substring(3));let s=t;if(/^\s/.test(s)&&(s=s.trim()),s.startsWith("<?xml")){const t=this.OnXMLRead(s);p.default.debug("[OSMD] Finally parsing XML content, length: "+t.length),e=(new DOMParser).parseFromString(t,"application/xml")}else{if(s.length<2083)return p.default.debug("[OSMD] Retrieve the file at the given URL: "+s),f.AJAX.ajax(s,this.loadUrlTimeout).then(e=>i.load(e),e=>{throw e});console.error("[OSMD] osmd.load(string): Could not process string. Did not find <?xml at beginning.")}}if(!e||!e.nodeName)return Promise.reject(new Error("OpenSheetMusicDisplay: The document which was provided is invalid"));const i=e,s=i.childNodes;let r;p.default.debug("[OSMD] load(), Document url: "+i.URL);for(let e=0,t=s.length;e<t;e+=1){const t=s[e];if(t.nodeType===Node.ELEMENT_NODE&&"score-partwise"===t.nodeName.toLowerCase()){r=t;break}}if(!r)return console.error("Could not parse MusicXML, no valid partwise element found"),Promise.reject(new Error("OpenSheetMusicDisplay: Document is not a valid 'partwise' MusicXML"));const a=new n.IXmlElement(r),l=new o.MusicSheetReader(void 0,this.rules);return this.sheet=l.createMusicSheet(a,t),void 0===this.sheet?Promise.reject(new Error("given music sheet was incomplete or could not be loaded.")):(p.default.info(`[OSMD] Loaded sheet ${this.sheet.TitleString} successfully.`),this.needBackendUpdate=!0,this.updateGraphic(),Promise.resolve({}))}updateGraphic(){const e=new r.VexFlowMusicSheetCalculator(this.rules);this.graphic=new a.GraphicalMusicSheet(this.sheet,e),this.drawingParameters.drawCursors&&this.cursors.forEach(e=>{e.init(this.sheet.MusicPartManager,this.graphic)}),this.drawingParameters.DrawingParametersEnum===g.DrawingParametersEnum.leadsheet&&(this.graphic.LeadSheet=!0)}render(){if(!this.graphic)throw new Error("OSMD: load() needs to be called before render()");this.drawer?.clear(),this.Sheet.SourceMeasures[0].ImplicitMeasure&&(this.rules.MinMeasureToDrawNumber>1&&(this.rules.MinMeasureToDrawIndex=this.rules.MinMeasureToDrawNumber),this.rules.MaxMeasureToDrawNumber>0&&(this.rules.MaxMeasureToDrawIndex=this.rules.MaxMeasureToDrawNumber));let e=this.container.offsetWidth;this.rules.RenderSingleHorizontalStaffline&&(e=this.rules.SheetMaximumWidth),this.sheet.pageWidth=e/this.zoom/10,this.rules.PageFormat&&!this.rules.PageFormat.IsUndefined?(this.rules.PageHeight=this.sheet.pageWidth/this.rules.PageFormat.aspectRatio,p.default.debug("[OSMD] PageHeight: "+this.rules.PageHeight)):(p.default.debug("[OSMD] endless/undefined pageformat, id: "+this.rules.PageFormat.idString),this.rules.PageHeight=100001),this.graphic.reCalculate(),this.drawingParameters.drawCursors&&(this.graphic.Cursors.length=0),this.createOrRefreshRenderBackend(),this.needBackendUpdate=!1,this.drawer.setZoom(this.zoom),this.drawer.drawSheet(this.graphic),this.enableOrDisableCursors(this.drawingParameters.drawCursors),this.drawingParameters.drawCursors&&this.cursors.forEach(e=>{e.update()}),this.zoomUpdated=!1,this.rules.RenderCount++}createOrRefreshRenderBackend(){if(this.drawer&&this.drawer.Backends){this.drawer.Backends[0]&&this.drawer.Backends[0].removeAllChildrenFromContainer(this.container);for(const e of this.drawer.Backends)e.free();this.drawer.Backends.clear()}this.drawingParameters.Rules=this.rules,this.drawer=new u.VexFlowMusicSheetDrawer(this.drawingParameters),this.drawer.drawableBoundingBoxElement=this.DrawBoundingBox,this.drawer.bottomLineVisible=this.drawBottomLine,this.drawer.skyLineVisible=this.drawSkyLine;let e,t=this.container.offsetWidth;this.rules.RenderSingleHorizontalStaffline&&(t=10*(this.EngravingRules.PageLeftMargin+this.graphic.MusicPages[0].PositionAndShape.Size.width+this.EngravingRules.PageRightMargin)*this.zoom);const i=32767;for(const s of this.graphic.MusicPages){if(s.PageNumber>this.rules.MaxPageToDrawNumber)break;const n=this.createBackend(this.backendType,s),r=" exceeds CanvasBackend limit of 32767. Cutting off score.";n.getOSMDBackendType()===E.BackendType.Canvas&&t>i&&(p.default.warn("[OSMD] Warning: width of "+t+r),t=i),this.rules.PageFormat&&!this.rules.PageFormat.IsUndefined?e=t/this.rules.PageFormat.aspectRatio:(e=s.PositionAndShape.Size.height,e+=this.rules.PageBottomMargin,n.getOSMDBackendType()===E.BackendType.Canvas&&(e+=.1),e+=s.PositionAndShape.BorderTop,this.rules.RenderTitle&&(e+=this.rules.TitleTopDistance),e*=10*this.zoom),n.getOSMDBackendType()===E.BackendType.Canvas&&e>i&&(p.default.warn("[OSMD] Warning: height of "+e+r),e=Math.min(e,i)),n.resize(t,e),n.clear(),n.getContext().setFillStyle(this.rules.DefaultColorMusic),n.getContext().setStrokeStyle(this.rules.DefaultColorMusic),this.drawer.Backends.push(n),this.graphic.drawer=this.drawer}}exportSVG(){for(const e of this.drawer?.Backends)e instanceof c.SvgVexFlowBackend&&e.export()}IsReadyToRender(){return void 0!==this.graphic}clear(){this.drawer?.clear(),this.reset()}setOptions(e){if(this.rules||(this.rules=new M.EngravingRules),this.drawingParameters||e.drawingParameters?e.drawingParameters&&(this.drawingParameters?this.drawingParameters.DrawingParametersEnum=g.DrawingParametersEnum[e.drawingParameters.toLowerCase()]:this.drawingParameters=new S.DrawingParameters(g.DrawingParametersEnum[e.drawingParameters],this.rules)):this.drawingParameters=new S.DrawingParameters(g.DrawingParametersEnum.default,this.rules),null==e)return void p.default.warn("warning: osmd.setOptions() called without an options parameter, has no effect.\nexample usage: osmd.setOptions({drawCredits: false, drawPartNames: false})");this.OnXMLRead=function(e){return e},e.onXMLRead&&(this.OnXMLRead=e.onXMLRead);let t=!this.drawer||!this.drawer.Backends||this.drawer.Backends.length<1;if(void 0!==e.backend){const i=E.OSMDOptions.BackendTypeFromString(e.backend);t=t||this.backendType!==i,this.backendType=i}this.needBackendUpdate=t,void 0!==e.autoBeam&&(this.rules.AutoBeamNotes=e.autoBeam);const i=e.autoBeamOptions;if(i&&(void 0===i.maintain_stem_directions&&(i.maintain_stem_directions=!1),this.rules.AutoBeamOptions=i,i.groups&&i.groups.length))for(const e of i.groups)if(2!==e.length)throw new Error("Each fraction in autoBeamOptions.groups must be of length 2, e.g. [3,4] for beaming three fourths");void 0!==e.percussionOneLineCutoff&&(this.rules.PercussionOneLineCutoff=e.percussionOneLineCutoff),0!==this.rules.PercussionOneLineCutoff&&void 0!==e.percussionForceVoicesOneLineCutoff&&(this.rules.PercussionForceVoicesOneLineCutoff=e.percussionForceVoicesOneLineCutoff),void 0!==e.alignRests&&(this.rules.AlignRests=e.alignRests),void 0!==e.coloringMode&&this.setColoringMode(e),void 0!==e.coloringEnabled&&(this.rules.ColoringEnabled=e.coloringEnabled),void 0!==e.colorStemsLikeNoteheads&&(this.rules.ColorStemsLikeNoteheads=e.colorStemsLikeNoteheads),e.disableCursor&&(this.drawingParameters.drawCursors=!1),e.drawHiddenNotes&&(this.drawingParameters.drawHiddenNotes=!0),void 0!==e.drawCredits&&(this.drawingParameters.DrawCredits=e.drawCredits),void 0!==e.drawComposer&&(this.drawingParameters.DrawComposer=e.drawComposer),void 0!==e.drawTitle&&(this.drawingParameters.DrawTitle=e.drawTitle),void 0!==e.drawSubtitle&&(this.drawingParameters.DrawSubtitle=e.drawSubtitle),void 0!==e.drawLyricist&&(this.drawingParameters.DrawLyricist=e.drawLyricist),void 0!==e.drawMetronomeMarks&&(this.rules.MetronomeMarksDrawn=e.drawMetronomeMarks),void 0!==e.drawPartNames&&(this.drawingParameters.DrawPartNames=e.drawPartNames,e.drawPartAbbreviations||(this.rules.RenderPartAbbreviations=e.drawPartNames)),void 0!==e.drawPartAbbreviations&&(this.rules.RenderPartAbbreviations=e.drawPartAbbreviations),!1===e.drawFingerings&&(this.rules.RenderFingerings=!1),void 0!==e.drawMeasureNumbers&&(this.rules.RenderMeasureNumbers=e.drawMeasureNumbers),e.drawMeasureNumbersOnlyAtSystemStart&&(this.rules.RenderMeasureNumbersOnlyAtSystemStart=e.drawMeasureNumbersOnlyAtSystemStart),void 0!==e.drawLyrics&&(this.rules.RenderLyrics=e.drawLyrics),void 0!==e.drawTimeSignatures&&(this.rules.RenderTimeSignatures=e.drawTimeSignatures),void 0!==e.drawSlurs&&(this.rules.RenderSlurs=e.drawSlurs),void 0!==e.measureNumberInterval&&(this.rules.MeasureNumberLabelOffset=e.measureNumberInterval),void 0!==e.useXMLMeasureNumbers&&(this.rules.UseXMLMeasureNumbers=e.useXMLMeasureNumbers),void 0!==e.fingeringPosition&&(this.rules.FingeringPosition=b.AbstractExpression.PlacementEnumFromString(e.fingeringPosition)),void 0!==e.fingeringInsideStafflines&&(this.rules.FingeringInsideStafflines=e.fingeringInsideStafflines),void 0!==e.newSystemFromXML&&(this.rules.NewSystemAtXMLNewSystemAttribute=e.newSystemFromXML),void 0!==e.newSystemFromNewPageInXML&&(this.rules.NewSystemAtXMLNewPageAttribute=e.newSystemFromNewPageInXML),void 0!==e.newPageFromXML&&(this.rules.NewPageAtXMLNewPageAttribute=e.newPageFromXML),void 0!==e.fillEmptyMeasuresWithWholeRest&&(this.rules.FillEmptyMeasuresWithWholeRest=e.fillEmptyMeasuresWithWholeRest),void 0!==e.followCursor&&(this.FollowCursor=e.followCursor),void 0!==e.setWantedStemDirectionByXml&&(this.rules.SetWantedStemDirectionByXml=e.setWantedStemDirectionByXml),e.darkMode?(this.rules.applyDefaultColorMusic("#FFFFFF"),this.rules.PageBackgroundColor="#000000",this.rules.DarkModeEnabled=!0):!1===e.darkMode&&(this.rules.applyDefaultColorMusic("#000000"),this.rules.PageBackgroundColor=void 0,this.rules.DarkModeEnabled=!1),e.defaultColorMusic&&this.rules.applyDefaultColorMusic(e.defaultColorMusic),e.defaultColorNotehead&&(this.rules.DefaultColorNotehead=e.defaultColorNotehead),e.defaultColorRest&&(this.rules.DefaultColorRest=e.defaultColorRest),e.defaultColorStem&&(this.rules.DefaultColorStem=e.defaultColorStem),e.defaultColorLabel&&(this.rules.DefaultColorLabel=e.defaultColorLabel),e.defaultColorTitle&&(this.rules.DefaultColorTitle=e.defaultColorTitle),e.defaultFontFamily&&(this.rules.DefaultFontFamily=e.defaultFontFamily),e.defaultFontStyle&&(this.rules.DefaultFontStyle=e.defaultFontStyle),e.drawUpToMeasureNumber>=0&&(this.rules.MaxMeasureToDrawIndex=Math.max(e.drawUpToMeasureNumber-1,0),this.rules.MaxMeasureToDrawNumber=e.drawUpToMeasureNumber),e.drawFromMeasureNumber>=0&&(this.rules.MinMeasureToDrawIndex=Math.max(e.drawFromMeasureNumber-1,0),this.rules.MinMeasureToDrawNumber=e.drawFromMeasureNumber),e.drawUpToPageNumber&&(this.rules.MaxPageToDrawNumber=e.drawUpToPageNumber),e.drawUpToSystemNumber&&(this.rules.MaxSystemToDrawNumber=e.drawUpToSystemNumber),e.tupletsRatioed&&(this.rules.TupletsRatioed=!0),e.tupletsBracketed&&(this.rules.TupletsBracketed=!0),e.tripletsBracketed&&(this.rules.TripletsBracketed=!0),e.autoResize?(this.resizeHandlerAttached||this.autoResize(),this.autoResizeEnabled=!0):!1===e.autoResize&&(this.autoResizeEnabled=!1),void 0!==e.pageFormat&&this.setPageFormat(e.pageFormat),void 0!==e.pageBackgroundColor&&(this.rules.PageBackgroundColor=e.pageBackgroundColor),void 0!==e.renderSingleHorizontalStaffline&&(this.rules.RenderSingleHorizontalStaffline=e.renderSingleHorizontalStaffline),void 0!==e.spacingFactorSoftmax&&(this.rules.SoftmaxFactorVexFlow=e.spacingFactorSoftmax),void 0!==e.spacingBetweenTextLines&&(this.rules.SpacingBetweenTextLines=e.spacingBetweenTextLines),void 0!==e.stretchLastSystemLine&&(this.rules.StretchLastSystemLine=e.stretchLastSystemLine),void 0!==e.autoGenerateMultipleRestMeasuresFromRestMeasures&&(this.rules.AutoGenerateMultipleRestMeasuresFromRestMeasures=e.autoGenerateMultipleRestMeasuresFromRestMeasures),void 0!==e.cursorsOptions?this.cursorsOptions=e.cursorsOptions:this.cursorsOptions=[{type:E.CursorType.Standard,color:this.EngravingRules.DefaultColorCursor,alpha:.5,follow:!0}],void 0!==e.preferredSkyBottomLineBatchCalculatorBackend&&(this.rules.PreferredSkyBottomLineBatchCalculatorBackend=e.preferredSkyBottomLineBatchCalculatorBackend),void 0!==e.skyBottomLineBatchMinMeasures&&(this.rules.SkyBottomLineBatchMinMeasures=e.skyBottomLineBatchMinMeasures)}setColoringMode(e){if(e.coloringMode===y.ColoringModes.XML)return void(this.rules.ColoringMode=y.ColoringModes.XML);const t=[v.NoteEnum.C,v.NoteEnum.D,v.NoteEnum.E,v.NoteEnum.F,v.NoteEnum.G,v.NoteEnum.A,v.NoteEnum.B];let i;if(e.coloringMode===y.ColoringModes.CustomColorSet){if(!e.coloringSetCustom||8!==e.coloringSetCustom.length)throw new Error("Invalid amount of colors: With coloringModes.customColorSet, you have to provide a coloringSetCustom parameter (array) with 8 strings (C to B, rest note).");for(const t of e.coloringSetCustom)if(!/^\#[0-9a-fA-F]{6}$/.test(t))throw new Error("One of the color strings in options.coloringSetCustom was not a valid HTML Hex color:\n"+t);i=e.coloringSetCustom}else if(e.coloringMode===y.ColoringModes.AutoColoring){i=[];const e=Object.keys(L.AutoColorSet);for(let t=0;t<e.length;t++)i.push(L.AutoColorSet[e[t]])}const s=new P.Dictionary;for(let e=0;e<t.length;e++)s.setValue(t[e],i[e]);s.setValue(-1,i.last()),this.rules.ColoringSetCurrent=s,this.rules.ColoringMode=e.coloringMode}setLogLevel(e){switch(e){case"trace":p.default.setLevel(p.default.levels.TRACE);break;case"debug":p.default.setLevel(p.default.levels.DEBUG);break;case"info":p.default.setLevel(p.default.levels.INFO);break;case"warn":p.default.setLevel(p.default.levels.WARN);break;case"error":p.default.setLevel(p.default.levels.ERROR);break;case"silent":p.default.setLevel(p.default.levels.SILENT);break;default:p.default.warn(`Could not set log level to ${e}. Using warn instead.`),p.default.setLevel(p.default.levels.WARN)}}getLogLevel(){return p.default.getLevel()}reset(){this.drawingParameters.drawCursors&&this.cursors.forEach(e=>{e.hide()}),this.sheet=void 0,this.graphic=void 0,this.zoom=1,this.rules.RenderCount=0}autoResize(){const e=this;this.handleResize(()=>{},()=>{this.graphic?.GetCalculator instanceof r.VexFlowMusicSheetCalculator&&(this.graphic.GetCalculator.beamsNeedUpdate=!0),e.IsReadyToRender()&&e.renderAndScrollBack()})}renderAndScrollBack(){const e=window.scrollY/document.body.scrollHeight;this.render();const t=document.body.scrollHeight*e;window.scrollTo({top:t,behavior:"instant"})}handleResize(e,t){let i,s;const n=this;function r(){n.AutoResizeEnabled&&(i=(new Date).getTime(),s||(e(),i=(new Date).getTime(),s=window.setTimeout(o,200)))}function o(){s=void 0,window.clearTimeout(s),(new Date).getTime()-i<200?s=window.setTimeout(o,200):t()}window.attachEvent?window.attachEvent("onresize",r):window.addEventListener("resize",r),this.resizeHandlerAttached=!0,window.setTimeout(e,0),window.setTimeout(t,1)}enableOrDisableCursors(e){if(this.drawingParameters.drawCursors=e,e)for(let e=0;e<this.cursorsOptions.length;e++){const t=this.cursors[e]?.Hidden??!0,i=this.cursors[e]?.Iterator;this.cursors[e]?.hide();let s=this.drawer?.Backends[0];if(s&&this.rules.RestoreCursorAfterRerender&&this.cursors[e]){const t=this.cursors[e].updateCurrentPage();s=this.drawer.Backends[t-1]}s&&s.getRenderElement()&&(this.cursors[e]=new d.Cursor(s.getRenderElement(),this,this.cursorsOptions[e])),this.sheet&&this.graphic&&this.cursors[e]&&this.cursors[e].init(this.sheet.MusicPartManager,this.graphic),this.rules.RestoreCursorAfterRerender&&(this.cursors[e].hidden=t,i&&(this.cursors[e].iterator=i,this.cursors[e].update()))}else this.cursors.forEach(e=>{e.hide()})}createBackend(e,t){let i;return i=void 0===e||e===E.BackendType.SVG?new c.SvgVexFlowBackend(this.rules):new h.CanvasVexFlowBackend(this.rules),i.graphicalMusicPage=t,i.initialize(this.container,this.zoom),i}static StringToPageFormat(e){let t=M.PageFormat.UndefinedPageFormat;if(e.match("^[0-9]+x[0-9]+$")){const i=e.split("x"),s=Number.parseInt(i[0],10),n=Number.parseInt(i[1],10);s>0&&s<32768&&n>0&&n<32768&&(t=new M.PageFormat(s,n,`customPageFormat${e}`))}return e=(e=(e=e.replace(" ","_")).replace("Landscape","L")).replace("Portrait","P"),T.PageFormatStandards.hasOwnProperty(e)?(t=T.PageFormatStandards[e],t):t}setPageFormat(e){const t=T.StringToPageFormat(e);this.needBackendUpdate=!t.Equals(this.rules.PageFormat),this.rules.PageFormat=t}setCustomPageFormat(e,t){if(e>0&&t>0){const i=new M.PageFormat(e,t);this.rules.PageFormat=i}}set DrawSkyLine(e){this.drawSkyLine=e,this.drawer&&(this.drawer.skyLineVisible=e)}get DrawSkyLine(){return this.drawer.skyLineVisible}set DrawBottomLine(e){this.drawBottomLine=e,this.drawer&&(this.drawer.bottomLineVisible=e)}get DrawBottomLine(){return this.drawer.bottomLineVisible}set DrawBoundingBox(e){this.setDrawBoundingBox(e,!0)}get DrawBoundingBox(){return this.drawBoundingBox}setDrawBoundingBox(e,t=!1){this.drawBoundingBox=e,this.drawer&&(this.drawer.drawableBoundingBoxElement=e),t&&this.renderAndScrollBack()}get AutoResizeEnabled(){return this.autoResizeEnabled}set AutoResizeEnabled(e){this.autoResizeEnabled=e}get Zoom(){return this.zoom}set Zoom(e){this.zoom=e,this.zoomUpdated=!0,this.graphic?.GetCalculator instanceof r.VexFlowMusicSheetCalculator&&(this.graphic.GetCalculator.beamsNeedUpdate=this.zoomUpdated)}set FollowCursor(e){this.followCursor=e}get FollowCursor(){return this.followCursor}set TransposeCalculator(e){l.MusicSheetCalculator.transposeCalculator=e}get TransposeCalculator(){return l.MusicSheetCalculator.transposeCalculator}get Sheet(){return this.sheet}get Drawer(){return this.drawer}get GraphicSheet(){return this.graphic}get DrawingParameters(){return this.drawingParameters}get EngravingRules(){return this.rules}get Version(){return this.version}}t.OpenSheetMusicDisplay=T,T.PageFormatStandards={A3_L:new M.PageFormat(420,297,"A3_L"),A3_P:new M.PageFormat(297,420,"A3_P"),A4_L:new M.PageFormat(297,210,"A4_L"),A4_P:new M.PageFormat(210,297,"A4_P"),A5_L:new M.PageFormat(210,148,"A5_L"),A5_P:new M.PageFormat(148,210,"A5_P"),A6_L:new M.PageFormat(148,105,"A6_L"),A6_P:new M.PageFormat(105,148,"A6_P"),Endless:M.PageFormat.UndefinedPageFormat,Letter_L:new M.PageFormat(279.4,215.9,"Letter_L"),Letter_P:new M.PageFormat(215.9,279.4,"Letter_P")}},7109:function(e,t,i){var s=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.VexFlowPedal=void 0;const n=s(i(3206)),r=i(6438),o=i(7824),a=i(512);class l extends o.GraphicalPedal{constructor(e,t,i=!1,s=!1){switch(super(e,t),this.vfStyle=n.default.Flow.PedalMarking.Styles.BRACKET,this.ChangeBegin=!1,this.ChangeEnd=!1,this.line=-3,this.EndSymbolPositionAndShape=void 0,this.ChangeBegin=e.ChangeBegin,this.ChangeEnd=e.ChangeEnd,this.pedalSymbol){case a.MusicSymbol.PEDAL_SYMBOL:this.vfStyle=n.default.Flow.PedalMarking.Styles.TEXT,this.EndSymbolPositionAndShape=new r.BoundingBox(this,t);break;case a.MusicSymbol.PEDAL_MIXED:this.vfStyle=i&&s?n.default.Flow.PedalMarking.Styles.BRACKET_OPEN_BOTH:i?n.default.Flow.PedalMarking.Styles.BRACKET_OPEN_BEGIN:s?n.default.Flow.PedalMarking.Styles.MIXED_OPEN_END:n.default.Flow.PedalMarking.Styles.MIXED;break;case a.MusicSymbol.PEDAL_BRACKET:default:this.vfStyle=i&&s?n.default.Flow.PedalMarking.Styles.BRACKET_OPEN_BOTH:i?n.default.Flow.PedalMarking.Styles.BRACKET_OPEN_BEGIN:s?n.default.Flow.PedalMarking.Styles.BRACKET_OPEN_END:n.default.Flow.PedalMarking.Styles.BRACKET}}setStartNote(e){if(!e)return!1;for(const t of e.graphicalVoiceEntries){const e=t;if(e?.vfStaveNote)return this.startNote=e.vfStaveNote,this.startVfVoiceEntry=e,!0}return!1}setEndNote(e){if(!e)return!1;for(const t of e.graphicalVoiceEntries){const e=t;if(e?.vfStaveNote)return this.endNote=e.vfStaveNote,this.endVfVoiceEntry=e,!0}return!1}setEndMeasure(e){this.endMeasure=e}CalculateBoundingBox(){}setLine(e){this.line=e}getPedalMarking(){const e=new n.default.Flow.PedalMarking([this.startNote,this.endNote]);return this.endMeasure&&e.setEndStave(this.endMeasure.getVFStave()),e.setStyle(this.vfStyle),e.setLine(this.line),e.setCustomText(this.DepressText,this.ReleaseText),this.endVfVoiceEntry&&!this.getPedal.EndsStave||(e.EndsStave=!0),this.getPedal.BeginsStave&&(e.BeginsStave=!0),e.ChangeBegin=this.ChangeBegin,e.ChangeEnd=this.ChangeEnd,e}setEndsStave(e,t){t?.gte(e.parentSourceMeasure.Duration)&&(this.getPedal.EndsStave=!0)}setBeginsStave(e,t){e&&0===t.RealValue&&(this.getPedal.BeginsStave=!0)}}t.VexFlowPedal=l},7307:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.InvalidEnumArgumentException=t.ArgumentOutOfRangeException=t.MusicSheetReadingException=void 0,t.MusicSheetReadingException=class{constructor(e,t){this.message=e,t&&(this.message+=" "+t.toString())}},t.ArgumentOutOfRangeException=class{constructor(e){this.message=e}},t.InvalidEnumArgumentException=class{constructor(e){this.message=e}}},7435:(e,t,i)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.Label=void 0;const s=i(7533);t.Label=class{constructor(e="",t=s.TextAlignmentEnum.CenterBottom,i=void 0,n=!0){this.IsCreditLabel=!1,this.text=e,this.print=n,this.textAlignment=t,this.font=i,this.fontFamily=void 0}ToString(){return this.text}}},7499:function(e,t,i){var s=this&&this.__createBinding||(Object.create?function(e,t,i,s){void 0===s&&(s=i);var n=Object.getOwnPropertyDescriptor(t,i);n&&!("get"in n?!t.__esModule:n.writable||n.configurable)||(n={enumerable:!0,get:function(){return t[i]}}),Object.defineProperty(e,s,n)}:function(e,t,i,s){void 0===s&&(s=i),e[s]=t[i]}),n=this&&this.__exportStar||function(e,t){for(var i in e)"default"===i||Object.prototype.hasOwnProperty.call(t,i)||s(t,e,i)};Object.defineProperty(t,"__esModule",{value:!0}),n(i(1083),t),n(i(9834),t),n(i(9436),t),n(i(1902),t),n(i(2400),t),n(i(6014),t),n(i(1216),t),n(i(9635),t),n(i(3753),t),n(i(7809),t),n(i(7098),t),n(i(3109),t),n(i(5246),t),n(i(3849),t),n(i(806),t),n(i(9479),t),n(i(4332),t),n(i(9310),t),n(i(5468),t),n(i(6670),t),n(i(5866),t),n(i(7506),t),n(i(6173),t),n(i(7785),t),n(i(4134),t)},7503:function(e,t,i){var s=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.ReaderPluginManager=void 0;const n=s(i(3065));t.ReaderPluginManager=class{constructor(){this.voiceMeasureReadPlugins=[]}addVoiceMeasureReadPlugin(e){this.voiceMeasureReadPlugins.push(e)}processVoiceMeasureReadPlugins(e,t,i){for(const s of this.voiceMeasureReadPlugins)try{s.measureReadCalculations(e,t,i)}catch(e){n.default.info("VoiceGenerator.addSingleNote: ",e)}}}},7506:(e,t,i)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.VexflowStafflineNoteCalculator=void 0;const s=i(8233),n=i(9635),r=i(3263),o=i(164),a=i(1336);class l{constructor(e){this.staffPitchListMapping=new r.Dictionary,this.baseLineNote=s.NoteEnum.B,this.baseLineOctave=1,this.rules=e}trackNote(e){if(!(e instanceof n.VexFlowGraphicalNote)||e.Clef().ClefType!==o.ClefEnum.percussion||e.sourceNote.isRest()||0===this.rules.PercussionOneLineCutoff||-1===this.rules.PercussionForceVoicesOneLineCutoff)return;const t=e.parentVoiceEntry.parentStaffEntry.sourceStaffEntry.ParentStaff.idInMusicSheet;let i;this.staffPitchListMapping.containsKey(t)||this.staffPitchListMapping.setValue(t,new Array),i=this.staffPitchListMapping.getValue(t);const s=e.sourceNote.Pitch;l.findOrInsert(i,s)}static PitchIndexOf(e,t,i=0){if(i>e.length-1)return-1;for(let s=i;s<e.length;s++){const i=e[s];if(t.OperatorEquals(i))return s}return-1}static findOrInsert(e,t){for(let i=0;i<e.length;i++){const s=e[i];if(t.OperatorEquals(s))return i;if(t.OperatorFundamentalLessThan(s))return e.splice(i,0,t),i}return e.push(t),e.length-1}positionNote(e){const t=e.parentVoiceEntry.parentStaffEntry.sourceStaffEntry.ParentStaff.idInMusicSheet;if(!(e instanceof n.VexFlowGraphicalNote)||e.sourceNote.isRest()||!this.staffPitchListMapping.containsKey(t))return e;const i=this.staffPitchListMapping.getValue(t),r=this.rules.PercussionUseXMLDisplayStep&&void 0!==e.sourceNote.displayStepUnpitched;if(i.length>this.rules.PercussionOneLineCutoff&&!r&&!this.rules.PercussionUseCajon2NoteSystem)return e;const o=e,u=e.sourceNote.Pitch;let c=this.baseLineNote,h=this.baseLineOctave;if(this.rules.PercussionUseCajon2NoteSystem?u.FundamentalNote===s.NoteEnum.C&&(c=s.NoteEnum.G,h=1):this.rules.PercussionUseXMLDisplayStep&&void 0!==e.sourceNote.displayStepUnpitched&&(c=e.sourceNote.displayStepUnpitched,h=e.sourceNote.displayOctaveUnpitched+this.rules.PercussionOneLineXMLDisplayStepOctaveOffset),i.length<=this.rules.PercussionForceVoicesOneLineCutoff)o.setAccidental(new s.Pitch(c,h,u.Accidental));else{const e=l.PitchIndexOf(i,u);if(e>-1){const t=Math.ceil(i.length/2);if(!this.rules.PercussionUseXMLDisplayStep)if(e>=t)switch(h=2,(e-t)%5){case 1:c=s.NoteEnum.E;break;case 2:c=s.NoteEnum.G;break;case 3:c=s.NoteEnum.B;break;case 4:c=s.NoteEnum.D,h=3;break;default:c=s.NoteEnum.C}else switch(e%5){case 1:c=s.NoteEnum.F;break;case 2:c=s.NoteEnum.D;break;case 3:c=s.NoteEnum.B,h=0;break;case 4:c=s.NoteEnum.G,h=0;break;default:c=s.NoteEnum.A}const n=new s.Pitch(c,h,u.Accidental);o.setAccidental(n);const r=o.parentVoiceEntry.parentVoiceEntry;!this.rules.SetWantedStemDirectionByXml&&r.Notes.length<2&&(n.Octave>this.baseLineOctave||n.FundamentalNote===this.baseLineNote&&n.Octave===this.baseLineOctave?o.parentVoiceEntry.parentVoiceEntry.WantedStemDirection=a.StemDirectionType.Up:o.parentVoiceEntry.parentVoiceEntry.WantedStemDirection=a.StemDirectionType.Down)}}return o}getStafflineUniquePositionCount(e){return this.staffPitchListMapping.containsKey(e)?this.staffPitchListMapping.getValue(e).length:0}}t.VexflowStafflineNoteCalculator=l},7533:(e,t)=>{var i;Object.defineProperty(t,"__esModule",{value:!0}),t.TextAlignment=t.TextAlignmentEnum=void 0,function(e){e[e.LeftTop=0]="LeftTop",e[e.LeftCenter=1]="LeftCenter",e[e.LeftBottom=2]="LeftBottom",e[e.CenterTop=3]="CenterTop",e[e.CenterCenter=4]="CenterCenter",e[e.CenterBottom=5]="CenterBottom",e[e.RightTop=6]="RightTop",e[e.RightCenter=7]="RightCenter",e[e.RightBottom=8]="RightBottom"}(i||(t.TextAlignmentEnum=i={})),t.TextAlignment=class{static IsLeft(e){return e===i.LeftTop||e===i.LeftCenter||e===i.LeftBottom}static IsCenterAligned(e){return e===i.CenterTop||e===i.CenterCenter||e===i.CenterBottom}static IsRight(e){return e===i.RightTop||e===i.RightCenter||e===i.RightBottom}}},7551:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.PartListEntry=void 0,t.PartListEntry=class{constructor(e){this.enrolledTimestamps=[],this.visible=!0,this.musicSheet=e}get Visible(){return this.visible}set Visible(e){this.visible=e}getFirstSourceMeasure(){return this.musicSheet.SourceMeasures[this.startIndex]}getLastSourceMeasure(){return this.musicSheet.SourceMeasures[this.endIndex]}}},7586:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.InstrumentalGroup=void 0,t.InstrumentalGroup=class{constructor(e,t,i){this.instrumentalGroups=[],this.name=e,this.musicSheet=t,this.parent=i}get InstrumentalGroups(){return this.instrumentalGroups}get Parent(){return this.parent}get Name(){return this.name}set Name(e){this.name=e}get GetMusicSheet(){return this.musicSheet}}},7631:(e,t,i)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.RepetitionInstructionReader=void 0;const s=i(1645),n=i(1645),r=i(4356);t.RepetitionInstructionReader=class{set MusicSheet(e){this.musicSheet=e,this.xmlMeasureList=new Array(this.musicSheet.Instruments.length),this.repetitionInstructions=[]}prepareReadingMeasure(e,t){this.currentMeasureIndex=t}handleLineRepetitionInstructions(e){let t=!1;if(e.elements().length>0){let i="",n=!1,r="",o="",a="";const l=[],u=e.element("bar-style");u&&(a=u.value),i=e.attributes().length>0&&e.attribute("location")?e.attribute("location").value:"right";const c=e.elements();for(let e=0,t=c.length;e<t;++e){const t=c[e];if("repeat"===t.name&&t.hasAttributes)n=!0,r=t.attribute("direction").value;else if("ending"===t.name&&t.hasAttributes&&void 0!==t.attribute("type")&&t.attribute("number")){if("no"===t.attribute("print-object")?.value)continue;o=t.attribute("type").value;let e=t.attribute("number").value;t.value&&(e=t.value);const i=e.split("[,+]");for(let e=0,t=i.length;e<t;++e){const t=i[e],s=t.match("[0-9]");if(-1!==t.search("-")&&2===s.length){const e=parseInt(s[0],10),t=parseInt(s[1],10);for(let i=e;i<=t;i++)l.push(i)}else for(let e=0,t=s.length;e<t;++e){const t=s[e];l.push(parseInt(t,10))}}}}if("light-heavy"!==a||0!==l.length||n||(t=!0),n||l.length>0)if("left"===i){if("start"===o){const e=new s.RepetitionInstruction(this.currentMeasureIndex,s.RepetitionInstructionEnum.Ending,s.AlignmentType.Begin,void 0,l);this.addInstruction(this.repetitionInstructions,e)}if("forward"===r){const e=new s.RepetitionInstruction(this.currentMeasureIndex,s.RepetitionInstructionEnum.StartLine);this.addInstruction(this.repetitionInstructions,e)}}else{if("stop"===o){const e=new s.RepetitionInstruction(this.currentMeasureIndex,s.RepetitionInstructionEnum.Ending,s.AlignmentType.End,void 0,l);this.addInstruction(this.repetitionInstructions,e)}if("backward"===r){const e=new s.RepetitionInstruction(this.currentMeasureIndex,s.RepetitionInstructionEnum.BackJumpLine);this.addInstruction(this.repetitionInstructions,e)}}}return t}handleRepetitionInstructionsFromWordsOrSymbols(e,t){const i=e.element("words"),n=this.currentMeasureIndex;if(i){const e="d\\s?\\.s\\.",t=i.value.trim().toLowerCase();if(r.StringUtil.StringContainsSeparatedWord(t,e+" al fine",!0)){const e=new s.RepetitionInstruction(n,s.RepetitionInstructionEnum.DalSegnoAlFine);return this.addInstruction(this.repetitionInstructions,e),!0}const o="d\\.\\s?c\\.";if(r.StringUtil.StringContainsSeparatedWord(t,o+" al coda",!0)){const e=new s.RepetitionInstruction(n,s.RepetitionInstructionEnum.DaCapoAlCoda);return this.addInstruction(this.repetitionInstructions,e),!0}if(r.StringUtil.StringContainsSeparatedWord(t,o+" al fine",!0)){const e=new s.RepetitionInstruction(n,s.RepetitionInstructionEnum.DaCapoAlFine);return this.addInstruction(this.repetitionInstructions,e),!0}if(r.StringUtil.StringContainsSeparatedWord(t,o+" al coda",!0)){const e=new s.RepetitionInstruction(n,s.RepetitionInstructionEnum.DaCapoAlCoda);return this.addInstruction(this.repetitionInstructions,e),!0}if(r.StringUtil.StringContainsSeparatedWord(t,o)||r.StringUtil.StringContainsSeparatedWord(t,"da\\s?capo",!0)){const e=new s.RepetitionInstruction(n,s.RepetitionInstructionEnum.DaCapo);return this.addInstruction(this.repetitionInstructions,e),!0}if(r.StringUtil.StringContainsSeparatedWord(t,e,!0)||r.StringUtil.StringContainsSeparatedWord(t,"dal\\s?segno",!0)){let e;return e=r.StringUtil.StringContainsSeparatedWord(t,"al\\s?coda",!0)?new s.RepetitionInstruction(n,s.RepetitionInstructionEnum.DalSegnoAlCoda):new s.RepetitionInstruction(n,s.RepetitionInstructionEnum.DalSegno),this.addInstruction(this.repetitionInstructions,e),!0}if(r.StringUtil.StringContainsSeparatedWord(t,"to\\s?coda",!0)||r.StringUtil.StringContainsSeparatedWord(t,"a (la )?coda",!0)){const e=new s.RepetitionInstruction(n,s.RepetitionInstructionEnum.ToCoda);return this.addInstruction(this.repetitionInstructions,e),!0}if(r.StringUtil.StringContainsSeparatedWord(t,"fine",!0)){const e=new s.RepetitionInstruction(n,s.RepetitionInstructionEnum.Fine);return this.addInstruction(this.repetitionInstructions,e),!0}if(r.StringUtil.StringContainsSeparatedWord(t,"coda",!0)){const e=new s.RepetitionInstruction(n,s.RepetitionInstructionEnum.Coda);return this.addInstruction(this.repetitionInstructions,e),!0}if(r.StringUtil.StringContainsSeparatedWord(t,"segno",!0)){const e=new s.RepetitionInstruction(n,s.RepetitionInstructionEnum.Segno);return this.addInstruction(this.repetitionInstructions,e),!0}}else{if(e.element("segno")){const e=new s.RepetitionInstruction(n,s.RepetitionInstructionEnum.Segno);return this.addInstruction(this.repetitionInstructions,e),!0}if(e.element("coda")){const e=new s.RepetitionInstruction(n,s.RepetitionInstructionEnum.Coda);return this.addInstruction(this.repetitionInstructions,e),!0}}return!1}removeRedundantInstructions(){let e=0,t=0,i=0,r=0;for(let n=0;n<this.repetitionInstructions.length;n++){const o=this.repetitionInstructions[n];switch(o.type){case s.RepetitionInstructionEnum.Coda:i>0&&this.findInstructionInPreviousMeasure(n,o.measureIndex,s.RepetitionInstructionEnum.ToCoda)&&(o.type=s.RepetitionInstructionEnum.None);break;case s.RepetitionInstructionEnum.Segno:if(e-r>0){let e=!1;for(let n=0,r=this.repetitionInstructions.length;n<r;++n){const r=this.repetitionInstructions[n];if(o.measureIndex-r.measureIndex===1)switch(r.type){case s.RepetitionInstructionEnum.BackJumpLine:r.type=i-t>0?s.RepetitionInstructionEnum.DalSegnoAlCoda:s.RepetitionInstructionEnum.DalSegno,o.type=s.RepetitionInstructionEnum.None,e=!0;break;case s.RepetitionInstructionEnum.DalSegno:case s.RepetitionInstructionEnum.DalSegnoAlFine:case s.RepetitionInstructionEnum.DalSegnoAlCoda:o.type=s.RepetitionInstructionEnum.None,e=!0}if(e)break}if(e)break;o.type=i-t>0?s.RepetitionInstructionEnum.DalSegnoAlCoda:s.RepetitionInstructionEnum.DalSegno,o.alignment=s.AlignmentType.End,o.measureIndex--}}if(this.backwardSearchForPreviousIdenticalInstruction(n,o)||o.type===s.RepetitionInstructionEnum.None)this.repetitionInstructions.splice(n,1),n--;else switch(o.type){case s.RepetitionInstructionEnum.Fine:break;case s.RepetitionInstructionEnum.ToCoda:i++;break;case s.RepetitionInstructionEnum.Coda:t++;break;case s.RepetitionInstructionEnum.Segno:e++;break;case s.RepetitionInstructionEnum.DalSegnoAlFine:case s.RepetitionInstructionEnum.DalSegnoAlCoda:r++}}this.repetitionInstructions.sort(n.RepetitionInstructionComparer.Compare)}findInstructionInPreviousMeasure(e,t,i){for(let s=e-1;s>=0;s--){const e=this.repetitionInstructions[s];if(t-e.measureIndex===1&&e.type===i)return!0}return!1}backwardSearchForPreviousIdenticalInstruction(e,t){for(let i=e-1;i>=0;i--)if(this.repetitionInstructions[i].equals(t))return!0;return!1}addInstruction(e,t){let i=!0;for(let s=0,n=e.length;s<n;++s){const n=e[s];if(t.equals(n)){i=!1;break}}i&&e.push(t)}}},7718:(e,t,i)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.Glissando=void 0;const s=i(2561),n=i(6438);t.Glissando=class{constructor(e){this.notes=[],this.XMLNumber=1,this.AddNote(e),this.StartNote=e,this.Direction=n.ColDirEnum.NotYetDefined}get Notes(){return this.notes}get Duration(){const e=new s.Fraction;for(const t of this.notes)e.Add(t.Length);return e}get Pitch(){return this.StartNote.Pitch}AddNote(e){this.notes.push(e),e.NoteGlissando=this,2===this.notes.length&&(this.notes[0].Pitch.getHalfTone()<this.notes[1].Pitch.getHalfTone()?this.Direction=n.ColDirEnum.Up:this.Direction=n.ColDirEnum.Down)}}},7741:(e,t,i)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.GraphicalObject=void 0;const s=i(7791);class n extends s.AClassHierarchyTrackable{get PositionAndShape(){return this.boundingBox}set PositionAndShape(e){this.boundingBox=e}}t.GraphicalObject=n},7751:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.GraphicalLyricWord=void 0,t.GraphicalLyricWord=class{constructor(e){this.graphicalLyricsEntries=[],this.lyricWord=e,this.initialize()}get GetLyricWord(){return this.lyricWord}get GraphicalLyricsEntries(){return this.graphicalLyricsEntries}set GraphicalLyricsEntries(e){this.graphicalLyricsEntries=e}isFilled(){for(let e=0;e<this.graphicalLyricsEntries.length;e++)if(!this.graphicalLyricsEntries[e])return!1;return!0}initialize(){for(let e=0;e<this.lyricWord.Syllables.length;e++)this.graphicalLyricsEntries.push(void 0)}}},7785:(e,t,i)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.VexFlowTextMeasurer=void 0;const s=i(6014);t.VexFlowTextMeasurer=class{constructor(e){this.fontSize=20,this.fontSizeStandard=this.fontSize;const t=document.createElement("canvas");this.context=t.getContext("2d"),this.rules=e}computeTextWidthToHeightRatio(e,t,i,n=void 0,r=this.fontSize){return this.context.font=s.VexFlowConverter.font(r,i,t,this.rules,n),this.context.measureText(e).width/r}setFontSize(e=this.fontSizeStandard){return this.fontSize=e,e}}},7791:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.AClassHierarchyTrackable=void 0,t.AClassHierarchyTrackable=class{isInstanceOfClass(e){let t=this.constructor.prototype;for(;t;){if(e===t.constructor.name)return!0;t=t.__proto__}return!1}}},7809:(e,t,i)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.VexFlowInstantaneousDynamicExpression=void 0;const s=i(5023),n=i(9767),r=i(8254),o=i(7435),a=i(7533),l=i(2570);class u extends s.GraphicalInstantaneousDynamicExpression{constructor(e,t,i){super(e,t,i);const s=new o.Label(this.Expression);this.label=new r.GraphicalLabel(s,this.rules.ContinuousDynamicTextHeight,a.TextAlignmentEnum.CenterCenter,this.rules,this.PositionAndShape),this.label.Label.fontStyle=l.FontStyles.BoldItalic,this.label.setLabelPositionAndShapeBorders(),this.PositionAndShape.calculateBoundingBox()}get InstantaneousDynamic(){return this.mInstantaneousDynamicExpression}get Expression(){return n.DynamicEnum[this.mInstantaneousDynamicExpression.DynEnum]}}t.VexFlowInstantaneousDynamicExpression=u},7824:(e,t,i)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.GraphicalPedal=void 0;const s=i(7741),n=i(6438),r=i(512);class o extends s.GraphicalObject{constructor(e,t){super(),this.getPedal=e,this.setSymbol(),this.PositionAndShape=new n.BoundingBox(this,t)}setSymbol(){!this.getPedal.IsLine&&this.getPedal.IsSign?this.pedalSymbol=r.MusicSymbol.PEDAL_SYMBOL:this.getPedal.IsLine&&this.getPedal.IsSign?this.pedalSymbol=r.MusicSymbol.PEDAL_MIXED:this.pedalSymbol=r.MusicSymbol.PEDAL_BRACKET}}t.GraphicalPedal=o},7921:function(e,t,i){var s=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.MusicSheetCalculator=void 0;const n=i(8724),r=i(2561),o=i(1850),a=i(5748),l=i(164),u=i(437),c=i(1336),h=i(7066),d=i(9409),m=i(2369),f=i(8254),p=i(7533),S=i(4543),g=i(3123),y=i(4249),E=i(6438),M=i(8033),b=i(8927),P=i(164),L=s(i(3065)),v=i(3263),T=i(6452),x=i(7435),A=i(3236),I=i(6362),w=i(3361),N=i(9161),C=i(2221),R=i(5875),B=i(1066),D=i(624),F=i(5824),V=i(5534),O=i(9647);class _{constructor(){this.staffEntriesWithGraphicalTies=[],this.staffEntriesWithOrnaments=[],this.staffEntriesWithChordSymbols=[],this.staffLinesWithLyricWords=[],this.graphicalLyricWords=[],this.abstractNotImplementedErrorMessage="abstract, not implemented",this.dynamicExpressionMap=new Map}static get TextMeasurer(){return _.textMeasurer}static set TextMeasurer(e){_.textMeasurer=e}get leadSheet(){return this.graphicalMusicSheet.LeadSheet}static setMeasuresMinStaffEntriesWidth(e,t){for(let i=0,s=e.length;i<s;++i){const s=e[i];s&&(s.minimumStaffEntriesWidth=t)}}initialize(e){this.graphicalMusicSheet=e,this.rules=e.ParentMusicSheet.Rules,this.rules.clearMusicSheetObjects(),this.prepareGraphicalMusicSheet()}prepareGraphicalMusicSheet(){const e=this.graphicalMusicSheet.ParentMusicSheet;this.staffEntriesWithGraphicalTies=[],this.staffEntriesWithOrnaments=[],this.staffEntriesWithChordSymbols=[],this.staffLinesWithLyricWords=[],this.graphicalMusicSheet.Initialize();const t=this.graphicalMusicSheet.MeasureList,i=this.createAccidentalCalculators(),s=this.graphicalMusicSheet.initializeActiveClefs(),n=[],r=e.getCompleteNumberOfStaves(),o=[];for(let e=0;e<r;e++)o.push(void 0);for(let r=0,a=e.SourceMeasures.length;r<a;++r){const a=e.SourceMeasures[r],l=this.createGraphicalMeasuresForSourceMeasure(a,i,n,o,s);if(t.push(l),a.multipleRestMeasures>0&&this.rules.RenderMultipleRestMeasures){a.isReducedToMultiRest=!0,a.multipleRestMeasureNumber=1;const i=a.multipleRestMeasures-1;r+=i;for(let s=1;s<=i;s++){const i=e.SourceMeasures.indexOf(a)+s;if(i>=e.SourceMeasures.length)break;const n=e.SourceMeasures[i];n.multipleRestMeasureNumber=s+1,n.isReducedToMultiRest=!0,t.push([void 0])}}}if(this.rules.AutoGenerateMultipleRestMeasuresFromRestMeasures&&this.rules.RenderMultipleRestMeasures){let r,a=0;for(let l=0,u=e.SourceMeasures.length;l<u;++l){const u=e.SourceMeasures[l];if(!u.isReducedToMultiRest&&u.canBeReducedToMultiRest())if(a>0){r.isReducedToMultiRest=!0,r.multipleRestMeasureNumber=1,a++,u.multipleRestMeasureNumber=a,u.isReducedToMultiRest=!0;for(let e=0;e<t[l].length;e++)t[l][e]=void 0}else r=u,a=1;else if(a>1){r.multipleRestMeasures=a;const e=this.createGraphicalMeasuresForSourceMeasure(r,i,n,o,s);t[r.measureListIndex]=e,a=0,r=void 0}else a=0,r=void 0}if(a>1){r.multipleRestMeasures=a,r.isReducedToMultiRest=!0;const e=this.createGraphicalMeasuresForSourceMeasure(r,i,n,o,s);t[r.measureListIndex]=e,a=0,r=void 0}}const a=s.map(e=>e.ClefType===l.ClefEnum.percussion);this.handleStaffEntries(a),this.calculateVerticalContainersList(),this.setIndicesToVerticalGraphicalContainers()}calculate(){this.musicSystems=[],this.clearSystemsAndMeasures(),this.clearRecreatedObjects(),this.createGraphicalTies(),this.calculateSheetLabelBoundingBoxes(),this.calculateXLayout(this.graphicalMusicSheet,this.maxInstrNameLabelLength()),this.graphicalMusicSheet.MusicPages.length=0,this.calculateMusicSystems(),n.GraphicalMusicSheet.transformRelativeToAbsolutePosition(this.graphicalMusicSheet)}calculateXLayout(e,t){if(this.graphicalMusicSheet.MeasureList.length>0){let e,t=0,i=1;for(let s=0;s<this.graphicalMusicSheet.MeasureList.length;s++){e=this.graphicalMusicSheet.MeasureList[s];let n=this.calculateMeasureXLayout(e);n=this.calculateMeasureWidthFromStaffEntries(e,n),n>t&&(t=n);const r=this.graphicalMusicSheet.ParentMusicSheet.MeasureWidthFactor;for(const t of e)if(t?.parentSourceMeasure.WidthFactor){i=t.parentSourceMeasure.WidthFactor;break}n*=r*i,_.setMeasuresMinStaffEntriesWidth(e,n)}if(this.rules.FixedMeasureWidth){let i=t;this.rules.FixedMeasureWidthFixedValue&&(i=this.rules.FixedMeasureWidthFixedValue);for(let t=0;t<this.graphicalMusicSheet.MeasureList.length;t++)e=this.graphicalMusicSheet.MeasureList[t],!this.rules.FixedMeasureWidthUseForPickupMeasures&&e[0]?.parentSourceMeasure.ImplicitMeasure||_.setMeasuresMinStaffEntriesWidth(e,i)}}}calculateMeasureWidthFromStaffEntries(e,t){throw new Error(this.abstractNotImplementedErrorMessage)}formatMeasures(){throw new Error(this.abstractNotImplementedErrorMessage)}calculateMeasureXLayout(e){throw new Error(this.abstractNotImplementedErrorMessage)}initGraphicalMeasuresCreation(){throw new Error(this.abstractNotImplementedErrorMessage)}handleBeam(e,t,i){throw new Error(this.abstractNotImplementedErrorMessage)}handleTiedGraphicalNote(e,t,i,s,n,r,o,a){throw new Error(this.abstractNotImplementedErrorMessage)}handleVoiceEntryLyrics(e,t,i){throw new Error(this.abstractNotImplementedErrorMessage)}handleVoiceEntryOrnaments(e,t,i){throw new Error(this.abstractNotImplementedErrorMessage)}handleVoiceEntryArticulations(e,t,i){throw new Error(this.abstractNotImplementedErrorMessage)}handleVoiceEntryTechnicalInstructions(e,t,i){throw new Error(this.abstractNotImplementedErrorMessage)}handleTuplet(e,t,i){throw new Error(this.abstractNotImplementedErrorMessage)}layoutVoiceEntry(e,t,i,s){throw new Error(this.abstractNotImplementedErrorMessage)}layoutStaffEntry(e){throw new Error(this.abstractNotImplementedErrorMessage)}createGraphicalTie(e,t,i,s,n){throw new Error(this.abstractNotImplementedErrorMessage)}updateStaffLineBorders(e){throw new Error(this.abstractNotImplementedErrorMessage)}calculateMeasureNumberPlacement(e){const t=e.StaffLines[0];if(!t||!t.Measures[0])return void L.default.warn("calculateMeasureNumberPlacement: measure undefined for system.Id "+e.Id);let i=t.Measures[0].MeasureNumber,s=0;for(let n=0;n<t.Measures.length;n++){const r=t.Measures[n];let o=this.rules.RenderMeasureNumbersOnlyAtSystemStart&&n>1;if(1===n&&t.Measures[0].parentSourceMeasure.ImplicitMeasure&&(o=!1),o)return;0!==r.MeasureNumber&&1!==r.MeasureNumber||(i=r.MeasureNumber),s=r!==t.Measures[0]&&this.rules.MeasureNumberLabelXOffset?this.rules.MeasureNumberLabelXOffset:0;const a=this.rules.UseXMLMeasureNumbers&&1===r.MeasureNumber&&1!==r.parentSourceMeasure.getPrintedMeasureNumber();((r.MeasureNumber===i||r.MeasureNumber>=i+this.rules.MeasureNumberLabelOffset)&&!r.parentSourceMeasure.ImplicitMeasure||a)&&((1!==r.MeasureNumber||1===r.MeasureNumber&&r!==t.Measures[0]||a)&&this.calculateSingleMeasureNumberPlacement(r,t,e,s),i=r.MeasureNumber)}}calculateSingleMeasureNumberPlacement(e,t,i,s=0){const n=e.parentSourceMeasure.getPrintedMeasureNumber().toString(),r=new x.Label(n),o=new f.GraphicalLabel(r,this.rules.MeasureNumberLabelHeight,p.TextAlignmentEnum.LeftBottom,this.rules),a=t.SkyBottomLineCalculator;o.setLabelPositionAndShapeBorders(),o.PositionAndShape.Parent=i.PositionAndShape;const l=t.PositionAndShape.RelativePosition.x+e.PositionAndShape.RelativePosition.x-o.PositionAndShape.BorderMarginLeft+s;let u,c=l,h=l-o.PositionAndShape.BorderLeft+o.PositionAndShape.BorderRight;c-=t.PositionAndShape.RelativePosition.x,h-=t.PositionAndShape.RelativePosition.x;const m=c+.5,S=h-.5,g=a.getSkyLineMinInRange(m,S);if(e===t.Measures[0]){let t=0;if(i.GroupBrackets.length>0)for(const e of i.GroupBrackets)t=Math.min(t,e.PositionAndShape.BorderTop);else e.ParentStaff.ParentInstrument.Parent&&(t=-1);u=Math.min(g,t)}else u=g;u=Math.min(0,u),o.PositionAndShape.RelativePosition=new d.PointF2D(l,u),i.MeasureNumberLabels.push(o)}calculateMeasureNumberSkyline(e){const t=e.StaffLines[0];for(const i of e.MeasureNumberLabels){let e=i.PositionAndShape.RelativePosition.x,s=e-i.PositionAndShape.BorderLeft+i.PositionAndShape.BorderRight;e-=t.PositionAndShape.RelativePosition.x,s-=t.PositionAndShape.RelativePosition.x,t.SkyBottomLineCalculator.updateSkyLineInRange(e,s,i.PositionAndShape.RelativePosition.y+i.PositionAndShape.BorderMarginTop)}}layoutGraphicalTie(e,t,i){throw new Error(this.abstractNotImplementedErrorMessage)}calculateSingleStaffLineLyricsPosition(e,t){let i=0,s=this.rules.StaffHeight;const n=new Map,r=[],o=e.SkyBottomLineCalculator;let a=e.Measures.length;for(let t=0;t<a;++t){const a=e.Measures[t],l=a.PositionAndShape.RelativePosition,u=a.staffEntries.length;for(let e=0;e<u;++e){const t=a.staffEntries[e],u=t.LyricsEntries.length;for(let e=0;e<u;++e){const i=t.LyricsEntries[e].LyricsEntry;n[i.VerseNumber]=i.IsChorus}if(u>0){r.push(t),i=Math.max(i,t.LyricsEntries.length);const e=t.PositionAndShape.RelativePosition.x+l.x;let n=Number.MAX_VALUE,a=Number.MIN_VALUE;for(let i=0;i<t.LyricsEntries.length;i++){const s=t.LyricsEntries[i].GraphicalLabel;n=Math.min(n,e+s.PositionAndShape.BorderMarginLeft),a=Math.max(a,e+s.PositionAndShape.BorderMarginRight)}const u=o.getBottomLineMaxInRange(n,a);s=Math.max(s,u+this.rules.LyricsYMarginToBottomLine)}}}let l=0;a=r.length;for(const e of r){const i=[];let r=!0;for(let t=0;t<e.LyricsEntries.length;t++)r&&(r=e.LyricsEntries[t].LyricsEntry.IsChorus);for(const e of t)n[e]===r&&i.push(e);for(let t=0;t<e.LyricsEntries.length;t++){const n=e.LyricsEntries[t],r=n.GraphicalLabel,o=n.LyricsEntry.VerseNumber,a=i.indexOf(o),u=s+this.rules.LyricsHeight+this.rules.VerticalBetweenLyricsDistance+this.rules.LyricsYOffsetToStaffHeight+(this.rules.VerticalBetweenLyricsDistance+this.rules.LyricsHeight)*a,c=r.PositionAndShape.RelativePosition.x;r.PositionAndShape.RelativePosition=new d.PointF2D(c,u),r.Label.fontStyle=n.LyricsEntry.FontStyle,l=Math.max(l,u)}}if(r.length>0){const t=e.PositionAndShape.Size.width;let i=r[0].PositionAndShape.RelativePosition.x+r[0].PositionAndShape.BorderMarginLeft+r[0].parentMeasure.PositionAndShape.RelativePosition.x;i=i>t?t:i,o.updateBottomLineInRange(i,t,l)}return r}calculateLyricsExtendsAndDashes(e){for(let t=0,i=e.length;t<i;++t){const i=e[t];for(let e=0;e<i.LyricsEntries.length;e++){const t=i.LyricsEntries[e];t.ParentLyricWord&&t.ParentLyricWord.GraphicalLyricsEntries[t.ParentLyricWord.GraphicalLyricsEntries.length-1]!==t&&this.calculateSingleLyricWord(t),t.LyricsEntry.extend&&this.calculateLyricExtend(t)}}}calculateSingleOctaveShift(e,t,i,s){throw new Error(this.abstractNotImplementedErrorMessage)}calculateWordRepetitionInstruction(e,t){throw new Error(this.abstractNotImplementedErrorMessage)}calculateMoodAndUnknownExpression(e,t,i){const s=e.AbsoluteTimestamp,n=this.graphicalMusicSheet.MeasureList[t];let r=new d.PointF2D;const o=e.UnknownList[0]?.defaultYXml;if(e.MoodList.length>0||e.UnknownList.length>0){let t="";for(let i=0,s=e.EntriesList.length;i<s;++i){const s=e.EntriesList[i];""!==s.prefix&&(t+=""===t?s.prefix:" "+s.prefix),t+=""===t?s.label:" "+s.label}const a=n[i].ParentStaffLine;if(!a)return void L.default.debug("MusicSheetCalculator.calculateMoodAndUnknownExpression: staffLine undefined. Returning.");r=this.getRelativePositionInStaffLineFromTimestamp(s,i,a,a?.isPartOfMultiStaffInstrument()),Math.abs(r.x-0)<1e-4&&(r.x=n[i].beginInstructionsWidth+this.rules.RhythmRightMargin);const l=this.rules.UnknownTextHeight,u=e.getPlacementOfFirstEntry(),c=this.calculateLabel(a,r,t,e.getFontstyleOfFirstEntry(),u,l);if(this.rules.PlaceWordsInsideStafflineFromXml&&o<0&&o>-50){let e=o/10;e+=this.rules.PlaceWordsInsideStafflineYOffset,c.PositionAndShape.RelativePosition.y=e}const h=new F.GraphicalUnknownExpression(a,c,u,n[i]?.parentSourceMeasure,e);a.AbstractExpressions.push(h)}}clearRecreatedObjects(){for(let e=0,t=this.staffEntriesWithGraphicalTies.length;e<t;++e)this.staffEntriesWithGraphicalTies[e].GraphicalTies.length=0;this.staffEntriesWithGraphicalTies.length=0}handleStaffEntryLink(e,t){L.default.debug("handleStaffEntryLink not implemented")}calculateMusicSystems(){if(!this.graphicalMusicSheet.MeasureList)return;const e=this.graphicalMusicSheet.MeasureList;if(!e)return;this.rules.MinMeasureToDrawIndex>e.length-1&&(L.default.debug("minimum measure to draw index out of range. resetting min measure index to limit."),this.rules.MinMeasureToDrawIndex=e.length-1);const t=[];for(let i=this.rules.MinMeasureToDrawIndex,s=e.length;i<s&&i<=this.rules.MaxMeasureToDrawIndex;++i){const s=[];for(let t=0,n=e[i].length;t<n;++t){const n=e[i][t];if(n?.isVisible()&&(s.push(n),this.rules.ColoringEnabled))for(const e of n.staffEntries)for(const t of e.graphicalVoiceEntries)t.applyCustomNoteheads(),t.color()}t.push(s)}let i=0;for(let e=0,s=t.length;e<s;++e){const s=t[e];i=Math.max(s.length,i);break}if(0===i)return;const s=new h.MusicSystemBuilder;if(s.initialize(this.graphicalMusicSheet,t,i),this.musicSystems=s.buildMusicSystems(),this.formatMeasures(),this.leadSheet||(this.optimizeRestPlacement(),this.calculateStaffEntryArticulationMarks(),this.rules.RenderSlurs&&this.calculateTieCurves()),this.calculateSkyBottomLines(),this.calculateTupletNumbers(),this.rules.RenderMeasureNumbers)for(let e=0,t=this.musicSystems.length;e<t;++e){const t=this.musicSystems[e];this.calculateMeasureNumberPlacement(t)}if(this.rules.RenderFingerings&&this.calculateFingerings(),!this.leadSheet&&this.rules.RenderSlurs&&this.calculateSlurs(),this.calculateGlissandi(),this.rules.RenderMeasureNumbers)for(let e=0,t=this.musicSystems.length;e<t;++e){const t=this.musicSystems[e];this.calculateMeasureNumberSkyline(t)}this.leadSheet||this.calculateOrnaments(),this.calculateChordSymbols(),this.leadSheet||(this.calculateDynamicExpressions(),this.calculateMoodAndUnknownExpressions(),this.calculateExpressionAlignements(),this.calculateOctaveShifts(),this.rules.RenderPedals&&this.calculatePedals(),this.calculateWordRepetitionInstructions()),this.calculateRepetitionEndings(),this.leadSheet||this.calculateTempoExpressions(),this.calculateRehearsalMarks(),this.calculateLyricsPosition();for(let e=0,t=this.musicSystems.length;e<t;++e){const t=this.musicSystems[e];for(let e=0,i=t.StaffLines.length;e<i;++e){const i=t.StaffLines[e];this.updateStaffLineBorders(i)}}s.calculateSystemYLayout(),this.calculateComments(),this.calculateMarkedAreas();for(let e=0,t=this.graphicalMusicSheet.MusicPages.length;e<t;++e){const t=this.graphicalMusicSheet.MusicPages[e];for(let i=0,s=t.MusicSystems.length;i<s;++i){const s=0===e&&0===i,n=t.MusicSystems[i];n.setMusicSystemLabelsYPosition(),this.leadSheet?n===n.Parent.MusicSystems[0]&&n.createSystemLeftLine(this.rules.SystemThinLineWidth,this.rules.SystemLabelsRightMargin,s):(n.setYPositionsToVerticalLineObjectsAndCreateLines(this.rules),n.createSystemLeftLine(this.rules.SystemThinLineWidth,this.rules.SystemLabelsRightMargin,s),n.createInstrumentBrackets(this.graphicalMusicSheet.ParentMusicSheet.Instruments,this.rules.StaffHeight),n.createGroupBrackets(this.graphicalMusicSheet.ParentMusicSheet.InstrumentalGroups,this.rules.StaffHeight,0),n.alignBeginInstructions()),n.calculateBorders(this.rules)}const i=t.MusicSystems[0].PositionAndShape.BorderTop;for(let e=0,s=t.MusicSystems.length;e<s;++e){const s=t.MusicSystems[e];s.PositionAndShape.RelativePosition=new d.PointF2D(s.PositionAndShape.RelativePosition.x,s.PositionAndShape.RelativePosition.y-i)}t.PositionAndShape.calculateTopBottomBorders(),t===this.graphicalMusicSheet.MusicPages[0]&&this.calculatePageLabels(t),t.PositionAndShape.calculateTopBottomBorders()}}calculateMarkedAreas(){}calculateComments(){}calculateChordSymbols(){for(const e of this.musicSystems)for(const t of e.StaffLines){const i=t.SkyBottomLineCalculator;let s=Number.MAX_SAFE_INTEGER,n=Number.MIN_SAFE_INTEGER;if(this.rules.ChordSymbolYAlignment&&"staffline"===this.rules.ChordSymbolYAlignmentScope){const e=[];for(const i of t.Measures)e.push(...i.staffEntries);const{minOffset:r,maxOffset:o}=this.calculateAlignedChordSymbolsOffset(e,i);s=r,n=o}for(let r=0;r<t.Measures.length;r++){const o=t.Measures[r];if(this.rules.ChordSymbolYAlignment&&"measure"===this.rules.ChordSymbolYAlignmentScope){const{minOffset:e,maxOffset:t}=this.calculateAlignedChordSymbolsOffset(o.staffEntries,i);s=e,n=t}let l;for(const t of o.staffEntries)if(t.graphicalChordContainers&&0!==t.graphicalChordContainers.length)for(let u=0;u<t.graphicalChordContainers.length;u++){const c=t.graphicalChordContainers[u];if(0===t.graphicalVoiceEntries.length&&t.relInMeasureTimestamp.RealValue>0){let e=0;0===o.staffEntries[0].relInMeasureTimestamp.RealValue&&(e=o.staffEntries[0].PositionAndShape.RelativePosition.x,1===o.MeasureNumber&&(e+=this.rules.ChordSymbolWholeMeasureRestXOffsetMeasure1));let i=e+(o.PositionAndShape.Size.width-o.endInstructionsWidth-e)*(t.relInMeasureTimestamp.RealValue/o.parentSourceMeasure.Duration.RealValue)+c.PositionAndShape.BorderMarginLeft;l&&(i=Math.max(i,l.PositionAndShape.RelativePosition.x+l.GraphicalLabel.PositionAndShape.Size.width+this.rules.ChordSymbolXSpacing)),c.PositionAndShape.RelativePosition.x=i,c.PositionAndShape.Parent=o.staffEntries[0].PositionAndShape.Parent}const h=c.PositionAndShape,d=h.Parent;if(d.DataObject instanceof a.GraphicalMeasure&&0===t.relInMeasureTimestamp.RealValue&&(h.RelativePosition.x=Math.max(o.beginInstructionsWidth,h.RelativePosition.x),1===o.MeasureNumber&&h.RelativePosition.x>3&&(h.RelativePosition.x+=this.rules.ChordSymbolWholeMeasureRestXOffsetMeasure1)),0===t.PositionAndShape.RelativePosition.x){const i=e.GraphicalMeasures[r];for(const e of i){let i=!1;for(const s of e.staffEntries)if(s.relInMeasureTimestamp===t.relInMeasureTimestamp&&0!==s.PositionAndShape.RelativePosition.x){h.RelativePosition.x=s.PositionAndShape.RelativePosition.x,i=!0;break}if(i)break}}const m=h.BorderMarginLeft+d.AbsolutePosition.x+h.RelativePosition.x,f=h.BorderMarginRight+d.AbsolutePosition.x+h.RelativePosition.x,p=c.GetChordSymbolContainer.Placement;p===I.PlacementEnum.Below?(!this.rules.ChordSymbolYAlignment||n<0)&&(n=i.getBottomLineMaxInRange(m,f)):p===I.PlacementEnum.Above&&(!this.rules.ChordSymbolYAlignment||s>0)&&(s=i.getSkyLineMinInRange(m,f));let S=0;0===u?(S+=this.rules.ChordSymbolYOffset,S+=.1):S+=this.rules.ChordSymbolYPadding,p!==I.PlacementEnum.Below&&(S*=-1);const g=c.GraphicalLabel;p===I.PlacementEnum.Below?(g.PositionAndShape.RelativePosition.y=n+S,g.setLabelPositionAndShapeBorders(),g.PositionAndShape.calculateBoundingBox(),i.updateBottomLineInRange(m,f,n+g.PositionAndShape.BorderMarginBottom+this.rules.ChordSymbolBottomMargin)):(g.PositionAndShape.RelativePosition.y=s+S,g.setLabelPositionAndShapeBorders(),g.PositionAndShape.calculateBoundingBox(),i.updateSkyLineInRange(m,f,s+g.PositionAndShape.BorderMarginTop)),l=c}}}}calculateAlignedChordSymbolsOffset(e,t){let i=Number.MAX_SAFE_INTEGER,s=Number.MIN_SAFE_INTEGER;for(const n of e)for(const e of n.graphicalChordContainers){const n=e.PositionAndShape,r=n.Parent;let o=n.BorderMarginLeft+r.AbsolutePosition.x,l=n.BorderMarginRight+r.AbsolutePosition.x;r.DataObject instanceof a.GraphicalMeasure&&(o+=r.DataObject.beginInstructionsWidth,l+=r.DataObject.beginInstructionsWidth);const u=e.GetChordSymbolContainer.Placement;u===I.PlacementEnum.Above?i=Math.min(i,t.getSkyLineMinInRange(o,l)):u===I.PlacementEnum.Below&&(s=Math.max(s,t.getBottomLineMaxInRange(o,l)))}return{minOffset:i,maxOffset:s}}layoutMeasureWithWholeRest(e,t,i){}layoutBeams(e){}layoutArticulationMarks(e,t,i){}layoutOrnament(e,t,i){}calculateRestNotePlacementWithinGraphicalBeam(e,t,i,s,n){}calculateTupletNumbers(){if(!this.rules.TupletNumberLimitConsecutiveRepetitions)return;let e,t,i,s=-1,n=0;const r={};for(const o of this.graphicalMusicSheet.ParentMusicSheet.Instruments)for(const a of o.Voices){n=0,r[a.VoiceId]={};for(const o of a.VoiceEntries)if(o.Notes.length>0){const l=o.Notes[0];if(!l.NoteTuplet||l.NoteTuplet.shouldBeBracketed(this.rules.TupletsBracketedUseXMLValue,this.rules.TupletsBracketed,this.rules.TripletsBracketed)){s=-1,n=0,t=void 0,e=void 0;continue}if(l.NoteTuplet===i)continue;let u=l.TypeLength;if(u||(L.default.warn("note missing TypeLength"),u=l.NoteTuplet.Fractions[0]),l.NoteTuplet!==t&&r[a.VoiceId][l.NoteTuplet.TupletLabelNumber]&&r[a.VoiceId][l.NoteTuplet.TupletLabelNumber][u.RealValue]){l.NoteTuplet.RenderTupletNumber=!1,i=l.NoteTuplet;continue}l.NoteTuplet.TupletLabelNumber===s&&u.Equals(e)&&!l.NoteTuplet.Bracket||(s=l.NoteTuplet.TupletLabelNumber,e=u,n=0),t=l.NoteTuplet,n++,n<=this.rules.TupletNumberMaxConsecutiveRepetitions&&(l.NoteTuplet.RenderTupletNumber=!0),n>this.rules.TupletNumberMaxConsecutiveRepetitions&&(l.NoteTuplet.RenderTupletNumber=!1,this.rules.TupletNumberAlwaysDisableAfterFirstMax&&(r[a.VoiceId][s]||(r[a.VoiceId][s]={}),r[a.VoiceId][s][u.RealValue]=!0)),i=t}}}calculateSlurs(){}calculateGlissandi(){}calculateDynamicExpressionsForMultiExpression(e,t,i){}calculateGraphicalVerbalContinuousDynamic(e,t){const i=e.Label,s=t.x+i.PositionAndShape.BorderMarginLeft,n=t.x+i.PositionAndShape.BorderMarginRight,r=e.ContinuousDynamic.Placement,o=e.ParentStaffLine.SkyBottomLineCalculator;let a;r===I.PlacementEnum.Below?(a=o.getBottomLineMaxInRange(s,n),i.PositionAndShape.RelativePosition=new d.PointF2D(t.x,a-i.PositionAndShape.BorderMarginTop)):(a=o.getSkyLineMinInRange(s,n),i.PositionAndShape.RelativePosition=new d.PointF2D(t.x,a-i.PositionAndShape.BorderMarginBottom))}calculateGraphicalContinuousDynamic(e,t){const i=e.IsSoftAccent,s=e.ParentStaffLine.ParentStaff.idInMusicSheet,n=this.graphicalMusicSheet.getGraphicalMeasureFromSourceMeasureAndIndex(e.ContinuousDynamic.EndMultiExpression.SourceMeasureParent,s);if(!n)return void L.default.warn("MusicSheetCalculator.calculateGraphicalContinuousDynamic: No endMeasure found");e.EndMeasure=n;const o=e.ParentStaffLine,a=n.ParentStaffLine,l=a&&o===a;let u=!1;a?u=a?.isPartOfMultiStaffInstrument():o&&(u=o?.isPartOfMultiStaffInstrument());const c=r.Fraction.createFromFraction(e.ContinuousDynamic.EndMultiExpression.AbsoluteTimestamp),h=this.graphicalMusicSheet.GetVerticalContainerFromTimestamp(c),d=h.getFirstNonNullStaffEntry().parentMeasure,m=d.PositionAndShape.AbsolutePosition.x+d.PositionAndShape.BorderRight;let f=new r.Fraction(0,0,0);for(const e of h.StaffEntries){const t=e?.sourceStaffEntry?.calculateMaxNoteLength(!1);t?.gt(f)&&(f=t)}const p=!i&&e.ContinuousDynamic.DynamicType===R.ContDynamicEnum.diminuendo,S=this.getRelativePositionInStaffLineFromTimestamp(c,s,a,u,0,p),g=r.Fraction.plus(c,f).clone();e.ContinuousDynamic.EndMultiExpression.EndOffsetFraction&&this.rules.UseEndOffsetForExpressions&&g.Add(e.ContinuousDynamic.EndMultiExpression.EndOffsetFraction);const y=this.getRelativePositionInStaffLineFromTimestamp(g,s,a,u,0,e.ContinuousDynamic.DynamicType===R.ContDynamicEnum.diminuendo),E=this.rules.SoftAccentWedgePadding,M=h.getFirstNonNullStaffEntry().PositionAndShape.Size.width,b=this.rules.SoftAccentSizeFactor;i?(t.x-=M/2*b+E,S.x=t.x+M/2*b):y.x>S.x&&y.x<m?S.x+=(y.x-S.x)/this.rules.WedgeEndDistanceBetweenTimestampsFactor:S.x=m-this.rules.WedgeHorizontalMargin;const P=this.dynamicExpressionMap.get(e.ContinuousDynamic.StartMultiExpression.AbsoluteTimestamp.RealValue);P&&P.DataObject.ParentStaffLine===o&&(t.x=P.RelativePosition.x+this.rules.WedgeHorizontalMargin,t.x+=P.BorderMarginRight);const v=o.ParentMusicSystem,T=v.StaffLines.indexOf(o),x=o.SkyBottomLineCalculator,A=e.ContinuousDynamic.Placement;let w;l&&S.x-t.x<this.rules.WedgeMinLength&&!i&&(S.x=t.x+this.rules.WedgeMinLength);const N=t.x;let C=a.Measures[0].beginInstructionsWidth-this.rules.WedgeHorizontalMargin-2,D=0,F=0;const V=[];if(l)D=S.x;else{D=o.PositionAndShape.Size.width,F=S.x;const t=[o,a],i=e.StartMeasure;let r=i,l=0,u=i.parentSourceMeasure.measureListIndex;for(;r!==n&&l<1e3;){const i=this.graphicalMusicSheet.ParentMusicSheet.SourceMeasures[u],n=this.graphicalMusicSheet.getGraphicalMeasureFromSourceMeasureAndIndex(i,s);if(n){r=n;const i=r.ParentStaffLine;if(!t.includes(i)){t.push(i);const s=new B.GraphicalContinuousDynamicExpression(e.ContinuousDynamic,i,i.Measures[0].parentSourceMeasure);s.IsSplittedPart=!0,V.push(s)}}u++,l++}w=new B.GraphicalContinuousDynamicExpression(e.ContinuousDynamic,a,n.parentSourceMeasure),w.IsSplittedPart=!0,e.IsSplittedPart=!0}i&&(C=S.x+E,F=C+M/2*b);let O=0,_=0;if(A===I.PlacementEnum.Below){let t=0;if(T<v.StaffLines.length-1&&(t=T+1),t>T){const e=v.StaffLines[t].PositionAndShape.RelativePosition.y-o.PositionAndShape.RelativePosition.y-this.rules.StaffHeight;O=this.rules.StaffHeight+e/2}else O=this.rules.WedgePlacementBelowY;O-=this.rules.WedgeOpeningLength/2,l||(_=O);let i=x.getBottomLineMaxInRange(N,D);i>O&&(O=i);const s=!1;if(T<v.StaffLines.length-1){const i=o.findClosestStaffEntry(D),n=o.findClosestStaffEntry(N);if(n&&i&&(n.parentVerticalContainer,s)){const i=v.StaffLines[t],s=i.SkyBottomLineCalculator.getSkyLineMinInRange(N,D),n=i.PositionAndShape.RelativePosition.y-o.PositionAndShape.RelativePosition.y+s;O=n-this.rules.WedgeOpeningLength>this.rules.StaffHeight?n-this.rules.WedgeVerticalMargin:this.rules.StaffHeight+this.rules.WedgeOpeningLength,e.NotToBeRemoved=!0}}l||(i=a.SkyBottomLineCalculator.getBottomLineMaxInRange(C,F),i>_&&(_=i),_+=this.rules.WedgeOpeningLength/2,_+=this.rules.WedgeVerticalMargin),s||(O+=this.rules.WedgeOpeningLength/2,O+=this.rules.WedgeVerticalMargin)}else if(A===I.PlacementEnum.Above){if(1===o.ParentStaff.ParentInstrument.Staves.length)O=this.rules.WedgePlacementAboveY;else{let e=0;T>0&&(e=T-1);const t=v.StaffLines[e];O=-(o.PositionAndShape.RelativePosition.y-t.PositionAndShape.RelativePosition.y-this.rules.StaffHeight)/2}O+=this.rules.WedgeOpeningLength/2,l||(_=O);let e=x.getSkyLineMinInRange(N,D);e<O&&(O=e);const t=!1;if(o.ParentStaff.ParentInstrument.Staves.length>1&&T>0){const e=o.findClosestStaffEntry(N),i=o.findClosestStaffEntry(D);if(e&&i){e.parentVerticalContainer;const i=T-1;if(t){const e=v.StaffLines[i];if(e){const t=e.SkyBottomLineCalculator.getBottomLineMaxInRange(N,D);O=(o.PositionAndShape.RelativePosition.y-e.PositionAndShape.RelativePosition.y-t-this.rules.StaffHeight)/2+this.rules.StaffHeight}}}}l||(e=a.SkyBottomLineCalculator.getSkyLineMinInRange(C,F),e<_&&(_=e),_-=this.rules.WedgeOpeningLength/2),t||(O-=this.rules.WedgeOpeningLength/2,O-=this.rules.WedgeVerticalMargin),l||(_-=this.rules.WedgeVerticalMargin)}if(e.Lines.clear(),i)e.createFirstHalfCrescendoLines(N,D,O),e.createSecondHalfDiminuendoLines(C,F,O),e.calcPsi();else if(l&&!i)e.createLines(N,D,O),e.calcPsi();else{e.createFirstHalfLines(N,D,O),e.calcPsi();for(let t=0;t<V.length;t++){const i=V[t],s=i.ParentStaffLine;let n=_;if(A===I.PlacementEnum.Below){const e=a.SkyBottomLineCalculator.getBottomLineMaxInRange(C,D);e>n&&(n=e),n+=this.rules.WedgeOpeningLength/2,n+=this.rules.WedgeVerticalMargin}else if(A===I.PlacementEnum.Above){const e=s.SkyBottomLineCalculator.getSkyLineMinInRange(C,F);e<_&&(n=e),n-=this.rules.WedgeOpeningLength/2}e.ContinuousDynamic.DynamicType===R.ContDynamicEnum.crescendo?i.createSecondHalfCrescendoLines(0,s.PositionAndShape.Size.width,n):i.createFirstHalfDiminuendoLines(0,s.PositionAndShape.Size.width,n),i.calcPsi()}w.createSecondHalfLines(C,F,_),w.calcPsi()}this.dynamicExpressionMap.set(c.RealValue,e.PositionAndShape)}calculateGraphicalInstantaneousDynamicExpression(e,t,i){const s=e.ParentStaffLine;if(!s)return;const n=t.x+e.PositionAndShape.BorderMarginLeft,r=t.x+e.PositionAndShape.BorderMarginRight,o=s.SkyBottomLineCalculator;let a=0;if(e.Placement===I.PlacementEnum.Above){const i=o.getSkyLineMinInRange(n,r);if(s.isPartOfMultiStaffInstrument()&&s.ParentStaff!==s.ParentStaff.ParentInstrument.Staves[0]){const t=s.ParentMusicSystem.StaffLines[s.ParentMusicSystem.StaffLines.indexOf(s)-1];if(t){const n=s?.PositionAndShape.RelativePosition.y-t.PositionAndShape.RelativePosition.y-this.rules.StaffHeight;a=i>-n/2?-n/2:i-e.PositionAndShape.BorderMarginBottom}}else a=i-e.PositionAndShape.BorderMarginBottom;e.PositionAndShape.RelativePosition=new d.PointF2D(t.x,a)}else if(e.Placement===I.PlacementEnum.Below){const i=o.getBottomLineMaxInRange(n,r),l=s.ParentStaff.ParentInstrument.Staves[s.ParentStaff.ParentInstrument.Staves.length-1];if(s.isPartOfMultiStaffInstrument()&&s.ParentStaff!==l){const t=s.ParentMusicSystem.StaffLines[s.ParentMusicSystem.StaffLines.indexOf(s)+1];if(t){const n=t.PositionAndShape.RelativePosition.y-s.PositionAndShape.RelativePosition.y-this.rules.StaffHeight;a=i+e.PositionAndShape.BorderMarginBottom<this.rules.StaffHeight+n/2?this.rules.StaffHeight+n/2:i-e.PositionAndShape.BorderMarginTop}}else a=i-e.PositionAndShape.BorderMarginTop;e.PositionAndShape.RelativePosition=new d.PointF2D(t.x,a)}e.updateSkyBottomLine()}calcGraphicalRepetitionEndingsRecursively(e){}layoutSingleRepetitionEnding(e,t,i,s,n,r){}calculateLabel(e,t,i,s,n,r,o=p.TextAlignmentEnum.CenterBottom,a=0){const l=new x.Label(i,o);l.fontStyle=s,l.fontHeight=r;const u=new f.GraphicalLabel(l,r,l.textAlignment,this.rules,e.PositionAndShape),c=1.1;n===I.PlacementEnum.Below&&(u.Label.textAlignment=p.TextAlignmentEnum.LeftTop),u.setLabelPositionAndShapeBorders(),u.PositionAndShape.BorderMarginBottom*=c,u.PositionAndShape.BorderMarginTop*=c,u.PositionAndShape.BorderMarginLeft*=c,u.PositionAndShape.BorderMarginRight*=c;let h,m=t.x+u.PositionAndShape.BorderMarginLeft,S=t.x+u.PositionAndShape.BorderMarginRight;S>e.PositionAndShape.Size.width&&(S=e.PositionAndShape.Size.width-this.rules.MeasureRightMargin,m=S-u.PositionAndShape.MarginSize.width,t.x=m-u.PositionAndShape.BorderMarginLeft);const g=e.SkyBottomLineCalculator;return h=n===I.PlacementEnum.Below?g.getBottomLineMaxInRange(m,S)+a:g.getSkyLineMinInRange(m,S)-a,u.PositionAndShape.RelativePosition=new d.PointF2D(t.x,h),n===I.PlacementEnum.Below?g.updateBottomLineInRange(m,S,u.PositionAndShape.BorderMarginBottom+h):g.updateSkyLineInRange(m,S,u.PositionAndShape.BorderMarginTop+h),u}calculateTempoExpressionsForMultiTempoExpression(e,t,i){const s=r.Fraction.plus(e.AbsoluteTimestamp,t.Timestamp),n=this.graphicalMusicSheet.MeasureList[i];let o=new d.PointF2D;if(t.ContinuousTempo||t.InstantaneousTempo){if(this.rules.MinMeasureToDrawIndex>0)return;if(!n[0])return;let e=n[0].ParentStaffLine,i=n[0].PositionAndShape.RelativePosition.x,r=0;for(let t=0;t<n.length;t++)if(n[t].ParentStaffLine&&0!==n[t].ParentStaffLine.Measures.length&&n[t].ParentStaffLine.Measures.length>0){e=n[t].ParentStaffLine,i=n[t].PositionAndShape.RelativePosition.x,r=t;break}if(o=this.getRelativePositionInStaffLineFromTimestamp(s,r,e,e.isPartOfMultiStaffInstrument(),i),t.EntriesList.length>0&&t.EntriesList[0].Expression instanceof N.InstantaneousTempoExpression&&(t.EntriesList[0].Expression.Placement=I.PlacementEnum.Above,e.Measures[0].staffEntries.length>0&&0===Math.abs(o.x-e.Measures[0].staffEntries[0].PositionAndShape.RelativePosition.x)&&e.ParentMusicSystem===this.musicSystems[0])){const t=e.Measures[0].FirstInstructionStaffEntry;if(t){const e=t.GraphicalInstructions.last();o.x=e.PositionAndShape.RelativePosition.x}this.rules.CompactMode&&(o.x=e.PositionAndShape.RelativePosition.x+e.Measures[0].PositionAndShape.RelativePosition.x)}for(const i of t.EntriesList){let s=p.TextAlignmentEnum.CenterBottom;this.rules.CompactMode&&(s=p.TextAlignmentEnum.LeftBottom);const n=this.calculateLabel(e,o,i.label,t.getFontstyleOfFirstEntry(),i.Expression.Placement,this.rules.UnknownTextHeight,s,this.rules.TempoYSpacing);if(i.Expression.ColorXML&&this.rules.ExpressionsUseXMLColor&&(n.ColorXML=i.Expression.ColorXML),i.Expression instanceof N.InstantaneousTempoExpression){for(const t of e.AbstractExpressions)t instanceof w.GraphicalInstantaneousTempoExpression&&(t.SourceExpression.Label,i.Expression.Label);if(new w.GraphicalInstantaneousTempoExpression(i.Expression,n).ParentStaffLine||L.default.warn("Adding staffline didn't work"),this.rules.MetronomeMarksDrawn&&i.Expression.Enum===N.TempoEnum.metronomeMark){this.createMetronomeMark(i.Expression);continue}}else if(i.Expression instanceof C.ContinuousTempoExpression){for(const t of e.AbstractExpressions)t instanceof w.GraphicalInstantaneousTempoExpression&&(t.SourceExpression.Label,i.Expression.Label);e.AbstractExpressions.push(new w.GraphicalInstantaneousTempoExpression(i.Expression,n))}}}}createMetronomeMark(e){throw new Error(this.abstractNotImplementedErrorMessage)}graphicalMeasureCreatedCalculations(e){}clearSystemsAndMeasures(){for(let e=0,t=this.graphicalMusicSheet.MusicPages.length;e<t;++e){const t=this.graphicalMusicSheet.MusicPages[e];for(let e=0,i=t.MusicSystems.length;e<i;++e){const i=t.MusicSystems[e];for(let e=0,t=i.StaffLines.length;e<t;++e){const t=i.StaffLines[e];t.ParentStaff.Visible||t.Measures.clear();for(let e=0,i=t.Measures.length;e<i;++e){const i=t.Measures[e];if(i.FirstInstructionStaffEntry){const e=i.PositionAndShape.ChildElements.indexOf(i.FirstInstructionStaffEntry.PositionAndShape);e>-1&&i.PositionAndShape.ChildElements.splice(e,1),i.FirstInstructionStaffEntry=void 0,i.beginInstructionsWidth=0}if(i.LastInstructionStaffEntry){const e=i.PositionAndShape.ChildElements.indexOf(i.LastInstructionStaffEntry.PositionAndShape);e>-1&&i.PositionAndShape.ChildElements.splice(e,1),i.LastInstructionStaffEntry=void 0,i.endInstructionsWidth=0}}t.Measures=[],t.PositionAndShape.ChildElements=[]}i.StaffLines.length=0,i.PositionAndShape.ChildElements=[]}t.MusicSystems=[],t.PositionAndShape.ChildElements=[]}this.graphicalMusicSheet.MusicPages=[]}handleVoiceEntry(e,t,i,s,n,r,o,a,l,u=void 0,h=void 0){e.StemDirectionXml!==c.StemDirectionType.Undefined&&this.rules.SetWantedStemDirectionByXml&&void 0!==e.StemDirectionXml?e.WantedStemDirection=e.StemDirectionXml:this.calculateStemDirectionFromVoices(e);const d=t.findOrCreateGraphicalVoiceEntry(e);d.octaveShiftValue=a;const m=t.tabStaffEntry;let f;m&&(f=m.findOrCreateGraphicalVoiceEntry(e));for(let s=0,l=e.Notes.length;s<l;++s){const l=e.Notes[s];if(!l)continue;if(void 0!==h&&void 0!==h.Link&&void 0!==u&&u.indexOf(l)>-1)continue;let c;if(e.IsGrace?c=_.symbolFactory.createGraceNote(l,d,n,this.rules,a):(c=_.symbolFactory.createNote(l,d,n,a,this.rules,void 0),_.stafflineNoteCalculator.trackNote(c)),l.Pitch&&this.checkNoteForAccidental(c,i,n,a),this.resetYPositionForLeadSheet(c.PositionAndShape),t.addGraphicalNoteToListAtCorrectYPosition(d,c),c.PositionAndShape.calculateBoundingBox(),this.leadSheet||(void 0!==l.NoteBeam&&l.PrintObject&&(l instanceof O.TabNote&&!this.rules.TabBeamsRendered||this.handleBeam(c,l.NoteBeam,o)),void 0!==l.NoteTuplet&&l.PrintObject&&this.handleTuplet(c,l.NoteTuplet,r)),f){const e=_.symbolFactory.createNote(l,f,n,a,this.rules,void 0);m.addGraphicalNoteToListAtCorrectYPosition(f,e),e.PositionAndShape.calculateBoundingBox(),this.leadSheet||l.NoteTuplet&&this.handleTuplet(e,l.NoteTuplet,r)}}return e.Articulations.length>0&&this.handleVoiceEntryArticulations(e.Articulations,e,t),e.TechnicalInstructions.length>0&&this.handleVoiceEntryTechnicalInstructions(e.TechnicalInstructions,e,t),e.LyricsEntries.size()>0&&this.handleVoiceEntryLyrics(e,t,s),e.OrnamentContainer&&this.handleVoiceEntryOrnaments(e.OrnamentContainer,e,t),a}resetYPositionForLeadSheet(e){this.leadSheet&&(e.RelativePosition=new d.PointF2D(e.RelativePosition.x,0))}layoutVoiceEntries(e,t){if(e.PositionAndShape.RelativePosition=new d.PointF2D(0,0),!this.leadSheet)for(const t of e.graphicalVoiceEntries){const i=t.notes;if(0===i.length)continue;const s=i[0].sourceNote.ParentVoiceEntry,n=void 0!==i[0].sourceNote.Pitch;this.layoutVoiceEntry(s,i,e,n)}}maxInstrNameLabelLength(){let e=0;for(const t of this.graphicalMusicSheet.ParentMusicSheet.Instruments)if(t.NameLabel?.print&&t.Voices.length>0&&t.Voices[0].Visible){let i=t.NameLabel;this.rules.RenderPartNames||(i=new x.Label("",i.textAlignment,i.font));const s=new f.GraphicalLabel(i,this.rules.InstrumentLabelTextHeight,p.TextAlignmentEnum.LeftCenter,this.rules);s.setLabelPositionAndShapeBorders(),e=Math.max(e,s.PositionAndShape.MarginSize.width)}return this.rules.RenderPartNames?e:0}calculateSheetLabelBoundingBoxes(){const e=this.graphicalMusicSheet.ParentMusicSheet,t=this.rules.DefaultColorTitle;if(void 0!==e.Title&&this.rules.RenderTitle){const i=new f.GraphicalLabel(e.Title,this.rules.SheetTitleHeight,p.TextAlignmentEnum.CenterBottom,this.rules);i.Label.IsCreditLabel=!0,i.Label.colorDefault=t,this.graphicalMusicSheet.Title=i,i.setLabelPositionAndShapeBorders()}else this.rules.RenderTitle||(this.graphicalMusicSheet.Title=void 0);if(void 0!==e.Subtitle&&this.rules.RenderSubtitle){const i=new f.GraphicalLabel(e.Subtitle,this.rules.SheetSubtitleHeight,p.TextAlignmentEnum.CenterCenter,this.rules);i.Label.IsCreditLabel=!0,i.Label.colorDefault=t,this.graphicalMusicSheet.Subtitle=i,i.setLabelPositionAndShapeBorders()}else this.rules.RenderSubtitle||(this.graphicalMusicSheet.Subtitle=void 0);if(void 0!==e.Composer&&this.rules.RenderComposer){const i=new f.GraphicalLabel(e.Composer,this.rules.SheetComposerHeight,p.TextAlignmentEnum.RightCenter,this.rules);i.Label.IsCreditLabel=!0,i.Label.colorDefault=t,this.graphicalMusicSheet.Composer=i,i.setLabelPositionAndShapeBorders()}else this.rules.RenderComposer||(this.graphicalMusicSheet.Composer=void 0);if(void 0!==e.Lyricist&&this.rules.RenderLyricist){const i=new f.GraphicalLabel(e.Lyricist,this.rules.SheetAuthorHeight,p.TextAlignmentEnum.LeftCenter,this.rules);i.Label.IsCreditLabel=!0,i.Label.colorDefault=t,this.graphicalMusicSheet.Lyricist=i,i.setLabelPositionAndShapeBorders()}else this.rules.RenderLyricist||(this.graphicalMusicSheet.Lyricist=void 0);if(void 0!==e.Copyright&&this.rules.RenderCopyright){const i=new f.GraphicalLabel(e.Copyright,this.rules.SheetCopyrightHeight,p.TextAlignmentEnum.CenterBottom,this.rules);i.Label.IsCreditLabel=!0,i.Label.colorDefault=t,this.graphicalMusicSheet.Copyright=i,i.setLabelPositionAndShapeBorders()}else this.rules.RenderCopyright||(this.graphicalMusicSheet.Copyright=void 0)}checkMeasuresForWholeRestNotes(){for(let e=0,t=this.musicSystems.length;e<t;++e){const t=this.musicSystems[e];for(let e=0,i=t.StaffLines.length;e<i;++e){const i=t.StaffLines[e];for(let e=0,t=i.Measures.length;e<t;++e){const t=i.Measures[e];if(1===t.staffEntries.length){const e=t.staffEntries[0];if(e.graphicalVoiceEntries.length>0&&1===e.graphicalVoiceEntries[0].notes.length){const i=e.graphicalVoiceEntries[0].notes[0];!i.sourceNote.Pitch&&new r.Fraction(1,2).lt(i.sourceNote.Length)&&this.layoutMeasureWithWholeRest(i,e,t)}}}}}}optimizeRestNotePlacement(e,t){if(0===e.graphicalVoiceEntries.length)return;const i=e.graphicalVoiceEntries[0].notes;if(0===i.length)return;const s=i[0],n=s.sourceNote.isRest();if(2===e.graphicalVoiceEntries.length){let t=!1;const i=e.graphicalVoiceEntries[1].notes;i.length>0&&(t=i[0].sourceNote.isRest()),n&&t?this.calculateTwoRestNotesPlacementWithCollisionDetection(e):(n||t)&&this.calculateRestNotePlacementWithCollisionDetectionFromGraphicalNote(e)}else if(n&&e!==t.staffEntries[0]&&e!==t.staffEntries[t.staffEntries.length-1]){const i=t.staffEntries.indexOf(e),n=t.staffEntries[i-1],r=t.staffEntries[i+1];if(1===n.graphicalVoiceEntries.length){const t=n.graphicalVoiceEntries[0].notes[0];if(void 0!==t.sourceNote.NoteBeam&&1===r.graphicalVoiceEntries.length){const i=r.graphicalVoiceEntries[0].notes[0];void 0!==i.sourceNote.NoteBeam&&t.sourceNote.NoteBeam===i.sourceNote.NoteBeam&&(this.calculateRestNotePlacementWithinGraphicalBeam(e,s,t,r,i),e.PositionAndShape.calculateBoundingBox())}}}}getRelativePositionInStaffLineFromTimestamp(e,t,i,s,n=0,o=!1){let a,l,u=new d.PointF2D;const c=this.graphicalMusicSheet.VerticalGraphicalStaffEntryContainers.length,h=this.graphicalMusicSheet.GetInterpolatedIndexInVerticalContainers(e),m=Math.min(Math.floor(h),c-1),f=Math.min(Math.ceil(h),c-1);if(m<0||t<0)return u;if(a=this.getFirstLeftNotNullStaffEntryFromContainer(m,t,s),l=this.getFirstRightNotNullStaffEntryFromContainer(f,t,s),a&&l){let t=a.parentMeasure.PositionAndShape.RelativePosition.x;n>0&&(t=n);let s=a.PositionAndShape.RelativePosition.x+t,c=l.PositionAndShape.RelativePosition.x+l.parentMeasure.PositionAndShape.RelativePosition.x;const h=e.RealValue>l.getAbsoluteTimestamp().RealValue;n>0?c=l.PositionAndShape.RelativePosition.x+t:o&&(a.getAbsoluteTimestamp().RealValue===e.RealValue||h)&&(s=a.PositionAndShape.RelativePosition.x+a.PositionAndShape.BorderLeft+t,c=s);let m=0;if(a!==l){const t=a.getAbsoluteTimestamp(),i=l.getAbsoluteTimestamp();m=r.Fraction.minus(e,t).RealValue/r.Fraction.minus(i,t).RealValue}a.parentMeasure.ParentStaffLine!==l.parentMeasure.ParentStaffLine&&(a.parentMeasure.ParentStaffLine===i?c=i.PositionAndShape.Size.width:s=i.PositionAndShape.RelativePosition.x),u=new d.PointF2D(s+(c-s)*m,0)}return u}getRelativeXPositionFromTimestamp(e){const t=this.graphicalMusicSheet.VerticalGraphicalStaffEntryContainers.length,i=this.graphicalMusicSheet.GetInterpolatedIndexInVerticalContainers(e),s=Math.max(0,Math.min(Math.round(i),t-1)),n=this.graphicalMusicSheet.VerticalGraphicalStaffEntryContainers[s].getFirstNonNullStaffEntry();return n.PositionAndShape.RelativePosition.x+n.parentMeasure.PositionAndShape.RelativePosition.x}calculatePageLabels(e){this.rules.RenderSingleHorizontalStaffline&&(e.PositionAndShape.calculateBoundingBox([a.GraphicalMeasure.name]),this.graphicalMusicSheet.ParentMusicSheet.pageWidth=e.PositionAndShape.Size.width);let t=10,i=-1;if(e.MusicSystems.length>0){const s=e.MusicSystems[0];t=s.PositionAndShape.RelativePosition.y+s.PositionAndShape.BorderTop;const n=e.MusicSystems[e.MusicSystems.length-1];i=n.PositionAndShape.RelativePosition.y+n.PositionAndShape.BorderBottom}const s=this.graphicalMusicSheet.Title;if(s&&this.rules.RenderTitle){s.PositionAndShape.Parent=e.PositionAndShape;const t=new d.PointF2D;t.x=this.graphicalMusicSheet.ParentMusicSheet.pageWidth/2,this.rules.RenderSingleHorizontalStaffline&&(t.x=Math.max(t.x,s.PositionAndShape.Size.width)),t.y=this.rules.TitleTopDistance+this.rules.SheetTitleHeight,s.PositionAndShape.RelativePosition=t,e.Labels.push(s)}if(this.graphicalMusicSheet.Subtitle&&this.rules.RenderTitle&&this.rules.RenderSubtitle){const t=this.graphicalMusicSheet.Subtitle;t.PositionAndShape.Parent=e.PositionAndShape;const i=new d.PointF2D;i.x=this.graphicalMusicSheet.ParentMusicSheet.pageWidth/2,this.rules.RenderSingleHorizontalStaffline&&(i.x=s.PositionAndShape.RelativePosition.x),i.y=this.rules.TitleTopDistance+this.rules.SheetTitleHeight+this.rules.SheetMinimumDistanceBetweenTitleAndSubtitle;const n=t.TextLines?.length;n>1&&(i.y+=t.PositionAndShape.BorderBottom*(n-1)/n),t.PositionAndShape.RelativePosition=i,e.Labels.push(t)}const n=this.graphicalMusicSheet.Composer;let r;if(n&&this.rules.RenderComposer){n.PositionAndShape.Parent=e.PositionAndShape,n.setLabelPositionAndShapeBorders();const i=new d.PointF2D;i.x=this.graphicalMusicSheet.ParentMusicSheet.pageWidth-this.rules.PageRightMargin,i.y=t,i.y-=this.rules.SystemComposerDistance;const s=n.TextLines?.length;s>1&&(i.y-=n.PositionAndShape.BorderBottom*(s-1)/s),r=i.y,n.PositionAndShape.RelativePosition=i,e.Labels.push(n)}const o=this.graphicalMusicSheet.Lyricist;if(o&&this.rules.RenderLyricist){o.PositionAndShape.Parent=e.PositionAndShape,o.setLabelPositionAndShapeBorders();const i=new d.PointF2D;i.x=this.rules.PageLeftMargin,i.y=t,i.y-=this.rules.SystemLyricistDistance,i.y+=o.PositionAndShape.BorderBottom,i.y=Math.min(i.y,r??Number.MAX_SAFE_INTEGER),o.PositionAndShape.RelativePosition=i,e.Labels.push(o)}const l=this.graphicalMusicSheet.Copyright;if(l&&this.rules.RenderCopyright){l.PositionAndShape.Parent=e.PositionAndShape,l.setLabelPositionAndShapeBorders();const t=new d.PointF2D;t.x=e.PositionAndShape.Size.width/2,t.y=i+this.rules.SheetCopyrightMargin,t.y-=l.PositionAndShape.BorderTop,l.PositionAndShape.RelativePosition=t,e.Labels.push(l)}this.rules.RenderSingleHorizontalStaffline&&(e.PositionAndShape.calculateBoundingBox([a.GraphicalMeasure.name]),this.graphicalMusicSheet.ParentMusicSheet.pageWidth=e.PositionAndShape.Size.width)}createGraphicalTies(){for(let e=0;e<this.graphicalMusicSheet.ParentMusicSheet.SourceMeasures.length;e++){const t=this.graphicalMusicSheet.ParentMusicSheet.SourceMeasures[e];for(let i=0;i<t.CompleteNumberOfStaves;i++)for(let s=0;s<t.VerticalSourceStaffEntryContainers.length;s++){const n=t.VerticalSourceStaffEntryContainers[s].StaffEntries[i];if(n){const t=this.graphicalMusicSheet.findGraphicalStaffEntryFromMeasureList(i,e,n);t&&(t.GraphicalTies.clear(),t.ties.clear());for(let s=0,r=n.VoiceEntries.length;s<r;++s){const r=n.VoiceEntries[s];for(let s=0,n=r.Notes.length;s<n;++s){const n=r.Notes[s];if(n.NoteTie){const s=n.NoteTie;if(n===n.NoteTie.Notes.last())continue;if(t)for(const e of t.GraphicalTies)e.Tie;this.handleTie(s,t,i,e)}}}this.setTieDirections(t)}}}}handleTie(e,t,i,s){if(!t)return;t.ties.push(e);let n,r,o,a=t;for(let t=1;t<e.Notes.length;t++)if(n=a.findTieGraphicalNoteFromNote(e.Notes[t-1]),r=this.graphicalMusicSheet.GetGraphicalFromSourceStaffEntry(e.Notes[t].ParentStaffEntry),r){if(o=r.findTieGraphicalNoteFromNote(e.Notes[t]),void 0!==n&&void 0!==o&&r){if(!n.sourceNote.PrintObject||!o.sourceNote.PrintObject)continue;const t=this.createGraphicalTie(e,a,r,n,o);a.GraphicalTies.push(t),this.staffEntriesWithGraphicalTies.indexOf(a)>=0&&this.staffEntriesWithGraphicalTies.push(a)}a=r}}setTieDirections(e){if(!e)return;const t=e.ties;if(1===t.length){const e=t[0];if(e.TieDirection===I.PlacementEnum.NotYetDefined){const t=e.Notes[0].ParentVoiceEntry.ParentVoice.VoiceId;2!==t&&6!==t||(e.TieDirection=I.PlacementEnum.Below)}}if(t.length>1){let e;for(const i of t){const t=i.Notes[0];(!e||t.Pitch.getHalfTone()>e.Pitch.getHalfTone())&&(e=t)}for(const i of t)i.TieDirection===I.PlacementEnum.NotYetDefined&&(i.Notes[0]===e?i.TieDirection=I.PlacementEnum.Above:i.TieDirection=I.PlacementEnum.Below)}}createAccidentalCalculators(){const e=[],t=this.graphicalMusicSheet.ParentMusicSheet.getFirstSourceMeasure();if(t)for(let i=0;i<t.CompleteNumberOfStaves;i++){const s=new b.AccidentalCalculator;if(e.push(s),s.Transpose=this.graphicalMusicSheet.ParentMusicSheet.Transpose,t.FirstInstructionsStaffEntries[i])for(let e=0,n=t.FirstInstructionsStaffEntries[i].Instructions.length;e<n;++e){const n=t.FirstInstructionsStaffEntries[i].Instructions[e];if(n instanceof S.KeyInstruction){const e=n;s.ActiveKeyInstruction=e}}}return e}calculateVerticalContainersList(){const e=this.graphicalMusicSheet.MeasureList[0].length;for(let t=0;t<this.graphicalMusicSheet.MeasureList.length;t++)for(let i=0;i<e;i++){const e=this.graphicalMusicSheet.MeasureList[t][i];if(e)for(let t=0,s=e.staffEntries.length;t<s;++t){const s=e.staffEntries[t],n=this.graphicalMusicSheet.getOrCreateVerticalContainer(s.getAbsoluteTimestamp());n&&(n.StaffEntries[i]=s,s.parentVerticalContainer=n)}}}setIndicesToVerticalGraphicalContainers(){for(let e=0;e<this.graphicalMusicSheet.VerticalGraphicalStaffEntryContainers.length;e++)this.graphicalMusicSheet.VerticalGraphicalStaffEntryContainers[e].Index=e}createGraphicalMeasuresForSourceMeasure(e,t,i,s,n){this.initGraphicalMeasuresCreation();const r=[],o=[],a=[],l=[];let u=!0;for(let c=0;c<e.CompleteNumberOfStaves;c++){const h=this.createGraphicalMeasure(e,a,o,t[c],n,s,i,c,l);u=u&&h.hasOnlyRests,r.push(h)}return e.allRests=u,e.VerticalMeasureList=r,r}createGraphicalMeasure(e,t,i,s,n,a,h,d,f){const p=this.graphicalMusicSheet.ParentMusicSheet.getStaffFromIndex(d);let g;if(n[d].ClefType===l.ClefEnum.TAB||p.isTab)p.isTab=!0,g=_.symbolFactory.createTabStaffMeasure(e,p);else if(e.multipleRestMeasures&&this.rules.RenderMultipleRestMeasures)g=_.symbolFactory.createMultiRestMeasure(e,p);else{if(e.multipleRestMeasureNumber>1)return;g=_.symbolFactory.createGraphicalMeasure(e,p)}if(g.hasError=e.getErrorInMeasure(d),e.FirstInstructionsStaffEntries[d])for(let t=0,i=e.FirstInstructionsStaffEntries[d].Instructions.length;t<i;++t){const i=e.FirstInstructionsStaffEntries[d].Instructions[t];if(i instanceof S.KeyInstruction){const e=S.KeyInstruction.copy(i),t=g.getTransposedHalftones();0!==t&&g.ParentStaff.ParentInstrument.MidiInstrumentId!==P.MidiInstrument.Percussion&&_.transposeCalculator&&_.transposeCalculator.transposeKey(e,t),s.ActiveKeyInstruction=e}}const y=[];for(let t=0,i=e.StaffLinkedExpressions[d].length;t<i;++t){const i=e.StaffLinkedExpressions[d][t];let s;if(i.OctaveShiftStart?s=i.OctaveShiftStart:i.OctaveShiftEnd&&(s=i.OctaveShiftEnd),s){y.push(i);const t=s;let n=t?.ParentEndMultiExpression?.AbsoluteTimestamp;t?.ParentEndMultiExpression||(n=r.Fraction.plus(e.AbsoluteTimestamp,e.Duration)),a[d]=new M.OctaveShiftParams(t,t.ParentStartMultiExpression.AbsoluteTimestamp,n)}}for(let r=0;r<e.VerticalSourceStaffEntryContainers.length;r++){const o=e.VerticalSourceStaffEntryContainers[r].StaffEntries[d];if(o){for(let e=0,t=o.Instructions.length;e<t;++e){const t=o.Instructions[e];t instanceof l.ClefInstruction&&n[d]?.ClefType!==l.ClefEnum.TAB&&(n[d]=t)}const e=_.symbolFactory.createStaffEntry(o,g);r<g.staffEntries.length?g.addGraphicalStaffEntryAtTimestamp(e):g.addGraphicalStaffEntry(e);const c=[];o.Link&&(o.findLinkedNotes(c),this.handleStaffEntryLink(e,f));let m=u.OctaveEnum.NONE;if(a[d]&&a[d].getAbsoluteStartTimestamp.lte(o.AbsoluteTimestamp)&&o.AbsoluteTimestamp.lte(a[d].getAbsoluteEndTimestamp)&&(m=a[d].getOpenOctaveShift.Type),m===u.OctaveEnum.NONE)for(const e of y){let t;if(e.OctaveShiftStart?t=e.OctaveShiftStart:e.OctaveShiftEnd&&(t=e.OctaveShiftEnd),t?.ParentStartMultiExpression?.AbsoluteTimestamp.lte(o.AbsoluteTimestamp)&&!t.ParentEndMultiExpression?.AbsoluteTimestamp.lt(o.AbsoluteTimestamp)){m=t.Type;break}}for(let r=0,a=o.VoiceEntries.length;r<a;++r){const a=o.VoiceEntries[r];m=this.handleVoiceEntry(a,e,s,h,n[d],t,i,m,d,c,o)}if(o.Instructions.length>0){const t=o.Instructions[0];_.symbolFactory.createInStaffClef(e,t)}this.rules.RenderChordSymbols&&o.ChordContainers?.length>0&&(o.ParentStaff.ParentInstrument.HasChordSymbols=!0,_.symbolFactory.createChordSymbols(o,e,s.ActiveKeyInstruction,this.graphicalMusicSheet.ParentMusicSheet.Transpose))}}if(s.doCalculationsAtEndOfMeasure(),e.LastInstructionsStaffEntries[d]){const t=e.LastInstructionsStaffEntries[d];for(let e=0,i=t.Instructions.length;e<i;++e){const i=t.Instructions[e];i instanceof l.ClefInstruction&&n[d]?.ClefType!==l.ClefEnum.TAB&&(n[d]=i)}}for(let t=0,i=e.StaffLinkedExpressions[d].length;t<i;++t){const i=e.StaffLinkedExpressions[d][t];void 0!==i.OctaveShiftEnd&&void 0!==a[d]&&i.OctaveShiftEnd===a[d].getOpenOctaveShift&&(a[d]=void 0)}for(const e of g.staffEntries)for(const t of e.graphicalVoiceEntries)this.setBeamNotesWantedStemDirections(t.parentVoiceEntry);if(this.rules.FillEmptyMeasuresWithWholeRest>=1&&0===g.staffEntries.length){const t=new m.SourceStaffEntry(new A.VerticalSourceStaffEntryContainer(g.parentSourceMeasure,g.parentSourceMeasure.AbsoluteTimestamp,g.parentSourceMeasure.CompleteNumberOfStaves),p);if(0===p.Voices.length){const e=new V.Voice(g.ParentStaff.ParentInstrument,-1);p.Voices.push(e)}const i=new c.VoiceEntry(new r.Fraction(0,1),p.Voices[0],t);let s=e.Duration;0===s.RealValue&&(s=e.ActiveTimeSignature.clone());const n=new o.Note(i,t,s,void 0,e,!0);n.IsWholeMeasureRest=!0,n.PrintObject=this.rules.FillEmptyMeasuresWithWholeRest===D.FillEmptyMeasuresWithWholeRests.YesVisible,i.Notes.push(n);const a=_.symbolFactory.createStaffEntry(t,g);g.addGraphicalStaffEntry(a),a.relInMeasureTimestamp=i.Timestamp;const h=_.symbolFactory.createVoiceEntry(i,a);a.graphicalVoiceEntries.push(h);const d=_.symbolFactory.createNote(n,h,new l.ClefInstruction,u.OctaveEnum.NONE,this.rules);_.stafflineNoteCalculator.trackNote(d),h.notes.push(d)}g.hasOnlyRests=!0;for(const e of g.staffEntries)if(g.hasOnlyRests=e.hasOnlyRests(),!g.hasOnlyRests)break;return g}checkNoteForAccidental(e,t,i,s){let n=e.sourceNote.Pitch;const r=e.parentVoiceEntry.parentStaffEntry.parentMeasure.getTransposedHalftones();0!==r&&e.sourceNote.ParentStaffEntry.ParentStaff.ParentInstrument.MidiInstrumentId!==P.MidiInstrument.Percussion&&(n=e.Transpose(t.ActiveKeyInstruction,i,r,s),e.sourceNote.TransposedPitch=n),e.sourceNote.halfTone=n.getHalfTone(),t.checkAccidental(e,n)}handleStaffEntries(e){for(let t=0,i=this.graphicalMusicSheet.MeasureList.length;t<i;++t){const i=this.graphicalMusicSheet.MeasureList[t];for(let t=0,s=i.length;t<s;++t){const s=i[t];if(s){this.rules.PercussionOneLineCutoff>0&&!this.rules.PercussionUseCajon2NoteSystem&&e[t]&&(-1===this.rules.PercussionOneLineCutoff||_.stafflineNoteCalculator.getStafflineUniquePositionCount(t)<this.rules.PercussionOneLineCutoff)&&(s.ParentStaff.StafflineCount=1);for(const e of s.staffEntries)void 0!==e.parentMeasure&&e.graphicalVoiceEntries.length>0&&e.graphicalVoiceEntries[0].notes.length>0&&(this.layoutVoiceEntries(e,t),this.layoutStaffEntry(e));this.graphicalMeasureCreatedCalculations(s)}}}}calculateSkyBottomLines(){}calculateExpressionAlignements(){}calculateStaffEntryArticulationMarks(){for(let e=0,t=this.musicSystems.length;e<t;++e){const t=this.musicSystems[e];for(let e=0,i=t.StaffLines.length;e<i;++e){const i=t.StaffLines[e];for(let e=0,t=i.Measures.length;e<t;++e){const t=i.Measures[e];for(let e=0,i=t.staffEntries.length;e<i;++e){const i=t.staffEntries[e];for(let e=0,t=i.sourceStaffEntry.VoiceEntries.length;e<t;++e){const t=i.sourceStaffEntry.VoiceEntries[e];t.Articulations.length>0&&this.layoutArticulationMarks(t.Articulations,t,i)}}}}}}calculateOrnaments(){for(let e=0,t=this.musicSystems.length;e<t;++e){const t=this.musicSystems[e];for(let e=0,i=t.StaffLines.length;e<i;++e){const i=t.StaffLines[e];for(let e=0,t=i.Measures.length;e<t;++e){const t=i.Measures[e];for(let e=0,i=t.staffEntries.length;e<i;++e){const i=t.staffEntries[e];for(let e=0,t=i.sourceStaffEntry.VoiceEntries.length;e<t;++e){const t=i.sourceStaffEntry.VoiceEntries[e];if(t.OrnamentContainer){if(t.hasTie()&&!i.relInMeasureTimestamp.Equals(t.Timestamp))continue;this.layoutOrnament(t.OrnamentContainer,t,i),-1===this.staffEntriesWithOrnaments.indexOf(i)&&this.staffEntriesWithOrnaments.push(i)}}}}}}}getFingeringPlacement(e){let t=this.rules.FingeringPosition;return t!==I.PlacementEnum.NotYetDefined&&t!==I.PlacementEnum.AboveOrBelow||(t=e.isUpperStaffOfInstrument()?I.PlacementEnum.Above:I.PlacementEnum.Below),t}calculateFingerings(){if(this.rules.FingeringPosition!==I.PlacementEnum.Left&&this.rules.FingeringPosition!==I.PlacementEnum.Right)for(const e of this.musicSystems)for(const t of e.StaffLines)for(const e of t.Measures){if(e.isTabMeasure&&!this.rules.TabFingeringsRendered)continue;const i=this.getFingeringPlacement(e);for(const s of e.staffEntries){s.FingeringEntries=[];const n=t.SkyBottomLineCalculator,r=s.PositionAndShape.RelativePosition.x+e.PositionAndShape.RelativePosition.x,o=[];for(const e of s.graphicalVoiceEntries)if(!e.parentVoiceEntry.IsGrace)for(const t of e.parentVoiceEntry.TechnicalInstructions)t.type===g.TechnicalInstructionType.Fingering&&o.push(t);if(o.length>0){let e;i===I.PlacementEnum.Below&&o.reverse();for(const t of s.graphicalVoiceEntries)for(const i of t.notes)(!e||i.sourceNote.Pitch?.getHalfTone()>e.Pitch?.getHalfTone())&&(e=i.sourceNote);o[0].sourceNote===e&&i===I.PlacementEnum.Above&&o.reverse()}for(let e=0;e<o.length;e++){const a=o[e],l=i===I.PlacementEnum.Above?p.TextAlignmentEnum.CenterBottom:p.TextAlignmentEnum.CenterTop,u=new x.Label(a.value,l),c=new f.GraphicalLabel(u,this.rules.FingeringTextSize,u.textAlignment,this.rules,t.PositionAndShape);a.fontFamily&&(u.fontFamily=a.fontFamily);const h=r+c.PositionAndShape.BorderMarginLeft,d=r+c.PositionAndShape.BorderMarginRight;let m;m=i===I.PlacementEnum.Above?n.getSkyLineMinInRange(h,d):n.getBottomLineMaxInRange(h,d);let S=0;0===e?(S+=this.rules.FingeringOffsetY,i===I.PlacementEnum.Above&&(S+=.1)):S+=this.rules.FingeringPaddingY,i===I.PlacementEnum.Above&&(S*=-1),c.PositionAndShape.RelativePosition.y+=m+S,c.PositionAndShape.RelativePosition.x=r,c.setLabelPositionAndShapeBorders(),c.PositionAndShape.calculateBoundingBox(),s.FingeringEntries.push(c);const g=c.PositionAndShape.RelativePosition.x+c.PositionAndShape.BorderLeft,y=g-c.PositionAndShape.BorderLeft+c.PositionAndShape.BorderRight;i===I.PlacementEnum.Above?n.updateSkyLineInRange(g,y,c.PositionAndShape.RelativePosition.y+c.PositionAndShape.BorderTop):i===I.PlacementEnum.Below&&n.updateBottomLineInRange(g,y,c.PositionAndShape.RelativePosition.y+c.PositionAndShape.BorderBottom)}}}}optimizeRestPlacement(){for(let e=0,t=this.musicSystems.length;e<t;++e){const t=this.musicSystems[e];for(let e=0,i=t.StaffLines.length;e<i;++e){const i=t.StaffLines[e];for(let e=0,t=i.Measures.length;e<t;++e){const t=i.Measures[e];for(let e=0,i=t.staffEntries.length;e<i;++e){const i=t.staffEntries[e];this.optimizeRestNotePlacement(i,t)}}}}}calculateTwoRestNotesPlacementWithCollisionDetection(e){const t=e.graphicalVoiceEntries[0].notes[0],i=e.graphicalVoiceEntries[1].notes[0];i.PositionAndShape.RelativePosition=new d.PointF2D(0,2.5),e.PositionAndShape.calculateAbsolutePositionsRecursiveWithoutTopelement(),t.PositionAndShape.computeNonOverlappingPositionWithMargin(e.PositionAndShape,E.ColDirEnum.Up,new d.PointF2D(0,i.PositionAndShape.RelativePosition.y));const s=t.PositionAndShape.RelativePosition;s.y-=1,t.PositionAndShape.RelativePosition=s,e.PositionAndShape.calculateBoundingBox()}calculateRestNotePlacementWithCollisionDetectionFromGraphicalNote(e){let t,i;e.graphicalVoiceEntries[0].notes[0].sourceNote.isRest()?(t=e.graphicalVoiceEntries[0].notes[0],i=e.graphicalVoiceEntries[1].notes):(i=e.graphicalVoiceEntries[0].notes,t=e.graphicalVoiceEntries[1].notes[0]);let s=!1;e.PositionAndShape.calculateAbsolutePositionsRecursiveWithoutTopelement();for(let e=0,n=i.length;e<n;++e){const n=i[e];if(t.PositionAndShape.marginCollisionDetection(n.PositionAndShape)){s=!0;break}}if(s)if(t.sourceNote.ParentVoiceEntry.ParentVoice instanceof y.LinkedVoice){const e=i[0].PositionAndShape.BorderMarginBottom+i[0].PositionAndShape.RelativePosition.y;t.PositionAndShape.RelativePosition=new d.PointF2D(0,e-t.PositionAndShape.BorderMarginTop+.5)}else{const e=i[i.length-1],s=e.PositionAndShape.BorderMarginTop+e.PositionAndShape.RelativePosition.y;if(i[0].sourceNote.ParentVoiceEntry.ParentVoice instanceof y.LinkedVoice)t.PositionAndShape.RelativePosition=new d.PointF2D(0,s-t.PositionAndShape.BorderMarginBottom-.5);else{const e=i[0].PositionAndShape.BorderMarginBottom+i[0].PositionAndShape.RelativePosition.y;t.PositionAndShape.RelativePosition=e<2?new d.PointF2D(0,e-t.PositionAndShape.BorderMarginTop+.5):new d.PointF2D(0,s-t.PositionAndShape.BorderMarginBottom-0)}}e.PositionAndShape.calculateBoundingBox()}calculateTieCurves(){for(const e of this.musicSystems)for(const t of e.StaffLines)for(const e of t.Measures)for(const t of e.staffEntries)for(const i of t.GraphicalTies)if(void 0!==i.StartNote&&i.StartNote.parentVoiceEntry.parentStaffEntry===t){const t=i.StartNote.parentVoiceEntry.parentStaffEntry.parentMeasure.ParentStaffLine!==i.EndNote.parentVoiceEntry.parentStaffEntry.parentMeasure.ParentStaffLine;this.layoutGraphicalTie(i,t,e.ParentStaff.isTab)}}calculateLyricsPosition(){const e=new v.Dictionary;for(let e=0,t=this.graphicalMusicSheet.ParentMusicSheet.Instruments.length;e<t;++e){const t=this.graphicalMusicSheet.ParentMusicSheet.Instruments[e];t.HasLyrics&&t.LyricVersesNumbers.length>0&&t.LyricVersesNumbers.sort()}for(let t=0,i=this.musicSystems.length;t<i;++t){const i=this.musicSystems[t];for(let t=0,s=i.StaffLines.length;t<s;++t){const s=i.StaffLines[t],n=this.calculateSingleStaffLineLyricsPosition(s,s.ParentStaff.ParentInstrument.LyricVersesNumbers);e.setValue(s,n),this.calculateLyricsExtendsAndDashes(e.getValue(s))}}for(let t=0,i=this.musicSystems.length;t<i;++t){const i=this.musicSystems[t];for(let t=0,s=i.StaffLines.length;t<s;++t){const s=i.StaffLines[t];this.calculateLyricsExtendsAndDashes(e.getValue(s))}}}calculateSingleLyricWord(e){const t=e.ParentLyricWord,i=t.GraphicalLyricsEntries.indexOf(e);let s;if(i>=0&&(s=t.GraphicalLyricsEntries[i+1]),!s)return;const n=e.StaffEntryParent.parentMeasure.ParentStaffLine,r=s.StaffEntryParent.parentMeasure.ParentStaffLine,o=e.StaffEntryParent,a=s.StaffEntryParent;if(e.StaffEntryParent.parentMeasure.ParentStaffLine===s.StaffEntryParent.parentMeasure.ParentStaffLine){const t=o.parentMeasure.PositionAndShape.RelativePosition.x+o.PositionAndShape.RelativePosition.x+e.GraphicalLabel.PositionAndShape.RelativePosition.x+e.GraphicalLabel.PositionAndShape.BorderMarginRight-e.GraphicalLabel.CenteringXShift,i=a.parentMeasure.PositionAndShape.RelativePosition.x+a.PositionAndShape.RelativePosition.x+e.GraphicalLabel.PositionAndShape.RelativePosition.x+s.GraphicalLabel.PositionAndShape.BorderMarginLeft,r=e.GraphicalLabel.PositionAndShape.RelativePosition.y;let l=1;i-t>3*this.rules.MinimumDistanceBetweenDashes&&(l=Math.floor((i-t)/this.rules.MinimumDistanceBetweenDashes)-1),1===l?this.calculateSingleDashForLyricWord(n,t,i,r):this.calculateDashes(n,t,i,r)}else{const t=o.parentMeasure.PositionAndShape.RelativePosition.x+o.PositionAndShape.RelativePosition.x+e.GraphicalLabel.PositionAndShape.BorderMarginRight,i=n.Measures[n.Measures.length-1],l=i.PositionAndShape.RelativePosition.x+i.PositionAndShape.Size.width;let u=e.GraphicalLabel.PositionAndShape.RelativePosition.y;if(this.calculateDashes(n,t,l,u),r&&r.Measures[0]&&a.parentMeasure.ParentStaffLine&&(a!==a.parentMeasure.staffEntries[0]||a.parentMeasure!==a.parentMeasure.ParentStaffLine.Measures[0])){const e=r.Measures[0].staffEntries[0].PositionAndShape.RelativePosition.x,t=a.parentMeasure.PositionAndShape.RelativePosition.x+a.PositionAndShape.RelativePosition.x+s.GraphicalLabel.PositionAndShape.BorderMarginLeft;u=s.GraphicalLabel.PositionAndShape.RelativePosition.y,this.calculateDashes(r,e,t,u)}}}calculateDashes(e,t,i,s){let n=i-t;if(n<3*this.rules.MinimumDistanceBetweenDashes)this.calculateSingleDashForLyricWord(e,t,i,s);else{const r=Math.floor(n/this.rules.MinimumDistanceBetweenDashes)-1,o=n/(r+1);let a=0;for(t+=o,i-=o;a<=Math.floor(r/2)&&i>t;)n=this.calculateRightAndLeftDashesForLyricWord(e,t,i,s),t+=o,i-=o,a++;n>2*o&&this.calculateSingleDashForLyricWord(e,t,i,s)}}calculateSingleDashForLyricWord(e,t,i,s){const n=new x.Label("-");n.colorDefault=this.rules.DefaultColorLyrics;let r=this.rules.LyricsHeight;i-t<.8&&(r*=.8,s-=.1*r);const o=new f.GraphicalLabel(n,r,p.TextAlignmentEnum.CenterBottom,this.rules);o.setLabelPositionAndShapeBorders(),e.LyricsDashes.push(o),-1===this.staffLinesWithLyricWords.indexOf(e)&&this.staffLinesWithLyricWords.push(e),o.PositionAndShape.Parent=e.PositionAndShape;const a=new d.PointF2D(t+(i-t)/2,s);o.PositionAndShape.RelativePosition=a}calculateLyricExtend(e){let t=e.GraphicalLabel.PositionAndShape.RelativePosition.y;const i=e.StaffEntryParent,s=i.parentMeasure.ParentStaffLine;let n,r;const o=i.parentMeasure.ParentStaff.idInMusicSheet;for(let e=i.parentVerticalContainer.Index+1;e<this.graphicalMusicSheet.VerticalGraphicalStaffEntryContainers.length;++e){const t=this.graphicalMusicSheet.VerticalGraphicalStaffEntryContainers[e].StaffEntries[o];if(t){if(t.hasOnlyRests())break;if(t.LyricsEntries.length>0)break;n=t,r=n.parentMeasure.ParentStaffLine,r||(r=i.parentMeasure.ParentStaffLine)}}if(n&&r)if(s===r&&n.parentMeasure.ParentStaffLine){const r=i.parentMeasure.PositionAndShape.RelativePosition.x+i.PositionAndShape.RelativePosition.x+e.GraphicalLabel.PositionAndShape.BorderMarginRight,o=n.parentMeasure.PositionAndShape.RelativePosition.x+n.PositionAndShape.RelativePosition.x+n.PositionAndShape.BorderMarginRight;t-=e.GraphicalLabel.PositionAndShape.Size.height/4,this.calculateSingleLyricWordWithUnderscore(s,r,o,t)}else{const o=s.Measures[s.Measures.length-1].PositionAndShape,a=i.parentMeasure.PositionAndShape.RelativePosition.x+i.PositionAndShape.RelativePosition.x+e.GraphicalLabel.PositionAndShape.BorderMarginRight,l=o.RelativePosition.x+o.Size.width;if(t-=e.GraphicalLabel.PositionAndShape.Size.height/4,this.calculateSingleLyricWordWithUnderscore(s,a,l,t),!n)return;if(n.parentMeasure.ParentStaffLine&&n.parentMeasure.staffEntries&&(n!==n.parentMeasure.staffEntries[0]||n.parentMeasure!==n.parentMeasure.ParentStaffLine.Measures[0])){const e=r.Measures[0].staffEntries[0].PositionAndShape.RelativePosition.x,i=n.parentMeasure.PositionAndShape.RelativePosition.x+n.PositionAndShape.RelativePosition.x+n.PositionAndShape.BorderMarginRight;this.calculateSingleLyricWordWithUnderscore(r,e,i,t)}}}calculateSingleLyricWordWithUnderscore(e,t,i,s){const n=new d.PointF2D(t,s),r=new d.PointF2D(i,s),o=new T.GraphicalLine(n,r,this.rules.LyricUnderscoreLineWidth);o.colorHex=this.rules.DefaultColorLyrics,e.LyricLines.push(o),-1===this.staffLinesWithLyricWords.indexOf(e)&&this.staffLinesWithLyricWords.push(e)}calculateRightAndLeftDashesForLyricWord(e,t,i,s){const n=new x.Label("-");n.colorDefault=this.rules.DefaultColorLyrics;const r=new f.GraphicalLabel(n,this.rules.LyricsHeight,p.TextAlignmentEnum.CenterBottom,this.rules);r.setLabelPositionAndShapeBorders(),e.LyricsDashes.push(r),-1===this.staffLinesWithLyricWords.indexOf(e)&&this.staffLinesWithLyricWords.push(e),r.PositionAndShape.Parent=e.PositionAndShape;const o=new d.PointF2D(t,s);r.PositionAndShape.RelativePosition=o;const a=new x.Label("-"),l=new f.GraphicalLabel(a,this.rules.LyricsHeight,p.TextAlignmentEnum.CenterBottom,this.rules);l.setLabelPositionAndShapeBorders(),e.LyricsDashes.push(l),l.PositionAndShape.Parent=e.PositionAndShape;const u=new d.PointF2D(i,s);return l.PositionAndShape.RelativePosition=u,l.PositionAndShape.RelativePosition.x-r.PositionAndShape.RelativePosition.x}calculateDynamicExpressions(){const e=Math.min(this.graphicalMusicSheet.ParentMusicSheet.SourceMeasures.length-1,this.rules.MaxMeasureToDrawIndex);for(let t=Math.min(this.rules.MinMeasureToDrawIndex,this.graphicalMusicSheet.ParentMusicSheet.SourceMeasures.length);t<=e;t++){const e=this.graphicalMusicSheet.ParentMusicSheet.SourceMeasures[t];this.dynamicExpressionMap.clear();for(let i=0;i<e.StaffLinkedExpressions.length;i++)if(this.graphicalMusicSheet.MeasureList[t]&&this.graphicalMusicSheet.MeasureList[t][i]&&this.graphicalMusicSheet.MeasureList[t][i].ParentStaff.isVisible())for(let s=0;s<e.StaffLinkedExpressions[i].length;s++)(void 0!==e.StaffLinkedExpressions[i][s].InstantaneousDynamic||void 0!==e.StaffLinkedExpressions[i][s].StartingContinuousDynamic&&e.StaffLinkedExpressions[i][s].StartingContinuousDynamic.StartMultiExpression===e.StaffLinkedExpressions[i][s]&&0===e.StaffLinkedExpressions[i][s].UnknownList.length)&&this.calculateDynamicExpressionsForMultiExpression(e.StaffLinkedExpressions[i][s],t,i)}this.dynamicExpressionMap.clear()}calculateOctaveShifts(){for(let e=0;e<this.graphicalMusicSheet.ParentMusicSheet.SourceMeasures.length;e++){const t=this.graphicalMusicSheet.ParentMusicSheet.SourceMeasures[e];for(let i=0;i<t.StaffLinkedExpressions.length;i++)if(this.graphicalMusicSheet.MeasureList[e]&&this.graphicalMusicSheet.MeasureList[e][i]&&this.graphicalMusicSheet.MeasureList[e][i].ParentStaff.isVisible())for(let s=0;s<t.StaffLinkedExpressions[i].length;s++)t.StaffLinkedExpressions[i][s].OctaveShiftStart&&this.calculateSingleOctaveShift(t,t.StaffLinkedExpressions[i][s],e,i)}}calculatePedals(){for(let e=0;e<this.graphicalMusicSheet.ParentMusicSheet.SourceMeasures.length;e++){const t=this.graphicalMusicSheet.ParentMusicSheet.SourceMeasures[e];for(let i=0;i<t.StaffLinkedExpressions.length;i++)if(this.graphicalMusicSheet.MeasureList[e]&&this.graphicalMusicSheet.MeasureList[e][i]&&this.graphicalMusicSheet.MeasureList[e][i].ParentStaff.isVisible())for(let s=0;s<t.StaffLinkedExpressions[i].length;s++)t.StaffLinkedExpressions[i][s].PedalStart&&this.calculateSinglePedal(t,t.StaffLinkedExpressions[i][s],e,i)}}getFirstLeftNotNullStaffEntryFromContainer(e,t,i){if(this.graphicalMusicSheet.VerticalGraphicalStaffEntryContainers[e].StaffEntries[t])return this.graphicalMusicSheet.VerticalGraphicalStaffEntryContainers[e].StaffEntries[t];for(let i=e-1;i>=0;i--)if(this.graphicalMusicSheet.VerticalGraphicalStaffEntryContainers[i].StaffEntries[t])return this.graphicalMusicSheet.VerticalGraphicalStaffEntryContainers[i].StaffEntries[t]}getFirstRightNotNullStaffEntryFromContainer(e,t,i){if(this.graphicalMusicSheet.VerticalGraphicalStaffEntryContainers[e].StaffEntries[t])return this.graphicalMusicSheet.VerticalGraphicalStaffEntryContainers[e].StaffEntries[t];for(let i=e+1;i<this.graphicalMusicSheet.VerticalGraphicalStaffEntryContainers.length;i++)if(this.graphicalMusicSheet.VerticalGraphicalStaffEntryContainers[i].StaffEntries[t])return this.graphicalMusicSheet.VerticalGraphicalStaffEntryContainers[i].StaffEntries[t]}calculateWordRepetitionInstructions(){for(let e=0;e<this.graphicalMusicSheet.ParentMusicSheet.SourceMeasures.length;e++){const t=this.graphicalMusicSheet.ParentMusicSheet.SourceMeasures[e];for(let i=0,s=t.FirstRepetitionInstructions.length;i<s;++i){const s=t.FirstRepetitionInstructions[i];this.calculateWordRepetitionInstruction(s,e)}for(let i=0,s=t.LastRepetitionInstructions.length;i<s;++i){const s=t.LastRepetitionInstructions[i];this.calculateWordRepetitionInstruction(s,e)}}}calculateRepetitionEndings(){const e=this.graphicalMusicSheet.ParentMusicSheet;for(let t=0,i=e.Repetitions.length;t<i;++t){const i=e.Repetitions[t];this.calcGraphicalRepetitionEndingsRecursively(i)}}calculateTempoExpressions(){const e=Math.min(this.graphicalMusicSheet.ParentMusicSheet.SourceMeasures.length-1,this.rules.MaxMeasureToDrawIndex);for(let t=this.rules.MinMeasureToDrawIndex;t<=e;t++){const e=this.graphicalMusicSheet.ParentMusicSheet.SourceMeasures[t];for(let i=0;i<e.TempoExpressions.length;i++)this.calculateTempoExpressionsForMultiTempoExpression(e,e.TempoExpressions[i],t)}}calculateRehearsalMarks(){if(this.rules.RenderRehearsalMarks)for(const e of this.graphicalMusicSheet.ParentMusicSheet.SourceMeasures)this.calculateRehearsalMark(e)}calculateRehearsalMark(e){throw new Error(this.abstractNotImplementedErrorMessage)}calculateMoodAndUnknownExpressions(){for(let e=0;e<this.graphicalMusicSheet.ParentMusicSheet.SourceMeasures.length;e++){const t=this.graphicalMusicSheet.ParentMusicSheet.SourceMeasures[e];for(let i=0;i<t.StaffLinkedExpressions.length;i++)if(this.graphicalMusicSheet.MeasureList[e]&&this.graphicalMusicSheet.MeasureList[e][i]&&this.graphicalMusicSheet.MeasureList[e][i].ParentStaff.isVisible())for(let s=0;s<t.StaffLinkedExpressions[i].length;s++)(t.StaffLinkedExpressions[i][s].MoodList.length>0||t.StaffLinkedExpressions[i][s].UnknownList.length>0)&&this.calculateMoodAndUnknownExpression(t.StaffLinkedExpressions[i][s],e,i)}}calculateStemDirectionFromVoices(e){if(void 0!==e.ParentSourceStaffEntry.Link)return e===e.ParentSourceStaffEntry.VoiceEntries[0]?void(e.WantedStemDirection=c.StemDirectionType.Up):void(e.WantedStemDirection=c.StemDirectionType.Down);e.ParentVoice instanceof y.LinkedVoice?e.WantedStemDirection=c.StemDirectionType.Down:e.ParentSourceStaffEntry.VoiceEntries.length>1&&(e.WantedStemDirection=c.StemDirectionType.Up)}setBeamNotesWantedStemDirections(e){if(!(e.Notes.length>0))return;const t=e.Notes[0].NoteBeam;if(t)for(const i of t.Notes)if(i.ParentVoiceEntry.WantedStemDirection!==c.StemDirectionType.Undefined&&i.ParentVoiceEntry.ParentSourceStaffEntry.ParentStaff.Id===e.ParentSourceStaffEntry.ParentStaff.Id){e.WantedStemDirection=i.ParentVoiceEntry.WantedStemDirection;break}}}t.MusicSheetCalculator=_},8033:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.OctaveShiftParams=void 0,t.OctaveShiftParams=class{constructor(e,t,i){this.getOpenOctaveShift=e,this.getAbsoluteStartTimestamp=t,this.getAbsoluteEndTimestamp=i}}},8045:function(e,t,i){var s=this&&this.__createBinding||(Object.create?function(e,t,i,s){void 0===s&&(s=i);var n=Object.getOwnPropertyDescriptor(t,i);n&&!("get"in n?!t.__esModule:n.writable||n.configurable)||(n={enumerable:!0,get:function(){return t[i]}}),Object.defineProperty(e,s,n)}:function(e,t,i,s){void 0===s&&(s=i),e[s]=t[i]}),n=this&&this.__exportStar||function(e,t){for(var i in e)"default"===i||Object.prototype.hasOwnProperty.call(t,i)||s(t,e,i)};Object.defineProperty(t,"__esModule",{value:!0}),n(i(5875),t),n(i(2221),t),n(i(437),t),n(i(6229),t)},8215:(e,t,i)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.OrnamentEnum=t.OrnamentContainer=void 0;const s=i(8233),n=i(6362);var r;t.OrnamentContainer=class{constructor(e){this.placement=n.PlacementEnum.Above,this.accidentalAbove=s.AccidentalEnum.NONE,this.accidentalBelow=s.AccidentalEnum.NONE,this.ornament=e}get GetOrnament(){return this.ornament}get AccidentalAbove(){return this.accidentalAbove}set AccidentalAbove(e){this.accidentalAbove=e}get AccidentalBelow(){return this.accidentalBelow}set AccidentalBelow(e){this.accidentalBelow=e}},function(e){e[e.Trill=0]="Trill",e[e.Turn=1]="Turn",e[e.InvertedTurn=2]="InvertedTurn",e[e.DelayedTurn=3]="DelayedTurn",e[e.DelayedInvertedTurn=4]="DelayedInvertedTurn",e[e.Mordent=5]="Mordent",e[e.InvertedMordent=6]="InvertedMordent"}(r||(t.OrnamentEnum=r={}))},8233:(e,t)=>{var i,s;Object.defineProperty(t,"__esModule",{value:!0}),t.Pitch=t.AccidentalEnum=t.NoteEnum=void 0,function(e){e[e.C=0]="C",e[e.D=2]="D",e[e.E=4]="E",e[e.F=5]="F",e[e.G=7]="G",e[e.A=9]="A",e[e.B=11]="B"}(i||(t.NoteEnum=i={})),function(e){e[e.SHARP=0]="SHARP",e[e.FLAT=1]="FLAT",e[e.NONE=2]="NONE",e[e.NATURAL=3]="NATURAL",e[e.DOUBLESHARP=4]="DOUBLESHARP",e[e.DOUBLEFLAT=5]="DOUBLEFLAT",e[e.TRIPLESHARP=6]="TRIPLESHARP",e[e.TRIPLEFLAT=7]="TRIPLEFLAT",e[e.QUARTERTONESHARP=8]="QUARTERTONESHARP",e[e.QUARTERTONEFLAT=9]="QUARTERTONEFLAT",e[e.SLASHFLAT=10]="SLASHFLAT",e[e.THREEQUARTERSSHARP=11]="THREEQUARTERSSHARP",e[e.THREEQUARTERSFLAT=12]="THREEQUARTERSFLAT",e[e.SLASHQUARTERSHARP=13]="SLASHQUARTERSHARP",e[e.SLASHSHARP=14]="SLASHSHARP",e[e.DOUBLESLASHFLAT=15]="DOUBLESLASHFLAT",e[e.SORI=16]="SORI",e[e.KORON=17]="KORON"}(s||(t.AccidentalEnum=s={}));class n{static getNoteEnumString(e){switch(e){case i.C:return"C";case i.D:return"D";case i.E:return"E";case i.F:return"F";case i.G:return"G";case i.A:return"A";case i.B:return"B";default:return""}}static lineShiftFromNoteEnum(e,t){if(0===t)return[e,0];const i=n.pitchEnumValues,s=i.indexOf(e);let r=0,o=(s+t)%i.length;return s+t>i.length-1&&(r=1),o<0&&(o=i.length+o,r=-1),[i[o],r]}static CalculateTransposedHalfTone(e,t){const i=e.fundamentalNote+e.AccidentalHalfTones+t;return n.WrapAroundCheck(i,12)}static WrapAroundCheck(e,t){let i=0;for(;e<0;)e+=t,i--;for(;e>=t;)e-=t,i++;return{overflow:i,halftone:e}}static calcFrequency(e){let t,s=0;if(e instanceof n){const n=e;s=n.octave-1,t=n.fundamentalNote-i.A+n.AccidentalHalfTones}else"number"==typeof e&&(t=e-57);return 440*Math.pow(2,s)*Math.pow(2,t/12)}static calcFractionalKey(e){return Math.log(e/440)/Math.LN10*n.halftoneFactor+57}static fromFrequency(e){const t=n.calcFractionalKey(e)+.5,i=Math.floor(t/12)-n.octXmlDiff,r=Math.floor(t)%12;let o=r,a=s.NONE;return-1===this.pitchEnumValues.indexOf(o)&&(o=r-1,a=s.SHARP),new n(o,i,a)}static fromHalftone(e){const t=Math.floor(e/12)-n.octXmlDiff,i=e%12;let r=i,o=s.NONE;return-1===this.pitchEnumValues.indexOf(r)&&(r=i-1,o=s.SHARP),new n(r,t,o)}static ceiling(e){let t=e%=12;return-1===this.pitchEnumValues.indexOf(t)&&(t=e+1),t}static floor(e){let t=e%=12;return-1===this.pitchEnumValues.indexOf(t)&&(t=e-1),t}constructor(e,t,i,r=void 0,o=!1,a=void 0){this.accidental=s.NONE,this.fundamentalNote=e,this.octave=t,this.accidental=i,this.accidentalXml=r,this.halfTone=e+12*(t+n.octXmlDiff)+n.HalfTonesFromAccidental(i),o||(this.frequency=n.calcFrequency(this)),this.OctaveShiftApplied=a}static HalfTonesFromAccidental(e){switch(e){case s.NONE:return 0;case s.SHARP:return 1;case s.FLAT:return-1;case s.NATURAL:return 0;case s.DOUBLESHARP:return 2;case s.DOUBLEFLAT:return-2;case s.TRIPLESHARP:return 3;case s.TRIPLEFLAT:return-3;case s.QUARTERTONESHARP:return.5;case s.QUARTERTONEFLAT:return-.5;case s.SLASHFLAT:return-.51;case s.THREEQUARTERSSHARP:return 1.5;case s.THREEQUARTERSFLAT:return-1.5;case s.SLASHQUARTERSHARP:return.0013;case s.SLASHSHARP:return.0014;case s.DOUBLESLASHFLAT:return-.0015;case s.SORI:return.0016;case s.KORON:return.0017;default:throw new Error("Unhandled AccidentalEnum value")}}static AccidentalFromHalfTones(e){switch(e){case 0:return s.NONE;case 1:return s.SHARP;case-1:return s.FLAT;case 2:return s.DOUBLESHARP;case-2:return s.DOUBLEFLAT;case 3:return s.TRIPLESHARP;case-3:return s.TRIPLEFLAT;case.5:return s.QUARTERTONESHARP;case-.5:return s.QUARTERTONEFLAT;case 1.5:return s.THREEQUARTERSSHARP;case-1.5:return s.THREEQUARTERSFLAT;default:return e>0&&e<1?s.QUARTERTONESHARP:e<0&&e>-1?s.QUARTERTONEFLAT:s.QUARTERTONESHARP}}static accidentalVexflow(e){let t;switch(e){case s.NATURAL:t="n";break;case s.FLAT:t="b";break;case s.SHARP:t="#";break;case s.DOUBLESHARP:t="##";break;case s.TRIPLESHARP:t="###";break;case s.DOUBLEFLAT:t="bb";break;case s.TRIPLEFLAT:t="bbs";break;case s.QUARTERTONESHARP:t="+";break;case s.QUARTERTONEFLAT:t="d";break;case s.SLASHFLAT:t="bs";break;case s.THREEQUARTERSSHARP:t="++";break;case s.THREEQUARTERSFLAT:t="db";break;case s.SLASHQUARTERSHARP:t="+-";break;case s.SLASHSHARP:t="++-";break;case s.DOUBLESLASHFLAT:t="bss";break;case s.SORI:t="o";break;case s.KORON:t="k"}return t}get AccidentalHalfTones(){return n.HalfTonesFromAccidental(this.accidental)}get Octave(){return this.octave}get FundamentalNote(){return this.fundamentalNote}get Accidental(){return this.accidental}get AccidentalXml(){return this.accidentalXml}get Frequency(){return this.frequency}static get OctaveXmlDifference(){return n.octXmlDiff}getHalfTone(){return this.halfTone}getTransposedPitch(e){if(e>12)throw new Error("rewrite this method to handle bigger octave changes or don't use is with bigger octave changes!");return e>0?this.getHigherPitchByTransposeFactor(e):e<0?this.getLowerPitchByTransposeFactor(-e):this}DoEnharmonicChange(){switch(this.accidental){case s.FLAT:case s.DOUBLEFLAT:this.fundamentalNote=this.getPreviousFundamentalNote(this.fundamentalNote),this.accidental=n.AccidentalFromHalfTones(this.halfTone-(this.fundamentalNote+12*(this.octave+n.octXmlDiff)));break;case s.SHARP:case s.DOUBLESHARP:this.fundamentalNote=this.getNextFundamentalNote(this.fundamentalNote),this.accidental=n.AccidentalFromHalfTones(this.halfTone-(this.fundamentalNote+12*(this.octave+n.octXmlDiff)));break;default:return}}ToString(){let e=n.accidentalVexflow(this.accidental);return e||(e=""),"Key: "+n.getNoteEnumString(this.fundamentalNote)+e+", Note: "+this.fundamentalNote+", octave: "+this.octave.toString()}ToStringShort(e=0){let t=n.accidentalVexflow(this.accidental);t||(t="");const i=this.octave+e;return n.getNoteEnumString(this.fundamentalNote)+t+i}get ToStringShortGet(){return this.ToStringShort(0)}OperatorEquals(e){const t=this;return!(!t||!e)&&t.FundamentalNote===e.FundamentalNote&&t.Octave===e.Octave&&t.Accidental===e.Accidental}OperatorNotEqual(e){return!(this===e)}OperatorFundamentalGreaterThan(e){const t=this;return t.Octave===e.Octave?t.FundamentalNote>e.FundamentalNote:t.Octave>e.Octave}OperatorFundamentalLessThan(e){const t=this;return t.Octave===e.Octave?t.FundamentalNote<e.FundamentalNote:t.Octave<e.Octave}getHigherPitchByTransposeFactor(e){const t=n.pitchEnumValues.indexOf(this.fundamentalNote);let i,r=this.octave;return t+e>n.pitchEnumValues.length-1?(i=n.pitchEnumValues[t+e-n.pitchEnumValues.length],r++):i=n.pitchEnumValues[t+e],new n(i,r,s.NONE)}getLowerPitchByTransposeFactor(e){const t=n.pitchEnumValues.indexOf(this.fundamentalNote);let i,r=this.octave;return t-e<0?(i=n.pitchEnumValues[n.pitchEnumValues.length+t-e],r--):i=n.pitchEnumValues[t-e],new n(i,r,s.NONE)}getNextFundamentalNote(e){let t=n.pitchEnumValues.indexOf(e);return t=(t+1)%n.pitchEnumValues.length,n.pitchEnumValues[t]}getPreviousFundamentalNote(e){const t=n.pitchEnumValues.indexOf(e);return t>0?n.pitchEnumValues[t-1]:n.pitchEnumValues[n.pitchEnumValues.length-1]}}t.Pitch=n,n.pitchEnumValues=[i.C,i.D,i.E,i.F,i.G,i.A,i.B],n.halftoneFactor=12/(Math.LN2/Math.LN10),n.octXmlDiff=3},8254:(e,t,i)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.GraphicalLabel=void 0;const s=i(7533),n=i(6438),r=i(995),o=i(7921);class a extends r.Clickable{constructor(e,t,i,s,r=void 0){super(),this.CenteringXShift=0,this.label=e,this.boundingBox=new n.BoundingBox(this,r),this.label.fontHeight=t,this.label.textAlignment=i,this.rules=s}get Label(){return this.label}toString(){return`${this.label.text} (${this.boundingBox.RelativePosition.x},${this.boundingBox.RelativePosition.y})`}setLabelPositionAndShapeBorders(){if(""===this.Label.text.trim())return;this.TextLines=[];const e=this.rules?.LabelMarginBorderFactor??.1,t=this.Label.text.split(/[\n\r]+/g),i=t.length;let n=0;for(let e=0;e<i;e++){const i=t[e].trim(),s=o.MusicSheetCalculator.TextMeasurer.computeTextWidthToHeightRatio(i,this.Label.font,this.Label.fontStyle,this.label.fontFamily),r=this.Label.fontHeight*s;n=Math.max(n,r),this.TextLines.push({text:i,xOffset:0,width:r})}for(const e of this.TextLines){let t=0;switch(this.Label.textAlignment){case s.TextAlignmentEnum.RightBottom:case s.TextAlignmentEnum.RightCenter:case s.TextAlignmentEnum.RightTop:t=n-e.width;break;case s.TextAlignmentEnum.CenterBottom:case s.TextAlignmentEnum.CenterCenter:case s.TextAlignmentEnum.CenterTop:t=(n-e.width)/2}e.xOffset=t}let r=this.Label.fontHeight*i;this.rules.SpacingBetweenTextLines>0&&this.TextLines.length>1&&(r+=this.rules.SpacingBetweenTextLines*i/10);const a=this.PositionAndShape;switch(this.Label.textAlignment){case s.TextAlignmentEnum.CenterBottom:a.BorderTop=-r,a.BorderLeft=-n/2,a.BorderBottom=0,a.BorderRight=n/2;break;case s.TextAlignmentEnum.CenterCenter:a.BorderTop=-r/2,a.BorderLeft=-n/2,a.BorderBottom=r/2,a.BorderRight=n/2;break;case s.TextAlignmentEnum.CenterTop:a.BorderTop=0,a.BorderLeft=-n/2,a.BorderBottom=r,a.BorderRight=n/2;break;case s.TextAlignmentEnum.LeftBottom:a.BorderTop=-r,a.BorderLeft=0,a.BorderBottom=0,a.BorderRight=n;break;case s.TextAlignmentEnum.LeftCenter:a.BorderTop=-r/2,a.BorderLeft=0,a.BorderBottom=r/2,a.BorderRight=n;break;case s.TextAlignmentEnum.LeftTop:a.BorderTop=0,a.BorderLeft=0,a.BorderBottom=r,a.BorderRight=n;break;case s.TextAlignmentEnum.RightBottom:a.BorderTop=-r,a.BorderLeft=-n,a.BorderBottom=0,a.BorderRight=0;break;case s.TextAlignmentEnum.RightCenter:a.BorderTop=-r/2,a.BorderLeft=-n,a.BorderBottom=r/2,a.BorderRight=0;break;case s.TextAlignmentEnum.RightTop:a.BorderTop=0,a.BorderLeft=-n,a.BorderBottom=r,a.BorderRight=0}a.BorderMarginTop=a.BorderTop-r*e,a.BorderMarginLeft=a.BorderLeft-r*e,a.BorderMarginBottom=a.BorderBottom+r*e,a.BorderMarginRight=a.BorderRight+r*e}}t.GraphicalLabel=a},8365:(e,t)=>{var i;Object.defineProperty(t,"__esModule",{value:!0}),t.BeamEnum=t.Beam=void 0,t.Beam=class{constructor(e=1,t=0){this.notes=[],this.extendedNoteList=[],this.BeamNumberOffsetToXML=0,this.AutoGenerated=!1,this.BeamNumber=e,this.BeamNumberOffsetToXML=t}get Notes(){return this.notes}set Notes(e){this.notes=e}get ExtendedNoteList(){return this.extendedNoteList}set ExtendedNoteList(e){this.extendedNoteList=e}addNoteToBeam(e){e&&(e.NoteBeam=this,this.notes.push(e),this.extendedNoteList.push(e))}},function(e){e[e.BeamNone=-1]="BeamNone",e[e.BeamBegin=0]="BeamBegin",e[e.BeamContinue=1]="BeamContinue",e[e.BeamEnd=2]="BeamEnd",e[e.BeamForward=3]="BeamForward",e[e.BeamBackward=4]="BeamBackward"}(i||(t.BeamEnum=i={}))},8705:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.OSMDColor=void 0;class i{constructor(e,t,i){this.alpha=255,this.red=e,this.green=t,this.blue=i}static get Black(){return new i(0,0,0)}static get DeepSkyBlue(){return new i(0,191,255)}static get Green(){return new i(20,160,20)}static get Magenta(){return new i(255,0,255)}static get Orange(){return new i(255,128,0)}static get Red(){return new i(240,20,20)}static get Disabled(){return new i(225,225,225)}static get DarkBlue(){return new i(0,0,140)}static get Debug1(){return new i(200,0,140)}static get Debug2(){return new i(100,100,200)}static get Debug3(){return new i(0,50,140)}toString(){return"rgb("+this.red+","+this.green+","+this.blue+","+this.alpha+")"}}t.OSMDColor=i},8724:function(e,t,i){var s=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.SystemImageProperties=t.GraphicalMusicSheet=void 0;const n=i(6723),r=i(6452),o=i(348),a=i(9409),l=i(164),u=i(4543),c=i(2561),h=i(6438),d=s(i(3065)),m=i(813),f=i(4548),p=i(7741);t.GraphicalMusicSheet=class{constructor(e,t){this.musicPages=[],this.measureList=[],this.verticalGraphicalStaffEntryContainers=[],this.cursors=[],this.leadSheet=!1,this.musicSheet=e,this.numberOfStaves=this.musicSheet.Staves.length,this.calculator=t,this.calculator.initialize(this)}get ParentMusicSheet(){return this.musicSheet}get GetCalculator(){return this.calculator}get MusicPages(){return this.musicPages}set MusicPages(e){this.musicPages=e}get MeasureList(){return this.measureList}set MeasureList(e){this.measureList=e}get VerticalGraphicalStaffEntryContainers(){return this.verticalGraphicalStaffEntryContainers}set VerticalGraphicalStaffEntryContainers(e){this.verticalGraphicalStaffEntryContainers=e}get Title(){return this.title}set Title(e){this.title=e}get Subtitle(){return this.subtitle}set Subtitle(e){this.subtitle=e}get Composer(){return this.composer}set Composer(e){this.composer=e}get Lyricist(){return this.lyricist}set Lyricist(e){this.lyricist=e}get Copyright(){return this.copyright}set Copyright(e){this.copyright=e}get Cursors(){return this.cursors}get SelectionStartSymbol(){return this.selectionStartSymbol}get SelectionEndSymbol(){return this.selectionEndSymbol}get MinAllowedSystemWidth(){return this.minAllowedSystemWidth}set MinAllowedSystemWidth(e){this.minAllowedSystemWidth=e}get NumberOfStaves(){return this.numberOfStaves}get LeadSheet(){return this.leadSheet}set LeadSheet(e){this.leadSheet=e}static transformRelativeToAbsolutePosition(e){for(let t=0;t<e.MusicPages.length;t++){const i=e.MusicPages[t].setMusicPageAbsolutePosition(t,e.ParentMusicSheet.Rules);e.MusicPages[t].PositionAndShape.calculateAbsolutePositionsRecursive(i.x,i.y)}}Initialize(){this.verticalGraphicalStaffEntryContainers=[],this.musicPages=[],this.measureList=[]}reCalculate(){this.calculator.calculate()}EnforceRedrawOfMusicSystems(){for(let e=0,t=this.musicPages.length;e<t;++e){const t=this.musicPages[e];for(let e=0,i=t.MusicSystems.length;e<i;++e)t.MusicSystems[e].needsToBeRedrawn=!0}}getClickedObject(e){for(let t=0,i=this.MusicPages.length;t<i;++t)return this.MusicPages[t].PositionAndShape.getClickedObjectOfType(e)}findGraphicalMeasure(e,t){for(let i=e;i>=0;i--){const e=this.measureList[i]?.[t];if(e)return e}}findGraphicalMeasureByMeasureNumber(e,t){for(let i=e;i>=0;i--)if(this.MeasureList[i]){const s=this.MeasureList[i][t];if(s?.MeasureNumber===e)return s}}findGraphicalStaffEntryFromMeasureList(e,t,i){for(let s=t;s<this.measureList.length;s++){const t=this.measureList[s][e];if(t)for(let e=0,s=t.staffEntries.length;e<s;++e){const s=t.staffEntries[e];if(s.sourceStaffEntry===i)return s}}}findNextGraphicalStaffEntry(e,t,i){const s=i.parentMeasure,n=s.staffEntries.indexOf(i);if(n<s.staffEntries.length-1)return s.staffEntries[n+1];if(t<this.measureList.length-1){const i=this.measureList[t+1][e];if(i.staffEntries.length>0)return i.staffEntries[0]}}getFirstVisibleMeasuresListFromIndices(e,t){const i=[],s=this.measureList[0].length;for(let n=e;n<=t;n++)for(let e=0;e<s;e++)if(this.measureList[n][e].isVisible()){i.push(this.measureList[n][e]);break}return i}orderMeasuresByStaffLine(e){const t=[];let i=[];t.push(i);for(let s=0;s<e.length;s++)0===s?i.push(e[0]):(e[s].ParentStaffLine===e[s-1].ParentStaffLine||(-1===t.indexOf(i)&&t.push(i),i=[],t.push(i)),i.push(e[s]));return t}initializeActiveClefs(){const e=[],t=this.musicSheet.getFirstSourceMeasure();if(t)for(let i=0;i<t.CompleteNumberOfStaves;i++){let s=new l.ClefInstruction;if(t.FirstInstructionsStaffEntries[i])for(let e=0,n=t.FirstInstructionsStaffEntries[i].Instructions.length;e<n;++e){const n=t.FirstInstructionsStaffEntries[i].Instructions[e];n instanceof l.ClefInstruction&&(s=n)}e.push(s)}return e}GetMainKey(){const e=this.musicSheet.getFirstSourceMeasure();if(e)for(let t=0;t<e.CompleteNumberOfStaves;t++)for(let i=0,s=e.FirstInstructionsStaffEntries[t].Instructions.length;i<s;++i){const s=e.FirstInstructionsStaffEntries[t].Instructions[i];if(s instanceof u.KeyInstruction)return s}}getOrCreateVerticalContainer(e){if(0===this.verticalGraphicalStaffEntryContainers.length||m.CollectionUtil.getLastElement(this.verticalGraphicalStaffEntryContainers).AbsoluteTimestamp.lt(e)){const t=new n.VerticalGraphicalStaffEntryContainer(this.numberOfStaves,e);return this.verticalGraphicalStaffEntryContainers.push(t),t}for(let t=this.verticalGraphicalStaffEntryContainers.length-1;t>=0;t--){if(this.verticalGraphicalStaffEntryContainers[t].AbsoluteTimestamp.lt(e)){const i=new n.VerticalGraphicalStaffEntryContainer(this.numberOfStaves,e);return this.verticalGraphicalStaffEntryContainers.splice(t+1,0,i),i}if(this.verticalGraphicalStaffEntryContainers[t].AbsoluteTimestamp.Equals(e))return this.verticalGraphicalStaffEntryContainers[t]}}GetVerticalContainerFromTimestamp(e,t=0){const i=m.CollectionUtil.binarySearch(this.verticalGraphicalStaffEntryContainers,new n.VerticalGraphicalStaffEntryContainer(0,e),n.VerticalGraphicalStaffEntryContainer.compareByTimestamp,t);if(i>=0)return this.verticalGraphicalStaffEntryContainers[i]}GetInterpolatedIndexInVerticalContainers(e){const t=this.verticalGraphicalStaffEntryContainers;if(1===t.length)return 0;let i,s,n=0,r=t.length-1;if(e.lte(t[t.length-1].AbsoluteTimestamp)){for(;r-n>1;){const i=Math.floor((r+n)/2);if(t[n].AbsoluteTimestamp.Equals(e)){r=n;break}if(t[r].AbsoluteTimestamp.Equals(e)){n=r;break}if(t[i].AbsoluteTimestamp.Equals(e))return this.verticalGraphicalStaffEntryContainers.indexOf(t[i]);e.lt(t[i].AbsoluteTimestamp)?r=i:n=i}if(n===r)return this.verticalGraphicalStaffEntryContainers.indexOf(t[n]);i=t[n].AbsoluteTimestamp,s=t[r].AbsoluteTimestamp}else i=t[t.length-1].AbsoluteTimestamp,s=c.Fraction.plus(this.getLongestStaffEntryDuration(t.length-1),i),r=t.length;const o=s.RealValue-i.RealValue,a=r-(s.RealValue-e.RealValue)/o;return Math.min(a,this.verticalGraphicalStaffEntryContainers.length-1)}getVisibleStavesIndicesFromSourceMeasure(e){const t=[],i=[];for(let i=0,s=e.length;i<s;++i){const s=e[i].ParentStaff.ParentInstrument;-1===t.indexOf(s)&&t.push(s)}for(let e=0,s=t.length;e<s;++e){const s=t[e],n=this.musicSheet.getGlobalStaffIndexOfFirstStaff(s);for(let e=0;e<s.Staves.length;e++)i.push(n+e)}return i}getGraphicalMeasureFromSourceMeasureAndIndex(e,t){for(let i=0;i<this.measureList.length;i++)if(this.measureList[i][0]?.parentSourceMeasure===e)return this.measureList[i][t]}getLastGraphicalMeasureFromIndex(e,t=!0){let i=this.measureList.length-1;t&&(i=Math.min(i,this.musicSheet.Rules.MaxMeasureToDrawIndex));let s=this.measureList[i][e];for(;!s&&i>=0;)s=this.measureList[--i][e];return this.measureList[i][e]}getMeasureIndex(e,t,i){for(t=0;t<this.measureList.length;t++)for(let i=0,s=this.measureList[t].length;i<s;++i)if(this.measureList[t][i]===e)return!0;return!1}GetNearestGraphicalObject(e,t=p.GraphicalObject.name,i=5,s=20,n=5,r=void 0){const o=[];for(;0===o.length&&i<=s;){const s=new h.BoundingBox(void 0);s.BorderLeft=e.x-i,s.BorderTop=e.y-i,s.BorderRight=e.x+i,s.BorderBottom=e.y+i,s.AbsolutePosition=new a.PointF2D(e.x,e.y),s.calculateAbsolutePosition();for(let e=0,i=this.MusicPages.length;e<i;++e){const i=this.MusicPages[e].PositionAndShape.getObjectsInRegion(s,!1,t);if(i&&0!==i.length)for(let e=0,t=i.length;e<t;++e)r?r(i[e])&&o.push(i[e]):o.push(i[e])}i+=n}let l;for(let t=0,i=o.length;t<i;++t){const i=o[t];(void 0===l||this.CalculateDistance(i.PositionAndShape.AbsolutePosition,e)<this.CalculateDistance(l.PositionAndShape.AbsolutePosition,e))&&(l=i)}if(l)return l}GetNearestVoiceEntry(e){return this.GetNearestGraphicalObject(e,f.GraphicalVoiceEntry.name,5,20,5,e=>void 0!==e.parentStaffEntry?.relInMeasureTimestamp)}GetNearestNote(e,t){const i=this.GetNearestVoiceEntry(e);if(!i)return;let s,n=Number.MAX_SAFE_INTEGER;for(const t of i.notes){const i=t.PositionAndShape.AbsolutePosition.y,r=Math.abs(t.PositionAndShape.AbsolutePosition.x-e.x),o=Math.abs(i-e.y);r+o<n&&(s=t,n=r+o)}return s}domToSvg(e){return this.domToSvgTransform(e,!0)}svgToDom(e){return this.domToSvgTransform(e,!1)}svgToOsmd(e){const t=new a.PointF2D(e.x,e.y);return t.x/=10,t.y/=10,t}domToSvgTransform(e,t){const i=this.drawer.Backends[0].getSvgElement(),s=i.createSVGPoint();s.x=e.x,s.y=e.y;let n=i.getScreenCTM();t&&(n=n.inverse());const r=s.matrixTransform(n);return new a.PointF2D(r.x,r.y)}GetClickableLabel(e){const t=new h.BoundingBox;t.BorderLeft=e.x-4,t.BorderTop=e.y-4,t.BorderRight=e.x+4,t.BorderBottom=e.y+4,t.AbsolutePosition=new a.PointF2D(0,0);for(let e=0,i=this.MusicPages.length;e<i;++e){const i=this.MusicPages[e].PositionAndShape.getObjectsInRegion(t);if(1===i.length)for(let e=0,t=i.length;e<t;++e)return i[e]}}GetNearestStaffEntry(e){const t=[],i=new h.BoundingBox(void 0);i.BorderLeft=e.x-10,i.BorderTop=e.y-10,i.BorderRight=e.x+10,i.BorderBottom=e.y+10,i.AbsolutePosition=new a.PointF2D(0,0);for(let e=0,s=this.MusicPages.length;e<s;++e){const s=this.MusicPages[e].PositionAndShape.getObjectsInRegion(i,!1,o.GraphicalStaffEntry.name);if(s&&0!==s.length)for(let e=0,i=s.length;e<i;++e){const i=s[e];t.push(i)}}let s;for(let i=0,n=t.length;i<n;++i){const n=t[i];if(void 0===s)s=n;else{if(!n.relInMeasureTimestamp)continue;this.CalculateDistance(n.PositionAndShape.AbsolutePosition,e)<this.CalculateDistance(s.PositionAndShape.AbsolutePosition,e)&&(s=n)}}if(s)return s}GetNearestObject(e,t){const i=[],s=new h.BoundingBox(void 0);s.BorderLeft=e.x-10,s.BorderTop=e.y-10,s.BorderRight=e.x+10,s.BorderBottom=e.y+10,s.AbsolutePosition=new a.PointF2D(0,0);for(let e=0,n=this.MusicPages.length;e<n;++e){const n=this.MusicPages[e].PositionAndShape.getObjectsInRegion(s,!1,t);if(n&&0!==n.length)for(let e=0,t=n.length;e<t;++e){const t=n[e];i.push(t)}}let n;for(let t=0,s=i.length;t<s;++t){const s=i[t];(void 0===n||this.CalculateDistance(s.PositionAndShape.AbsolutePosition,e)<this.CalculateDistance(n.PositionAndShape.AbsolutePosition,e))&&(n=s)}if(n)return n}GetPossibleCommentAnchor(e){const t=this.GetNearestStaffEntry(e);if(t)return t.sourceStaffEntry}getClickedObjectOfType(e){for(let t=0,i=this.musicPages.length;t<i;++t){const i=this.musicPages[t].PositionAndShape.getClickedObjectOfType(e);if(i)return i}}tryGetTimestampFromPosition(e){const t=this.getClickedObjectOfType(e);if(t)return t.getAbsoluteTimestamp()}tryGetClickableLabel(e){try{return this.GetClickableLabel(e)}catch(t){d.default.info("GraphicalMusicSheet.tryGetClickableObject","positionOnMusicSheet: "+e,t)}}tryGetTimeStampFromPosition(e){try{const t=this.GetNearestStaffEntry(e);if(!t)return;return t.getAbsoluteTimestamp()}catch(t){d.default.info("GraphicalMusicSheet.tryGetTimeStampFromPosition","positionOnMusicSheet: "+e,t)}}getStaffEntry(e){const t=this.VerticalGraphicalStaffEntryContainers[e];let i;try{for(let e=0,s=t.StaffEntries.length;e<s;++e){const s=t.StaffEntries[e];s&&s.sourceStaffEntry.ParentStaff.isVisible()&&(i?s.PositionAndShape&&i.PositionAndShape&&i.PositionAndShape.RelativePosition.x>s.PositionAndShape.RelativePosition.x&&(i=s):i=s)}}catch(e){d.default.info("GraphicalMusicSheet.getStaffEntry",e)}return i}GetPreviousVisibleContainerIndex(e){for(let t=e-1;t>=0;t--){const e=this.verticalGraphicalStaffEntryContainers[t].StaffEntries;for(let i=0,s=e.length;i<s;++i){const s=e[i];if(s&&s.sourceStaffEntry.ParentStaff.isVisible())return t}}return-1}GetNextVisibleContainerIndex(e){for(let t=e+1;t<this.verticalGraphicalStaffEntryContainers.length;++t){const e=this.verticalGraphicalStaffEntryContainers[t].StaffEntries;for(let i=0,s=e.length;i<s;++i){const s=e[i];if(s&&s.sourceStaffEntry.ParentStaff.isVisible())return t}}return-1}findClosestLeftStaffEntry(e,t){let i,s=Math.floor(e);s=Math.min(this.VerticalGraphicalStaffEntryContainers.length-1,s);for(let e=s;e>=0;e--)if(i=this.getStaffEntry(e),i){if(!t)return i;if(i.sourceStaffEntry.ParentStaff.isVisible())return i}}findClosestRightStaffEntry(e,t){let i;for(let s=Math.max(0,Math.ceil(e));s<this.VerticalGraphicalStaffEntryContainers.length;s++)if(i=this.getStaffEntry(s),i){if(!t)return i;if(i.sourceStaffEntry.ParentStaff.isVisible())return i}}calculateCursorLineAtTimestamp(e,t){const i=this.calculateXPositionFromTimestamp(e),s=i[0],n=i[1];if(!n||0===n.StaffLines.length)return;const o=n.PositionAndShape.AbsolutePosition.y,l=m.CollectionUtil.last(n.StaffLines).PositionAndShape.RelativePosition.y+4;return new r.GraphicalLine(new a.PointF2D(s,o),new a.PointF2D(s,o+l),3,t)}calculateXPositionFromTimestamp(e){let t;const i=this.GetInterpolatedIndexInVerticalContainers(e),s=this.findClosestLeftStaffEntry(i,!0),n=this.findClosestRightStaffEntry(i,!0),r=e.RealValue;if(!s&&!n)return[0,void 0];let o,a;if(o=s?s.parentMeasure.ParentStaffLine?.ParentMusicSystem:n.parentMeasure.ParentStaffLine?.ParentMusicSystem,a=n?n.parentMeasure.ParentStaffLine?.ParentMusicSystem:s.parentMeasure.ParentStaffLine?.ParentMusicSystem,o===a){let e,i,a;if(t=o,s)if(n)i=s.PositionAndShape.AbsolutePosition.x,a=n.PositionAndShape.AbsolutePosition.x,e=s===n?0:(r-s.getAbsoluteTimestamp().RealValue)/(n.getAbsoluteTimestamp().RealValue-s.getAbsoluteTimestamp().RealValue);else{i=s.PositionAndShape.AbsolutePosition.x,a=t.GetRightBorderAbsoluteXPosition();const n=s.parentMeasure.parentSourceMeasure;e=(r-s.getAbsoluteTimestamp().RealValue)/(c.Fraction.plus(n.AbsoluteTimestamp,n.Duration).RealValue-s.getAbsoluteTimestamp().RealValue)}else i=a=n.PositionAndShape.AbsolutePosition.x,e=0;return e=Math.min(1,Math.max(0,e)),[i+e*(a-i),t]}{const e=n.parentMeasure.parentSourceMeasure.AbsoluteTimestamp.RealValue;let i,l;if(r<e&&o.StaffLines[0]){t=o;const n=s.PositionAndShape.AbsolutePosition.x,a=t.GetRightBorderAbsoluteXPosition();i=(r-s.getAbsoluteTimestamp().RealValue)/(e-s.getAbsoluteTimestamp().RealValue),i=Math.min(1,Math.max(0,i)),l=n+i*(a-n)}else{t=a;const s=n.PositionAndShape.AbsolutePosition.x,o=t.GetLeftBorderAbsoluteXPosition();i=(r-e)/(n.getAbsoluteTimestamp().RealValue-e),i=Math.min(1,Math.max(0,i)),l=o+i*(s-o)}return[l,t]}}GetNumberOfVisibleInstruments(){let e=0;for(let t=0,i=this.musicSheet.Instruments.length;t<i;++t)this.musicSheet.Instruments[t].isVisible()&&e++;return e}GetNumberOfFollowedInstruments(){let e=0;for(let t=0,i=this.musicSheet.Instruments.length;t<i;++t)!0===this.musicSheet.Instruments[t].Following&&e++;return e}GetGraphicalFromSourceStaffEntry(e){if(!e.VerticalContainerParent.ParentMeasure?.VerticalMeasureList)return;const t=e.VerticalContainerParent.ParentMeasure.VerticalMeasureList[e.ParentStaff.idInMusicSheet];return t?.findGraphicalStaffEntryFromTimestamp(e.Timestamp)}CalculateDistance(e,t){const i=e.x-t.x,s=e.y-t.y;return i*i+s*s}getLongestStaffEntryDuration(e){let t=new c.Fraction(0,1);for(const i of this.verticalGraphicalStaffEntryContainers[e].StaffEntries){if(!i)continue;const e=i.findStaffEntryMaxNoteLength();t.lt(e)&&(t=e)}return t}},t.SystemImageProperties=class{}},8786:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.MusicSheetErrors=void 0,t.MusicSheetErrors=class{constructor(){this.measureErrors={},this.errors=[],this.tempErrors=[]}finalizeMeasure(e){let t=this.measureErrors[e];t||(t=[]),this.measureErrors[e]=t.concat(this.tempErrors),this.tempErrors=[]}pushMeasureError(e){this.tempErrors.push(e)}push(e){this.errors.push(e)}}},8927:(e,t,i)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.AccidentalCalculator=void 0;const s=i(8233),n=i(8233),r=i(3263),o=i(7921);t.AccidentalCalculator=class{constructor(){this.keySignatureNoteAlterationsDict=new r.Dictionary,this.currentAlterationsComparedToKeyInstructionList=[],this.currentInMeasureNoteAlterationsDict=new r.Dictionary}get ActiveKeyInstruction(){return this.activeKeyInstruction}set ActiveKeyInstruction(e){this.activeKeyInstruction=e,this.reactOnKeyInstructionChange()}doCalculationsAtEndOfMeasure(){this.currentInMeasureNoteAlterationsDict.clear(),this.currentAlterationsComparedToKeyInstructionList.clear();for(const e of this.keySignatureNoteAlterationsDict.keys())this.currentInMeasureNoteAlterationsDict.setValue(e,this.keySignatureNoteAlterationsDict.getValue(e))}checkAccidental(e,t){if(!t)return;const i=t.FundamentalNote+12*t.Octave,r=e.sourceNote.NoteTie;if(r&&e.sourceNote!==r.StartNote)return;const a=this.currentAlterationsComparedToKeyInstructionList.indexOf(i)>=0;if(this.currentInMeasureNoteAlterationsDict.containsKey(i))if(a&&this.currentAlterationsComparedToKeyInstructionList.splice(this.currentAlterationsComparedToKeyInstructionList.indexOf(i),1),this.currentInMeasureNoteAlterationsDict.getValue(i)!==t.AccidentalHalfTones){this.keySignatureNoteAlterationsDict.containsKey(i)&&this.keySignatureNoteAlterationsDict.getValue(i)!==t.AccidentalHalfTones?(this.currentAlterationsComparedToKeyInstructionList.push(i),this.currentInMeasureNoteAlterationsDict.setValue(i,t.AccidentalHalfTones)):t.Accidental!==s.AccidentalEnum.NONE&&this.currentInMeasureNoteAlterationsDict.remove(i);const r=this.currentInMeasureNoteAlterationsDict.getValue(i);if(t.Accidental===s.AccidentalEnum.NONE&&(t=.5===Math.abs(r)?new n.Pitch(t.FundamentalNote,t.Octave,s.AccidentalEnum.NONE,void 0,!1,t.OctaveShiftApplied):new n.Pitch(t.FundamentalNote,t.Octave,s.AccidentalEnum.NATURAL,void 0,!1,t.OctaveShiftApplied)),this.isAlterAmbiguousAccidental(t.Accidental)&&!t.AccidentalXml)return;o.MusicSheetCalculator.symbolFactory.addGraphicalAccidental(e,t)}else t.AccidentalXml&&0===this.Transpose&&!a&&o.MusicSheetCalculator.symbolFactory.addGraphicalAccidental(e,t);else if(t.Accidental!==s.AccidentalEnum.NONE){if(a||this.currentAlterationsComparedToKeyInstructionList.push(i),this.currentInMeasureNoteAlterationsDict.setValue(i,t.AccidentalHalfTones),this.isAlterAmbiguousAccidental(t.Accidental)&&!t.AccidentalXml)return;o.MusicSheetCalculator.symbolFactory.addGraphicalAccidental(e,t)}else a&&(t=new n.Pitch(t.FundamentalNote,t.Octave,s.AccidentalEnum.NATURAL,void 0,!1,t.OctaveShiftApplied),this.currentAlterationsComparedToKeyInstructionList.splice(this.currentAlterationsComparedToKeyInstructionList.indexOf(i),1),o.MusicSheetCalculator.symbolFactory.addGraphicalAccidental(e,t))}isAlterAmbiguousAccidental(e){return e===s.AccidentalEnum.SLASHFLAT||e===s.AccidentalEnum.QUARTERTONEFLAT}reactOnKeyInstructionChange(){const e=this.activeKeyInstruction.AlteratedNotes;let t;t=this.activeKeyInstruction.Key>0?s.AccidentalEnum.SHARP:s.AccidentalEnum.FLAT,this.keySignatureNoteAlterationsDict.clear(),this.currentAlterationsComparedToKeyInstructionList.length=0;for(let i=-9;i<9;i++)for(let s=0;s<e.length;s++)this.keySignatureNoteAlterationsDict.setValue(e[s]+12*i,n.Pitch.HalfTonesFromAccidental(t));this.doCalculationsAtEndOfMeasure()}}},9003:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.Articulation=void 0,t.Articulation=class{constructor(e,t){this.articulationEnum=e,this.placement=t}Equals(e){return e.articulationEnum===this.articulationEnum&&e.placement===this.placement}}},9019:(e,t,i)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.MultiExpressionEntry=t.MultiExpression=void 0;const s=i(2561),n=i(9767),r=i(5875),o=i(9803),a=i(1112),l=i(6362),u=i(2570);t.MultiExpression=class{constructor(e,t){this.unknownList=[],this.moodList=[],this.expressions=[],this.sourceMeasure=e,this.timestamp=t}get SourceMeasureParent(){return this.sourceMeasure}set SourceMeasureParent(e){this.sourceMeasure=e}get StaffNumber(){return this.staffNumber}set StaffNumber(e){this.staffNumber=e}get Timestamp(){return this.timestamp}set Timestamp(e){this.timestamp=e}get AbsoluteTimestamp(){return s.Fraction.plus(this.timestamp,this.sourceMeasure.AbsoluteTimestamp)}get InstantaneousDynamic(){return this.instantaneousDynamic}set InstantaneousDynamic(e){this.instantaneousDynamic=e}get EndingContinuousDynamic(){return this.endingContinuousDynamic}set EndingContinuousDynamic(e){this.endingContinuousDynamic=e}get StartingContinuousDynamic(){return this.startingContinuousDynamic}set StartingContinuousDynamic(e){this.startingContinuousDynamic=e}get MoodList(){return this.moodList}get UnknownList(){return this.unknownList}get EntriesList(){return this.expressions}get OctaveShiftStart(){return this.octaveShiftStart}set OctaveShiftStart(e){this.octaveShiftStart=e}get OctaveShiftEnd(){return this.octaveShiftEnd}set OctaveShiftEnd(e){this.octaveShiftEnd=e}get CombinedExpressionsText(){return this.combinedExpressionsText}set CombinedExpressionsText(e){this.combinedExpressionsText=e}getPlacementOfFirstEntry(){let e=l.PlacementEnum.Above;return this.expressions.length>0&&(this.expressions[0].expression instanceof n.InstantaneousDynamicExpression||this.expressions[0].expression instanceof r.ContinuousDynamicExpression||this.expressions[0].expression instanceof o.MoodExpression||this.expressions[0].expression instanceof a.UnknownExpression)&&(e=this.expressions[0].expression.Placement),e}getFontstyleOfFirstEntry(){let e=u.FontStyles.Regular;return this.expressions.length>0&&(this.expressions[0].expression instanceof r.ContinuousDynamicExpression||this.expressions[0].expression instanceof o.MoodExpression?e=u.FontStyles.Italic:this.expressions[0].expression instanceof a.UnknownExpression&&(e=this.expressions[0].expression.fontStyle??u.FontStyles.Regular)),e}addExpression(e,t){e instanceof n.InstantaneousDynamicExpression?(this.instantaneousDynamic&&this.removeExpressionFromEntryList(this.InstantaneousDynamic),this.instantaneousDynamic=e,this.instantaneousDynamic.ParentMultiExpression=this):e instanceof r.ContinuousDynamicExpression?this.startingContinuousDynamic=e:e instanceof o.MoodExpression?this.moodList.push(e):e instanceof a.UnknownExpression&&this.unknownList.push(e),this.addExpressionToEntryList(e,t)}CompareTo(e){return this.Timestamp.RealValue>e.Timestamp.RealValue?1:this.Timestamp.RealValue<e.Timestamp.RealValue?-1:0}addExpressionToEntryList(e,t){const i=new c;i.prefix=t,i.expression=e,e instanceof r.ContinuousDynamicExpression||e instanceof o.MoodExpression||e instanceof a.UnknownExpression?i.label=e.Label:i.label="",this.expressions.push(i)}removeExpressionFromEntryList(e){for(let t=0,i=this.expressions.length;t<i;++t)if(this.expressions[t].expression===e){this.expressions.splice(t,1);break}}};class c{}t.MultiExpressionEntry=c},9024:(e,t,i)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.TimestampTransform=t.MusicPartManager=void 0;const s=i(2561),n=i(474);t.MusicPartManager=class{constructor(e){this.musicSheet=e}reInit(){this.init()}init(){this.parts=this.musicSheet.Repetitions.slice(),this.sheetStart=this.musicSheet.SelectionStart=new s.Fraction(0,1),this.sheetEnd=this.musicSheet.SelectionEnd=this.musicSheet.SheetEndTimestamp,this.calcMapping()}getCurrentRepetitionTimestampTransform(e){let t;for(let i=this.timestamps.length-1;i>=0;i--)if(t=this.timestamps[i],e.gte(t.$from))return t;return this.timestamps[0]}absoluteEnrolledToSheetTimestamp(e){if(0===this.timestamps.length)return e;const t=this.getCurrentRepetitionTimestampTransform(e);return s.Fraction.plus(e,s.Fraction.minus(t.to,t.$from))}get Parts(){return this.parts}get MusicSheet(){return this.musicSheet}getIterator(e){return e?new n.MusicPartManagerIterator(this.musicSheet,e,void 0):new n.MusicPartManagerIterator(this.musicSheet,this.musicSheet.SelectionStart,this.musicSheet.SelectionEnd)}setSelectionStart(e){this.musicSheet.SelectionStart=e,this.musicSheet.SelectionEnd=void 0}setSelectionRange(e,t){this.musicSheet.SelectionStart=e??this.sheetStart,this.musicSheet.SelectionEnd=t??this.sheetEnd}calcMapping(){const e=[],t=this.getIterator();let i=t.CurrentRepetition,s=new r(t.CurrentEnrolledTimestamp.clone(),t.CurrentSourceTimestamp.clone(),void 0,0);for(e.push(s);!t.EndReached;){if(t.JumpOccurred||i!==t.CurrentRepetition){if(i=t.CurrentRepetition,t.backJumpOccurred){const i=t.JumpResponsibleRepetition;s.nextBackJump=t.CurrentEnrolledTimestamp,s.curRepetition=i,s.curRepetitionIteration=t.CurrentJumpResponsibleRepetitionIterationBeforeJump;for(let t=this.timestamps.length-2;t>=0&&!e[t].to.lt(i.AbsoluteTimestamp)&&!e[t].curRepetition;t--)e[t].nextBackJump=s.nextBackJump,e[t].curRepetition=i,e[t].curRepetitionIteration=s.curRepetitionIteration}s=new r(t.CurrentEnrolledTimestamp.clone(),t.CurrentSourceTimestamp.clone(),void 0,0),e.push(s)}t.moveToNext()}this.timestamps=e}};class r{constructor(e,t,i,s){this.$from=e,this.to=t,this.curRepetition=i,this.curRepetitionIteration=s,this.nextBackJump=void 0,this.nextForwardJump=void 0}}t.TimestampTransform=r},9099:function(e,t,i){var s=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.MusicSheetReader=void 0;const n=i(427),r=i(4387),o=i(2561),a=i(1272),l=i(9252),u=i(2148),c=i(7307),h=s(i(3065)),d=i(9288),m=i(9288),f=i(2369),p=i(7586),S=i(5294),g=i(164),y=i(7435),E=i(5749),M=i(9713),b=i(7503),P=i(7533);t.MusicSheetReader=class{constructor(e=void 0,t=new M.EngravingRules){this.completeNumberOfStaves=0,this.pluginManager=new b.ReaderPluginManager,this.afterSheetReadingModules=e||[],this.repetitionInstructionReader=E.MusicSymbolModuleFactory.createRepetitionInstructionReader(),this.repetitionCalculator=E.MusicSymbolModuleFactory.createRepetitionCalculator(),this.rules=t}get PluginManager(){return this.pluginManager}get CompleteNumberOfStaves(){return this.completeNumberOfStaves}static doCalculationsAfterDurationHasBeenSet(e){for(const t of e)t.doCalculationsAfterDurationHasBeenSet()}createMusicSheet(e,t){try{return this._createMusicSheet(e,t)}catch(e){return void h.default.error("MusicSheetReader.CreateMusicSheet",e)}}_removeFromArray(e,t){const i=e.indexOf(t);-1!==i&&e.splice(i,1)}trimString(e){return e.replace(/^\s+|\s+$/g,"")}_lastElement(e){return e[e.length-1]}_createMusicSheet(e,t){const i=[];let s=0;this.musicSheet=new n.MusicSheet,this.musicSheet.Path=t,this.musicSheet.Rules=this.rules;const a=e.attribute("osmdMeasureWidthFactor");if(a){const e=Number.parseFloat(a.value);"number"!=typeof e||isNaN(e)?h.default.info("xml parse: osmdMeasureWidthFactor invalid"):this.musicSheet.MeasureWidthFactor=e}if(!e)throw new c.MusicSheetReadingException("Undefined root element");this.pushSheetLabels(e,t);const l=e.element("part-list");if(!l)throw new c.MusicSheetReadingException("Undefined partListNode");const d=e.elements("part"),m=l.elements();this.initializeReading(m,d,i);let f=!0;this.currentFraction=new o.Fraction(0,1);let p=!1,S=e.element("identification");for(S&&(S=S.element("encoding")),S&&(S=S.element("software")),void 0!==S&&"Guitar Pro 5"===S.value&&(p=!0);f;){void 0!==this.currentMeasure&&this.currentMeasure.HasEndLine&&this.rules.NewPartAndSystemAfterFinalBarline&&(s=0),this.currentMeasure=new r.SourceMeasure(this.completeNumberOfStaves,this.musicSheet.Rules);for(const e of i)try{f=f&&e.readNextXmlMeasure(this.currentMeasure,this.currentFraction,p)}catch(e){const t=u.ITextTranslation.translateText("ReaderErrorMessages/InstrumentError","Error while reading instruments.");throw new c.MusicSheetReadingException(t,e)}f&&(this.musicSheet.addMeasure(this.currentMeasure),this.checkIfRhythmInstructionsAreSetAndEqual(i),this.checkSourceMeasureForNullEntries(),s=this.setSourceMeasureDuration(i,s),this.currentMeasure.AbsoluteTimestamp=this.currentFraction.clone(),this.musicSheet.SheetErrors.finalizeMeasure(this.currentMeasure.MeasureNumber),this.currentFraction.Add(this.currentMeasure.Duration),this.previousMeasure=this.currentMeasure)}this.repetitionInstructionReader&&(this.repetitionInstructionReader.removeRedundantInstructions(),this.repetitionCalculator&&this.repetitionCalculator.calculateRepetitions(this.musicSheet,this.repetitionInstructionReader.repetitionInstructions)),this.musicSheet.checkForInstrumentWithNoVoice(),this.musicSheet.fillStaffList();for(let e=0,t=this.afterSheetReadingModules.length;e<t;++e)this.afterSheetReadingModules[e].calculate(this.musicSheet);return this.musicSheet.userStartTempoInBPM=this.musicSheet.userStartTempoInBPM||this.musicSheet.DefaultStartTempoInBpm,this.musicSheet}initializeReading(e,t,i){const s=this.createInstrumentGroups(e);this.completeNumberOfStaves=this.getCompleteNumberOfStavesFromXml(t),0!==t.length&&(this.repetitionInstructionReader.MusicSheet=this.musicSheet,this.currentFraction=new o.Fraction(0,1),this.currentMeasure=void 0,this.previousMeasure=void 0);let n=0;for(const e of t){const t=e.attribute("id");if(t){const r=s[t.value],o=e.elements("measure");let l=1;try{l=this.getInstrumentNumberOfStavesFromXml(e)}catch(e){const t=u.ITextTranslation.translateText("ReaderErrorMessages/InstrumentStavesNumberError","Invalid number of staves at instrument: ");this.musicSheet.SheetErrors.push(t+r.Name);continue}r.createStaves(l),i.push(new a.InstrumentReader(this.pluginManager,this.repetitionInstructionReader,o,r)),this.repetitionInstructionReader&&(this.repetitionInstructionReader.xmlMeasureList[n]=o),n++}}}checkIfRhythmInstructionsAreSetAndEqual(e){const t=[];for(let e=0;e<this.completeNumberOfStaves;e++)if(this.currentMeasure.FirstInstructionsStaffEntries[e]){const i=this.currentMeasure.FirstInstructionsStaffEntries[e].Instructions[this.currentMeasure.FirstInstructionsStaffEntries[e].Instructions.length-1];i instanceof d.RhythmInstruction&&t.push(i)}let i=0,s=-1;for(let e=0,n=t.length;e<n;++e){const n=t[e];if(n.Rhythm.RealValue>i){if(this.areRhythmInstructionsMixed(t)&&n.SymbolEnum!==m.RhythmSymbolEnum.NONE)continue;i=n.Rhythm.RealValue,s=t.indexOf(n)}}if(t.length>0&&t.length<this.completeNumberOfStaves){const i=t[s].clone();for(let e=0;e<this.completeNumberOfStaves;e++)void 0===this.currentMeasure.FirstInstructionsStaffEntries[e]||this._lastElement(this.currentMeasure.FirstInstructionsStaffEntries[e].Instructions)instanceof d.RhythmInstruction||(this.currentMeasure.FirstInstructionsStaffEntries[e].removeAllInstructionsOfTypeRhythmInstruction(),this.currentMeasure.FirstInstructionsStaffEntries[e].Instructions.push(i.clone())),this.currentMeasure.FirstInstructionsStaffEntries[e]||(this.currentMeasure.FirstInstructionsStaffEntries[e]=new f.SourceStaffEntry(void 0,void 0),this.currentMeasure.FirstInstructionsStaffEntries[e].Instructions.push(i.clone()));for(let t=0,s=e.length;t<s;++t)e[t].ActiveRhythm=i}if(0===t.length&&this.currentMeasure===this.musicSheet.SourceMeasures[0]){const t=new d.RhythmInstruction(new o.Fraction(4,4,0,!1),m.RhythmSymbolEnum.NONE);for(let e=0;e<this.completeNumberOfStaves;e++)this.currentMeasure.FirstInstructionsStaffEntries[e]?this.currentMeasure.FirstInstructionsStaffEntries[e].removeAllInstructionsOfTypeRhythmInstruction():this.currentMeasure.FirstInstructionsStaffEntries[e]=new f.SourceStaffEntry(void 0,void 0),this.currentMeasure.FirstInstructionsStaffEntries[e].Instructions.push(t);for(let i=0,s=e.length;i<s;++i)e[i].ActiveRhythm=t}for(let e=0,n=t.length;e<n;++e){const n=t[e];if(n.Rhythm.RealValue<i&&this._lastElement(this.currentMeasure.FirstInstructionsStaffEntries[t.indexOf(n)].Instructions)instanceof d.RhythmInstruction){const e=this.currentMeasure.FirstInstructionsStaffEntries[t.indexOf(n)].Instructions;e[e.length-1]=t[s].clone()}Math.abs(n.Rhythm.RealValue-i)<1e-6&&n.SymbolEnum!==m.RhythmSymbolEnum.NONE&&this.areRhythmInstructionsMixed(t)&&(n.SymbolEnum=m.RhythmSymbolEnum.NONE)}}areRhythmInstructionsMixed(e){for(let t=1;t<e.length;t++)if(Math.abs(e[t].Rhythm.RealValue-e[0].Rhythm.RealValue)<1e-6&&e[t].SymbolEnum!==e[0].SymbolEnum)return!0;return!1}setSourceMeasureDuration(e,t){let i=new o.Fraction(0,1);const s=[];for(const t of e){s.push(t.MaxTieNoteFraction);const e=t.ActiveRhythm.Rhythm;i.lt(e)&&(i=new o.Fraction(e.Numerator,e.Denominator,0,!1))}const n=this.currentMeasure.calculateInstrumentsDuration(this.musicSheet,s);let r=new o.Fraction(0,1);for(const e of n)r.lt(e)&&(r=e);o.Fraction.Equal(r,i)?this.checkFractionsForEquivalence(r,i):r.lt(i)&&(r=this.currentMeasure.reverseCheck(this.musicSheet,r),this.checkFractionsForEquivalence(r,i)),this.currentMeasure.ImplicitMeasure=this.checkIfMeasureIsImplicit(r,i),(!this.currentMeasure.ImplicitMeasure||t>0)&&t++,this.currentMeasure.Duration=r,this.currentMeasure.ActiveTimeSignature=i,this.currentMeasure.MeasureNumber=t;for(let e=0;e<n.length;e++){const t=n[e];if(this.currentMeasure.ImplicitMeasure&&t!==r||!o.Fraction.Equal(t,i)&&!this.allInstrumentsHaveSameDuration(n,r)){const t=this.musicSheet.getGlobalStaffIndexOfFirstStaff(this.musicSheet.Instruments[e]);for(let i=0;i<this.musicSheet.Instruments[e].Staves.length;i++)if(!this.graphicalMeasureIsEmpty(t+i)){this.currentMeasure.setErrorInGraphicalMeasure(t+i,!0);const e=u.ITextTranslation.translateText("ReaderErrorMessages/MissingNotesError","Given Notes don't correspond to measure duration.");this.musicSheet.SheetErrors.pushMeasureError(e)}}}return t}checkFractionsForEquivalence(e,t){if(t.Denominator>e.Denominator){const i=t.Denominator/e.Denominator;e.expand(i)}}checkIfMeasureIsImplicit(e,t){return!(this.previousMeasure||!e.lt(t))||!!this.previousMeasure&&o.Fraction.plus(this.previousMeasure.Duration,e).Equals(t)}allInstrumentsHaveSameDuration(e,t){let i=0;for(let s=0,n=e.length;s<n;++s)e[s].Equals(t)&&i++;return i===e.length&&t!==new o.Fraction(0,1)}graphicalMeasureIsEmpty(e){let t=0;for(let i=0;i<this.currentMeasure.VerticalSourceStaffEntryContainers.length;i++)this.currentMeasure.VerticalSourceStaffEntryContainers[i].StaffEntries[e]||t++;return t===this.currentMeasure.VerticalSourceStaffEntryContainers.length}checkSourceMeasureForNullEntries(){for(let e=this.currentMeasure.VerticalSourceStaffEntryContainers.length-1;e>=0;e--)for(let t=this.currentMeasure.VerticalSourceStaffEntryContainers[e].StaffEntries.length-1;t>=0;t--){const i=this.currentMeasure.VerticalSourceStaffEntryContainers[e].StaffEntries[t];if(i)for(let e=i.VoiceEntries.length-1;e>=0;e--){const t=i.VoiceEntries[e];0===t.Notes.length&&(this._removeFromArray(t.ParentVoice.VoiceEntries,t),this._removeFromArray(i.VoiceEntries,t))}void 0!==i&&0===i.VoiceEntries.length&&0===i.ChordContainers.length&&(this.currentMeasure.VerticalSourceStaffEntryContainers[e].StaffEntries[t]=void 0)}for(let e=this.currentMeasure.VerticalSourceStaffEntryContainers.length-1;e>=0;e--){let t=0;for(let i=0,s=this.currentMeasure.VerticalSourceStaffEntryContainers[e].StaffEntries.length;i<s;++i)this.currentMeasure.VerticalSourceStaffEntryContainers[e].StaffEntries[i]||t++;t===this.currentMeasure.VerticalSourceStaffEntryContainers[e].StaffEntries.length&&this._removeFromArray(this.currentMeasure.VerticalSourceStaffEntryContainers,this.currentMeasure.VerticalSourceStaffEntryContainers[e])}}pushSheetLabels(e,t){this.readComposer(e),this.readTitle(e),this.readCopyright(e);try{this.musicSheet.Title&&this.musicSheet.Composer&&this.musicSheet.Subtitle||this.readTitleAndComposerFromCredits(e)}catch(e){h.default.info("MusicSheetReader.pushSheetLabels","readTitleAndComposerFromCredits",e)}try{if(!this.musicSheet.Title){const e=Math.max(0,t.lastIndexOf("/"),t.lastIndexOf("\\")),i=t.substr(e).split(".",1);this.musicSheet.Title=new y.Label(i[0])}}catch(e){h.default.info("MusicSheetReader.pushSheetLabels","read title from file name",e)}}presentAttrsWithValue(e,t){for(const i of e.attributes())if(i.value===t)return!0;return!1}readComposer(e){const t=e.element("identification");if(t){const e=t.elements("creator");for(let t=0,i=e.length;t<i;++t){const i=e[t];if(i.hasAttributes){if(this.presentAttrsWithValue(i,"composer")){this.musicSheet.Composer=new y.Label(this.trimString(i.value));continue}(this.presentAttrsWithValue(i,"lyricist")||this.presentAttrsWithValue(i,"poet"))&&(this.musicSheet.Lyricist=new y.Label(this.trimString(i.value)))}}}}readCopyright(e){const t=e.elements("identification");if(t.length>0){const e=t[0].elements("rights");if(e.length>0)for(let t=0,i=e.length;t<i;++t){const i=e[t];if(i.value){this.musicSheet.Copyright=new y.Label(i.value,P.TextAlignmentEnum.CenterBottom,void 0,!0);break}}}}readTitleAndComposerFromCredits(e){if(this.rules.SheetComposerSubtitleUseLegacyParsing)return void this.readTitleAndComposerFromCreditsLegacy(e);const t=this.computeSystemYCoordinates(e);if(0===t)return;let i,s,n;const r=e.elements("credit");for(let e=0,o=r.length;e<o;++e){const o=r[e];if(!o.attribute("page"))return;if("1"===o.attribute("page").value){let e;if(o){let r=!1,a=!1;const l=o.element("credit-type");"subtitle"===l?.value?r=!0:"composer"===l?.value&&(a=!0);let u=r||a;e=o.elements("credit-words");for(const o of e){const e=o.value?.trim();if("Copyright ©"===e)continue;const l=o.attribute("justify")?.value;"right"===l?(a=!0,u=!0):"center"===l&&i&&(r=!0,u=!0);const c=o.attribute("default-y")?.value,h=null!=c,d=h?parseFloat(c):Number.MIN_VALUE;if(h&&d>t||u)if(i||u){if(a||"right"===l)n?n+="\n"+e:n=e;else if(r||"right"!==l&&"left"!==l)s?s+="\n"+e:s=e;else if("left"===l){this.musicSheet.Lyricist||(this.musicSheet.Lyricist=new y.Label(e));break}}else i=e}}}}if(!this.musicSheet.Title&&i&&(this.musicSheet.Title=new y.Label(this.trimString(i))),!this.musicSheet.Subtitle&&s&&(this.musicSheet.Subtitle=new y.Label(this.trimString(s))),n){let e=!1;this.musicSheet.Composer?(n.match("\n")??[]).length+1>=(this.musicSheet.Composer.text.match("\n")??[]).length+1&&(e=!0):e=!0,e&&(this.musicSheet.Composer=new y.Label(this.trimString(n)))}}readTitleAndComposerFromCreditsLegacy(e){const t=this.computeSystemYCoordinates(e);if(0===t)return;let i,s,n,r=1,o=0;const a=e.elements("credit");for(let e=0,l=a.length;e<l;++e){const l=a[e];if(!l.attribute("page"))return;if("1"===l.attribute("page").value){let e;if(l){if(e=l.element("credit-words"),!e.attribute("justify"))break;const a=e.attribute("justify")?.value,u=e.attribute("default-y")?.value,c=null!=u,h=c?parseFloat(u):Number.MIN_VALUE;let d=!1;const m=l.element("credit-type");if("subtitle"===m?.value&&(d=!0),c&&h>t||d){if(!this.musicSheet.Title&&!d){const t=e.attribute("font-size")?.value;if(t){const s=parseFloat(t);r<s&&(r=s,i=e.value)}}switch(this.musicSheet.Subtitle||("right"!==a&&"left"!==a||d)&&(o<h?(o=h,n?(s=n,n=e.value):n=e.value):s?s+="\n"+e.value:s=e.value),a){case"right":this.musicSheet.Composer||(this.musicSheet.Composer=new y.Label(this.trimString(e.value)));break;case"left":this.musicSheet.Lyricist||(this.musicSheet.Lyricist=new y.Label(this.trimString(e.value)))}}}}}!this.musicSheet.Title&&i&&(this.musicSheet.Title=new y.Label(this.trimString(i))),!this.musicSheet.Subtitle&&s&&(this.musicSheet.Subtitle=new y.Label(this.trimString(s)))}computeSystemYCoordinates(e){if(!e.element("defaults"))return 0;let t=0,i=0;try{const i=e.element("defaults").element("page-layout").element("page-height").value;t=parseFloat(i)}catch(e){return h.default.info("MusicSheetReader.computeSystemYCoordinates(): couldn't find page height, not reading title/composer."),0}let s=!1;const n=e.elements("part");for(let e=0,t=n.length;e<t;++e){const t=n[e].elements("measure");for(let e=0,n=t.length;e<n;++e){const n=t[e];if(n.element("print")){const e=n.element("print").elements("system-layout");for(let t=0,n=e.length;t<n;++t){const n=e[t];if(n.element("top-system-distance")){const e=n.element("top-system-distance").value;i=parseFloat(e),s=!0;break}}break}}if(s)break}if(e.element("defaults").element("system-layout")&&e.element("defaults").element("system-layout").element("top-system-distance")){const t=e.element("defaults").element("system-layout").element("top-system-distance").value;i=parseFloat(t)}return 0===i?0:t-i}readTitle(e){const t=e.element("work");let i;t&&(i=t.element("work-title"),i&&i.value&&(this.musicSheet.Title=new y.Label(this.trimString(i.value))));const s=e.element("movement-title");let n="";if(s&&(this.musicSheet.Title?n=this.trimString(s.value):this.musicSheet.Title=new y.Label(this.trimString(s.value))),t){const e=t.element("work-number");if(e){const t=e.value;t&&(n=""===n?t:n+", "+t)}}n&&(this.musicSheet.Subtitle=new y.Label(n))}createInstrumentGroups(e){let t=0;const i={};let s;try{const n=e;for(let e=0,r=n.length;e<r;++e){const r=n[e];if("score-part"===r.name){const e=r.attribute("id").value,n=new l.Instrument(t,e,this.musicSheet,s);t++;const o=r.elements();for(let e=0,t=o.length;e<t;++e){const t=o[e];try{if("part-name"===t.name)n.Name=t.value,t.attribute("print-object")&&"no"===t.attribute("print-object").value&&(n.NameLabel.print=!1);else if("part-abbreviation"===t.name)n.PartAbbreviation=t.value;else if("score-instrument"===t.name){const e=new S.SubInstrument(n);e.idString=t.firstAttribute.value,n.SubInstruments.push(e);const i=t.element("instrument-name");i&&(e.name=i.value,e.setMidiInstrument(i.value))}else if("midi-instrument"===t.name){let e=n.getSubInstrument(t.firstAttribute.value);for(let i=0,s=n.SubInstruments.length;i<s;++i){const s=n.SubInstruments[i];if(s.idString===t.value){e=s;break}}const i=t.elements();for(let t=0,s=i.length;t<s;++t){const s=i[t];try{if("midi-channel"===s.name)10===parseInt(s.value,10)&&(n.MidiInstrumentId=g.MidiInstrument.Percussion);else if("midi-program"===s.name)n.SubInstruments.length>0&&n.MidiInstrumentId!==g.MidiInstrument.Percussion&&(e.midiInstrumentID=Math.max(0,parseInt(s.value,10)-1));else if("midi-unpitched"===s.name)e.fixedKey=Math.max(0,parseInt(s.value,10));else if("volume"===s.name)try{const t=parseFloat(s.value);e.volume=t/127}catch(e){h.default.debug("ExpressionReader.readExpressionParameters","read volume",e)}else if("pan"===s.name)try{const t=parseFloat(s.value);e.pan=t/64}catch(e){h.default.debug("ExpressionReader.readExpressionParameters","read pan",e)}}catch(e){h.default.info("MusicSheetReader.createInstrumentGroups midi settings: ",e)}}}}catch(e){h.default.info("MusicSheetReader.createInstrumentGroups: ",e)}}if(0===n.SubInstruments.length){const e=new S.SubInstrument(n);n.SubInstruments.push(e)}i[e]=n,s?(s.InstrumentalGroups.push(n),this.musicSheet.Instruments.push(n)):(this.musicSheet.InstrumentalGroups.push(n),this.musicSheet.Instruments.push(n))}else if("part-group"===r.name&&"start"===r.attribute("type").value){const e=new p.InstrumentalGroup("group",this.musicSheet,s);s?s.InstrumentalGroups.push(e):this.musicSheet.InstrumentalGroups.push(e),s=e}else if("part-group"===r.name&&"stop"===r.attribute("type").value&&s){if(1===s.InstrumentalGroups.length){const e=s.InstrumentalGroups[0];s.Parent?(s.Parent.InstrumentalGroups.push(e),this._removeFromArray(s.Parent.InstrumentalGroups,s)):(this.musicSheet.InstrumentalGroups.push(e),this._removeFromArray(this.musicSheet.InstrumentalGroups,s))}s=s.Parent}}}catch(e){const t=u.ITextTranslation.translateText("ReaderErrorMessages/InstrumentError","Error while reading Instruments");throw new c.MusicSheetReadingException(t,e)}for(let e=0,t=this.musicSheet.Instruments.length;e<t;++e){const t=this.musicSheet.Instruments[e];t.Name||(t.Name="Instr. "+t.IdString)}return i}getCompleteNumberOfStavesFromXml(e){let t=0;for(const i of e){const e=i.elements("measure");if(e.length>0){const i=e[0];if(i){let e=i.element("attributes");e&&(e=e.element("staves")),e?t+=parseInt(e.value,10):t++}}}if(isNaN(t)||t<=0){const e=u.ITextTranslation.translateText("ReaderErrorMessages/StaffError","Invalid number of staves.");throw new c.MusicSheetReadingException(e)}return t}getInstrumentNumberOfStavesFromXml(e){let t=0;const i=e.element("measure");if(i){const e=i.element("attributes");let s;e&&(s=e.element("staves")),t=e&&s?parseInt(s.value,10):1}if(isNaN(t)||t<=0){const e=u.ITextTranslation.translateText("ReaderErrorMessages/StaffError","Invalid number of Staves.");throw new c.MusicSheetReadingException(e)}return t}}},9147:(e,t,i)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.AbstractTempoExpression=void 0;const s=i(6362);class n extends s.AbstractExpression{constructor(e,t,i,s){super(t),this.label=e,this.staffNumber=i,this.parentMultiTempoExpression=s}get Label(){return this.label}set Label(e){this.label=e}get Placement(){return this.placement}set Placement(e){this.placement=e}get StaffNumber(){return this.staffNumber}set StaffNumber(e){this.staffNumber=e}get ParentMultiTempoExpression(){return this.parentMultiTempoExpression}static isStringInStringList(e,t){for(const i of e)if(n.stringContainsSeparatedWord(t.toLowerCase().trim(),i.toLowerCase().trim()))return!0;return!1}static stringContainsSeparatedWord(e,t){return e===t||-1!==e.indexOf(" "+t)||-1!==e.indexOf(t+" ")}}t.AbstractTempoExpression=n},9157:(e,t,i)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.RehearsalExpression=void 0;const s=i(6362);class n extends s.AbstractExpression{constructor(e,t){super(t),this.label=e}}t.RehearsalExpression=n},9161:(e,t,i)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.TempoEnum=t.InstantaneousTempoExpression=void 0;const s=i(9147),n=i(7307),r=i(2561);class o extends s.AbstractTempoExpression{constructor(e,t,i,s,n,r=!1){super(e,t,i,n),this.parentMeasure=n.SourceMeasureParent,this.isMetronomeMark=r,this.setTempoAndTempoType(s)}static getDefaultValueForTempoType(e){switch(e){case a.larghissimo:return 20;case a.grave:return 30;case a.lento:return 48;case a.largo:return 52;case a.larghetto:return 63;case a.adagio:return 70;case a.adagietto:return 75;case a.andanteModerato:return 88;case a.andante:return 92;case a.andantino:return 96;case a.moderato:return 106;case a.allegretto:return 112;case a.allegroModerato:return 118;case a.allegro:return 130;case a.vivace:return 140;case a.vivacissimo:return 155;case a.allegrissimo:return 170;case a.presto:return 184;case a.prestissimo:return 200;default:throw new n.ArgumentOutOfRangeException("tempoEnum")}}static isInputStringInstantaneousTempo(e){return!!e&&(o.isStringInStringList(o.listInstantaneousTempoLarghissimo,e)||o.isStringInStringList(o.listInstantaneousTempoGrave,e)||o.isStringInStringList(o.listInstantaneousTempoLento,e)||o.isStringInStringList(o.listInstantaneousTempoLargo,e)||o.isStringInStringList(o.listInstantaneousTempoLarghetto,e)||o.isStringInStringList(o.listInstantaneousTempoAdagio,e)||o.isStringInStringList(o.listInstantaneousTempoAdagietto,e)||o.isStringInStringList(o.listInstantaneousTempoAndanteModerato,e)||o.isStringInStringList(o.listInstantaneousTempoAndante,e)||o.isStringInStringList(o.listInstantaneousTempoAndantino,e)||o.isStringInStringList(o.listInstantaneousTempoModerato,e)||o.isStringInStringList(o.listInstantaneousTempoAllegretto,e)||o.isStringInStringList(o.listInstantaneousTempoAllegroModerato,e)||o.isStringInStringList(o.listInstantaneousTempoAllegro,e)||o.isStringInStringList(o.listInstantaneousTempoVivace,e)||o.isStringInStringList(o.listInstantaneousTempoVivacissimo,e)||o.isStringInStringList(o.listInstantaneousTempoAllegrissimo,e)||o.isStringInStringList(o.listInstantaneousTempoPresto,e)||o.isStringInStringList(o.listInstantaneousTempoPrestissimo,e)||o.isStringInStringList(o.listInstantaneousTempoChangesGeneral,e))}get Label(){return this.label}set Label(e){this.label=e}get Placement(){return this.placement}set Placement(e){this.placement=e}get StaffNumber(){return this.staffNumber}set StaffNumber(e){this.staffNumber=e}get Enum(){return this.tempoEnum}get TempoInBpm(){return this.tempoInBpm}set TempoInBpm(e){this.tempoInBpm=e}get ParentMultiTempoExpression(){return this.parentMultiTempoExpression}getAbsoluteTimestamp(){return r.Fraction.plus(this.ParentMultiTempoExpression.SourceMeasureParent.AbsoluteTimestamp,this.ParentMultiTempoExpression.Timestamp)}getAbsoluteFloatTimestamp(){return r.Fraction.plus(this.ParentMultiTempoExpression.SourceMeasureParent.AbsoluteTimestamp,this.ParentMultiTempoExpression.Timestamp).RealValue}setTempoAndTempoType(e){return this.label?o.isStringInStringList(o.listInstantaneousTempoLarghissimo,this.label)?(0===e&&(e=o.getDefaultValueForTempoType(a.larghissimo)),this.tempoInBpm=e,void(this.tempoEnum=a.larghissimo)):o.isStringInStringList(o.listInstantaneousTempoGrave,this.label)?(0===e&&(e=o.getDefaultValueForTempoType(a.grave)),this.tempoInBpm=e,void(this.tempoEnum=a.grave)):o.isStringInStringList(o.listInstantaneousTempoLento,this.label)?(0===e&&(e=o.getDefaultValueForTempoType(a.lento)),this.tempoInBpm=e,void(this.tempoEnum=a.lento)):o.isStringInStringList(o.listInstantaneousTempoLargo,this.label)?(0===e&&(e=o.getDefaultValueForTempoType(a.largo)),this.tempoInBpm=e,void(this.tempoEnum=a.largo)):o.isStringInStringList(o.listInstantaneousTempoLarghetto,this.label)?(0===e&&(e=o.getDefaultValueForTempoType(a.larghetto)),this.tempoInBpm=e,void(this.tempoEnum=a.larghetto)):o.isStringInStringList(o.listInstantaneousTempoAdagio,this.label)?(0===e&&(e=o.getDefaultValueForTempoType(a.adagio)),this.tempoInBpm=e,void(this.tempoEnum=a.adagio)):o.isStringInStringList(o.listInstantaneousTempoAdagietto,this.label)?(0===e&&(e=o.getDefaultValueForTempoType(a.adagietto)),this.tempoInBpm=e,void(this.tempoEnum=a.adagietto)):o.isStringInStringList(o.listInstantaneousTempoAndanteModerato,this.label)?(0===e&&(e=o.getDefaultValueForTempoType(a.andanteModerato)),this.tempoInBpm=e,void(this.tempoEnum=a.andanteModerato)):o.isStringInStringList(o.listInstantaneousTempoAndante,this.label)?(0===e&&(e=o.getDefaultValueForTempoType(a.andante)),this.tempoInBpm=e,void(this.tempoEnum=a.andante)):o.isStringInStringList(o.listInstantaneousTempoAndantino,this.label)?(0===e&&(e=o.getDefaultValueForTempoType(a.andantino)),this.tempoInBpm=e,void(this.tempoEnum=a.andantino)):o.isStringInStringList(o.listInstantaneousTempoModerato,this.label)?(0===e&&(e=o.getDefaultValueForTempoType(a.moderato)),this.tempoInBpm=e,void(this.tempoEnum=a.moderato)):o.isStringInStringList(o.listInstantaneousTempoAllegretto,this.label)?(0===e&&(e=o.getDefaultValueForTempoType(a.allegretto)),this.tempoInBpm=e,void(this.tempoEnum=a.allegretto)):o.isStringInStringList(o.listInstantaneousTempoAllegroModerato,this.label)?(0===e&&(e=o.getDefaultValueForTempoType(a.allegroModerato)),this.tempoInBpm=e,void(this.tempoEnum=a.allegroModerato)):o.isStringInStringList(o.listInstantaneousTempoAllegro,this.label)?(0===e&&(e=o.getDefaultValueForTempoType(a.allegro)),this.tempoInBpm=e,void(this.tempoEnum=a.allegro)):o.isStringInStringList(o.listInstantaneousTempoVivace,this.label)?(0===e&&(e=o.getDefaultValueForTempoType(a.vivace)),this.tempoInBpm=e,void(this.tempoEnum=a.vivace)):o.isStringInStringList(o.listInstantaneousTempoVivacissimo,this.label)?(0===e&&(e=o.getDefaultValueForTempoType(a.vivacissimo)),this.tempoInBpm=e,void(this.tempoEnum=a.vivacissimo)):o.isStringInStringList(o.listInstantaneousTempoAllegrissimo,this.label)?(0===e&&(e=o.getDefaultValueForTempoType(a.allegrissimo)),this.tempoInBpm=e,void(this.tempoEnum=a.allegrissimo)):o.isStringInStringList(o.listInstantaneousTempoPresto,this.label)?(0===e&&(e=o.getDefaultValueForTempoType(a.presto)),this.tempoInBpm=e,void(this.tempoEnum=a.presto)):o.isStringInStringList(o.listInstantaneousTempoPrestissimo,this.label)?(0===e&&(e=o.getDefaultValueForTempoType(a.prestissimo)),this.tempoInBpm=e,void(this.tempoEnum=a.prestissimo)):o.isStringInStringList(o.listInstantaneousTempoAddons,this.label)?(this.tempoInBpm=0,void(this.tempoEnum=a.addon)):o.isStringInStringList(o.listInstantaneousTempoChangesGeneral,this.label)?(this.tempoInBpm=0,void(this.tempoEnum=a.changes)):void 0:(this.tempoInBpm=e,void(this.tempoEnum=a.metronomeMark))}}var a;t.InstantaneousTempoExpression=o,o.listInstantaneousTempoLarghissimo=["Larghissimo","Sehr breit","very, very slow"],o.listInstantaneousTempoGrave=["Grave","Schwer","slow and solemn"],o.listInstantaneousTempoLento=["Lento","Lent","Langsam","slowly"],o.listInstantaneousTempoLargo=["Largo","Breit","broadly"],o.listInstantaneousTempoLarghetto=["Larghetto","Etwas breit","rather broadly"],o.listInstantaneousTempoAdagio=["Adagio","Langsam","Ruhig","slow and stately"],o.listInstantaneousTempoAdagietto=["Adagietto","Ziemlich ruhig","Ziemlich langsam","rather slow"],o.listInstantaneousTempoAndanteModerato=["Andante moderato"],o.listInstantaneousTempoAndante=["Andante","Gehend","Schreitend","at a walking pace"],o.listInstantaneousTempoAndantino=["Andantino","Maestoso"],o.listInstantaneousTempoModerato=["Moderato","Mäßig","Modéré","moderately"],o.listInstantaneousTempoAllegretto=["Allegretto","Animato","fast"],o.listInstantaneousTempoAllegroModerato=["Allegro moderato"],o.listInstantaneousTempoAllegro=["Allegro","Rapide","Vite","Rasch","Schnell","Fröhlich"],o.listInstantaneousTempoVivace=["Vivace","Allegro Assai","Lebhaft","Lebendig","lively and fast"],o.listInstantaneousTempoVivacissimo=["Vivacissimo","Sehr lebhaft","Sehr lebendig"],o.listInstantaneousTempoAllegrissimo=["Allegrissimo","very fast"],o.listInstantaneousTempoPresto=["Presto","Sehr schnell","Geschwind"],o.listInstantaneousTempoPrestissimo=["Prestissimo","äußerst schnell"],o.listInstantaneousTempoChangesGeneral=["tempo primo","a tempo","tempo i","rubato","doppio movimento","rallentando","ritardando","ritard.","rit.","ritard","rall...","accelerando","accel"],o.listInstantaneousTempoAddons=["assai","amoroso","cantabile","con brio","con dolore","con espressione","con fuoco","con moto","con spirito","spiritoso","espressivo","giocoso","giusto","grazioso","lesto","lugubre","maestoso","ma non troppo","marcato","molto","morendo","mosso","non tanto","piu","un poco","poco","quasi","risoluto","scherzando","sostenuto","teneramente","tempo giusto","tranquillo","sehr","lieblich","liebevoll","mit Leidenschaft","mit Liebe","amourös","gesanglich","mit Schwung","mit Feuer","mit Schmerz","mit Ausdruck","mit Bewegung","geistvoll","ausdrucksvoll","freudig","verspielt","angemessen","graziös","mit Grazie","flink","behände","traurig","klagend","majestätisch","aber nicht zu sehr","markant","gemäßigt","viel","sehr","ersterbend","bewegt","nicht zu sehr","mehr","ein wenig","gleichsam","entschlossen","zupackend","heiter","nachdrücklich","getragen","gewichtig","zart","zärtlich","im angemessenen Zeitmaß","ruhig","ein wenig","alla marcia","ad libitum","alla breve"],function(e){e[e.none=0]="none",e[e.larghissimo=1]="larghissimo",e[e.grave=2]="grave",e[e.lento=3]="lento",e[e.largo=4]="largo",e[e.larghetto=5]="larghetto",e[e.adagio=6]="adagio",e[e.adagietto=7]="adagietto",e[e.andanteModerato=8]="andanteModerato",e[e.andante=9]="andante",e[e.andantino=10]="andantino",e[e.moderato=11]="moderato",e[e.allegretto=12]="allegretto",e[e.allegroModerato=13]="allegroModerato",e[e.allegro=14]="allegro",e[e.vivace=15]="vivace",e[e.vivacissimo=16]="vivacissimo",e[e.allegrissimo=17]="allegrissimo",e[e.presto=18]="presto",e[e.prestissimo=19]="prestissimo",e[e.lastRealTempo=20]="lastRealTempo",e[e.addon=21]="addon",e[e.changes=22]="changes",e[e.metronomeMark=23]="metronomeMark"}(a||(t.TempoEnum=a={}))},9252:(e,t,i)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.Instrument=void 0;const s=i(7586),n=i(7435),r=i(1910);class o extends s.InstrumentalGroup{constructor(e,t,i,s){super(void 0,i,s),this.Transpose=0,this.voices=[],this.staves=[],this.hasLyrics=!1,this.hasChordSymbols=!1,this.lyricVersesNumbers=[],this.subInstruments=[],this.id=e,this.idString=t,this.nameLabel=new n.Label(t)}get Voices(){return this.voices}get Staves(){return this.staves}get NameLabel(){return this.nameLabel}get HasLyrics(){return this.hasLyrics}set HasLyrics(e){this.hasLyrics=e}get HasChordSymbols(){return this.hasChordSymbols}set HasChordSymbols(e){this.hasChordSymbols=e}get LyricVersesNumbers(){return this.lyricVersesNumbers}set LyricVersesNumbers(e){this.lyricVersesNumbers=e}get Name(){return this.nameLabel.text}set Name(e){this.nameLabel.text=e}get IdString(){return this.idString}get Id(){return this.id}get MidiInstrumentId(){return this.subInstruments[0].midiInstrumentID}set MidiInstrumentId(e){this.subInstruments[0].midiInstrumentID=e}get Volume(){return this.subInstruments[0].volume}set Volume(e){for(let t=0,i=this.subInstruments.length;t<i;++t)this.subInstruments[t].volume=e}get PlaybackTranspose(){return this.playbackTranspose}set PlaybackTranspose(e){this.playbackTranspose=e}get SubInstruments(){return this.subInstruments}getSubInstrument(e){for(let t=0,i=this.subInstruments.length;t<i;++t){const i=this.subInstruments[t];if(i.idString===e)return i}}get PartAbbreviation(){return this.partAbbreviation}set PartAbbreviation(e){this.partAbbreviation=e}get Visible(){return this.voices.length>0&&this.Voices[0].Visible}isVisible(){if(!this.Visible)return!1;for(const e of this.Staves)if(e.Visible)return!0;return!1}set Visible(e){for(let t=0,i=this.Voices.length;t<i;++t)this.Voices[t].Visible=e}get Audible(){let e=!1;for(let t=0,i=this.Voices.length;t<i;++t){const i=this.Voices[t];e=e||i.Audible}return e}set Audible(e){for(let t=0,i=this.Voices.length;t<i;++t)this.Voices[t].Audible=e;for(let t=0,i=this.staves.length;t<i;++t)this.staves[t].audible=e}get Following(){let e=!1;for(let t=0,i=this.Voices.length;t<i;++t){const i=this.Voices[t];e=e||i.Following}return e}set Following(e){for(let t=0,i=this.Voices.length;t<i;++t)this.Voices[t].Following=e;for(let t=0,i=this.staves.length;t<i;++t)this.staves[t].following=e}SetVoiceAudible(e,t){for(let i=0,s=this.Voices.length;i<s;++i){const s=this.Voices[i];if(s.VoiceId===e){s.Audible=t;break}}}SetVoiceFollowing(e,t){for(let i=0,s=this.Voices.length;i<s;++i){const s=this.Voices[i];if(s.VoiceId===e){s.Following=t;break}}}SetStaffAudible(e,t){const i=this.staves[e-1];if(i.audible=t,t)for(let e=0,t=i.Voices.length;e<t;++e)i.Voices[e].Audible=!0;else for(let t=0,s=i.Voices.length;t<s;++t){const s=i.Voices[t];let n=!1;for(let t=0,i=this.Staves.length;t<i;++t){const i=this.Staves[t];if(i.Id!==e&&i.audible)for(let e=0,t=i.Voices.length;e<t;++e)i.Voices[e]===s&&(n=!0)}n||(s.Audible=!1)}}SetStaffFollow(e,t){const i=this.staves[e-1];if(i.following=t,t)for(let e=0,t=i.Voices.length;e<t;++e)i.Voices[e].Following=!0;else for(let t=0,s=i.Voices.length;t<s;++t){const s=i.Voices[t];let n=!1;for(let t=0,i=this.Staves.length;t<i;++t){const i=this.Staves[t];if(i.Id!==e&&i.following)for(let e=0,t=i.Voices.length;e<t;++e)i.Voices[e]===s&&(n=!0)}n||(s.Following=!1)}}areAllVoiceVisible(){for(const e of this.Voices)if(!e.Visible)return!1;return!0}createStaves(e){for(let t=0;t<e;t++)this.staves.push(new r.Staff(this,t+1))}toString(){return`${this.Name} , id: ${this.id}, idstring: ${this.idString}`}}t.Instrument=o},9288:(e,t,i)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.RhythmSymbolEnum=t.RhythmInstruction=void 0;const s=i(5364);class n extends s.AbstractNotationInstruction{constructor(e,t){super(void 0),this.rhythm=e,this.numerator=e.Numerator,this.denominator=e.Denominator,this.symbolEnum=t}get Rhythm(){return this.rhythm}set Rhythm(e){this.rhythm=e}get SymbolEnum(){return this.symbolEnum}set SymbolEnum(e){this.symbolEnum=e}clone(){return new n(this.rhythm.clone(),this.symbolEnum)}OperatorEquals(e){const t=this;return t===e||!(!t||!e)&&t.numerator===e.numerator&&t.denominator===e.denominator}OperatorNotEqual(e){return!(this===e)}ToString(){return"Rhythm: "+this.rhythm.toString()}}var r;t.RhythmInstruction=n,function(e){e[e.NONE=0]="NONE",e[e.COMMON=1]="COMMON",e[e.CUT=2]="CUT"}(r||(t.RhythmSymbolEnum=r={}))},9310:function(e,t,i){var s=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.VexFlowOctaveShift=void 0;var n=s(i(3206)).default.Flow;const r=i(2768),o=i(437),a=s(i(3065));class l extends r.GraphicalOctaveShift{constructor(e,t){switch(super(e,t),e.Type){case o.OctaveEnum.VA8:this.position=n.TextBracket.Positions.TOP,this.supscript="va",this.text="8";break;case o.OctaveEnum.MA15:this.position=n.TextBracket.Positions.TOP,this.supscript="ma",this.text="15";break;case o.OctaveEnum.VB8:this.position=n.TextBracket.Positions.BOTTOM,this.supscript="vb",this.text="8";break;case o.OctaveEnum.MB15:this.position=n.TextBracket.Positions.BOTTOM,this.supscript="mb",this.text="15";break;default:a.default.error("Unknown or NONE octaveshift. This should not be called!")}}setStartNote(e){for(const t of e.graphicalVoiceEntries){const e=t;if(e?.vfStaveNote)return this.startNote=e.vfStaveNote,!0}return!1}setEndNote(e){for(const t of e.graphicalVoiceEntries){const i=t;if(i?.vfStaveNote)return this.endNote=i.vfStaveNote,this.endMeasure=e.parentMeasure,this.endMeasure?.parentSourceMeasure.Rules.OctaveShiftOnWholeMeasureNoteUntilEndOfMeasure&&i.notes[0].sourceNote.isWholeMeasureNote()&&(this.graphicalEndAtMeasureEnd=!0),!0}return!1}getTextBracket(){let e,t=this.endNote;const i=this;this.graphicalEndAtMeasureEnd&&(e={getAbsoluteX:()=>10*(i.endMeasure.PositionAndShape.AbsolutePosition.x+i.endMeasure.PositionAndShape.Size.width),getGlyph:()=>({getWidth:()=>0})}),e&&(t=e);const s=new n.TextBracket({position:this.position,start:this.startNote,stop:t,superscript:this.supscript,text:this.text});return this.endsOnDifferentStaffLine&&(s.render_options.show_bracket=!1),s}}t.VexFlowOctaveShift=l},9409:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.PointF2D=void 0;class i{constructor(e=0,t=0){this.x=0,this.y=0,this.x=e,this.y=t}static get Empty(){return new i}static pointsAreEqual(e,t){return e.x===t.x&&e.y===t.y}ToString(){return"["+this.x+", "+this.y+"]"}}t.PointF2D=i},9436:function(e,t,i){var s=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.SvgVexFlowBackend=void 0;var n=s(i(3206)).default.Flow;const r=i(1902),o=i(6014),a=i(2570),l=i(624),u=s(i(3065));class c extends r.VexFlowBackend{constructor(e){super(),this.rules=e}getVexflowBackendType(){return n.Renderer.Backends.SVG}getOSMDBackendType(){return l.BackendType.SVG}getCanvasSize(){return document.getElementById("osmdCanvasPage"+this.graphicalMusicPage.PageNumber)?.offsetHeight}initialize(e,t){this.zoom=t,this.canvas=document.createElement("div"),this.canvas.id="osmdCanvasPage"+this.graphicalMusicPage.PageNumber,this.inner=this.canvas,this.inner.style.position="relative",this.canvas.style.zIndex="0",e.appendChild(this.inner),this.renderer=new n.Renderer(this.canvas,this.getVexflowBackendType()),this.ctx=this.renderer.getContext(),this.ctx.svg.id="osmdSvgPage"+this.graphicalMusicPage.PageNumber}getContext(){return this.ctx}getSvgElement(){return this.ctx.svg}removeNode(e){const t=this.ctx?.svg;if(!t)return!1;try{t.removeChild(e)}catch(e){return u.default.error(e),!1}return!0}free(){const e=this.ctx.svg;for(;e.lastChild;)e.removeChild(e.lastChild)}clear(){this.ctx&&(this.free(),this.rules.PageBackgroundColor&&(this.ctx.svg.style["background-color"]=this.rules.PageBackgroundColor))}scale(e){this.ctx.scale(e,e)}translate(e,t){}renderText(e,t,i,s,n,r,l=void 0,u=void 0){this.ctx.save();const c=this.ctx.openGroup("text");l&&(this.ctx.attributes.fill=l,this.ctx.attributes.stroke=l);let h=u;u&&"default"!==u||(h=this.rules.DefaultFontFamily),this.ctx.setFont(h,e,o.VexFlowConverter.fontStyle(t)),this.ctx.attributes["font-size"]=`${e}px`,this.ctx.state["font-size"]=`${e}px`;let d="normal",m="normal";switch(t){case a.FontStyles.Bold:d="bold";break;case a.FontStyles.Italic:m="italic";break;case a.FontStyles.BoldItalic:d="bold",m="italic";break;default:d="normal"}return this.ctx.attributes["font-weight"]=d,this.ctx.state["font-weight"]=d,this.ctx.attributes["font-style"]=m,this.ctx.state["font-style"]=m,this.ctx.fillText(s,r.x,r.y+n),this.ctx.closeGroup(),this.ctx.restore(),c}renderRectangle(e,t,i,s=1){this.ctx.save();const n=this.ctx.openGroup("rect");return this.ctx.attributes.fill=i||o.VexFlowConverter.style(t),this.ctx.attributes["fill-opacity"]=s,this.ctx.fillRect(e.x,e.y,e.width,e.height),this.ctx.restore(),this.ctx.attributes["fill-opacity"]=1,this.ctx.closeGroup(),n}renderLine(e,t,i="#FF0000FF",s=2,n){this.ctx.save();const r=this.ctx.openGroup("line",n);return this.ctx.beginPath(),this.ctx.moveTo(e.x,e.y),this.ctx.lineTo(t.x,t.y),this.ctx.attributes.stroke=i,this.ctx.lineWidth=s,this.ctx.stroke(),this.ctx.closeGroup(),this.ctx.restore(),r}renderCurve(e){const t=this.ctx.openGroup("curve");return this.ctx.beginPath(),this.ctx.moveTo(e[0].x,e[0].y),this.ctx.bezierCurveTo(e[1].x,e[1].y,e[2].x,e[2].y,e[3].x,e[3].y),this.ctx.lineTo(e[7].x,e[7].y),this.ctx.bezierCurveTo(e[6].x,e[6].y,e[5].x,e[5].y,e[4].x,e[4].y),this.ctx.lineTo(e[0].x,e[0].y),this.ctx.closePath(),this.ctx.fill(),this.ctx.closeGroup(),t}renderPath(e,t=!0,i){const s=this.ctx.openGroup("path",i);let n;this.ctx.beginPath();for(const t of e)n?this.ctx.lineTo(t.x,t.y):(this.ctx.moveTo(t.x,t.y),n=t);return this.ctx.closePath(),t?this.ctx.fill():this.ctx.stroke(),this.ctx.stroke(),this.ctx.closeGroup(),s}export(){const e=this.ctx.svg.cloneNode(!0),t=document.implementation.createDocumentType("svg","-//W3C//DTD SVG 1.1//EN","http://www.w3.org/Graphics/SVG/1.1/DTD/svg11.dtd"),i=document.implementation.createDocument("http://www.w3.org/2000/svg","svg",t);i.replaceChild(e,i.documentElement);const s=(new XMLSerializer).serializeToString(i),n=document.createElement("a");n.href="data:image/svg+xml; charset=utf8, "+encodeURIComponent(s.replace(/></g,">\n\r<")),n.download="opensheetmusicdisplay_download.svg",n.innerHTML=window.location.href+"/download",document.body.appendChild(n)}}t.SvgVexFlowBackend=c},9479:function(e,t,i){var s=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.VexFlowMusicSheetDrawer=t.unitInPixels=void 0;const n=s(i(3206)),r=i(1932),o=i(200),a=i(9409),l=i(7785),u=i(2683),c=i(6362),h=i(3361),d=i(5023),m=s(i(3065)),f=i(1066),p=i(3661),S=i(5824),g=i(9436);t.unitInPixels=10;class y extends r.MusicSheetDrawer{constructor(e=new p.DrawingParameters){super(new l.VexFlowTextMeasurer(e.Rules),e),this.backends=[],this.zoom=1,this.pageIdx=0}get Backends(){return this.backends}drawSheet(e){"gonville"===this.rules.DefaultVexFlowNoteFont&&(n.default.Flow.DEFAULT_FONT_STACK=[n.default.Flow.Fonts?.Gonville,n.default.Flow.Fonts?.Bravura,n.default.Flow.Fonts?.Custom]),n.default.Flow.STAVE_LINE_THICKNESS=this.rules.StaffLineWidth*t.unitInPixels,n.default.Flow.STEM_WIDTH=this.rules.StemWidth*t.unitInPixels,n.default.Flow.DEFAULT_NOTATION_FONT_SCALE=this.rules.VexFlowDefaultNotationFontScale,n.default.Flow.DEFAULT_TAB_FONT_SCALE=this.rules.VexFlowDefaultTabFontScale,this.pageIdx=0;for(const t of e.MusicPages){if(t.PageNumber>this.rules.MaxPageToDrawNumber)break;const e=this.backends[this.pageIdx];e.graphicalMusicPage=t,e.scale(this.zoom),this.pageIdx+=1}this.pageIdx=0,this.backend=this.backends[0],super.drawSheet(e)}drawPage(e){e&&(this.backend=this.backends[e.PageNumber-1],super.drawPage(e),this.pageIdx+=1)}clear(){for(const e of this.backends)e.clear()}setZoom(e){this.zoom=e}calculatePixelDistance(e){return e*t.unitInPixels}drawStaffLine(e){const t=this.backend.getContext(),i=t.openGroup();i&&(i.classList.add("staffline"),e.ParentStaff&&(i.id=`${e.ParentStaff.ParentInstrument?.Name}${e.ParentStaff.ParentInstrument?.Id}-${e.ParentStaff?.Id}`)),super.drawStaffLine(e);const s=e.PositionAndShape.AbsolutePosition;this.rules.RenderSlurs&&this.drawSlurs(e,s),this.rules.RenderGlissandi&&this.drawGlissandi(e,s),t.closeGroup()}drawSlurs(e,t){for(const i of e.GraphicalSlurs)i.slur.isCrossed()||this.drawSlur(i,t)}drawGlissandi(e,t){for(const i of e.GraphicalGlissandi)this.drawGlissando(i,t)}drawGlissando(e,t){if(e.StaffLine.ParentStaff.isTab||e.calculateLine(this.rules),e.Line){const i=new a.PointF2D(e.Line.Start.x+t.x,e.Line.Start.y),s=new a.PointF2D(e.Line.End.x+t.x,e.Line.End.y);e.Line.SVGElement=this.drawLine(i,s,e.Color,e.Width)}else{const t=e.vfTie;if(t){const e=this.backend.getContext();t.setContext(e),t.draw()}}}drawSlur(e,t){const i=[],s=new a.PointF2D(e.bezierStartPt.x+t.x,e.bezierStartPt.y+t.y),n=new a.PointF2D(e.bezierStartControlPt.x+t.x,e.bezierStartControlPt.y+t.y),r=new a.PointF2D(e.bezierEndControlPt.x+t.x,e.bezierEndControlPt.y+t.y),o=new a.PointF2D(e.bezierEndPt.x+t.x,e.bezierEndPt.y+t.y);i.push(this.applyScreenTransformation(s)),i.push(this.applyScreenTransformation(n)),i.push(this.applyScreenTransformation(r)),i.push(this.applyScreenTransformation(o)),e.placement===c.PlacementEnum.Above?(s.y-=.05,n.y-=.3,r.y-=.3,o.y-=.05):(s.y+=.05,n.y+=.3,r.y+=.3,o.y+=.05),i.push(this.applyScreenTransformation(s)),i.push(this.applyScreenTransformation(n)),i.push(this.applyScreenTransformation(r)),i.push(this.applyScreenTransformation(o)),e.SVGElement=this.backend.renderCurve(i)}drawMeasure(e){e.setAbsoluteCoordinates(e.PositionAndShape.AbsolutePosition.x*t.unitInPixels,e.PositionAndShape.AbsolutePosition.y*t.unitInPixels);try{e.draw(this.backend.getContext())}catch(e){m.default.warn("VexFlowMusicSheetDrawer.drawMeasure",e)}let i=0;for(const t of e.staffEntries)this.drawStaffEntry(t),i=this.drawBuzzRolls(t,i)}drawBuzzRolls(e,t){for(const i of e.graphicalVoiceEntries)for(const e of i.notes)if(e.sourceNote.TremoloInfo?.tremoloUnmeasured){const i=this.rules.TremoloBuzzRollThickness,s=.9,n=.5,r=e;let o,l;const u=r.vfnote[0].getStemDirection();let c;if(this.backend instanceof g.SvgVexFlowBackend&&(c=r.getStemSVG()),void 0!==c?.getBbox){const e=c.getBBox();o=new a.PointF2D(e.x/10,e.y/10),l=e.height/10}else l=r.vfnote[0].getStemLength()/10,o=new a.PointF2D(r.vfnote[0].getStem().x_begin/10,r.vfnote[0].getStem().y_top/10),1===u&&(o.y-=l);let h=o.y+l/3;r.vfnote[0].getBeamCount()>1&&(h=o.y+l/2,-1===u&&(h-=n+.2));const d=o.x-.5,m=h,f=[],p=[new a.PointF2D(0,-i),new a.PointF2D(s-i,0),new a.PointF2D(-s+i,-n),new a.PointF2D(0,-i),new a.PointF2D(s,0),new a.PointF2D(0,i),new a.PointF2D(-s+i,0),new a.PointF2D(s-i,n),new a.PointF2D(0,i),new a.PointF2D(-s,0)];let S=new a.PointF2D(d,m);f.push(S);for(const e of p)S=f.last(),f.push(new a.PointF2D(S.x+e.x,S.y-e.y));this.DrawPath(f,r.ParentMusicPage,!0,`buzzRoll${t}`),t++}return t}drawLine(e,i,s="#000000FF",n=.2){return e=this.applyScreenTransformation(e),i=this.applyScreenTransformation(i),this.backend.renderLine(e,i,s,n*t.unitInPixels)}DrawOverlayLine(e,i,s,n="#FF0000FF",r=.2,o){if(!s.PageNumber||s.PageNumber>this.backends.length||s.PageNumber<1)return void console.log("VexFlowMusicSheetDrawer.drawOverlayLine: invalid page number / music page number doesn't correspond to an existing backend.");const a=s.PageNumber-1,l=this.backends[a];return e=this.applyScreenTransformation(e),i=this.applyScreenTransformation(i),o||(o=`overlayLine ${e.x}/${e.y}`),l.renderLine(e,i,n,r*t.unitInPixels,o)}DrawPath(e,t,i=!0,s){const n=t.PageNumber-1,r=this.backends[n],o=[];for(const t of e)o.push(this.applyScreenTransformation(t));return r.renderPath(o,i,s)}drawSkyLine(e){const t=e.PositionAndShape.AbsolutePosition,i=e.PositionAndShape.Size.width;this.drawSampledLine(e.SkyLine,t,i)}drawBottomLine(e){const t=new a.PointF2D(e.PositionAndShape.AbsolutePosition.x,e.PositionAndShape.AbsolutePosition.y),i=e.PositionAndShape.Size.width;this.drawSampledLine(e.BottomLine,t,i,"#0000FFFF")}drawSampledLine(e,t,i,s="#FF0000FF"){const n=[];let r=0;for(let t=0;t<e.length;t++)e[t]!==r&&(n.push(t),r=e[t]);const o=t;if(n.length>0){const t=this.rules.SamplingUnit;let r,l,u=new a.PointF2D(o.x,o.y),c=new a.PointF2D(n[0]/t+o.x,o.y);this.drawLine(u,c,s),e[0]>=0&&(r=new a.PointF2D(n[0]/t+o.x,o.y),l=new a.PointF2D(n[0]/t+o.x,o.y+e[n[0]]),this.drawLine(r,l,s));for(let i=1;i<n.length;i++)u=new a.PointF2D(n[i-1]/t+o.x,o.y+e[n[i-1]]),c=new a.PointF2D(n[i]/t+o.x,o.y+e[n[i-1]]),this.drawLine(u,c,s),r=new a.PointF2D(n[i]/t+o.x,o.y+e[n[i-1]]),l=new a.PointF2D(n[i]/t+o.x,o.y+e[n[i]]),this.drawLine(r,l,s);n[n.length-1]<e.length?(u=new a.PointF2D(n[n.length-1]/t+o.x,o.y+e[n[n.length-1]]),c=new a.PointF2D(o.x+i,o.y+e[n[n.length-1]]),this.drawLine(u,c,s)):(u=new a.PointF2D(n[n.length-1]/t+o.x,o.y),c=new a.PointF2D(o.x+i,o.y),this.drawLine(u,c,s))}else{const e=new a.PointF2D(o.x,o.y),t=new a.PointF2D(o.x+i,o.y);this.drawLine(e,t,s)}}drawStaffEntry(e){if(e.FingeringEntries.length>0)for(const t of e.FingeringEntries)t.SVGNode=this.drawLabel(t,u.GraphicalLayers.Notes);if(void 0!==e.graphicalChordContainers&&e.graphicalChordContainers.length>0)for(const t of e.graphicalChordContainers){const e=t.GraphicalLabel;e.SVGNode=this.drawLabel(e,u.GraphicalLayers.Notes)}this.rules.RenderLyrics&&e.LyricsEntries.length>0&&this.drawLyrics(e.LyricsEntries,u.GraphicalLayers.Notes)}drawLyrics(e,t){e.forEach(e=>{const i=e.GraphicalLabel;i.Label.colorDefault=this.rules.DefaultColorLyrics,i.SVGNode=this.drawLabel(i,t),i.SVGNode?.classList.add("lyrics")})}drawInstrumentBrace(e,t){const i=this.backend.getContext();i.openGroup("brace"),e.draw(i),i.closeGroup()}drawGroupBracket(e,t){const i=this.backend.getContext();i.openGroup("bracket"),e.draw(i),i.closeGroup()}drawOctaveShifts(e){for(const t of e.OctaveShifts)if(t){const e=t,i=this.backend.getContext(),s=e.getTextBracket();this.rules.DefaultColorMusic&&(s.render_options.color=this.rules.DefaultColorMusic),s.setContext(i);try{s.draw()}catch(e){m.default.warn(e)}}}drawPedals(e){for(const t of e.Pedals)if(t){const e=t,i=this.backend.getContext(),s=e.getPedalMarking();s.render_options.color=this.rules.DefaultColorMusic,s.setContext(i),s.draw()}}drawExpressions(e){for(const t of e.AbstractExpressions)if(t instanceof d.GraphicalInstantaneousDynamicExpression)this.drawInstantaneousDynamic(t);else if(t instanceof h.GraphicalInstantaneousTempoExpression){const e=t.GraphicalLabel;e.SVGNode=this.drawLabel(e,u.GraphicalLayers.Notes)}else if(t instanceof f.GraphicalContinuousDynamicExpression)this.drawContinuousDynamic(t);else if(t instanceof S.GraphicalUnknownExpression){const e=t.Label;e.SVGNode=this.drawLabel(e,u.GraphicalLayers.Notes)}else m.default.warn("Unkown type of expression!")}drawInstantaneousDynamic(e){const t=e.Label;t.SVGNode=this.drawLabel(t,u.GraphicalLayers.Notes)}drawContinuousDynamic(e){if(e.IsVerbal){const t=e.Label;t.SVGNode=this.drawLabel(t,u.GraphicalLayers.Notes)}else for(const t of e.Lines){const i=new a.PointF2D(e.ParentStaffLine.PositionAndShape.AbsolutePosition.x+t.Start.x,e.ParentStaffLine.PositionAndShape.AbsolutePosition.y+t.Start.y),s=new a.PointF2D(e.ParentStaffLine.PositionAndShape.AbsolutePosition.x+t.End.x,e.ParentStaffLine.PositionAndShape.AbsolutePosition.y+t.End.y);t.SVGElement=this.drawLine(i,s,t.colorHex??"#000000",t.Width)}}renderLabel(e,i,s,n,r,o){if(!e.Label.print)return;const l=e.Label.fontHeight*t.unitInPixels,{font:u}=e.Label;let c;this.rules.ColoringEnabled&&(c=e.Label.colorDefault,e.ColorXML&&(c=e.ColorXML),c||(c=this.rules.DefaultColorLabel));let h,{fontStyle:d,fontFamily:m}=e.Label;d||(d=this.rules.DefaultFontStyle),m||(m=this.rules.DefaultFontFamily);for(let t=0;t<e.TextLines?.length;t++){const i=e.TextLines[t],s=this.calculatePixelDistance(i.xOffset),n=new a.PointF2D(o.x+s,o.y),m=this.backend.renderText(l,d,u,i.text,r,n,c,e.Label.fontFamily);h?h.appendChild(m):h=m,o.y=o.y+r,e.TextLines.length>1&&(o.y+=this.rules.SpacingBetweenTextLines)}return h}renderRectangle(e,t,i,s,n){return this.backend.renderRectangle(e,i,s,n)}applyScreenTransformation(e){return new a.PointF2D(e.x*t.unitInPixels,e.y*t.unitInPixels)}applyScreenTransformationForRect(e){return new o.RectangleF2D(e.x*t.unitInPixels,e.y*t.unitInPixels,e.width*t.unitInPixels,e.height*t.unitInPixels)}}t.VexFlowMusicSheetDrawer=y},9490:(e,t,i)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.AbstractGraphicalExpression=void 0;const s=i(7741),n=i(6438);class r extends s.GraphicalObject{constructor(e,t,i){super(),this.expression=t,this.parentMeasure=i,this.boundingBox=new n.BoundingBox(this,e.PositionAndShape),this.parentStaffLine=e,this.parentStaffLine.AbstractExpressions.push(this),this.rules=e.ParentMusicSystem.rules}get Label(){return this.label}get ParentStaffLine(){return this.parentStaffLine}get SourceExpression(){return this.expression}get Placement(){return this.expression.Placement}}t.AbstractGraphicalExpression=r},9536:function(e,t,i){var s=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.ChordSymbolReader=void 0;const n=i(9719),r=i(8233),o=i(2148),a=s(i(3065)),l=i(6362);class u{static readChordSymbol(e,t,i){const s=e.element("root"),c=e.element("kind"),h=e.element("numeral"),d=c.attribute("text");if(!s&&!h)return;let m;const f=e.element("bass");if(f){const e=f.element("bass-step"),i=f.element("bass-alter");let s=r.NoteEnum.C;if(e)try{s=r.NoteEnum[e.value.trim()]}catch(e){const i=o.ITextTranslation.translateText("ReaderErrorMessages/ChordSymbolError","Invalid chord symbol");return t.SheetErrors.pushMeasureError(i),void a.default.debug("InstrumentReader.readChordSymbol",i,e)}let n=r.AccidentalEnum.NONE;if(i)try{n=r.Pitch.AccidentalFromHalfTones(parseInt(i.value,10))}catch(e){const i=o.ITextTranslation.translateText("ReaderErrorMessages/ChordSymbolError","Invalid chord symbol");t.SheetErrors.pushMeasureError(i),a.default.debug("InstrumentReader.readChordSymbol",i,e)}m=new r.Pitch(s,1,n)}const p=[],S=e.elements("degree");for(const e of S)if(e){const i=e.element("degree-value"),s=e.element("degree-alter"),l=e.element("degree-type");if(!i||!s||!l)return;let u,c,h;try{u=parseInt(i.value.trim(),10)}catch(e){const i=o.ITextTranslation.translateText("ReaderErrorMessages/ChordSymbolError","Invalid chord symbol");return t.SheetErrors.pushMeasureError(i),void a.default.debug("InstrumentReader.readChordSymbol",i,e)}try{c=r.Pitch.AccidentalFromHalfTones(parseInt(s.value,10))}catch(e){const i=o.ITextTranslation.translateText("ReaderErrorMessages/ChordSymbolError","Invalid chord symbol");return t.SheetErrors.pushMeasureError(i),void a.default.debug("InstrumentReader.readChordSymbol",i,e)}try{h=n.ChordDegreeText[l.value.trim().toLowerCase()]}catch(e){const i=o.ITextTranslation.translateText("ReaderErrorMessages/ChordSymbolError","Invalid chord symbol");return t.SheetErrors.pushMeasureError(i),void a.default.debug("InstrumentReader.readChordSymbol",i,e)}p.push(new n.Degree(u,c,h))}let g=u.readPlacement(e);if(g!==l.PlacementEnum.Below&&(g=l.PlacementEnum.Above),h){const e=h.element("numeral-root"),i=e?.attribute("text")?.value,s=i??e?.value,r=new n.ChordSymbolContainer(void 0,n.ChordSymbolEnum.none,m,p,t.Rules,g);return r.NumeralText=s,r}const y=s.element("root-step"),E=s.element("root-alter");if(s&&!y)return;let M;try{M=r.NoteEnum[y.value.trim()]}catch(e){const i=o.ITextTranslation.translateText("ReaderErrorMessages/ChordSymbolError","Invalid chord symbol");return t.SheetErrors.pushMeasureError(i),void a.default.debug("InstrumentReader.readChordSymbol",i,e)}let b=r.AccidentalEnum.NONE;if(E)try{b=r.Pitch.AccidentalFromHalfTones(parseInt(E.value,10))}catch(e){const i=o.ITextTranslation.translateText("ReaderErrorMessages/ChordSymbolError","Invalid chord symbol");t.SheetErrors.pushMeasureError(i),a.default.debug("InstrumentReader.readChordSymbol",i,e)}const P=new r.Pitch(M,1,b);let L,v=c.value.trim().replace("-","");if(d)switch(d.value){case"aug":v="augmented";break;case"dim":v="diminished"}try{L=n.ChordSymbolEnum[v]}catch(e){const i=o.ITextTranslation.translateText("ReaderErrorMessages/ChordSymbolError","Invalid chord symbol");return t.SheetErrors.pushMeasureError(i),void a.default.debug("InstrumentReader.readChordSymbol",i,e)}return new n.ChordSymbolContainer(P,L,m,p,t.Rules,g)}static readPlacement(e){const t=e.attribute("placement")?.value;return"above"===t?l.PlacementEnum.Above:"below"===t?l.PlacementEnum.Below:l.PlacementEnum.NotYetDefined}}t.ChordSymbolReader=u},9635:(e,t,i)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.VexFlowGraphicalNote=void 0;const s=i(3430),n=i(6014),r=i(437);class o extends s.GraphicalNote{constructor(e,t,i,s=r.OctaveEnum.NONE,o,a=void 0){if(super(e,t,o,a),this.clef=i,this.octaveShift=s,e.Pitch){const t=e.isRest()?e.Pitch:r.OctaveShift.getPitchFromOctaveShift(e.Pitch,s);this.vfpitch=n.VexFlowConverter.pitch(t,e.isRest(),this.clef,this.sourceNote.Notehead),this.vfpitch[1]=void 0}}setAccidental(e){const t=this.drawPitch(e);this.vfpitch=n.VexFlowConverter.pitch(t,this.sourceNote.isRest(),this.clef,this.sourceNote.Notehead),this.DrawnAccidental=t.Accidental}drawPitch(e){return r.OctaveShift.getPitchFromOctaveShift(e,this.octaveShift)}Transpose(e,t,i,s){const o=super.Transpose(e,t,i,s),a=r.OctaveShift.getPitchFromOctaveShift(o,this.octaveShift);return this.vfpitch=n.VexFlowConverter.pitch(a,this.sourceNote.isRest(),this.clef,this.sourceNote.Notehead),this.vfpitch[1]=void 0,a}setIndex(e,t){this.vfnote=[e,t],this.vfnoteIndex=t}notehead(e=void 0){let t=e;t||(t=this.vfnote[0]);const i=t.note_heads;return i&&i.length>this.vfnoteIndex&&i[this.vfnoteIndex]?t.note_heads[this.vfnoteIndex]:{line:0}}Clef(){return this.clef}getSVGId(){if(this.vfnote)return this.vfnote[0].getAttribute("id")}getSVGGElement(){if(this.vfnote)return this.vfnote[0].getAttribute("el")}getStemSVG(){return document.getElementById("vf-"+this.getSVGId()+"-stem")}getBeamSVGs(){const e=[];for(let t=0;;t++){const i=document.getElementById(`vf-${this.getSVGId()}-beam${t}`);if(!i)break;e.push(i)}return e}}t.VexFlowGraphicalNote=o},9647:(e,t,i)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.TabNote=void 0;const s=i(1850);class n extends s.Note{constructor(e,t,i,s,n,r,o,a,l){super(e,t,i,s,n),this.stringNumberTab=r,this.fretNumber=o,this.bendArray=a,this.vibratoStroke=l}get StringNumberTab(){return this.stringNumberTab}get FretNumber(){return this.fretNumber}get BendArray(){return this.bendArray}get VibratoStroke(){return this.vibratoStroke}hasTabEffects(){return this.bendArray?.length>0||this.vibratoStroke}}t.TabNote=n},9713:function(e,t,i){var s=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.PageFormat=t.EngravingRules=void 0;const n=i(1888),r=s(i(3065)),o=i(7533),a=i(6362),l=i(624),u=i(4434),c=i(3263),h=i(2257),d=i(8233),m=i(9719),f=i(3430);class p{constructor(){this.NoteDistances=[1,1,1.3,1.6,2,2.5,3,4],this.NoteDistancesScalingFactors=[1,2,4,8,16,32,64,128],this.DurationDistanceDict={},this.DurationScalingDistanceDict={},this.NoteToGraphicalNoteMapObjectCount=0,this.RenderCount=0,this.loadDefaultValues()}loadDefaultValues(){this.SamplingUnit=3*p.unit,this.SheetTitleHeight=4,this.SheetSubtitleHeight=2,this.SheetMinimumDistanceBetweenTitleAndSubtitle=1,this.SheetComposerHeight=2,this.SheetAuthorHeight=2,this.SheetCopyrightHeight=1.5,this.SheetCopyrightMargin=2,this.SheetComposerSubtitleUseLegacyParsing=!1,this.CompactMode=!1,this.PagePlacementEnum=n.PagePlacementEnum.Down,this.PageHeight=100001,this.PageTopMargin=5,this.PageTopMarginNarrow=0,this.PageBottomMargin=5,this.PageLeftMargin=5,this.PageRightMargin=5,this.TitleTopDistance=5,this.TitleBottomDistance=1,this.StaffDistance=7,this.BetweenStaffDistance=5,this.MinimumStaffLineDistance=4,this.MinSkyBottomDistBetweenStaves=1,this.StaffHeight=4,this.TabStaffInterlineHeight=1.1111,this.TabStaffInterlineHeightForBboxes=1.3,this.BetweenStaffLinesDistance=p.unit,this.SystemLeftMargin=0,this.SystemRightMargin=0,this.SystemLabelsRightMargin=2,this.SystemComposerDistance=2,this.SystemLyricistDistance=2,this.InstrumentLabelTextHeight=2,this.MinimumDistanceBetweenSystems=7,this.MinSkyBottomDistBetweenSystems=5,this.LastSystemMaxScalingFactor=1.4,this.AutoBeamNotes=!1,this.AutoBeamOptions={beam_middle_rests_only:!1,beam_rests:!1,maintain_stem_directions:!1},this.AutoBeamTabs=!1,this.BeamWidth=p.unit/2,this.BeamSpaceWidth=p.unit/3,this.BeamForwardLength=1.25*p.unit,this.FlatBeams=!1,this.FlatBeamOffset=20,this.FlatBeamOffsetPerBeam=10,this.ClefLeftMargin=.5,this.ClefRightMargin=.75,this.PercussionOneLineCutoff=3,this.PercussionForceVoicesOneLineCutoff=1,this.PercussionUseXMLDisplayStep=!0,this.PercussionXMLDisplayStepNoteValueShift=0,this.PercussionOneLineXMLDisplayStepOctaveOffset=0,this.PercussionUseCajon2NoteSystem=!1,this.BetweenKeySymbolsDistance=.2,this.KeyRightMargin=.75,this.RhythmRightMargin=1.25,this.ShowRhythmAgainAfterPartEndOrFinalBarline=!0,this.NewPartAndSystemAfterFinalBarline=!1,this.InStaffClefScalingFactor=.8,this.DistanceBetweenNaturalAndSymbolWhenCancelling=.4,this.NoteHelperLinesOffset=.25,this.MeasureLeftMargin=.7,this.MeasureRightMargin=0,this.DistanceBetweenLastInstructionAndRepetitionBarline=1,this.ArpeggioDistance=.6,this.StaccatoShorteningFactor=2,this.IdealStemLength=3,this.StemNoteHeadBorderYOffset=.2,this.StemMargin=.2,this.StemMinLength=2.5,this.StemMaxLength=4.5,this.BeamSlopeMaxAngle=10,this.StemMinAllowedDistanceBetweenNoteHeadAndBeamLine=1,this.SetWantedStemDirectionByXml=!0,this.GraceNoteScalingFactor=.6,this.GraceNoteXOffset=.2,this.GraceNoteGroupXMargin=0,this.WedgeOpeningLength=1.2,this.WedgeMeasureEndOpeningLength=.75,this.WedgeMeasureBeginOpeningLength=.75,this.WedgePlacementAboveY=-1.5,this.WedgePlacementBelowY=1.5,this.WedgeHorizontalMargin=.6,this.WedgeVerticalMargin=.5,this.DistanceOffsetBetweenTwoHorizontallyCrossedWedges=.3,this.WedgeMinLength=2,this.WedgeEndDistanceBetweenTimestampsFactor=1.75,this.ArticulationAboveNoteForStemUp=!1,this.SoftAccentWedgePadding=.4,this.SoftAccentSizeFactor=.6,this.DistanceBetweenAdjacentDynamics=.75,this.TempoChangeMeasureValidity=4,this.TempoContinousFactor=.7,this.StaccatoScalingFactor=.8,this.BetweenDotsDistance=.8,this.OrnamentAccidentalScalingFactor=.65,this.ChordSymbolTextHeight=2,this.ChordSymbolTextAlignmentTop=o.TextAlignmentEnum.LeftBottom,this.ChordSymbolTextAlignmentBottom=o.TextAlignmentEnum.LeftTop,this.ChordSymbolBottomMargin=.6,this.ChordSymbolRelativeXOffset=-1,this.ChordSymbolExtraXShiftForShortChordSymbols=.3,this.ChordSymbolExtraXShiftWidthThreshold=2,this.ChordSymbolXSpacing=1,this.ChordOverlapAllowedIntoNextMeasure=0,this.ChordSymbolYOffset=.1,this.ChordSymbolYPadding=0,this.ChordSymbolYAlignment=!0,this.ChordSymbolYAlignmentScope="staffline",this.ChordSymbolWholeMeasureRestXOffset=0,this.ChordSymbolWholeMeasureRestXOffsetMeasure1=-2,this.ChordAccidentalTexts=new c.Dictionary,this.resetChordAccidentalTexts(this.ChordAccidentalTexts,!1),this.ChordSymbolLabelTexts=new c.Dictionary,this.resetChordSymbolLabelTexts(this.ChordSymbolLabelTexts),this.CustomChords=[],this.resetChordNames(),this.RepetitionSymbolsYOffset=0,this.RepetitionEndInstructionXShiftAsPercentOfStaveWidth=.4,this.RehearsalMarkXOffsetDefault=10,this.RehearsalMarkXOffset=0,this.RehearsalMarkXOffsetSystemStartMeasure=-20,this.RehearsalMarkYOffsetDefault=-15,this.RehearsalMarkYOffsetAddedForRehearsalMarks=-12,this.RehearsalMarkYOffset=0,this.RehearsalMarkFontSize=10,this.MeasureNumberLabelHeight=1.5*p.unit,this.MeasureNumberLabelOffset=2,this.MeasureNumberLabelXOffset=-.5,this.TupletsRatioed=!1,this.TupletsBracketed=!1,this.TripletsBracketed=!1,this.TupletsBracketedUseXMLValue=!0,this.TupletNumberLabelHeight=1.5*p.unit,this.TupletNumberYOffset=.5,this.TupletNumberLimitConsecutiveRepetitions=!0,this.TupletNumberMaxConsecutiveRepetitions=2,this.TupletNumberAlwaysDisableAfterFirstMax=!0,this.TupletNumberUseShowNoneXMLValue=!0,this.LabelMarginBorderFactor=.1,this.TupletVerticalLineLength=.5,this.TupletNumbersInTabs=!0,this.TabTupletYOffsetBottom=1,this.TabTupletYOffsetTop=-3.5,this.TabTupletYOffsetEffects=1.5,this.TabTupletsBracketed=!0,this.TabBeamsRendered=!0,this.TabKeySignatureRendered=!1,this.TabKeySignatureSpacingAdded=!0,this.TabTimeSignatureRendered=!1,this.TabTimeSignatureSpacingAdded=!0,this.TabFingeringsRendered=!1,this.TabUseXNoteheadShapeForTabNote=!0,this.TabUseXNoteheadAlternativeGlyph=!0,this.TabXNoteheadScale=.9,this.SlurPlacementFromXML=!0,this.SlurPlacementAtStems=!1,this.SlurPlacementUseSkyBottomLine=!1,this.BezierCurveStepSize=1e3,this.calculateCurveParametersArrays(),this.TieGhostObjectWidth=.75,this.TieYPositionOffsetFactor=.3,this.MinimumNeededXspaceForTieGhostObject=1,this.TieHeightMinimum=.28,this.TieHeightMaximum=1.2,this.TieHeightInterpolationK=.0288,this.TieHeightInterpolationD=.136,this.SlurNoteHeadYOffset=.5,this.SlurEndArticulationYOffset=.8,this.SlurStartArticulationYOffsetOfArticulation=.5,this.SlurStemXOffset=.3,this.SlurSlopeMaxAngle=15,this.SlurTangentMinAngle=30,this.SlurTangentMaxAngle=80,this.SlurHeightFactor=1,this.SlurHeightFlattenLongSlursFactorByWidth=.24,this.SlurHeightFlattenLongSlursFactorByAngle=.36,this.SlurHeightFlattenLongSlursCutoffAngle=47,this.SlurHeightFlattenLongSlursCutoffWidth=16,this.SlursStartingAtSameStaffEntryYOffset=.8,this.SlurMaximumYControlPointDistance=void 0,this.GlissandoNoteOffset=.5,this.GlissandoStafflineStartMinimumWidth=1,this.GlissandoStafflineStartYDistanceToNote=.8,this.GlissandoStafflineEndOffset=1,this.GlissandoDefaultWidth=.1,this.RepetitionAllowFirstMeasureBeginningRepeatBarline=!0,this.RepetitionEndingLabelHeight=2,this.RepetitionEndingLabelXOffset=.5,this.RepetitionEndingLabelYOffset=.3,this.RepetitionEndingLineYLowerOffset=.5,this.RepetitionEndingLineYUpperOffset=.3,this.VoltaOffset=2.5,this.LyricsAlignmentStandard=o.TextAlignmentEnum.LeftBottom,this.LyricsHeight=2,this.LyricsYOffsetToStaffHeight=0,this.LyricsYMarginToBottomLine=.2,this.LyricsExtraXShiftForShortLyrics=.5,this.LyricsExtraXShiftForShortLyricsWidthThreshold=1.4,this.LyricsUseXPaddingForLongLyrics=!0,this.LyricsXPaddingFactorForLongLyrics=1,this.LyricsXPaddingWidthThreshold=1.7,this.LyricsXPaddingReductionForLongNotes=.7,this.LyricsXPaddingReductionForLastNoteInMeasure=1.2,this.LyricsXPaddingForLastNoteInMeasure=!0,this.VerticalBetweenLyricsDistance=.5,this.HorizontalBetweenLyricsDistance=.2,this.BetweenSyllableMaximumDistance=10,this.BetweenSyllableMinimumDistance=.5,this.LyricOverlapAllowedIntoNextMeasure=3.4,this.MinimumDistanceBetweenDashes=10,this.MaximumLyricsElongationFactor=2.5,this.TempoYSpacing=.5,this.InstantaneousTempoTextHeight=2.3,this.ContinuousDynamicTextHeight=2.3,this.UseEndOffsetForExpressions=!0,this.MoodTextHeight=2.3,this.UnknownTextHeight=2,this.ContinuousTempoTextHeight=2.3,this.DynamicExpressionMaxDistance=2,this.DynamicExpressionSpacer=.5,this.IgnoreRepeatedDynamics=!1,this.ExpressionsUseXMLColor=!0,this.VexFlowDefaultNotationFontScale=39,this.VexFlowDefaultTabFontScale=39,this.TremoloStrokeScale=1,this.TremoloYSpacingScale=1,this.TremoloBuzzRollThickness=.25,this.StemWidth=.15,this.StaffLineWidth=.1,this.StaffLineColor=void 0,this.LedgerLineWidth=1,this.LedgerLineStrokeStyle=void 0,this.LedgerLineColorDefault="#000000",this.WedgeLineWidth=.12,this.TupletLineWidth=.12,this.LyricUnderscoreLineWidth=.12,this.SystemThinLineWidth=.12,this.SystemBoldLineWidth=p.unit/2,this.SystemRepetitionEndingLineWidth=.12,this.SystemDotWidth=p.unit/2,this.DistanceBetweenVerticalSystemLines=.35,this.DistanceBetweenDotAndLine=.7,this.RepeatEndStartPadding=2,this.OctaveShiftLineWidth=.12,this.OctaveShiftVerticalLineLength=p.unit,this.OctaveShiftOnWholeMeasureNoteUntilEndOfMeasure=!1,this.GraceLineWidth=this.StaffLineWidth*this.GraceNoteScalingFactor,this.MultipleRestMeasureDefaultWidth=4,this.MultipleRestMeasureAddKeySignature=!0,this.FixedMeasureWidth=!1,this.FixedMeasureWidthFixedValue=void 0,this.FixedMeasureWidthUseForPickupMeasures=!1,this.MinimumCrossedBeamDifferenceMargin=1e-4,this.SheetMaximumWidth=32767,this.VoiceSpacingMultiplierVexflow=.85,this.VoiceSpacingAddendVexflow=3,this.PickupMeasureWidthMultiplier=1,this.PickupMeasureRepetitionSpacing=.8,this.PickupMeasureSpacingSingleNoteAddend=1.6,this.DisplacedNoteMargin=.1,this.MinNoteDistance=2,this.SubMeasureXSpacingThreshold=35,this.MeasureDynamicsMaxScalingFactor=2.5,this.WholeRestXShiftVexflow=-1.5,this.MetronomeMarksDrawn=!0,this.MetronomeMarkXShift=-6,this.MetronomeMarkYShift=-1,this.SoftmaxFactorVexFlow=15,this.StaggerSameWholeNotes=!0,this.AlignRests=l.AlignRestOption.Never,this.RestCollisionYPadding=0,this.FillEmptyMeasuresWithWholeRest=l.FillEmptyMeasuresWithWholeRests.No,this.ArpeggiosGoAcrossVoices=!1,this.RenderArpeggios=!0,this.RenderSlurs=!0,this.RenderGlissandi=!0,this.ColoringMode=u.ColoringModes.XML,this.ColoringEnabled=!0,this.ColorStemsLikeNoteheads=!1,this.ColorBeams=!0,this.ColorFlags=!0,this.applyDefaultColorMusic("#000000"),this.DefaultColorCursor="#33e02f",this.DefaultFontFamily="Times New Roman",this.DefaultFontStyle=h.FontStyles.Regular,this.DefaultVexFlowNoteFont="gonville",this.MaxMeasureToDrawIndex=Number.MAX_VALUE,this.MaxMeasureToDrawNumber=Number.MAX_VALUE,this.MinMeasureToDrawIndex=0,this.MinMeasureToDrawNumber=0,this.MaxSystemToDrawNumber=Number.MAX_VALUE,this.MaxPageToDrawNumber=Number.MAX_VALUE,this.RenderComposer=!0,this.RenderTitle=!0,this.RenderSubtitle=!0,this.RenderLyricist=!0,this.RenderCopyright=!1,this.RenderPartNames=!0,this.RenderPartAbbreviations=!0,this.RenderSystemLabelsAfterFirstPage=!0,this.RenderFingerings=!0,this.RenderMeasureNumbers=!0,this.RenderMeasureNumbersOnlyAtSystemStart=!1,this.UseXMLMeasureNumbers=!0,this.RenderLyrics=!0,this.RenderChordSymbols=!0,this.RenderMultipleRestMeasures=!0,this.AutoGenerateMultipleRestMeasuresFromRestMeasures=!0,this.RenderRehearsalMarks=!0,this.RenderClefsAtBeginningOfStaffline=!0,this.RenderKeySignatures=!0,this.RenderTimeSignatures=!0,this.RenderPedals=!0,this.ArticulationPlacementFromXML=!0,this.BreathMarkDistance=.8,this.FingeringPosition=a.PlacementEnum.AboveOrBelow,this.FingeringPositionFromXML=!0,this.FingeringPositionGrace=a.PlacementEnum.Left,this.FingeringInsideStafflines=!1,this.FingeringLabelFontHeight=1.7,this.FingeringOffsetX=0,this.FingeringOffsetY=0,this.FingeringPaddingY=-.2,this.FingeringTextSize=1.5,this.RenderStringNumbersClassical=!0,this.StringNumberOffsetY=0,this.NewSystemAtXMLNewSystemAttribute=!1,this.NewPageAtXMLNewPageAttribute=!1,this.NewSystemAtXMLNewPageAttribute=!1,this.RenderXMeasuresPerLineAkaSystem=0,this.RestoreCursorAfterRerender=!0,this.StretchLastSystemLine=!1,this.IgnoreBracketsWords=!0,this.PlaceWordsInsideStafflineFromXml=!1,this.PlaceWordsInsideStafflineYOffset=.9,this.PageFormat=S.UndefinedPageFormat,this.PageBackgroundColor=void 0,this.DarkModeEnabled=!1,this.UsePageBackgroundColorForTabNotes=!0,this.RenderSingleHorizontalStaffline=!1,this.SpacingBetweenTextLines=0,this.NoteToGraphicalNoteMap=new c.Dictionary,this.NoteToGraphicalNoteMapObjectCount=0,this.SkyBottomLineBatchMinMeasures=5,this.SkyBottomLineWebGLMinMeasures=80,this.AlwaysSetPreferredSkyBottomLineBackendAutomatically=!0,this.DisableWebGLInFirefox=!0,this.DisableWebGLInSafariAndIOS=!0,this.setPreferredSkyBottomLineBackendAutomatically();try{this.MaxInstructionsConstValue=this.ClefLeftMargin+this.ClefRightMargin+this.KeyRightMargin+this.RhythmRightMargin+11}catch(e){r.default.info("EngravingRules()",e)}}setPreferredSkyBottomLineBackendAutomatically(e=-1){let t="",i="";"object"==typeof globalThis&&(t=globalThis.navigator?.vendor??"",i=globalThis.navigator?.userAgent??"");let s=!1;(this.DisableWebGLInSafariAndIOS&&/apple/i.test(t)||this.DisableWebGLInFirefox&&i.includes("Firefox"))&&(s=!0),this.PreferredSkyBottomLineBatchCalculatorBackend=l.SkyBottomLineBatchCalculatorBackendType.Plain,s||e>=this.SkyBottomLineWebGLMinMeasures&&(this.PreferredSkyBottomLineBatchCalculatorBackend=l.SkyBottomLineBatchCalculatorBackendType.WebGL)}applyDefaultColorMusic(e){this.DefaultColorMusic=e,this.DefaultColorNotehead=e,this.DefaultColorRest=e,this.DefaultColorStem=e,this.DefaultColorLabel=e,this.DefaultColorLyrics=e,this.DefaultColorTitle=e,this.LedgerLineColorDefault=e}addGraphicalNoteToNoteMap(e,t){e.NoteToGraphicalNoteObjectId=this.NoteToGraphicalNoteMapObjectCount,this.NoteToGraphicalNoteMap.setValue(e.NoteToGraphicalNoteObjectId,t),this.NoteToGraphicalNoteMapObjectCount++}GNote(e){return f.GraphicalNote.FromNote(e,this)}clearMusicSheetObjects(){this.NoteToGraphicalNoteMap=new c.Dictionary,this.NoteToGraphicalNoteMapObjectCount=0}resetChordAccidentalTexts(e,t){e.setValue(d.AccidentalEnum.SHARP,t?"♯":"#"),e.setValue(d.AccidentalEnum.FLAT,t?"♭":"b"),e.setValue(d.AccidentalEnum.DOUBLEFLAT,t?"𝄫":"bb"),e.setValue(d.AccidentalEnum.DOUBLESHARP,t?"𝄪":"x")}setChordSymbolLabelText(e,t){this.ChordSymbolLabelTexts.setValue(e,t)}resetChordSymbolLabelTexts(e){return e.setValue(m.ChordSymbolEnum.minor,"m"),e.setValue(m.ChordSymbolEnum.augmented,"aug"),e.setValue(m.ChordSymbolEnum.diminished,"dim"),e.setValue(m.ChordSymbolEnum.dominant,"7"),e.setValue(m.ChordSymbolEnum.majorseventh,"maj7"),e.setValue(m.ChordSymbolEnum.minorseventh,"m7"),e.setValue(m.ChordSymbolEnum.diminishedseventh,"dim7"),e.setValue(m.ChordSymbolEnum.augmentedseventh,"aug7"),e.setValue(m.ChordSymbolEnum.halfdiminished,`m7${this.ChordAccidentalTexts.getValue(d.AccidentalEnum.FLAT)}5`),e.setValue(m.ChordSymbolEnum.majorminor,"m(maj7)"),e.setValue(m.ChordSymbolEnum.majorsixth,"maj6"),e.setValue(m.ChordSymbolEnum.minorsixth,"m6"),e.setValue(m.ChordSymbolEnum.dominantninth,"9"),e.setValue(m.ChordSymbolEnum.majorninth,"maj9"),e.setValue(m.ChordSymbolEnum.minorninth,"m9"),e.setValue(m.ChordSymbolEnum.dominant11th,"11"),e.setValue(m.ChordSymbolEnum.major11th,"maj11"),e.setValue(m.ChordSymbolEnum.minor11th,"m11"),e.setValue(m.ChordSymbolEnum.dominant13th,"13"),e.setValue(m.ChordSymbolEnum.major13th,"maj13"),e.setValue(m.ChordSymbolEnum.minor13th,"m13"),e.setValue(m.ChordSymbolEnum.suspendedsecond,"sus2"),e.setValue(m.ChordSymbolEnum.suspendedfourth,"sus4"),e.setValue(m.ChordSymbolEnum.power,"5"),e.setValue(m.ChordSymbolEnum.none,"N.C."),e}addChordName(e,t,i,s,n){if(void 0!==m.ChordSymbolEnum[t]){const r={adds:i,alts:s,subs:n};this.CustomChords.push(m.CustomChord.createCustomChord(e,m.ChordSymbolEnum[t],r))}}renameChord(e,t){m.CustomChord.renameCustomChord(e,t,this.CustomChords)}resetChordNames(){const e=this.ChordAccidentalTexts.getValue(d.AccidentalEnum.SHARP),t=this.ChordAccidentalTexts.getValue(d.AccidentalEnum.FLAT);this.addChordName("alt","major",[`${e}5`,`${t}9`,`${e}9`],[`${t}5`],[]),this.addChordName("7alt","dominant",[`${e}5`,`${t}9`,`${e}9`],[`${t}5`],[]),this.addChordName("7sus4","dominant",["4"],[],["3"]),this.addChordName("7sus4","suspendedfourth",["7"],[],[]),this.addChordName("9sus4","dominantninth",["4"],[],["3"]),this.addChordName("9sus4","suspendedfourth",["9"],[],[]),this.addChordName("11sus4","dominant11th",["4"],[],["3"]),this.addChordName("11sus4","suspendedfourth",["11"],[],[]),this.addChordName("13sus4","dominant13th",["4"],[],["3"]),this.addChordName("13sus4","suspendedfourth",["13"],[],[]),this.addChordName("7sus2","dominant",["2"],[],["3"]),this.addChordName("7sus2","suspendedsecond",["7"],[],[]),this.addChordName(`m7${t}5`,"minorseventh",[],[`${t}5`],[]),this.addChordName("9sus2","dominantninth",["2"],[],["3"]),this.addChordName("9sus2","suspendedsecond",["9"],[],[]),this.addChordName("11sus2","dominant11th",["2"],[],["3"]),this.addChordName("11sus2","suspendedsecond",["11"],[],[]),this.addChordName("13sus2","dominant13th",["2"],[],["3"]),this.addChordName("13sus2","suspendedsecond",["13"],[],[]),this.addChordName("m(maj9)","majorminor",["9"],[],[]),this.addChordName("m(maj11)","majorminor",["11"],[],[]),this.addChordName("m(maj13)","majorminor",["13"],[],[]),this.addChordName("69","majorsixth",["9"],[],[]),this.addChordName("mi69","minorsixth",["9"],[],[])}calculateCurveParametersArrays(){this.TPower3=new Array(this.BezierCurveStepSize),this.OneMinusTPower3=new Array(this.BezierCurveStepSize),this.FactorOne=new Array(this.BezierCurveStepSize),this.FactorTwo=new Array(this.BezierCurveStepSize);for(let e=0;e<this.BezierCurveStepSize;e++){const t=e/this.BezierCurveStepSize;this.TPower3[e]=Math.pow(t,3),this.OneMinusTPower3[e]=Math.pow(1-t,3),this.FactorOne[e]=3*Math.pow(1-t,2)*t,this.FactorTwo[e]=3*(1-t)*Math.pow(t,2)}}}t.EngravingRules=p,p.unit=1;class S{constructor(e,t,i="noIdStringGiven"){this.width=e,this.height=t,this.idString=i}get aspectRatio(){return this.IsUndefined?0:this.width/this.height}get IsUndefined(){return void 0===this.width||void 0===this.height||0===this.height||0===this.width}static get UndefinedPageFormat(){return new S(0,0)}Equals(e){return!!e&&e.width===this.width&&e.height===this.height}}t.PageFormat=S},9719:(e,t,i)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.ChordSymbolEnum=t.ChordDegreeText=t.CustomChord=t.Degree=t.ChordSymbolContainer=void 0;const s=i(8233),n=i(7921),r=i(8233),o=i(6362);t.ChordSymbolContainer=class{constructor(e,t,i,s,n,r=o.PlacementEnum.Above){this.rootPitch=e,this.chordKind=t,this.bassPitch=i,this.degrees=s,this.rules=n,this.Placement=r}get RootPitch(){return this.rootPitch}get ChordKind(){return this.chordKind}get BassPitch(){return this.bassPitch}get ChordDegrees(){return this.degrees}static calculateChordText(e,t,i){if(void 0!==e.NumeralText)return e.NumeralText;let o=e.RootPitch;if(n.MusicSheetCalculator.transposeCalculator&&(o=n.MusicSheetCalculator.transposeCalculator.transposePitch(e.RootPitch,i,t)),e.ChordKind===u.none)return e.getTextFromChordKindEnum(e.ChordKind);let a=s.Pitch.getNoteEnumString(o.FundamentalNote);o.Accidental!==r.AccidentalEnum.NONE&&(a+=e.getTextForAccidental(o.Accidental));const c={adds:[],alts:[],subs:[]};for(const t of e.ChordDegrees)if(t){let i="";switch(t.alteration!==r.AccidentalEnum.NONE&&(i+=e.getTextForAccidental(t.alteration)),i+=t.value,t.text){case l.add:c.adds.push(i);break;case l.alter:c.alts.push(i);break;case l.subtract:c.subs.push(i)}}let h=e.getTextFromChordKindEnum(e.ChordKind);const d=["adds","alts","subs"],m=e.rules.CustomChords;for(const t of m){if(t.chordKind!==e.chordKind)continue;let i=!0;for(const e of d){for(const s of t.degrees[e]||[])if(c[e].indexOf(s)<0){i=!1;break}if(!i)break}if(i){for(const e of d)for(const i of t.degrees[e]||[])c[e].splice(c[e].indexOf(i),1);h=t.alternateName}}if(a+=h,c.adds.length>0&&(a+="("+c.adds.join(",")+")"),c.alts.length>0&&(a+="(alt "+c.alts.join(",")+")"),c.subs.length>0&&(a+="(omit "+c.subs.join(",")+")"),e.BassPitch){let r=e.BassPitch;n.MusicSheetCalculator.transposeCalculator&&(r=n.MusicSheetCalculator.transposeCalculator.transposePitch(e.BassPitch,i,t)),a+="/",a+=s.Pitch.getNoteEnumString(r.FundamentalNote),a+=e.getTextForAccidental(r.Accidental)}return a}getTextForAccidental(e){const t=this.rules.ChordAccidentalTexts.getValue(e);return void 0!==t?t:""}getTextFromChordKindEnum(e){return this.rules.ChordSymbolLabelTexts.getValue(e)??""}},t.Degree=class{constructor(e,t,i){this.value=e,this.alteration=t,this.text=i}};class a{constructor(e,t,i){this.alternateName=e,this.chordKind=t,this.degrees=i}static createCustomChord(e,t,i){return new a(e,t,i)}static renameCustomChord(e,t,i){for(const s of i)s.alternateName===e&&(s.alternateName=t)}}var l,u;t.CustomChord=a,function(e){e[e.add=0]="add",e[e.alter=1]="alter",e[e.subtract=2]="subtract"}(l||(t.ChordDegreeText=l={})),function(e){e[e.major=0]="major",e[e.minor=1]="minor",e[e.augmented=2]="augmented",e[e.diminished=3]="diminished",e[e.dominant=4]="dominant",e[e.majorseventh=5]="majorseventh",e[e.minorseventh=6]="minorseventh",e[e.diminishedseventh=7]="diminishedseventh",e[e.augmentedseventh=8]="augmentedseventh",e[e.halfdiminished=9]="halfdiminished",e[e.majorminor=10]="majorminor",e[e.majorsixth=11]="majorsixth",e[e.minorsixth=12]="minorsixth",e[e.dominantninth=13]="dominantninth",e[e.majorninth=14]="majorninth",e[e.minorninth=15]="minorninth",e[e.dominant11th=16]="dominant11th",e[e.major11th=17]="major11th",e[e.minor11th=18]="minor11th",e[e.dominant13th=19]="dominant13th",e[e.major13th=20]="major13th",e[e.minor13th=21]="minor13th",e[e.suspendedsecond=22]="suspendedsecond",e[e.suspendedfourth=23]="suspendedfourth",e[e.Neapolitan=24]="Neapolitan",e[e.Italian=25]="Italian",e[e.French=26]="French",e[e.German=27]="German",e[e.pedal=28]="pedal",e[e.power=29]="power",e[e.Tristan=30]="Tristan",e[e.none=31]="none"}(u||(t.ChordSymbolEnum=u={}))},9735:function(e,t,i){var s=this&&this.__createBinding||(Object.create?function(e,t,i,s){void 0===s&&(s=i);var n=Object.getOwnPropertyDescriptor(t,i);n&&!("get"in n?!t.__esModule:n.writable||n.configurable)||(n={enumerable:!0,get:function(){return t[i]}}),Object.defineProperty(e,s,n)}:function(e,t,i,s){void 0===s&&(s=i),e[s]=t[i]}),n=this&&this.__exportStar||function(e,t){for(var i in e)"default"===i||Object.prototype.hasOwnProperty.call(t,i)||s(t,e,i)};Object.defineProperty(t,"__esModule",{value:!0}),n(i(2561),t),n(i(6904),t),n(i(8786),t),n(i(8705),t),n(i(8233),t),n(i(9409),t),n(i(200),t),n(i(6864),t)},9767:function(e,t,i){var s=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.DynamicEnum=t.InstantaneousDynamicExpression=void 0;const n=i(6362),r=i(6990),o=i(7307),a=s(i(3065)),l=i(3263);class u extends n.AbstractExpression{static staticConstructor(){u.dynamicToRelativeVolumeDict.setValue(c.ffffff,1),u.dynamicToRelativeVolumeDict.setValue(c.fffff,126/127),u.dynamicToRelativeVolumeDict.setValue(c.ffff,125/127),u.dynamicToRelativeVolumeDict.setValue(c.fff,124/127),u.dynamicToRelativeVolumeDict.setValue(c.ff,122/127),u.dynamicToRelativeVolumeDict.setValue(c.f,108/127),u.dynamicToRelativeVolumeDict.setValue(c.mf,76/127),u.dynamicToRelativeVolumeDict.setValue(c.sf,.5),u.dynamicToRelativeVolumeDict.setValue(c.sfp,.5),u.dynamicToRelativeVolumeDict.setValue(c.sfpp,.5),u.dynamicToRelativeVolumeDict.setValue(c.fp,.5),u.dynamicToRelativeVolumeDict.setValue(c.rf,.5),u.dynamicToRelativeVolumeDict.setValue(c.rfz,.5),u.dynamicToRelativeVolumeDict.setValue(c.sfz,.5),u.dynamicToRelativeVolumeDict.setValue(c.sffz,.5),u.dynamicToRelativeVolumeDict.setValue(c.fz,.5),u.dynamicToRelativeVolumeDict.setValue(c.mp,60/127),u.dynamicToRelativeVolumeDict.setValue(c.p,28/127),u.dynamicToRelativeVolumeDict.setValue(c.pp,12/127),u.dynamicToRelativeVolumeDict.setValue(c.ppp,10/127),u.dynamicToRelativeVolumeDict.setValue(c.pppp,7/127),u.dynamicToRelativeVolumeDict.setValue(c.ppppp,5/127),u.dynamicToRelativeVolumeDict.setValue(c.pppppp,4/127)}constructor(e,t,i,s,n){super(i),this.parentMeasure=n,this.dynamicEnum=c[e.toLowerCase()],this.soundDynamic=t,this.staffNumber=s}get ParentMultiExpression(){return this.multiExpression}set ParentMultiExpression(e){this.multiExpression=e}get DynEnum(){return this.dynamicEnum}set DynEnum(e){this.dynamicEnum=e}get SoundDynamic(){return this.soundDynamic}set SoundDynamic(e){this.soundDynamic=e}get Placement(){return this.placement}set Placement(e){this.placement=e}get StaffNumber(){return this.staffNumber}set StaffNumber(e){this.staffNumber=e}get Length(){return Math.abs(this.length)<1e-4&&(this.length=this.calculateLength()),this.length}get MidiVolume(){return 127*this.Volume}get Volume(){return u.dynamicToRelativeVolumeDict.getValue(this.dynamicEnum)}static isInputStringInstantaneousDynamic(e){return!!e&&u.isStringInStringList(u.listInstantaneousDynamics,e)}getDynamicExpressionSymbol(e){switch(e){case"p":return r.DynamicExpressionSymbolEnum.p;case"f":return r.DynamicExpressionSymbolEnum.f;case"s":return r.DynamicExpressionSymbolEnum.s;case"z":return r.DynamicExpressionSymbolEnum.z;case"m":return r.DynamicExpressionSymbolEnum.m;case"r":return r.DynamicExpressionSymbolEnum.r;default:throw new o.InvalidEnumArgumentException("unknown DynamicExpressionSymbolEnum: "+e)}}calculateLength(){return a.default.debug("[Andrea] instantaneousDynamicExpression: not implemented: calculateLength!"),0}}var c;t.InstantaneousDynamicExpression=u,u.dynamicToRelativeVolumeDict=new l.Dictionary,u.listInstantaneousDynamics=["pppppp","ppppp","pppp","ppp","pp","p","ffffff","fffff","ffff","fff","ff","f","mf","mp","sf","sff","sp","spp","fp","rf","rfz","sfz","sffz","fz"],function(e){e[e.pppppp=0]="pppppp",e[e.ppppp=1]="ppppp",e[e.pppp=2]="pppp",e[e.ppp=3]="ppp",e[e.pp=4]="pp",e[e.p=5]="p",e[e.mp=6]="mp",e[e.mf=7]="mf",e[e.f=8]="f",e[e.ff=9]="ff",e[e.fff=10]="fff",e[e.ffff=11]="ffff",e[e.fffff=12]="fffff",e[e.ffffff=13]="ffffff",e[e.sf=14]="sf",e[e.sff=15]="sff",e[e.sfp=16]="sfp",e[e.sfpp=17]="sfpp",e[e.fp=18]="fp",e[e.rf=19]="rf",e[e.rfz=20]="rfz",e[e.sfz=21]="sfz",e[e.sffz=22]="sffz",e[e.fz=23]="fz",e[e.other=24]="other"}(c||(t.DynamicEnum=c={})),u.staticConstructor()},9803:(e,t,i)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.MoodEnum=t.MoodExpression=void 0;const s=i(6362);class n extends s.AbstractExpression{constructor(e,t,i){super(t),this.label=e,this.staffNumber=i,this.setMoodType()}static isInputStringMood(e){return!!e&&(n.isStringInStringList(n.listMoodAffettuoso,e)||n.isStringInStringList(n.listMoodAgitato,e)||n.isStringInStringList(n.listMoodAnimato,e)||n.isStringInStringList(n.listMoodAppassionato,e)||n.isStringInStringList(n.listMoodBrillante,e)||n.isStringInStringList(n.listMoodCantabile,e)||n.isStringInStringList(n.listMoodDolce,e)||n.isStringInStringList(n.listMoodEnergico,e)||n.isStringInStringList(n.listMoodEroico,e)||n.isStringInStringList(n.listMoodEspressivo,e)||n.isStringInStringList(n.listMoodFurioso,e)||n.isStringInStringList(n.listMoodGiocoso,e)||n.isStringInStringList(n.listMoodGioioso,e)||n.isStringInStringList(n.listMoodGrandioso,e)||n.isStringInStringList(n.listMoodGrazioso,e)||n.isStringInStringList(n.listMoodLacrimoso,e)||n.isStringInStringList(n.listMoodLeggiero,e)||n.isStringInStringList(n.listMoodMaestoso,e)||n.isStringInStringList(n.listMoodMalinconico,e)||n.isStringInStringList(n.listMoodMarcato,e)||n.isStringInStringList(n.listMoodMarziale,e)||n.isStringInStringList(n.listMoodMesto,e)||n.isStringInStringList(n.listMoodMorendo,e)||n.isStringInStringList(n.listMoodNobilmente,e)||n.isStringInStringList(n.listMoodPatetico,e)||n.isStringInStringList(n.listMoodPesante,e)||n.isStringInStringList(n.listMoodSaltando,e)||n.isStringInStringList(n.listMoodSautille,e)||n.isStringInStringList(n.listMoodScherzando,e)||n.isStringInStringList(n.listMoodSostenuto,e)||n.isStringInStringList(n.listMoodSpiccato,e)||n.isStringInStringList(n.listMoodTenerezza,e)||n.isStringInStringList(n.listMoodTranquillamente,e)||n.isStringInStringList(n.listMoodTrionfante,e))}get Label(){return this.label}set Label(e){this.label=e}get Mood(){return this.moodType}set Mood(e){this.moodType=e}get StaffNumber(){return this.staffNumber}set StaffNumber(e){this.staffNumber=e}get Placement(){return this.placement}set Placement(e){this.placement=e}setMoodType(){n.isStringInStringList(n.listMoodAffettuoso,this.label)?this.moodType=r.Affettuoso:n.isStringInStringList(n.listMoodAgitato,this.label)?this.moodType=r.Agitato:n.isStringInStringList(n.listMoodAnimato,this.label)?this.moodType=r.Animato:n.isStringInStringList(n.listMoodAppassionato,this.label)?this.moodType=r.Appassionato:n.isStringInStringList(n.listMoodBrillante,this.label)?this.moodType=r.Brillante:n.isStringInStringList(n.listMoodCantabile,this.label)?this.moodType=r.Cantabile:n.isStringInStringList(n.listMoodDolce,this.label)?this.moodType=r.Dolce:n.isStringInStringList(n.listMoodEnergico,this.label)?this.moodType=r.Energico:n.isStringInStringList(n.listMoodEroico,this.label)?this.moodType=r.Eroico:n.isStringInStringList(n.listMoodEspressivo,this.label)?this.moodType=r.Espressivo:n.isStringInStringList(n.listMoodFurioso,this.label)?this.moodType=r.Furioso:n.isStringInStringList(n.listMoodGiocoso,this.label)?this.moodType=r.Giocoso:n.isStringInStringList(n.listMoodGioioso,this.label)?this.moodType=r.Gioioso:n.isStringInStringList(n.listMoodGrandioso,this.label)?this.moodType=r.Grandioso:n.isStringInStringList(n.listMoodGrazioso,this.label)?this.moodType=r.Grazioso:n.isStringInStringList(n.listMoodLacrimoso,this.label)?this.moodType=r.Lacrimoso:n.isStringInStringList(n.listMoodLeggiero,this.label)?this.moodType=r.Leggiero:n.isStringInStringList(n.listMoodMaestoso,this.label)?this.moodType=r.Maestoso:n.isStringInStringList(n.listMoodMalinconico,this.label)?this.moodType=r.Malinconico:n.isStringInStringList(n.listMoodMarcato,this.label)?this.moodType=r.Marcato:n.isStringInStringList(n.listMoodMarziale,this.label)?this.moodType=r.Marziale:n.isStringInStringList(n.listMoodMesto,this.label)?this.moodType=r.Mesto:n.isStringInStringList(n.listMoodMorendo,this.label)?this.moodType=r.Morendo:n.isStringInStringList(n.listMoodNobilmente,this.label)?this.moodType=r.Nobilmente:n.isStringInStringList(n.listMoodPatetico,this.label)?this.moodType=r.Patetico:n.isStringInStringList(n.listMoodPesante,this.label)?this.moodType=r.Pesante:n.isStringInStringList(n.listMoodSaltando,this.label)?this.moodType=r.Saltando:n.isStringInStringList(n.listMoodSautille,this.label)?this.moodType=r.Sautille:n.isStringInStringList(n.listMoodScherzando,this.label)?this.moodType=r.Scherzando:n.isStringInStringList(n.listMoodSostenuto,this.label)?this.moodType=r.Sostenuto:n.isStringInStringList(n.listMoodSpiccato,this.label)?this.moodType=r.Spiccato:n.isStringInStringList(n.listMoodTenerezza,this.label)?this.moodType=r.Tenerezza:n.isStringInStringList(n.listMoodTranquillamente,this.label)?this.moodType=r.Tranquillamente:n.isStringInStringList(n.listMoodTrionfante,this.label)&&(this.moodType=r.Trionfante)}}var r;t.MoodExpression=n,n.listMoodAffettuoso=["affettuoso"],n.listMoodAgitato=["agitato"],n.listMoodAppassionato=["appassionato"],n.listMoodAnimato=["animato","lively"],n.listMoodBrillante=["brillante"],n.listMoodCantabile=["cantabile"],n.listMoodDolce=["dolce"],n.listMoodEnergico=["energico"],n.listMoodEroico=["eroico"],n.listMoodEspressivo=["espressivo"],n.listMoodFurioso=["furioso"],n.listMoodGiocoso=["giocoso"],n.listMoodGioioso=["gioioso"],n.listMoodLacrimoso=["lacrimoso"],n.listMoodGrandioso=["grandioso"],n.listMoodGrazioso=["grazioso"],n.listMoodLeggiero=["leggiero"],n.listMoodMaestoso=["maestoso"],n.listMoodMalinconico=["malinconico"],n.listMoodMarcato=["marcato"],n.listMoodMarziale=["marziale"],n.listMoodMesto=["mesto"],n.listMoodMorendo=["morendo"],n.listMoodNobilmente=["nobilmente"],n.listMoodPatetico=["patetico"],n.listMoodPesante=["pesante"],n.listMoodSautille=["sautille"],n.listMoodSaltando=["saltando"],n.listMoodScherzando=["scherzando"],n.listMoodSostenuto=["sostenuto"],n.listMoodSpiccato=["spiccato"],n.listMoodTenerezza=["tenerezza"],n.listMoodTranquillamente=["tranquillamente"],n.listMoodTrionfante=["trionfante"],function(e){e[e.Affettuoso=0]="Affettuoso",e[e.Agitato=1]="Agitato",e[e.Appassionato=2]="Appassionato",e[e.Animato=3]="Animato",e[e.Brillante=4]="Brillante",e[e.Cantabile=5]="Cantabile",e[e.Dolce=6]="Dolce",e[e.Energico=7]="Energico",e[e.Eroico=8]="Eroico",e[e.Espressivo=9]="Espressivo",e[e.Furioso=10]="Furioso",e[e.Giocoso=11]="Giocoso",e[e.Gioioso=12]="Gioioso",e[e.Lacrimoso=13]="Lacrimoso",e[e.Grandioso=14]="Grandioso",e[e.Grazioso=15]="Grazioso",e[e.Leggiero=16]="Leggiero",e[e.Maestoso=17]="Maestoso",e[e.Malinconico=18]="Malinconico",e[e.Marcato=19]="Marcato",e[e.Marziale=20]="Marziale",e[e.Mesto=21]="Mesto",e[e.Morendo=22]="Morendo",e[e.Nobilmente=23]="Nobilmente",e[e.Patetico=24]="Patetico",e[e.Pesante=25]="Pesante",e[e.Sautille=26]="Sautille",e[e.Saltando=27]="Saltando",e[e.Scherzando=28]="Scherzando",e[e.Sostenuto=29]="Sostenuto",e[e.Spiccato=30]="Spiccato",e[e.Tenerezza=31]="Tenerezza",e[e.Tranquillamente=32]="Tranquillamente",e[e.Trionfante=33]="Trionfante",e[e.Vivace=34]="Vivace"}(r||(t.MoodEnum=r={}))},9834:function(e,t,i){var s=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.CanvasVexFlowBackend=void 0;var n=s(i(3206)).default.Flow;const r=i(1902),o=i(6014),a=i(624),l=i(1888);class u extends r.VexFlowBackend{constructor(e){super(),this.rules=e}getVexflowBackendType(){return n.Renderer.Backends.CANVAS}getOSMDBackendType(){return a.BackendType.Canvas}getCanvasSize(){return document.getElementById("osmdCanvasPage"+this.graphicalMusicPage.PageNumber)?.offsetHeight}initialize(e,t){this.zoom=t,this.canvas=document.createElement("canvas"),this.graphicalMusicPage||(this.graphicalMusicPage=new l.GraphicalMusicPage(void 0),this.graphicalMusicPage.PageNumber=1),this.canvas.id="osmdCanvasVexFlowBackendCanvas"+this.graphicalMusicPage.PageNumber,this.inner=document.createElement("div"),this.inner.id="osmdCanvasPage"+this.graphicalMusicPage.PageNumber,this.inner.style.position="relative",this.canvas.style.zIndex="0",this.inner.appendChild(this.canvas),e.appendChild(this.inner),this.renderer=new n.Renderer(this.canvas,this.getVexflowBackendType()),this.ctx=this.renderer.getContext()}initializeHeadless(e=300,t=300){this.graphicalMusicPage||(this.graphicalMusicPage=new l.GraphicalMusicPage(void 0),this.graphicalMusicPage.PageNumber=1),this.canvas=document.createElement("canvas"),this.canvas.width=e,this.canvas.height=t,this.renderer=new n.Renderer(this.canvas,this.getVexflowBackendType()),this.ctx=this.renderer.getContext()}getContext(){return this.ctx}free(){this.canvas&&(this.canvas.width=0,this.canvas.height=0,this.canvas.remove(),delete this.canvas,this.canvas=null)}clear(){this.ctx.clearRect(0,0,this.canvas.width,this.canvas.height),this.rules.PageBackgroundColor&&(this.ctx.save(),this.ctx.setFillStyle(this.rules.PageBackgroundColor),this.zoom=1,this.ctx.fillRect(0,0,this.canvas.width/this.zoom,this.canvas.height/this.zoom),this.ctx.restore())}scale(e){this.ctx.scale(e,e)}translate(e,t){this.CanvasRenderingCtx.translate(e,t)}renderText(e,t,i,s,n,r,a=void 0,l=void 0){const u=this.CanvasRenderingCtx.font;this.CanvasRenderingCtx.save(),this.CanvasRenderingCtx.font=o.VexFlowConverter.font(e,t,i,this.rules,l),this.CanvasRenderingCtx.fillStyle=a,this.CanvasRenderingCtx.strokeStyle=a,this.CanvasRenderingCtx.fillText(s,r.x,r.y+n),this.CanvasRenderingCtx.restore(),this.CanvasRenderingCtx.font=u}renderRectangle(e,t,i,s=1){const n=this.CanvasRenderingCtx.fillStyle;this.CanvasRenderingCtx.fillStyle=i||o.VexFlowConverter.style(t),this.CanvasRenderingCtx.globalAlpha=s,this.ctx.fillRect(e.x,e.y,e.width,e.height),this.CanvasRenderingCtx.fillStyle=n,this.CanvasRenderingCtx.globalAlpha=1}renderLine(e,t,i="#FF0000FF",s=2,n){const r=this.CanvasRenderingCtx.strokeStyle;this.CanvasRenderingCtx.strokeStyle=i,this.CanvasRenderingCtx.beginPath(),this.CanvasRenderingCtx.moveTo(e.x,e.y),this.CanvasRenderingCtx.lineTo(t.x,t.y),this.CanvasRenderingCtx.stroke(),this.CanvasRenderingCtx.strokeStyle=r}renderCurve(e){this.ctx.beginPath(),this.ctx.moveTo(e[0].x,e[0].y),this.ctx.bezierCurveTo(e[1].x,e[1].y,e[2].x,e[2].y,e[3].x,e[3].y),this.ctx.lineTo(e[7].x,e[7].y),this.ctx.bezierCurveTo(e[6].x,e[6].y,e[5].x,e[5].y,e[4].x,e[4].y),this.ctx.lineTo(e[0].x,e[0].y),this.ctx.closePath(),this.ctx.fill()}renderPath(e,t=!0,i){let s;this.ctx.beginPath();for(const t of e)s?this.ctx.lineTo(t.x,t.y):(this.ctx.moveTo(t.x,t.y),s=t);this.ctx.closePath(),t?this.ctx.fill():this.ctx.stroke()}get CanvasRenderingCtx(){return this.ctx.vexFlowCanvasContext}}t.CanvasVexFlowBackend=u}}]);